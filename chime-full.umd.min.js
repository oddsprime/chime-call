var ChimeSDK=(()=>{var CI=Object.create;var Wa=Object.defineProperty;var OI=Object.getOwnPropertyDescriptor;var EI=Object.getOwnPropertyNames;var AI=Object.getPrototypeOf,PI=Object.prototype.hasOwnProperty;var dl=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var MI=(n,t)=>()=>(n&&(t=n(n=0)),t);var g=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),RI=(n,t)=>{for(var e in t)Wa(n,e,{get:t[e],enumerable:!0})},Ey=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of EI(t))!PI.call(n,r)&&r!==e&&Wa(n,r,{get:()=>t[r],enumerable:!(i=OI(t,r))||i.enumerable});return n};var DI=(n,t,e)=>(e=n!=null?CI(AI(n)):{},Ey(t||!n||!n.__esModule?Wa(e,"default",{value:n,enumerable:!0}):e,n)),Ay=n=>Ey(Wa({},"__esModule",{value:!0}),n);var _i=g(ll=>{"use strict";Object.defineProperty(ll,"__esModule",{value:!0});var cl=class n{constructor(t){this.ids=new Set(t)}add(t){this.ids.add(t)}array(){return Array.from(this.ids.values()).sort((e,i)=>e-i)}contain(t){return this.ids.has(t)}forEach(t){this.ids.forEach(t)}empty(){return this.ids.size===0}size(){return this.ids.size}equal(t){if(!t)return this.ids.size===0;let e=this.array(),i=t.array();if(e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==i[r])return!1;return!0}clone(){return new n(this.array())}remove(t){this.ids.delete(t)}toJSON(){return this.array()}truncate(t){let e=this.array();return new n(e.splice(0,t))}};ll.default=cl});var $a=g(po=>{"use strict";var xI=po&&po.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(po,"__esModule",{value:!0});var ul=xI(_i()),za=class n{constructor(t){this.selfAttendeeId=t,this.reset()}reset(){this.optimalReceiveSet=new ul.default,this.subscribedReceiveSet=new ul.default,this.videoSources=void 0}updateIndex(t){this.videoIndex=t,this.optimalReceiveSet=this.calculateOptimalReceiveSet(t)}updateMetrics(t){}wantsResubscribe(){return!this.subscribedReceiveSet.equal(this.optimalReceiveSet)}chooseSubscriptions(){return this.subscribedReceiveSet=this.optimalReceiveSet.clone(),this.subscribedReceiveSet.clone()}chooseRemoteVideoSources(t){this.videoSources=t,this.optimalReceiveSet=this.calculateOptimalReceiveSet(this.videoIndex).clone()}calculateOptimalReceiveSet(t){let e=new ul.default;if(!this.videoIndex||this.videoIndex.allStreams().empty())return e;let i=t.highestQualityStreamFromEachGroupExcludingSelf(this.selfAttendeeId),r=this.videoSources?this.videoSources:this.videoIndex.allVideoSendingSourcesExcludingSelf(this.selfAttendeeId),o=this.videoIndex.remoteStreamDescriptions(),s=new Map;for(let l of o)i.contain(l.streamId)&&s.set(l.attendeeId,l);let d=0;for(let l of r){let c=l.attendee.attendeeId;if(s.has(c)){let a=s.get(c);if(d+a.maxBitrateKbps<=n.maxReceiveBitrateKbps)e.add(a.streamId),d+=a.maxBitrateKbps;else{console.warn("total bitrate "+(d+a.maxBitrateKbps)+" exceeds maximum limit (15000). Use chooseRemoteVideoSources to select a subset of participants to avoid this.");break}}}return e}};po.default=za;za.maxReceiveBitrateKbps=15e3});var Py=g(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});var fl=class n{constructor(t,e){this.appName=t,this.appVersion=e}static create(t,e){let i=/^[a-zA-Z0-9]+[a-zA-Z0-9_-]*[a-zA-Z0-9]+$/g;if(!t||t.length>32)throw new Error("appName should be a valid string and 1 to 32 characters in length");if(!i.test(t))throw new Error(`appName must satisfy ${i} regular expression`);let r=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/gm;if(!e||e.length>32)throw new Error("appVersion should be a valid string and 1 to 32 characters in length");if(!r.test(e))throw new Error("appVersion must satisfy Semantic Versioning format");return new n(t,e)}};hl.default=fl});var Qn=g(ml=>{"use strict";Object.defineProperty(ml,"__esModule",{value:!0});var pl=class{constructor(t){this.timeoutMs=t,this.timer=null}start(t){this.stop(),this.timer=setTimeout(()=>{clearTimeout(this.timer),t()},this.timeoutMs)}stop(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}};ml.default=pl});var Ve=g(mo=>{"use strict";var VI=mo&&mo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(mo,"__esModule",{value:!0});var NI=VI(Qn()),gl=class extends NI.default{constructor(){super(0)}static nextTick(t){setTimeout(t,0)}};mo.default=gl});var Ka=g(Xn=>{"use strict";Object.defineProperty(Xn,"__esModule",{value:!0});Xn.VideoLogEvent=void 0;var My;(function(n){n[n.InputAttached=0]="InputAttached",n[n.SendingFailed=1]="SendingFailed",n[n.SendingSuccess=2]="SendingSuccess"})(My=Xn.VideoLogEvent||(Xn.VideoLogEvent={}));Xn.default=My});var Ge=g(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});Zn.LogLevel=void 0;var Ry;(function(n){n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR",n[n.OFF=4]="OFF"})(Ry=Zn.LogLevel||(Zn.LogLevel={}));Zn.default=Ry});var Sl=g(go=>{"use strict";var xy=go&&go.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(go,"__esModule",{value:!0});var LI=xy(Ge()),Dy=xy(Ve()),vl=class{constructor(t,e,i){this.logger=t,this.task=e,this.dependencies=i,this.canceled=!1}name(){return`${this.task.name()} (once)`}cancel(){if(!this.canceled){if(this.dependencies)for(let t of this.dependencies)t.cancel();this.logger.info(`Canceling ${this.name()}`),Dy.default.nextTick(()=>this.task.cancel()),this.canceled=!0,this.cancelPromise&&Dy.default.nextTick(()=>this.cancelPromise(new Error(`canceling ${this.name()}`)))}}logDependencies(){if(this.logger.getLogLevel()>LI.default.INFO||!this.dependencies)return;let t=this.dependencies.filter(e=>e).map(e=>e.name()).join(", ");this.logger.info(`${this.task.name()} waiting for dependencies: ${t}`)}run(){if(this.promise)return this.promise;let t=this.dependencies?Promise.all(this.dependencies.map(e=>e?.run())):Promise.resolve();return this.logDependencies(),this.ongoing=t.then(()=>this.task.run()),this.promise=new Promise((e,i)=>{this.cancelPromise=i,this.ongoing.then(e).catch(i)})}setParent(t){this.task.setParent(t)}};go.default=vl});var Ga=g(bl=>{"use strict";Object.defineProperty(bl,"__esModule",{value:!0});var yl;(function(n){n.IDLE="IDLE",n.RUNNING="RUNNING",n.CANCELED="CANCELED",n.FINISHED="FINISHED"})(yl||(yl={}));bl.default=yl});var Z=g(wi=>{"use strict";var BI=wi&&wi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Vy=wi&&wi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(wi,"__esModule",{value:!0});var FI=Vy(Sl()),ut=Vy(Ga()),_l=class{constructor(t){this.logger=t,this.taskName="BaseTask",this.parentTask=null,this.status=ut.default.IDLE,this.run=this.baseRun.bind(this,this.run),this.cancel=this.baseCancel.bind(this,this.cancel)}once(...t){return new FI.default(this.logger,this,t)}cancel(){}name(){return this.parentTask?`${this.parentTask.name()}/${this.taskName}`:this.taskName}setParent(t){this.parentTask=t}getStatus(){return this.status}logAndThrow(t){throw this.logger.info(t),new Error(t)}baseRun(t){return BI(this,void 0,void 0,function*(){try{let e=Date.now();switch(this.logger.info(`running task ${this.name()}`),this.status){case ut.default.RUNNING:this.logAndThrow(`${this.name()} is already running`);case ut.default.CANCELED:this.logAndThrow(`${this.name()} was canceled before running`);case ut.default.FINISHED:this.logAndThrow(`${this.name()} was already finished`)}this.status=ut.default.RUNNING,yield t.call(this),this.logger.info(`${this.name()} took ${Math.round(Date.now()-e)} ms`)}catch(e){throw e}finally{this.status!==ut.default.CANCELED&&(this.status=ut.default.FINISHED)}})}baseCancel(t){if(this.status===ut.default.CANCELED||this.status===ut.default.FINISHED){this.logger.info(`Not canceling ${this.name()}: state is ${this.status}`);return}this.logger.info(`canceling task ${this.name()}`),this.status=ut.default.CANCELED,t.call(this)}};wi.default=_l});var Tl=g(Ti=>{"use strict";var UI=Ti&&Ti.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Ny=Ti&&Ti.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ti,"__esModule",{value:!0});var qI=Ny(Ka()),HI=Ny(Z()),wl=class extends HI.default{constructor(t){super(t.logger),this.context=t,this.taskName="AttachMediaInputTask"}run(){return UI(this,void 0,void 0,function*(){let t=this.context.transceiverController;t.setPeer(this.context.peer),t.setupLocalTransceivers();let e=this.context.activeAudioInput;if(e){let r=e.getAudioTracks();this.context.logger.info("attaching audio track to peer connection"),yield t.setAudioInput(r.length?r[0]:null)}else yield t.setAudioInput(null),this.context.logger.info("no audio track");this.setAudioCodecPreferences();let i=this.context.activeVideoInput;if(i){let r=i.getVideoTracks(),o=r.length?r[0]:null;if(this.context.logger.info("attaching video track to peer connection"),yield t.setVideoInput(o),this.context.enableSimulcast&&this.context.videoUplinkBandwidthPolicy){let s=this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters();t.setEncodingParameters(s)}o&&this.context.statsCollector.logVideoEvent(qI.default.InputAttached,this.context.videoDeviceInformation)}else yield t.setVideoInput(null),this.context.logger.info("no video track");this.context.videoSubscriptions=t.updateVideoTransceivers(this.context.videoStreamIndex,this.context.videosToReceive),this.context.videoStreamIndex.subscribeFrameSent()})}setAudioCodecPreferences(){let t=window.RTCRtpTransceiver&&"setCodecPreferences"in window.RTCRtpTransceiver.prototype,e=this.context.audioProfile.hasRedundancyEnabled();if(!t){this.context.logger.warn("Setting codec preferences not supported");return}let i=this.context.transceiverController.localAudioTransceiver(),{codecs:r}=RTCRtpSender.getCapabilities("audio");this.context.logger.debug(`Available audio codecs ${JSON.stringify(r,null,4)}`);let o=r.findIndex(s=>s.mimeType==="audio/red");if(!i){this.context.logger.error("audio transceiver is null");return}if(o>=0){let s=r[o];r.splice(o,1),e?(r.unshift(s),this.context.logger.info("audio/red set as preferred codec")):this.context.logger.info("audio/red removed from preferred codec"),i.setCodecPreferences(r);return}this.context.logger.info("audio/red codec not supported")}};Ti.default=wl});var Cl=g(Il=>{"use strict";Object.defineProperty(Il,"__esModule",{value:!0});var kl=class{};Il.default=kl});var Ja=g(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.AudioLogEvent=void 0;var Ly;(function(n){n[n.DeviceChanged=0]="DeviceChanged",n[n.MutedLocal=1]="MutedLocal",n[n.UnmutedLocal=2]="UnmutedLocal",n[n.Connected=3]="Connected",n[n.ConnectFailed=4]="ConnectFailed",n[n.RedmicStartLoss=5]="RedmicStartLoss",n[n.RedmicEndLoss=6]="RedmicEndLoss"})(Ly=Yn.AudioLogEvent||(Yn.AudioLogEvent={}));Yn.default=Ly});var Jy=g(ie=>{"use strict";var By=ie&&ie.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var i=0,r=t.length,o;i<r;i++)(o||!(i in t))&&(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return n.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(ie,"__esModule",{value:!0});ie.getNodeVersion=ie.detectOS=ie.parseUserAgent=ie.browserName=ie.detect=ie.ReactNativeInfo=ie.BotInfo=ie.SearchBotDeviceInfo=ie.NodeInfo=ie.BrowserInfo=void 0;var qy=(function(){function n(t,e,i){this.name=t,this.version=e,this.os=i,this.type="browser"}return n})();ie.BrowserInfo=qy;var Hy=(function(){function n(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return n})();ie.NodeInfo=Hy;var jy=(function(){function n(t,e,i,r){this.name=t,this.version=e,this.os=i,this.bot=r,this.type="bot-device"}return n})();ie.SearchBotDeviceInfo=jy;var Wy=(function(){function n(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return n})();ie.BotInfo=Wy;var zy=(function(){function n(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return n})();ie.ReactNativeInfo=zy;var jI=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,WI=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Fy=3,zI=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",jI]],Uy=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function $I(n){return n?Ol(n):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new zy:typeof navigator<"u"?Ol(navigator.userAgent):Gy()}ie.detect=$I;function $y(n){return n!==""&&zI.reduce(function(t,e){var i=e[0],r=e[1];if(t)return t;var o=r.exec(n);return!!o&&[i,o]},!1)}function KI(n){var t=$y(n);return t?t[0]:null}ie.browserName=KI;function Ol(n){var t=$y(n);if(!t)return null;var e=t[0],i=t[1];if(e==="searchbot")return new Wy;var r=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);r?r.length<Fy&&(r=By(By([],r,!0),GI(Fy-r.length),!0)):r=[];var o=r.join("."),s=Ky(n),d=WI.exec(n);return d&&d[1]?new jy(e,o,s,d[1]):new qy(e,o,s)}ie.parseUserAgent=Ol;function Ky(n){for(var t=0,e=Uy.length;t<e;t++){var i=Uy[t],r=i[0],o=i[1],s=o.exec(n);if(s)return r}return null}ie.detectOS=Ky;function Gy(){var n=typeof process<"u"&&process.version;return n?new Hy(process.version.slice(1)):null}ie.getNodeVersion=Gy;function GI(n){for(var t=[],e=0;e<n;e++)t.push("0");return t}});var Xa=g((vo,Qa)=>{(function(n,t){"use strict";var e="1.0.41",i="",r="?",o="function",s="undefined",d="object",l="string",c="major",a="model",u="name",p="type",m="vendor",S="version",C="architecture",I="console",_="mobile",k="tablet",T="smarttv",w="wearable",D="embedded",L=500,O="Amazon",A="Apple",P="ASUS",V="BlackBerry",U="Browser",fe="Chrome",dt="Edge",It="Firefox",Ct="Google",gy="Honor",vy="Huawei",wI="Lenovo",qa="LG",el="Microsoft",tl="Motorola",il="Nvidia",Sy="OnePlus",ao="Opera",nl="OPPO",co="Samsung",yy="Sharp",lo="Sony",rl="Xiaomi",ol="Zebra",by="Facebook",_y="Chromium OS",wy="Mac OS",Ty=" Browser",TI=function(z,G){var H={};for(var ee in z)G[ee]&&G[ee].length%2===0?H[ee]=G[ee].concat(z[ee]):H[ee]=z[ee];return H},Ha=function(z){for(var G={},H=0;H<z.length;H++)G[z[H].toUpperCase()]=z[H];return G},ky=function(z,G){return typeof z===l?uo(G).indexOf(uo(z))!==-1:!1},uo=function(z){return z.toLowerCase()},kI=function(z){return typeof z===l?z.replace(/[^\d\.]/g,i).split(".")[0]:t},sl=function(z,G){if(typeof z===l)return z=z.replace(/^\s\s*/,i),typeof G===s?z:z.substring(0,L)},fo=function(z,G){for(var H=0,ee,Ot,ct,Q,q,lt;H<G.length&&!q;){var al=G[H],Oy=G[H+1];for(ee=Ot=0;ee<al.length&&!q&&al[ee];)if(q=al[ee++].exec(z),q)for(ct=0;ct<Oy.length;ct++)lt=q[++Ot],Q=Oy[ct],typeof Q===d&&Q.length>0?Q.length===2?typeof Q[1]==o?this[Q[0]]=Q[1].call(this,lt):this[Q[0]]=Q[1]:Q.length===3?typeof Q[1]===o&&!(Q[1].exec&&Q[1].test)?this[Q[0]]=lt?Q[1].call(this,lt,Q[2]):t:this[Q[0]]=lt?lt.replace(Q[1],Q[2]):t:Q.length===4&&(this[Q[0]]=lt?Q[3].call(this,lt.replace(Q[1],Q[2])):t):this[Q]=lt||t;H+=2}},ho=function(z,G){for(var H in G)if(typeof G[H]===d&&G[H].length>0){for(var ee=0;ee<G[H].length;ee++)if(ky(G[H][ee],z))return H===r?t:H}else if(ky(G[H],z))return H===r?t:H;return G.hasOwnProperty("*")?G["*"]:z},II={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Iy={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Cy={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,S],[/opios[\/ ]+([\w\.]+)/i],[S,[u,ao+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[S,[u,ao+" GX"]],[/\bopr\/([\w\.]+)/i],[S,[u,ao]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[S,[u,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[S,[u,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[u,S],[/quark(?:pc)?\/([-\w\.]+)/i],[S,[u,"Quark"]],[/\bddg\/([\w\.]+)/i],[S,[u,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[u,"UC"+U]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[S,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[u,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[S,[u,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[S,[u,"Smart Lenovo "+U]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+U],S],[/\bfocus\/([\w\.]+)/i],[S,[u,It+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[u,ao+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[u,ao+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[u,"MIUI"+Ty]],[/fxios\/([\w\.-]+)/i],[S,[u,It]],[/\bqihoobrowser\/?([\w\.]*)/i],[S,[u,"360"]],[/\b(qq)\/([\w\.]+)/i],[[u,/(.+)/,"$1Browser"],S],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1"+Ty],S],[/samsungbrowser\/([\w\.]+)/i],[S,[u,co+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[S,[u,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[u,"Sogou Mobile"],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[u,S],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[u],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[S,u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,by],S],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[u,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[u,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[S,[u,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[u,fe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,fe+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[u,"Android "+U]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[S,ho,II]],[/(webkit|khtml)\/([\w\.]+)/i],[u,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],S],[/(wolvic|librewolf)\/([\w\.]+)/i],[u,S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[u,It+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[u,[S,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[u,[S,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[C,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[C,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[C,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[C,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[C,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[C,/ower/,i,uo]],[/ sun4\w[;\)]/i],[[C,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[C,uo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a,[m,co],[p,k]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[a,[m,co],[p,_]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[a,[m,A],[p,_]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a,[m,A],[p,k]],[/(macintosh);/i],[a,[m,A]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a,[m,yy],[p,_]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[a,[m,gy],[p,k]],[/honor([-\w ]+)[;\)]/i],[a,[m,gy],[p,_]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[a,[m,vy],[p,k]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a,[m,vy],[p,_]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[a,/_/g," "],[m,rl],[p,k]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[a,/_/g," "],[m,rl],[p,_]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a,[m,nl],[p,_]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[a,[m,ho,{OnePlus:["304","403","203"],"*":nl}],[p,k]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a,[m,"Vivo"],[p,_]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[a,[m,"Realme"],[p,_]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a,[m,tl],[p,_]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a,[m,tl],[p,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a,[m,qa],[p,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[a,[m,qa],[p,_]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[a,[m,wI],[p,k]],[/(nokia) (t[12][01])/i],[m,a,[p,k]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[a,/_/g," "],[p,_],[m,"Nokia"]],[/(pixel (c|tablet))\b/i],[a,[m,Ct],[p,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a,[m,Ct],[p,_]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a,[m,lo],[p,_]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a,"Xperia Tablet"],[m,lo],[p,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a,[m,Sy],[p,_]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a,[m,O],[p,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a,/(.+)/g,"Fire Phone $1"],[m,O],[p,_]],[/(playbook);[-\w\),; ]+(rim)/i],[a,m,[p,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a,[m,V],[p,_]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a,[m,P],[p,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a,[m,P],[p,_]],[/(nexus 9)/i],[a,[m,"HTC"],[p,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[a,/_/g," "],[p,_]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[a,[m,"TCL"],[p,k]],[/(itel) ((\w+))/i],[[m,uo],a,[p,ho,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a,[m,"Acer"],[p,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a,[m,"Meizu"],[p,_]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[a,[m,"Ulefone"],[p,_]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[a,[m,"Energizer"],[p,_]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[a,[m,"Cat"],[p,_]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[a,[m,"Smartfren"],[p,_]],[/droid.+; (a(?:015|06[35]|142p?))/i],[a,[m,"Nothing"],[p,_]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[a,[m,"Archos"],[p,k]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[a,[m,"Archos"],[p,_]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[m,a,[p,k]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[m,a,[p,_]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,a,[p,k]],[/(surface duo)/i],[a,[m,el],[p,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a,[m,"Fairphone"],[p,_]],[/(u304aa)/i],[a,[m,"AT&T"],[p,_]],[/\bsie-(\w*)/i],[a,[m,"Siemens"],[p,_]],[/\b(rct\w+) b/i],[a,[m,"RCA"],[p,k]],[/\b(venue[\d ]{2,7}) b/i],[a,[m,"Dell"],[p,k]],[/\b(q(?:mv|ta)\w+) b/i],[a,[m,"Verizon"],[p,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a,[m,"Barnes & Noble"],[p,k]],[/\b(tm\d{3}\w+) b/i],[a,[m,"NuVision"],[p,k]],[/\b(k88) b/i],[a,[m,"ZTE"],[p,k]],[/\b(nx\d{3}j) b/i],[a,[m,"ZTE"],[p,_]],[/\b(gen\d{3}) b.+49h/i],[a,[m,"Swiss"],[p,_]],[/\b(zur\d{3}) b/i],[a,[m,"Swiss"],[p,k]],[/\b((zeki)?tb.*\b) b/i],[a,[m,"Zeki"],[p,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],a,[p,k]],[/\b(ns-?\w{0,9}) b/i],[a,[m,"Insignia"],[p,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[a,[m,"NextBook"],[p,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],a,[p,_]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],a,[p,_]],[/\b(ph-1) /i],[a,[m,"Essential"],[p,_]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a,[m,"Envizen"],[p,k]],[/\b(trio[-\w\. ]+) b/i],[a,[m,"MachSpeed"],[p,k]],[/\btu_(1491) b/i],[a,[m,"Rotor"],[p,k]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[a,[m,il],[p,k]],[/(sprint) (\w+)/i],[m,a,[p,_]],[/(kin\.[onetw]{3})/i],[[a,/\./g," "],[m,el],[p,_]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a,[m,ol],[p,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a,[m,ol],[p,_]],[/smart-tv.+(samsung)/i],[m,[p,T]],[/hbbtv.+maple;(\d+)/i],[[a,/^/,"SmartTV"],[m,co],[p,T]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,qa],[p,T]],[/(apple) ?tv/i],[m,[a,A+" TV"],[p,T]],[/crkey/i],[[a,fe+"cast"],[m,Ct],[p,T]],[/droid.+aft(\w+)( bui|\))/i],[a,[m,O],[p,T]],[/(shield \w+ tv)/i],[a,[m,il],[p,T]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a,[m,yy],[p,T]],[/(bravia[\w ]+)( bui|\))/i],[a,[m,lo],[p,T]],[/(mi(tv|box)-?\w+) bui/i],[a,[m,rl],[p,T]],[/Hbbtv.*(technisat) (.*);/i],[m,a,[p,T]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,sl],[a,sl],[p,T]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[a,[p,T]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,T]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,a,[p,I]],[/droid.+; (shield)( bui|\))/i],[a,[m,il],[p,I]],[/(playstation \w+)/i],[a,[m,lo],[p,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a,[m,el],[p,I]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[a,[m,co],[p,w]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[m,a,[p,w]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[a,[m,nl],[p,w]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a,[m,A],[p,w]],[/(opwwe\d{3})/i],[a,[m,Sy],[p,w]],[/(moto 360)/i],[a,[m,tl],[p,w]],[/(smartwatch 3)/i],[a,[m,lo],[p,w]],[/(g watch r)/i],[a,[m,qa],[p,w]],[/droid.+; (wt63?0{2,3})\)/i],[a,[m,ol],[p,w]],[/droid.+; (glass) \d/i],[a,[m,Ct],[p,w]],[/(pico) (4|neo3(?: link|pro)?)/i],[m,a,[p,w]],[/; (quest( \d| pro)?)/i],[a,[m,by],[p,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[p,D]],[/(aeobc)\b/i],[a,[m,O],[p,D]],[/(homepod).+mac os/i],[a,[m,A],[p,D]],[/windows iot/i],[[p,D]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[a,[p,_]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a,[p,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,_]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[a,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[u,dt+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[u,S],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[u,S],[/ladybird\//i],[[u,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,S],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[u,[S,ho,Iy]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,ho,Iy],[u,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,wy],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,u],[/(ubuntu) ([\w\.]+) like android/i],[[u,/(.+)/,"$1 Touch"],S],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[u,S],[/\(bb(10);/i],[S,[u,V]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[S,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[u,It+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[u,fe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,_y],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,S],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[u,S]]},Ee=function(z,G){if(typeof z===d&&(G=z,z=t),!(this instanceof Ee))return new Ee(z,G).getResult();var H=typeof n!==s&&n.navigator?n.navigator:t,ee=z||(H&&H.userAgent?H.userAgent:i),Ot=H&&H.userAgentData?H.userAgentData:t,ct=G?TI(Cy,G):Cy,Q=H&&H.userAgent==ee;return this.getBrowser=function(){var q={};return q[u]=t,q[S]=t,fo.call(q,ee,ct.browser),q[c]=kI(q[S]),Q&&H&&H.brave&&typeof H.brave.isBrave==o&&(q[u]="Brave"),q},this.getCPU=function(){var q={};return q[C]=t,fo.call(q,ee,ct.cpu),q},this.getDevice=function(){var q={};return q[m]=t,q[a]=t,q[p]=t,fo.call(q,ee,ct.device),Q&&!q[p]&&Ot&&Ot.mobile&&(q[p]=_),Q&&q[a]=="Macintosh"&&H&&typeof H.standalone!==s&&H.maxTouchPoints&&H.maxTouchPoints>2&&(q[a]="iPad",q[p]=k),q},this.getEngine=function(){var q={};return q[u]=t,q[S]=t,fo.call(q,ee,ct.engine),q},this.getOS=function(){var q={};return q[u]=t,q[S]=t,fo.call(q,ee,ct.os),Q&&!q[u]&&Ot&&Ot.platform&&Ot.platform!="Unknown"&&(q[u]=Ot.platform.replace(/chrome os/i,_y).replace(/macos/i,wy)),q},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ee},this.setUA=function(q){return ee=typeof q===l&&q.length>L?sl(q,L):q,this},this.setUA(ee),this};Ee.VERSION=e,Ee.BROWSER=Ha([u,S,c]),Ee.CPU=Ha([C]),Ee.DEVICE=Ha([a,m,p,I,_,T,k,w,D]),Ee.ENGINE=Ee.OS=Ha([u,S]),typeof vo!==s?(typeof Qa!==s&&Qa.exports&&(vo=Qa.exports=Ee),vo.UAParser=Ee):typeof define===o&&define.amd?define(function(){return Ee}):typeof n!==s&&(n.UAParser=Ee);var Jn=typeof n!==s&&(n.jQuery||n.Zepto);if(Jn&&!Jn.ua){var ja=new Ee;Jn.ua=ja.getResult(),Jn.ua.get=function(){return ja.getUA()},Jn.ua.set=function(z){ja.setUA(z);var G=ja.getResult();for(var H in G)Jn.ua[H]=G[H]}}})(typeof window=="object"?window:vo)});var pe=g(yo=>{"use strict";var JI=yo&&yo.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(yo,"__esModule",{value:!0});var QI=Jy(),XI=Xa(),So=class n{constructor(){this.FALLBACK_BROWSER={type:"browser",name:"unknown",version:"unknown",os:"unknown"},this.browser=QI.detect()||this.FALLBACK_BROWSER,this.uaParserResult=navigator&&navigator.userAgent?new XI.UAParser(navigator.userAgent).getResult():null,this.browserSupport={chrome:78,"edge-chromium":79,electron:7,firefox:75,ios:13,safari:13,opera:66,samsung:12,crios:86,fxios:23,"ios-webview":605,"chromium-webview":92},this.browserName={chrome:"Google Chrome","edge-chromium":"Microsoft Edge",electron:"Electron",firefox:"Mozilla Firefox",ios:"Safari iOS",safari:"Safari",opera:"Opera",samsung:"Samsung Internet",crios:"Chrome iOS",fxios:"Firefox iOS","ios-webview":"WKWebView iOS","chromium-webview":"Chrome WebView"},this.chromeLike=["chrome","edge-chromium","chromium-webview","opera","samsung"],this.webkitBrowsers=["crios","fxios","safari","ios","ios-webview","edge-ios"]}version(){return this.browser.version}majorVersion(){return this.version()!==null?parseInt(this.version().split(".")[0]):-1}osMajorVersion(){return parseInt(this.uaParserResult.os.version.split(".")[0])}engine(){return this.uaParserResult.engine.name}engineMajorVersion(){return parseInt(this.uaParserResult.engine.version.split(".")[0])}name(){return this.browser.name}hasChromiumWebRTC(){for(let t of this.chromeLike)if(t===this.browser.name)return!0;return!1}hasWebKitWebRTC(){for(let t of this.webkitBrowsers)if(t===this.browser.name)return!0;return!1}hasFirefoxWebRTC(){return this.isFirefox()}requiresPlaybackLatencyHintForAudioContext(){return navigator.userAgent.indexOf("Windows")!==-1}supportsCanvasCapturedStreamPlayback(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()&&!this.isIOSEdge()||this.isIOSSafari()&&this.majorVersion()>=n.MIN_IOS_SUPPORT_CANVAS_STREAM_PLAYBACK||this.majorVersion()>=n.MIN_IOS_NON_SAFARI_SUPPORT_CANVAS_STREAM_PLAYBACK}supportsBackgroundFilter(){return!(this.name()==="safari"&&this.majorVersion()===15||!this.supportsCanvasCapturedStreamPlayback())}supportsVideoLayersAllocationRtpHeaderExtension(){return this.hasChromiumWebRTC()}supportsDependencyDescriptorRtpHeaderExtension(){return this.hasChromiumWebRTC()}supportsScalableVideoCoding(){return this.hasChromiumWebRTC()&&this.engine()==="Blink"&&this.engineMajorVersion()>=111}supportsAudioRedundancy(){return this.hasChromiumWebRTC()?this.engineMajorVersion()>=107:!this.hasFirefoxWebRTC()}requiresResolutionAlignment(t,e){return this.isAndroid()&&this.isPixel3()?[Math.ceil(t/64)*64,Math.ceil(e/64)*64]:[t,e]}requiresCheckForSdpConnectionAttributes(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()}requiresIceCandidateGatheringTimeoutWorkaround(){return this.hasChromiumWebRTC()}requiresBundlePolicy(){return"max-bundle"}requiresNoExactMediaStreamConstraints(){return this.isSamsungInternet()}requiresGroupIdMediaStreamConstraints(){return this.isSamsungInternet()}getDisplayMediaAudioCaptureSupport(){return this.isChrome()||this.isEdge()}doesNotSupportMediaDeviceLabels(){return this.browser.name==="chromium-webview"}isSupported(){return!(!this.browserSupport[this.browser.name]||this.majorVersion()<this.browserSupport[this.browser.name]||this.browser.name==="firefox"&&this.isAndroid())}isSimulcastSupported(){return this.hasChromiumWebRTC()}supportDownlinkBandwidthEstimation(){return!this.isFirefox()}supportString(){if(this.isAndroid())return`${this.browserName.chrome} ${this.browserSupport.chrome}+, ${this.browserName.samsung} ${this.browserSupport.samsung}+`;let t=[];for(let e in this.browserSupport)t.push(`${this.browserName[e]} ${this.browserSupport[e]}+`);return t.join(", ")}supportedVideoCodecs(){return JI(this,void 0,void 0,function*(){let t=new RTCPeerConnection;return t.addTransceiver("video",{direction:"inactive",streams:[]}),(yield t.createOffer({offerToReceiveVideo:!0})).sdp.split(`\r
`).filter(e=>e.includes("a=rtpmap:")).map(e=>e.replace(/.* /,"").replace(/\/.*/,"")).filter((e,i,r)=>r.indexOf(e)===i).filter(e=>e!=="rtx"&&e!=="red"&&e!=="ulpfec")})}supportsSetSinkId(){return"setSinkId"in HTMLAudioElement.prototype}disableResolutionScaleDown(){return this.isAndroid()}disable480pResolutionScaleDown(){return/( Chrome\/98\.)/i.test(navigator.userAgent)&&this.browser.os.startsWith("Windows")}requiresDisablingH264Encoding(){return this.isIOS()&&(this.version()==="15.1.0"||/( OS 15_1)/i.test(navigator.userAgent))}requiresVideoPlayWorkaround(){return this.isSafari()}requiresAudioContextResetOnDeviceFailureForWebAudio(){return this.isIOS()}isVideoFxSupportedBrowser(){return this.supportsBackgroundFilter()}isIOSSafari(){return this.browser.name==="ios"||this.browser.name==="ios-webview"||this.browser.name==="safari"&&/( Mac )/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1}isSafari(){return this.browser.name==="safari"||this.isIOSSafari()}isFirefox(){return this.browser.name==="firefox"}isIOSFirefox(){return this.browser.name==="fxios"}isIOSChrome(){return this.browser.name==="crios"}isChrome(){return this.browser.name==="chrome"}isEdge(){return this.browser.name==="edge-chromium"}isIOSEdge(){return this.browser.name==="edge-ios"}isSamsungInternet(){return this.browser.name==="samsung"}isAndroid(){return/(android)/i.test(navigator.userAgent)}isPixel3(){return/( pixel 3)/i.test(navigator.userAgent)}isIOS(){return this.isIOSSafari()||this.isIOSChrome()||this.isIOSFirefox()}};yo.default=So;So.MIN_IOS_SUPPORT_CANVAS_STREAM_PLAYBACK=16;So.MIN_IOS_NON_SAFARI_SUPPORT_CANVAS_STREAM_PLAYBACK=106});var Za=g(bo=>{"use strict";var ZI=bo&&bo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(bo,"__esModule",{value:!0});var YI=ZI(pe()),El=class n{constructor(t=null,e=!0){this.audioBitrateBps=t,this.enableAudioRedundancy=new YI.default().supportsAudioRedundancy()&&e}static fullbandSpeechMono(t=!0){return new n(4e4,t)}static fullbandMusicMono(t=!0){return new n(64e3,t)}static fullbandMusicStereo(t=!0){return new n(128e3,t)}isStereo(){return this.audioBitrateBps===128e3}hasRedundancyEnabled(){return this.enableAudioRedundancy}};bo.default=El});var Pl=g(ki=>{"use strict";Object.defineProperty(ki,"__esModule",{value:!0});ki.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT=void 0;ki.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT=25;var Al=class{constructor(){this.logger=null,this.browserBehavior=null,this.meetingSessionConfiguration=null,this.signalingClient=null,this.peer=null,this.previousSdpOffer=null,this.sdpOfferInit=null,this.audioVideoController=null,this.realtimeController=null,this.videoTileController=null,this.mediaStreamBroker=null,this.activeAudioInput=void 0,this.activeVideoInput=void 0,this.audioMixController=null,this.transceiverController=null,this.indexFrame=null,this.iceCandidates=[],this.iceCandidateHandler=null,this.iceGatheringStateEventHandler=null,this.sdpAnswer=null,this.turnCredentials=null,this.reconnectController=null,this.removableObservers=[],this.audioProfile=null,this.videoStreamIndex=null,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.lastKnownVideoAvailability=null,this.videoCaptureAndEncodeParameter=null,this.videosToReceive=null,this.lastVideosToReceive=null,this.videoSubscriptions=null,this.lastVideoSubscriptionConfiguration=new Map,this.videoSubscriptionLimit=ki.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT,this.previousSdpAnswerAsString="",this.serverSupportsCompression=!1,this.videoSendCodecPreferences=[],this.currentVideoSendCodec=void 0,this.meetingSupportedVideoSendCodecPreferences=void 0,this.prioritizedSendVideoCodecCapabilities=[],this.degradedVideoSendCodecs=[],this.videosPaused=null,this.videoDuplexMode=null,this.volumeIndicatorAdapter=null,this.statsCollector=null,this.connectionMonitor=null,this.videoInputAttachedTimestampMs=0,this.audioDeviceInformation={},this.videoDeviceInformation={},this.enableSimulcast=!1,this.enableSVC=!1,this.eventController=null,this.signalingOpenDurationMs=null,this.iceGatheringDurationMs=null,this.startAudioVideoTimestamp=null,this.attendeePresenceDurationMs=null,this.meetingStartDurationMs=null,this.poorConnectionCount=0,this.maxVideoTileCount=0,this.startTimeMs=null,this.isSessionConnected=!1}resetConnectionSpecificState(){this.peer&&this.peer.close(),this.peer=null,this.previousSdpOffer=null,this.sdpOfferInit=null,this.transceiverController!==void 0&&this.transceiverController.reset(),this.indexFrame=null,this.iceCandidates=[],this.iceCandidateHandler=null,this.sdpAnswer=null,this.turnCredentials=null,this.videoDownlinkBandwidthPolicy.reset(),this.videoUplinkBandwidthPolicy.reset&&this.videoUplinkBandwidthPolicy.reset(),this.lastVideosToReceive=null,this.lastVideoSubscriptionConfiguration=new Map,this.videoSubscriptions=null,this.videoSubscriptionLimit=ki.DEFAULT_VIDEO_SUBSCRIPTION_LIMIT,this.previousSdpAnswerAsString="",this.serverSupportsCompression=!1,this.currentVideoSendCodec=void 0,this.meetingSupportedVideoSendCodecPreferences=void 0,this.videoDuplexMode=null,this.isSessionConnected=!1}};ki.default=Al});var wo=g(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.BlurStrengthMapper=void 0;var eC={LOW:7,MEDIUM:15,HIGH:30},Ya=class{static getBlurAmount(t,e){if(t<=0)throw new Error(`invalid value for blur strength: ${t}`);return Math.round(t*e.height/this.BLUR_STRENGTH_DIVISOR)}};_o.BlurStrengthMapper=Ya;Ya.BLUR_STRENGTH_DIVISOR=540;_o.default=eC});var ed=g(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.isValidRevisionID=ye.isValidAssetGroup=ye.resolveURL=ye.addQueryParams=ye.withQueryString=ye.withRequestHeaders=ye.fetchWithBehavior=void 0;function Qy(n,t,e){if(!e)return fetch(n,t);let i=Zy(n,e),r=Xy(t,e);return fetch(i,r)}ye.fetchWithBehavior=Qy;function Xy(n,t){return t?.headers?n?Object.assign(Object.assign({},n),{headers:Object.assign(Object.assign({},n.headers||{}),t.headers)}):{headers:t.headers}:n}ye.withRequestHeaders=Xy;function Zy(n,t){if(!t?.escapedQueryString)return n;let e=n.lastIndexOf("?")!==-1;return`${n}${e?"&":"?"}${t.escapedQueryString}`}ye.withQueryString=Zy;function tC(n,t){let e=Object.keys(t);if(!e.length)return n;let i=new URLSearchParams(n?.escapedQueryString);for(let r of e)i.append(r,t[r]);return Object.assign(Object.assign({},n),{escapedQueryString:i.toString()})}ye.addQueryParams=tC;var iC={method:"HEAD",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"origin"};function nC(n,t){return Qy(n,iC,t).then(e=>e.redirected?e.url:n)}ye.resolveURL=nC;function rC(n){return!!n&&/^[-.a-zA-Z0-9]+$/.test(n)}ye.isValidAssetGroup=rC;function oC(n){return!!n&&/^[123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ]{22}$/.test(n)}ye.isValidRevisionID=oC});var Ii=g(td=>{"use strict";Object.defineProperty(td,"__esModule",{value:!0});td.loadWorker=void 0;var Yy=ed(),sC={method:"GET",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"no-referrer"},aC=(n,t,e,i)=>{i?.debug(`Loading ${t} worker from ${n}.`);let r=!1;try{r=self.origin===new URL(n).origin}catch(o){i?.error("Could not compare origins.",o)}if(r){let o=(0,Yy.withQueryString)(n,e);return Promise.resolve(new Worker(o,{name:t}))}return(0,Yy.fetchWithBehavior)(n,sC,e).then(o=>{if(o.ok)return o.blob().then(s=>new Worker(window.URL.createObjectURL(s)));throw new Error("Fetch failed.")})};td.loadWorker=aC});var Wt=g(ne=>{"use strict";var dC=ne&&ne.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(ne,"__esModule",{value:!0});ne.isOldChrome=ne.supportsWASMStreaming=ne.supportsSharedArrayBuffer=ne.supportsWASM=ne.supportsAudioWorklet=ne.supportsWorker=ne.supportsVoiceFocusWorker=ne.supportsWASMPostMessage=ne.isSafari=void 0;var cC=Ii(),lC=(n=globalThis)=>!!n.navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)/),uC=(n=globalThis)=>{let t=n.navigator.userAgent,e=t.match(/Safari\//),i=t.match(/Chrom(?:e|ium)\//);return!!(e&&!i)};ne.isSafari=uC;var fC=(n=globalThis)=>(0,ne.isSafari)(n)?!1:lC(n)?(eb(n)||0)<95:!0;ne.supportsWASMPostMessage=fC;var hC=(n=globalThis,t,e)=>dC(void 0,void 0,void 0,function*(){if(!(0,ne.supportsWorker)(n,e))return!1;let i=`${t.paths.workers}worker-v1.js`;try{let r=yield(0,cC.loadWorker)(i,"VoiceFocusTestWorker",t,e);try{r.terminate()}catch(o){e?.debug("Failed to terminate worker.",o)}return!0}catch(r){return e?.info("Failed to fetch and instantiate test worker",r),!1}});ne.supportsVoiceFocusWorker=hC;var pC=(n=globalThis,t)=>{try{return!!n.Worker}catch(e){return t?.info("Does not support Worker",e),!1}};ne.supportsWorker=pC;var mC=(n=globalThis,t)=>{try{return!!n.AudioWorklet&&!!n.AudioWorkletNode}catch(e){return t?.info("Does not support Audio Worklet",e),!1}};ne.supportsAudioWorklet=mC;var gC=(n=globalThis,t)=>{try{return!!n.WebAssembly&&(!!n.WebAssembly.compile||!!n.WebAssembly.compileStreaming)}catch(e){return t?.info("Does not support WASM",e),!1}};ne.supportsWASM=gC;var vC=(n=globalThis,t=globalThis,e)=>{try{return!!n.SharedArrayBuffer&&(!!t.chrome||!!n.crossOriginIsolated)}catch{return e?.info("Does not support SharedArrayBuffer."),!1}};ne.supportsSharedArrayBuffer=vC;var SC=(n=globalThis,t)=>{var e;try{return!!(!((e=n.WebAssembly)===null||e===void 0)&&e.compileStreaming)}catch(i){return t?.info("Does not support WASM streaming compilation",i),!1}};ne.supportsWASMStreaming=SC;var yC=90,eb=(n=globalThis)=>{try{if(!n.chrome)return}catch{}let t=n.navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)/);if(t)return parseInt(t[1],10)},bC=(n=globalThis,t)=>{let e=eb(n);return e&&e<yC?(t?.debug(`Chrome ${e} has incomplete SIMD support.`),!0):!1};ne.isOldChrome=bC});var Dl=g(Rl=>{"use strict";Object.defineProperty(Rl,"__esModule",{value:!0});var Ml=class n{constructor(){this.path=null,this.input=null,this.output=null}static builder(){return new n}withDefaultModel(){return this.withSelfieSegmentationDefaults()}withSelfieSegmentationDefaults(){let t={height:144,width:256,range:[0,1],channels:3},e={height:144,width:256,range:[0,1],channels:1},i="https://static.sdkassets.chime.aws/bgblur/models/selfie_segmentation_landscape.tflite";return this.path=i,this.input=t,this.output=e,this}withPath(t){return this.path=t,this}withInput(t){return this.input=t,this}withOutput(t){return this.output=t,this}validate(){if(!this.path)throw new Error("model spec path is not set");if(!this.input)throw new Error("model spec input is not set");if(!this.output)throw new Error("model spec output is not set")}build(){return this.validate(),{path:this.path,input:this.input,output:this.output}}};Rl.default=Ml});var tb=g(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});xl.default={hash:"e209404",raw:"v3.29.0",semverString:"3.29.0"}});var Je=g(ko=>{"use strict";var ib=ko&&ko.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ko,"__esModule",{value:!0});var _C=ib(pe()),Vl=ib(tb()),To=class n{static get sdkName(){return"amazon-chime-sdk-js"}static get sdkVersion(){return Vl.default.semverString}static get sdkVersionSemVer(){var t,e,i,r;let o=Vl.default.semverString.match(/^(?<major>[0-9]+)\.(?<minor>[0-9]+)((?:\.(?<patch>[0-9]+))(?:-(?<preRelease>[a-zA-Z]+(\.[0-9])*))?)?/);return{major:(t=o?.groups)===null||t===void 0?void 0:t.major,minor:(e=o?.groups)===null||e===void 0?void 0:e.minor,patch:(i=o?.groups)===null||i===void 0?void 0:i.patch,preRelease:(r=o?.groups)===null||r===void 0?void 0:r.preRelease}}static get buildSHA(){return Vl.default.hash.substring(1)}static get sdkUserAgentLowResolution(){let t=new _C.default;return`${t.name()}-${t.majorVersion()}`}static urlWithVersion(t){let e=new URL(t);return e.searchParams.append(n.X_AMZN_VERSION,n.sdkVersion),e.searchParams.append(n.X_AMZN_USER_AGENT,n.sdkUserAgentLowResolution),e.toString()}};ko.default=To;To.X_AMZN_VERSION="X-Amzn-Version";To.X_AMZN_USER_AGENT="X-Amzn-User-Agent"});var id=g(Ci=>{"use strict";var wC=Ci&&Ci.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Fl=Ci&&Ci.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ci,"__esModule",{value:!0});var TC=Ii(),nb=Wt(),kC=Fl(Dl()),IC=Fl(pe()),Nl=Fl(Je()),CC=()=>kC.default.builder().withSelfieSegmentationDefaults().build(),Ll="https://static.sdkassets.chime.aws",OC={worker:`${Ll}/bgblur/workers/worker.js`,wasm:`${Ll}/bgblur/wasm/_cwt-wasm.wasm`,simd:`${Ll}/bgblur/wasm/_cwt-wasm-simd.wasm`},Bl=class{static defaultAssetSpec(){let t=Nl.default.sdkVersionSemVer;return{assetGroup:`sdk-${t.major}.${t.minor}`}}static createUrlWithParams(t,e){let i=new URL(t),r=Object.keys(e);for(let o of r)e[o]!==void 0&&i.searchParams.set(o,e[o]);return i.toString()}static resolveSpec(t){let{paths:e=OC,model:i=CC(),assetGroup:r=this.defaultAssetSpec().assetGroup,revisionID:o=this.defaultAssetSpec().revisionID}=t||{},s={assetGroup:r,revisionID:o,sdk:encodeURIComponent(Nl.default.sdkVersion),ua:encodeURIComponent(Nl.default.sdkUserAgentLowResolution)};return e.worker=this.createUrlWithParams(e.worker,s),e.wasm=this.createUrlWithParams(e.wasm,s),e.simd=this.createUrlWithParams(e.simd,s),i.path=this.createUrlWithParams(i.path,s),{paths:e,model:i,assetGroup:r,revisionID:o}}static resolveOptions(t){t.reportingPeriodMillis||(t.reportingPeriodMillis=1e3);let e=30;return t.filterCPUUtilization?(t.filterCPUUtilization<0||t.filterCPUUtilization>100)&&(t.logger.warn(`filterCPUUtilization must be set to a range between 0 and 100 percent. Falling back to default of ${e} percent`),t.filterCPUUtilization=e):t.filterCPUUtilization=e,t}static isSupported(t,e){let{logger:i}=e;return typeof globalThis>"u"?(i.info("Browser does not have globalThis."),Promise.resolve(!1)):new IC.default().supportsBackgroundFilter()?nb.supportsWASM(globalThis,i)?this.supportsBackgroundFilter(globalThis,t,i):(i.info("Browser does not support WASM."),Promise.resolve(!1)):(i.info("Browser is not supported."),Promise.resolve(!1))}static supportsBackgroundFilter(t=globalThis,e,i){return wC(this,void 0,void 0,function*(){if(!nb.supportsWorker(t,i))return i.info("Browser does not support web workers."),!1;let r=e.paths.worker;try{let o=yield TC.loadWorker(r,"BackgroundFilterWorker",{},null);try{o.terminate()}catch(s){i.info(`Failed to terminate worker. ${s.message}`)}return!0}catch(o){return i.info(`Failed to fetch and instantiate test worker ${o.message}`),!1}})}};Ci.default=Bl});var nd=g(Io=>{"use strict";var EC=Io&&Io.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Io,"__esModule",{value:!0});var Ae=EC(Ge()),Ul=class{constructor(t,e=Ae.default.WARN){this.name=t,this.level=e}info(t){this.log(Ae.default.INFO,t)}warn(t){this.log(Ae.default.WARN,t)}error(t){this.log(Ae.default.ERROR,t)}debug(t){Ae.default.DEBUG<this.level||(typeof t=="string"?this.log(Ae.default.DEBUG,t):t?this.log(Ae.default.DEBUG,t()):this.log(Ae.default.DEBUG,""+t))}setLogLevel(t){this.level=t}getLogLevel(){return this.level}log(t,e){if(t<this.level)return;let r=`${new Date().toISOString()} [${Ae.default[t]}] ${this.name} - ${e}`;switch(t){case Ae.default.ERROR:console.error(r);break;case Ae.default.WARN:console.warn(r);break;case Ae.default.DEBUG:console.debug(r.replace(/\\r\\n/g,`
`));break;case Ae.default.INFO:console.info(r);break}}};Io.default=Ul});var rd=g(Co=>{"use strict";var rb=Co&&Co.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(Co,"__esModule",{value:!0});var ql=class{process(t){return rb(this,void 0,void 0,function*(){return t})}destroy(){return rb(this,void 0,void 0,function*(){})}};Co.default=ql});var Eo=g(Oo=>{"use strict";var AC=Oo&&Oo.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(Oo,"__esModule",{value:!0});var Hl=class{constructor(t){this.canvas=t,this.destroyed=!1}destroy(){this.canvas=null,this.destroyed=!0}asCanvasImageSource(){return AC(this,void 0,void 0,function*(){return this.destroyed?Promise.reject("canvas buffer is destroyed"):Promise.resolve(this.canvas)})}asCanvasElement(){return this.canvas}};Oo.default=Hl});var ob=g(Wl=>{"use strict";Object.defineProperty(Wl,"__esModule",{value:!0});var PC=.8,jl=class{constructor(t,e,i,r){this.delegate=t,this.reportingPeriodMillis=e,this.filterCPUUtilization=i,this.logger=r,this._processingFilter=!0,this.lastReportedEventTimestamp=0,this.lastFilterCompleteTimestamp=0,this.filterTotalMillis=0,this.filterCount=0,this.framerate=0,this.filterDurationNotifyMillis=0,this.setSegmentationDuration()}reportEvent(t){let e=t-this.lastReportedEventTimestamp;if(e>=this.reportingPeriodMillis){let i=this.filterCount,r=this.filterTotalMillis;if(this.filterCount=0,this.filterTotalMillis=0,this.lastReportedEventTimestamp=t,this.framerate===0||i===0)return;let o=Math.round(r/i),s=Math.round(this.framerate*(e/1e3))-i,d=Math.round(100*r/e);o>=this.filterDurationNotifyMillis&&this.delegate.filterFrameDurationHigh({framesDropped:s,avgFilterDurationMillis:o,framerate:this.framerate,periodMillis:e}),d>=this.filterCPUUtilization&&this.delegate.filterCPUUtilizationHigh({cpuUtilization:d,filterMillis:r,periodMillis:e})}}setSegmentationDuration(){this.filterDurationNotifyMillis=Math.round(1e3/this.framerate*PC)}frameReceived(t){t!==this.framerate&&(this.framerate=t,this.logger.info(`frame counter setting frame rate to ${this.framerate}`),this.setSegmentationDuration());let e=Date.now();this.reportEvent(e)}filterSubmitted(){this._processingFilter=!0,this.lastFilterCompleteTimestamp=Date.now()}filterComplete(){this.filterTotalMillis+=Date.now()-this.lastFilterCompleteTimestamp,this._processingFilter=!1,this.filterCount++}get processingSegment(){return this._processingFilter}};Wl.default=jl});var Gl=g(Et=>{"use strict";var zl=Et&&Et.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},sb=Et&&Et.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Et,"__esModule",{value:!0});Et.BackgroundFilterMonitor=void 0;var MC=Ii(),RC=sb(Eo()),DC=sb(ob()),$l=class{constructor(){this.value=void 0,this.resolve=null}whenNext(){return this.promise||(this.promise=new Promise(t=>this.resolve=t)),this.promise}next(t){this.value=t,this.resolve(t),delete this.promise}},Kl=class n{constructor(t,e,i,r,o){this.targetCanvas=document.createElement("canvas"),this.canvasCtx=this.targetCanvas.getContext("2d"),this.canvasVideoFrameBuffer=new RC.default(this.targetCanvas),this.mask$=new $l,this.sourceWidth=0,this.sourceHeight=0,this.frameNumber=0,this.videoFramesPerFilterUpdate=1,this.initWorkerPromise=n.createWorkerPromise(),this.loadModelPromise=n.createWorkerPromise(),this.modelInitialized=!1,this.destroyed=!1,this.filterType=t,this.validateSpec(e),this.validateOptions(i),this.spec=e,this.logger=i.logger,this.delegate=r,this.initCPUMonitor(i),this.eventController=o}static createWorkerPromise(){let t={resolve:null,reject:null,promise:null};return t.promise=new Promise((e,i)=>{t.resolve=e,t.reject=i}),t}validateSpec(t){if(!t)throw new Error("processor has null spec");if(!t.model)throw new Error("processor spec has null model");if(!t.paths)throw new Error("processor spec has null paths")}validateOptions(t){if(!t)throw new Error("processor has null options");if(!t.logger)throw new Error("processor has null options - logger");if(!t.reportingPeriodMillis)throw new Error("processor has null options - reportingPeriodMillis");if(!t.filterCPUUtilization)throw new Error("processor has null options - filterCPUUtilization")}initCPUMonitor(t){this.videoFramesPerFilterUpdate=1,this.frameCounter=new DC.default(this.delegate,t.reportingPeriodMillis,t.filterCPUUtilization,this.logger),this.cpuMonitor=new od(5e3,{reduceCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.min(this.videoFramesPerFilterUpdate+1,10))},increaseCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.max(this.videoFramesPerFilterUpdate-1,1))}}),this.delegate.addObserver(this.cpuMonitor)}stringify(t){return JSON.stringify(t,null,2)}handleInitialize(t){if(this.logger.info(`received initialize message: ${this.stringify(t)}`),!t.payload){this.logger.error("failed to initialize module"),this.initWorkerPromise.reject(new Error("failed to initialize the module"));return}let e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:0}}),this.initWorkerPromise.resolve({})}handleLoadModel(t){if(this.logger.info(`received load model message: ${this.stringify(t)}`),t.payload!==2){this.logger.error("failed to load model! status: "+t.payload),this.loadModelPromise.reject(new Error("failed to load model! status: "+t.payload));return}this.modelInitialized=!0,this.loadModelPromise.resolve({})}handlePredict(t){this.mask$.next(t.payload.output)}handleWorkerEvent(t){let e=t.data;switch(e.msg){case"initialize":this.handleInitialize(e);break;case"loadModel":this.handleLoadModel(e);break;case"predict":this.handlePredict(e);break;default:this.logger.info(`unexpected event msg: ${this.stringify(e)}`);break}}loadAssets(){return zl(this,void 0,void 0,function*(){this.logger.info("start initializing the processor");try{this.worker=yield MC.loadWorker(this.spec.paths.worker,"BackgroundFilterWorker",{},null),this.worker.addEventListener("message",t=>this.handleWorkerEvent(t)),this.worker.postMessage({msg:"initialize",payload:{wasmPath:this.spec.paths.wasm,simdPath:this.spec.paths.simd}}),yield this.initWorkerPromise.promise,this.logger.info(`successfully initialized the ${this.filterType} worker`),yield this.loadModelPromise.promise,this.logger.info(`successfully loaded ${this.filterType} worker segmentation model`)}catch(t){throw new Error(`could not initialize the ${this.filterType} video frame processor due to '${t.message}'`)}this.logger.info(`successfully initialized the ${this.filterType} processor`)})}process(t){return zl(this,void 0,void 0,function*(){if(this.destroyed)return t;this.frameCounter.frameReceived(t[0].framerate),this.cpuMonitor.frameReceived();let e=t[0].asCanvasElement();if(!e)return t;if(!this.modelInitialized)return t[0]=this.canvasVideoFrameBuffer,t;let i=e.width,r=e.height;if(i===0||r===0)return t;this.sourceWidth===0&&(this.sourceWidth=i,this.sourceHeight=r,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight,this.logger.info(`${this.filterType} source width: ${this.sourceWidth}`),this.logger.info(`${this.filterType} source height: ${this.sourceHeight}`),this.initOnFirstExecution()),(this.sourceWidth!==i||this.sourceHeight!==r)&&(this.sourceWidth=i,this.sourceHeight=r,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight);try{this.frameCounter.filterSubmitted();let o=this.mask$.value,s=this.spec.model.input.width/e.width,d=this.spec.model.input.height/e.height;this.scaledCanvas===void 0&&(this.scaledCanvas=document.createElement("canvas"),this.scaledCanvas.width=this.spec.model.input.width,this.scaledCanvas.height=this.spec.model.input.height);let l=this.scaledCanvas.getContext("2d");l.save(),l.scale(s,d),l.drawImage(e,0,0),l.restore();let c=l.getImageData(0,0,this.scaledCanvas.width,this.scaledCanvas.height);if(this.frameNumber%this.videoFramesPerFilterUpdate===0){let a=this.mask$.whenNext();this.worker.postMessage({msg:"predict",payload:c},[c.data.buffer]),o=yield a}this.destroyed||this.drawImageWithMask(e,o)}catch(o){return this.logger.error(`could not process ${this.filterType} frame buffer due to ${o}`),t}finally{this.frameCounter.filterComplete(),this.frameNumber++}return t[0]=this.canvasVideoFrameBuffer,t})}updateVideoFramesPerFilterUpdate(t){t!==this.videoFramesPerFilterUpdate&&(this.videoFramesPerFilterUpdate=t,this.logger.info(`Adjusting filter rate to compensate for CPU utilization. Filter rate is ${this.videoFramesPerFilterUpdate} video frames per filter.`))}destroy(){var t,e,i,r;return zl(this,void 0,void 0,function*(){this.destroyed=!0,this.delegate.removeObserver(this.cpuMonitor),this.canvasVideoFrameBuffer.destroy(),(t=this.worker)===null||t===void 0||t.postMessage({msg:"destroy"}),(e=this.worker)===null||e===void 0||e.postMessage({msg:"stop"}),(i=this.targetCanvas)===null||i===void 0||i.remove(),this.targetCanvas=void 0,(r=this.scaledCanvas)===null||r===void 0||r.remove(),this.scaledCanvas=void 0,this.logger.info(`${this.filterType} frame process destroyed`)})}};Et.default=Kl;var od=class{constructor(t,e){this.monitoringPeriodMillis=t,this.observer=e,this.lastCPUChangeTimestamp=0}filterCPUUtilizationHigh(){let t=Date.now();t-this.lastCPUChangeTimestamp>=this.monitoringPeriodMillis&&(this.lastCPUChangeTimestamp=t,this.observer.reduceCPUUtilization())}frameReceived(){let t=Date.now();t-this.lastCPUChangeTimestamp>=this.monitoringPeriodMillis*2&&(this.lastCPUChangeTimestamp=t,this.observer.increaseCPUUtilization())}};Et.BackgroundFilterMonitor=od});var Xl=g(Ql=>{"use strict";Object.defineProperty(Ql,"__esModule",{value:!0});var Jl=class{constructor(){this.observers=new Set}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}filterFrameDurationHigh(t){var e;for(let i of this.observers)(e=i.filterFrameDurationHigh)===null||e===void 0||e.call(i,t)}filterCPUUtilizationHigh(t){var e;for(let i of this.observers)(e=i.filterCPUUtilizationHigh)===null||e===void 0||e.call(i,t)}};Ql.default=Jl});var ab=g(Ao=>{"use strict";var xC=Ao&&Ao.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ao,"__esModule",{value:!0});var VC=xC(Xl()),Zl=class extends VC.default{};Ao.default=Zl});var eu=g(Oi=>{"use strict";var NC=Oi&&Oi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},db=Oi&&Oi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Oi,"__esModule",{value:!0});var LC=db(Gl()),BC=wo(),FC=db(ab()),Yl=class extends LC.default{constructor(t,e){super("background blur",t,e,new FC.default),this.blurAmount=0,this.setBlurStrength(e.blurStrength),this.logger.info("BackgroundBlur processor successfully created"),this.logger.info(`BackgroundBlur spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundBlur options: { blurStrength: ${e.blurStrength}, filterCPUUtilization: ${e.filterCPUUtilization}, reportingPeriodMillis: ${e.reportingPeriodMillis}}`)}validateOptions(t){if(super.validateOptions(t),!t.blurStrength)throw new Error("processor has null options - blurStrength")}initOnFirstExecution(){this.setBlurPixels()}drawImageWithMask(t,e){e||(e=new ImageData(this.spec.model.input.width,this.spec.model.input.height)),this.scaledCanvas.getContext("2d").putImageData(e,0,0);let{canvasCtx:r,targetCanvas:o}=this,{width:s,height:d}=o;r.save(),r.clearRect(0,0,s,d),r.drawImage(this.scaledCanvas,0,0,s,d),r.globalCompositeOperation="source-in",r.drawImage(t,0,0,s,d),r.globalCompositeOperation="destination-over",r.filter=`blur(${this.blurAmount}px)`,r.drawImage(t,0,0,o.width,o.height),r.restore()}setBlurStrength(t){this._blurStrength=t,this.logger.info(`blur strength set to ${this._blurStrength}`),this.setBlurPixels()}setBlurPixels(){this.blurAmount=BC.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:this.sourceHeight}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}addObserver(t){this.delegate.addObserver(t)}removeObserver(t){this.delegate.removeObserver(t)}static isSupported(){return NC(this,void 0,void 0,function*(){let t=document.createElement("canvas"),e=t.getContext("2d").filter!==void 0;return t.remove(),e})}setEventController(t){this.eventController?this.eventController=t:(this.eventController=t,this.publishBackgroundFilterEvent())}publishBackgroundFilterEvent(){let t={backgroundBlurEnabled:"true",backgroundBlurStrength:this._blurStrength,backgroundReplacementEnabled:"false",backgroundFilterVersion:1};this.eventController.publishEvent("backgroundFilterConfigSelected",t)}};Oi.default=Yl});var cb=g(Ei=>{"use strict";var UC=Ei&&Ei.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},qC=Ei&&Ei.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ei,"__esModule",{value:!0});var HC=qC(eu()),jC=wo(),tu=class extends HC.default{constructor(t,e){super(t,e),this.blurCanvas=document.createElement("canvas"),this.blurCanvasCtx=this.blurCanvas.getContext("2d"),this.blurCanvas.width=this.spec.model.input.width,this.blurCanvas.height=this.spec.model.input.height,this.logger.info("BackgroundBlur processor using builtin blur")}drawImageWithMask(t,e){let i=this.blurredImage,{canvasCtx:r,targetCanvas:o}=this,{width:s,height:d}=o;if(!e||!i){r.clearRect(0,0,s,d);return}this.scaledCanvas.getContext("2d").putImageData(e,0,0),this.blurCanvasCtx.putImageData(this.blurredImage,0,0),r.save(),r.clearRect(0,0,s,d),r.drawImage(this.scaledCanvas,0,0,s,d),r.globalCompositeOperation="source-in",r.drawImage(t,0,0,s,d),r.globalCompositeOperation="destination-over",r.drawImage(this.blurCanvas,0,0,s,d),r.restore()}setBlurStrength(t){if(super.setBlurStrength(t),this.worker){this.modelInitialized=!1,this.worker.postMessage({msg:"destroy"});let e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:this.blurAmount}})}}setBlurPixels(){this.blurAmount=jC.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:540}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}handleInitialize(t){if(this.logger.info(`received initialize message: ${this.stringify(t)}`),!t.payload){this.logger.error("failed to initialize module"),this.initWorkerPromise.reject(new Error("failed to initialize the module"));return}let e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:this.blurAmount}}),this.initWorkerPromise.resolve({})}handlePredict(t){this.blurredImage=t.payload.blurOutput,super.handlePredict(t)}destroy(){let t=Object.create(null,{destroy:{get:()=>super.destroy}});var e;return UC(this,void 0,void 0,function*(){t.destroy.call(this),(e=this.blurCanvas)===null||e===void 0||e.remove(),this.blurCanvas=void 0})}};Ei.default=tu});var fb=g(Ai=>{"use strict";var ub=Ai&&Ai.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Pi=Ai&&Ai.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ai,"__esModule",{value:!0});var WC=Pi(id()),zC=Pi(nd()),$C=Pi(Ge()),KC=Pi(rd()),GC=Pi(cb()),lb=Pi(eu()),JC=Pi(wo()),iu=class extends KC.default{setBlurStrength(){}loadAssets(){return ub(this,void 0,void 0,function*(){})}addObserver(){}removeObserver(){}},nu=class n extends WC.default{static create(t,e){return ub(this,void 0,void 0,function*(){t=n.resolveSpec(t),e=n.resolveOptions(e);let{logger:i}=e,r=yield n.isSupported(t,e);if(i.info(`processor is ${r?"":"not"} supported`),!r)return i.warn("Using no-op processor because background blur is not supported"),new iu;let o;return(yield lb.default.isSupported())?(i.info("Using browser-provided background blur"),o=new lb.default(t,e)):(i.info("Using built-in background blur"),o=new GC.default(t,e)),yield o.loadAssets(),o})}static resolveOptions(t={}){let e=Object.assign({},t);return e.blurStrength||(e.blurStrength=JC.default.MEDIUM),e.logger||(e.logger=new zC.default("BackgroundBlurProcessor",$C.default.INFO)),e=super.resolveOptions(e),e}static isSupported(t,e){return t=n.resolveSpec(t),e=n.resolveOptions(e),super.isSupported(t,e)}};Ai.default=nu});var hb=g(Po=>{"use strict";var QC=Po&&Po.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Po,"__esModule",{value:!0});var XC=QC(Xl()),ru=class extends XC.default{};Po.default=ru});var mb=g(Mi=>{"use strict";var sd=Mi&&Mi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},pb=Mi&&Mi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Mi,"__esModule",{value:!0});var ZC=pb(Gl()),YC=pb(hb()),ou=class n extends ZC.default{constructor(t,e){super("background replacement",t,e,new YC.default),this.replacementBlob=e.imageBlob,this.logger.info("BackgroundReplacement processor successfully created"),this.logger.info(`BackgroundReplacement spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundReplacement options: { filterCPUUtilization: ${e.filterCPUUtilization}, reportingPeriodMillis: ${e.reportingPeriodMillis}}`)}setImageBlob(t){return sd(this,void 0,void 0,function*(){this.replacementBlob=t,this.replacementImage=yield n.loadImage(this.createReplacementObjectUrl())})}initOnFirstExecution(){}drawImageWithMask(t,e){e||(e=new ImageData(this.spec.model.input.width,this.spec.model.input.height)),this.scaledCanvas.getContext("2d").putImageData(e,0,0);let{canvasCtx:r,targetCanvas:o}=this,{width:s,height:d}=o;r.save(),r.clearRect(0,0,s,d),r.drawImage(this.scaledCanvas,0,0,s,d),r.globalCompositeOperation="source-in",r.drawImage(t,0,0,s,d),r.globalCompositeOperation="destination-over",r.drawImage(this.replacementImage,0,0,o.width,o.height),r.restore()}static loadImageExecutor(t,e,i){let r=new Image;r.crossOrigin="Anonymous",r.addEventListener("load",()=>{t(r)},!1),r.addEventListener("error",o=>{e(new Error(`Could not load replacement image ${r.src}: ${o.message}`))},!1),r.src=i}static loadImage(t){return sd(this,void 0,void 0,function*(){return new Promise((e,i)=>this.loadImageExecutor(e,i,t))})}revokeReplacementObjectUrl(){this.replacementObjectUrl&&URL.revokeObjectURL(this.replacementObjectUrl)}createReplacementObjectUrl(){return this.revokeReplacementObjectUrl(),this.replacementObjectUrl=URL.createObjectURL(this.replacementBlob),this.replacementObjectUrl}loadAssets(){let t=Object.create(null,{loadAssets:{get:()=>super.loadAssets}});return sd(this,void 0,void 0,function*(){this.replacementImage=yield n.loadImage(this.createReplacementObjectUrl()),t.loadAssets.call(this)})}addObserver(t){this.delegate.addObserver(t)}removeObserver(t){this.delegate.removeObserver(t)}destroy(){let t=Object.create(null,{destroy:{get:()=>super.destroy}});return sd(this,void 0,void 0,function*(){t.destroy.call(this),this.revokeReplacementObjectUrl()})}setEventController(t){this.eventController?this.eventController=t:(this.eventController=t,this.publishBackgroundFilterEvent())}publishBackgroundFilterEvent(){let t={backgroundBlurEnabled:"false",backgroundBlurStrength:"low",backgroundReplacementEnabled:"true",backgroundFilterVersion:1};this.eventController.publishEvent("backgroundFilterConfigSelected",t)}};Mi.default=ou});var vb=g(Ri=>{"use strict";var Mo=Ri&&Ri.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Ro=Ri&&Ri.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ri,"__esModule",{value:!0});var eO=Ro(id()),tO=Ro(nd()),iO=Ro(Ge()),nO=Ro(rd()),gb=Ro(mb()),su=class extends nO.default{loadAssets(){return Mo(this,void 0,void 0,function*(){})}addObserver(){}removeObserver(){}setImageBlob(){return Mo(this,void 0,void 0,function*(){})}},au=class n extends eO.default{static create(t,e){return Mo(this,void 0,void 0,function*(){t=this.resolveSpec(t),e=this.resolveOptions(e),yield this.resolveOptionsAsync(e);let{logger:i}=e;if(!(yield n.isSupported(t,e)))return i.warn("Using no-op processor because background replacement is not supported"),new su;i.info("Using background replacement filter");let o=new gb.default(t,e);return yield o.loadAssets(),o})}static resolveOptions(t={}){let e=Object.assign({},t);return e.logger||(e.logger=new tO.default("BackgroundReplacementProcessor",iO.default.INFO)),super.resolveOptions(e)}static resolveOptionsAsync(t){return Mo(this,void 0,void 0,function*(){if(!t.imageBlob){let e=document.createElement("canvas");e.width=100,e.height=100;let i=e.getContext("2d");i.fillStyle="blue",i.fillRect(0,0,100,100);let r=yield new Promise(o=>{e.toBlob(o)});t.imageBlob=r}})}static isSupported(t,e){let i=Object.create(null,{isSupported:{get:()=>super.isSupported}});return Mo(this,void 0,void 0,function*(){t=this.resolveSpec(t),e=this.resolveOptions(e),yield this.resolveOptionsAsync(e);let r=e.imageBlob,o=URL.createObjectURL(r);try{yield gb.default.loadImage(o)}catch(s){return e.logger.info(`Failed to fetch load replacement image ${s.message}`),!1}finally{URL.revokeObjectURL(o)}return i.isSupported.call(this,t,e)})}};Ri.default=au});var zt=g(cu=>{"use strict";Object.defineProperty(cu,"__esModule",{value:!0});var du=class{constructor(t,e,i){this.minHealth=t.minHealth,this.maxHealth=t.maxHealth,this.currentHealth=t.initialHealth,this.currentData=e.clone(),this.name=i}minimumHealth(){return this.minHealth}maximumHealth(){return this.maxHealth}health(){return this.maximumHealth()}update(t){this.currentData=t}getConnectionHealthData(){return this.currentData.clone()}healthy(){return this.health()>this.minimumHealth()}healthIfChanged(){let t=this.health();return t!==this.currentHealth?(this.currentHealth=t,t):null}};cu.default=du});var fu=g(uu=>{"use strict";Object.defineProperty(uu,"__esModule",{value:!0});var lu=class{};uu.default=lu});var ad=g(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});var At=class n{static register(){!("document"in global)||!document.addEventListener||n.shouldRegisterCSPMonitor&&(n.added||(document.addEventListener("securitypolicyviolation",n.listener),n.added=!0))}static unregister(){!("document"in global)||!document.removeEventListener||(document.removeEventListener("securitypolicyviolation",n.listener),n.loggers=new Set,n.added=!1)}static disable(){n.shouldRegisterCSPMonitor=!1,n.unregister()}static addLogger(t){t&&n.loggers.add(t)}static removeLogger(t){t&&n.loggers.delete(t)}};hu.default=At;At.loggers=new Set;At.shouldRegisterCSPMonitor=!0;At.added=!1;At.listener=n=>{let t=`Security Policy Violation
Blocked URI: ${n.blockedURI}
Violated Directive: ${n.violatedDirective}
Original Policy: ${n.originalPolicy}
Document URI: ${n.documentURI}
Source File: ${n.sourceFile}
Line No.: ${n.lineNumber}
`;for(let e of At.loggers)e.error(t);At.loggers.size===0&&console.error(t)}});var pu=g(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.CheckAudioConnectivityFeedback=void 0;var Sb;(function(n){n[n.Succeeded=0]="Succeeded",n[n.AudioInputRequestFailed=1]="AudioInputRequestFailed",n[n.AudioInputPermissionDenied=2]="AudioInputPermissionDenied",n[n.ConnectionFailed=3]="ConnectionFailed",n[n.AudioNotReceived=4]="AudioNotReceived"})(Sb=er.CheckAudioConnectivityFeedback||(er.CheckAudioConnectivityFeedback={}));er.default=Sb});var mu=g(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.CheckAudioInputFeedback=void 0;var yb;(function(n){n[n.Succeeded=0]="Succeeded",n[n.Failed=1]="Failed",n[n.PermissionDenied=2]="PermissionDenied"})(yb=tr.CheckAudioInputFeedback||(tr.CheckAudioInputFeedback={}));tr.default=yb});var gu=g(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});ir.CheckAudioOutputFeedback=void 0;var bb;(function(n){n[n.Succeeded=0]="Succeeded",n[n.Failed=1]="Failed"})(bb=ir.CheckAudioOutputFeedback||(ir.CheckAudioOutputFeedback={}));ir.default=bb});var vu=g(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.CheckCameraResolutionFeedback=void 0;var _b;(function(n){n[n.Succeeded=0]="Succeeded",n[n.Failed=1]="Failed",n[n.ResolutionNotSupported=2]="ResolutionNotSupported",n[n.PermissionDenied=3]="PermissionDenied"})(_b=nr.CheckCameraResolutionFeedback||(nr.CheckCameraResolutionFeedback={}));nr.default=_b});var Su=g(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.CheckContentShareConnectivityFeedback=void 0;var wb;(function(n){n[n.Succeeded=0]="Succeeded",n[n.Failed=1]="Failed",n[n.PermissionDenied=2]="PermissionDenied",n[n.TimedOut=3]="TimedOut",n[n.ConnectionFailed=4]="ConnectionFailed"})(wb=rr.CheckContentShareConnectivityFeedback||(rr.CheckContentShareConnectivityFeedback={}));rr.default=wb});var yu=g(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.CheckNetworkTCPConnectivityFeedback=void 0;var Tb;(function(n){n[n.Succeeded=0]="Succeeded",n[n.MeetingSessionURLsNotInitialized=1]="MeetingSessionURLsNotInitialized",n[n.ConnectionFailed=2]="ConnectionFailed",n[n.ICENegotiationFailed=3]="ICENegotiationFailed"})(Tb=or.CheckNetworkTCPConnectivityFeedback||(or.CheckNetworkTCPConnectivityFeedback={}));or.default=Tb});var bu=g(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});sr.CheckNetworkUDPConnectivityFeedback=void 0;var kb;(function(n){n[n.Succeeded=0]="Succeeded",n[n.MeetingSessionURLsNotInitialized=1]="MeetingSessionURLsNotInitialized",n[n.ConnectionFailed=2]="ConnectionFailed",n[n.ICENegotiationFailed=3]="ICENegotiationFailed"})(kb=sr.CheckNetworkUDPConnectivityFeedback||(sr.CheckNetworkUDPConnectivityFeedback={}));sr.default=kb});var _u=g(ar=>{"use strict";Object.defineProperty(ar,"__esModule",{value:!0});ar.CheckVideoConnectivityFeedback=void 0;var Ib;(function(n){n[n.Succeeded=0]="Succeeded",n[n.VideoInputRequestFailed=1]="VideoInputRequestFailed",n[n.VideoInputPermissionDenied=2]="VideoInputPermissionDenied",n[n.ConnectionFailed=3]="ConnectionFailed",n[n.VideoNotSent=4]="VideoNotSent"})(Ib=ar.CheckVideoConnectivityFeedback||(ar.CheckVideoConnectivityFeedback={}));ar.default=Ib});var wu=g(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.CheckVideoInputFeedback=void 0;var Cb;(function(n){n[n.Succeeded=0]="Succeeded",n[n.Failed=1]="Failed",n[n.PermissionDenied=2]="PermissionDenied"})(Cb=dr.CheckVideoInputFeedback||(dr.CheckVideoInputFeedback={}));dr.default=Cb});var ku=g(Di=>{"use strict";var rO=Di&&Di.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},oO=Di&&Di.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Di,"__esModule",{value:!0});var sO=oO(Z()),Tu=class extends sO.default{constructor(t){super(t.logger),this.context=t,this.taskName="CleanRestartedSessionTask"}run(){return rO(this,void 0,void 0,function*(){this.context.resetConnectionSpecificState()})}};Di.default=Tu});var me=g(cr=>{"use strict";Object.defineProperty(cr,"__esModule",{value:!0});cr.SignalingClientEventType=void 0;var Ob;(function(n){n[n.WebSocketConnecting=0]="WebSocketConnecting",n[n.WebSocketOpen=1]="WebSocketOpen",n[n.WebSocketError=2]="WebSocketError",n[n.WebSocketClosing=3]="WebSocketClosing",n[n.WebSocketClosed=4]="WebSocketClosed",n[n.WebSocketFailed=5]="WebSocketFailed",n[n.WebSocketMessage=6]="WebSocketMessage",n[n.WebSocketSendMessageFailure=7]="WebSocketSendMessageFailure",n[n.WebSocketSentMessage=8]="WebSocketSentMessage",n[n.ProtocolDecodeFailure=9]="ProtocolDecodeFailure",n[n.ReceivedSignalFrame=10]="ReceivedSignalFrame",n[n.WebSocketSkippedMessage=11]="WebSocketSkippedMessage"})(Ob=cr.SignalingClientEventType||(cr.SignalingClientEventType={}));cr.default=Ob});var Cu=g(xi=>{"use strict";var aO=xi&&xi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Eb=xi&&xi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(xi,"__esModule",{value:!0});var dO=Eb(me()),cO=Eb(Z()),Iu=class extends cO.default{constructor(t){super(t.logger),this.context=t,this.taskName="CleanStoppedSessionTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return aO(this,void 0,void 0,function*(){try{this.context.signalingClient.ready()&&(this.context.signalingClient.closeConnection(),yield this.receiveWebSocketClosedEvent())}catch(t){throw t}finally{for(let e of this.context.removableObservers)e.removeObserver();this.context.resetConnectionSpecificState(),this.context.statsCollector.stop(),this.context.statsCollector=null,this.context.connectionMonitor.stop(),this.context.connectionMonitor=null,this.context.videoUplinkBandwidthPolicy.setTransceiverController&&this.context.videoUplinkBandwidthPolicy.setTransceiverController(void 0),this.context.videoDownlinkBandwidthPolicy.bindToTileController&&this.context.videoDownlinkBandwidthPolicy.bindToTileController(void 0);let t=this.context.videoTileController.getLocalVideoTile();t&&t.bindVideoStream("",!0,null,null,null,null),this.context.videoTileController.removeAllVideoTiles()}})}receiveWebSocketClosedEvent(){return new Promise((t,e)=>{class i{constructor(s){this.signalingClient=s}cancel(){this.signalingClient.removeObserver(this),e(new Error("CleanStoppedSessionTask got canceled while waiting for the WebSocket closed event"))}handleSignalingClientEvent(s){s.type===dO.default.WebSocketClosed&&(this.signalingClient.removeObserver(this),t())}}let r=new i(this.context.signalingClient);this.taskCanceler=r,this.context.signalingClient.registerObserver(r)})}};xi.default=Iu});var Pb=g((_U,Ab)=>{"use strict";Ab.exports=lO;function lO(n,t){for(var e=new Array(arguments.length-1),i=0,r=2,o=!0;r<arguments.length;)e[i++]=arguments[r++];return new Promise(function(d,l){e[i]=function(a){if(o)if(o=!1,a)l(a);else{for(var u=new Array(arguments.length-1),p=0;p<u.length;)u[p++]=arguments[p];d.apply(null,u)}};try{n.apply(t||null,e)}catch(c){o&&(o=!1,l(c))}})}});var xb=g(Db=>{"use strict";var dd=Db;dd.length=function(t){var e=t.length;if(!e)return 0;for(var i=0;--e%4>1&&t.charAt(e)==="=";)++i;return Math.ceil(t.length*3)/4-i};var lr=new Array(64),Rb=new Array(123);for(Qe=0;Qe<64;)Rb[lr[Qe]=Qe<26?Qe+65:Qe<52?Qe+71:Qe<62?Qe-4:Qe-59|43]=Qe++;var Qe;dd.encode=function(t,e,i){for(var r=null,o=[],s=0,d=0,l;e<i;){var c=t[e++];switch(d){case 0:o[s++]=lr[c>>2],l=(c&3)<<4,d=1;break;case 1:o[s++]=lr[l|c>>4],l=(c&15)<<2,d=2;break;case 2:o[s++]=lr[l|c>>6],o[s++]=lr[c&63],d=0;break}s>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),s=0)}return d&&(o[s++]=lr[l],o[s++]=61,d===1&&(o[s++]=61)),r?(s&&r.push(String.fromCharCode.apply(String,o.slice(0,s))),r.join("")):String.fromCharCode.apply(String,o.slice(0,s))};var Mb="invalid encoding";dd.decode=function(t,e,i){for(var r=i,o=0,s,d=0;d<t.length;){var l=t.charCodeAt(d++);if(l===61&&o>1)break;if((l=Rb[l])===void 0)throw Error(Mb);switch(o){case 0:s=l,o=1;break;case 1:e[i++]=s<<2|(l&48)>>4,s=l,o=2;break;case 2:e[i++]=(s&15)<<4|(l&60)>>2,s=l,o=3;break;case 3:e[i++]=(s&3)<<6|l,o=0;break}}if(o===1)throw Error(Mb);return i-r};dd.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}});var Nb=g((TU,Vb)=>{"use strict";Vb.exports=cd;function cd(){this._listeners={}}cd.prototype.on=function(t,e,i){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:i||this}),this};cd.prototype.off=function(t,e){if(t===void 0)this._listeners={};else if(e===void 0)this._listeners[t]=[];else for(var i=this._listeners[t],r=0;r<i.length;)i[r].fn===e?i.splice(r,1):++r;return this};cd.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var i=[],r=1;r<arguments.length;)i.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,i)}return this}});var jb=g((kU,Hb)=>{"use strict";Hb.exports=Lb(Lb);function Lb(n){return typeof Float32Array<"u"?(function(){var t=new Float32Array([-0]),e=new Uint8Array(t.buffer),i=e[3]===128;function r(l,c,a){t[0]=l,c[a]=e[0],c[a+1]=e[1],c[a+2]=e[2],c[a+3]=e[3]}function o(l,c,a){t[0]=l,c[a]=e[3],c[a+1]=e[2],c[a+2]=e[1],c[a+3]=e[0]}n.writeFloatLE=i?r:o,n.writeFloatBE=i?o:r;function s(l,c){return e[0]=l[c],e[1]=l[c+1],e[2]=l[c+2],e[3]=l[c+3],t[0]}function d(l,c){return e[3]=l[c],e[2]=l[c+1],e[1]=l[c+2],e[0]=l[c+3],t[0]}n.readFloatLE=i?s:d,n.readFloatBE=i?d:s})():(function(){function t(i,r,o,s){var d=r<0?1:0;if(d&&(r=-r),r===0)i(1/r>0?0:2147483648,o,s);else if(isNaN(r))i(2143289344,o,s);else if(r>34028234663852886e22)i((d<<31|2139095040)>>>0,o,s);else if(r<11754943508222875e-54)i((d<<31|Math.round(r/1401298464324817e-60))>>>0,o,s);else{var l=Math.floor(Math.log(r)/Math.LN2),c=Math.round(r*Math.pow(2,-l)*8388608)&8388607;i((d<<31|l+127<<23|c)>>>0,o,s)}}n.writeFloatLE=t.bind(null,Bb),n.writeFloatBE=t.bind(null,Fb);function e(i,r,o){var s=i(r,o),d=(s>>31)*2+1,l=s>>>23&255,c=s&8388607;return l===255?c?NaN:d*(1/0):l===0?d*1401298464324817e-60*c:d*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=e.bind(null,Ub),n.readFloatBE=e.bind(null,qb)})(),typeof Float64Array<"u"?(function(){var t=new Float64Array([-0]),e=new Uint8Array(t.buffer),i=e[7]===128;function r(l,c,a){t[0]=l,c[a]=e[0],c[a+1]=e[1],c[a+2]=e[2],c[a+3]=e[3],c[a+4]=e[4],c[a+5]=e[5],c[a+6]=e[6],c[a+7]=e[7]}function o(l,c,a){t[0]=l,c[a]=e[7],c[a+1]=e[6],c[a+2]=e[5],c[a+3]=e[4],c[a+4]=e[3],c[a+5]=e[2],c[a+6]=e[1],c[a+7]=e[0]}n.writeDoubleLE=i?r:o,n.writeDoubleBE=i?o:r;function s(l,c){return e[0]=l[c],e[1]=l[c+1],e[2]=l[c+2],e[3]=l[c+3],e[4]=l[c+4],e[5]=l[c+5],e[6]=l[c+6],e[7]=l[c+7],t[0]}function d(l,c){return e[7]=l[c],e[6]=l[c+1],e[5]=l[c+2],e[4]=l[c+3],e[3]=l[c+4],e[2]=l[c+5],e[1]=l[c+6],e[0]=l[c+7],t[0]}n.readDoubleLE=i?s:d,n.readDoubleBE=i?d:s})():(function(){function t(i,r,o,s,d,l){var c=s<0?1:0;if(c&&(s=-s),s===0)i(0,d,l+r),i(1/s>0?0:2147483648,d,l+o);else if(isNaN(s))i(0,d,l+r),i(2146959360,d,l+o);else if(s>17976931348623157e292)i(0,d,l+r),i((c<<31|2146435072)>>>0,d,l+o);else{var a;if(s<22250738585072014e-324)a=s/5e-324,i(a>>>0,d,l+r),i((c<<31|a/4294967296)>>>0,d,l+o);else{var u=Math.floor(Math.log(s)/Math.LN2);u===1024&&(u=1023),a=s*Math.pow(2,-u),i(a*4503599627370496>>>0,d,l+r),i((c<<31|u+1023<<20|a*1048576&1048575)>>>0,d,l+o)}}}n.writeDoubleLE=t.bind(null,Bb,0,4),n.writeDoubleBE=t.bind(null,Fb,4,0);function e(i,r,o,s,d){var l=i(s,d+r),c=i(s,d+o),a=(c>>31)*2+1,u=c>>>20&2047,p=4294967296*(c&1048575)+l;return u===2047?p?NaN:a*(1/0):u===0?a*5e-324*p:a*Math.pow(2,u-1075)*(p+4503599627370496)}n.readDoubleLE=e.bind(null,Ub,0,4),n.readDoubleBE=e.bind(null,qb,4,0)})(),n}function Bb(n,t,e){t[e]=n&255,t[e+1]=n>>>8&255,t[e+2]=n>>>16&255,t[e+3]=n>>>24}function Fb(n,t,e){t[e]=n>>>24,t[e+1]=n>>>16&255,t[e+2]=n>>>8&255,t[e+3]=n&255}function Ub(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16|n[t+3]<<24)>>>0}function qb(n,t){return(n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3])>>>0}});var Wb=g((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var $b=g(zb=>{"use strict";var Ou=zb;Ou.length=function(t){for(var e=0,i=0,r=0;r<t.length;++r)i=t.charCodeAt(r),i<128?e+=1:i<2048?e+=2:(i&64512)===55296&&(t.charCodeAt(r+1)&64512)===56320?(++r,e+=4):e+=3;return e};Ou.read=function(t,e,i){var r=i-e;if(r<1)return"";for(var o=null,s=[],d=0,l;e<i;)l=t[e++],l<128?s[d++]=l:l>191&&l<224?s[d++]=(l&31)<<6|t[e++]&63:l>239&&l<365?(l=((l&7)<<18|(t[e++]&63)<<12|(t[e++]&63)<<6|t[e++]&63)-65536,s[d++]=55296+(l>>10),s[d++]=56320+(l&1023)):s[d++]=(l&15)<<12|(t[e++]&63)<<6|t[e++]&63,d>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),d=0);return o?(d&&o.push(String.fromCharCode.apply(String,s.slice(0,d))),o.join("")):String.fromCharCode.apply(String,s.slice(0,d))};Ou.write=function(t,e,i){for(var r=i,o,s,d=0;d<t.length;++d)o=t.charCodeAt(d),o<128?e[i++]=o:o<2048?(e[i++]=o>>6|192,e[i++]=o&63|128):(o&64512)===55296&&((s=t.charCodeAt(d+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++d,e[i++]=o>>18|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128,e[i++]=o&63|128):(e[i++]=o>>12|224,e[i++]=o>>6&63|128,e[i++]=o&63|128);return i-r}});var Gb=g((CU,Kb)=>{"use strict";Kb.exports=uO;function uO(n,t,e){var i=e||8192,r=i>>>1,o=null,s=i;return function(l){if(l<1||l>r)return n(l);s+l>i&&(o=n(i),s=0);var c=t.call(o,s,s+=l);return s&7&&(s=(s|7)+1),c}}});var Qb=g((OU,Jb)=>{"use strict";Jb.exports=he;var Do=Kt();function he(n,t){this.lo=n>>>0,this.hi=t>>>0}var Vi=he.zero=new he(0,0);Vi.toNumber=function(){return 0};Vi.zzEncode=Vi.zzDecode=function(){return this};Vi.length=function(){return 1};var fO=he.zeroHash="\0\0\0\0\0\0\0\0";he.fromNumber=function(t){if(t===0)return Vi;var e=t<0;e&&(t=-t);var i=t>>>0,r=(t-i)/4294967296>>>0;return e&&(r=~r>>>0,i=~i>>>0,++i>4294967295&&(i=0,++r>4294967295&&(r=0))),new he(i,r)};he.from=function(t){if(typeof t=="number")return he.fromNumber(t);if(Do.isString(t))if(Do.Long)t=Do.Long.fromString(t);else return he.fromNumber(parseInt(t,10));return t.low||t.high?new he(t.low>>>0,t.high>>>0):Vi};he.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=~this.lo+1>>>0,i=~this.hi>>>0;return e||(i=i+1>>>0),-(e+i*4294967296)}return this.lo+this.hi*4294967296};he.prototype.toLong=function(t){return Do.Long?new Do.Long(this.lo|0,this.hi|0,!!t):{low:this.lo|0,high:this.hi|0,unsigned:!!t}};var $t=String.prototype.charCodeAt;he.fromHash=function(t){return t===fO?Vi:new he(($t.call(t,0)|$t.call(t,1)<<8|$t.call(t,2)<<16|$t.call(t,3)<<24)>>>0,($t.call(t,4)|$t.call(t,5)<<8|$t.call(t,6)<<16|$t.call(t,7)<<24)>>>0)};he.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};he.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this};he.prototype.zzDecode=function(){var t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this};he.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:i<128?9:10}});var Kt=g(Eu=>{"use strict";var x=Eu;x.asPromise=Pb();x.base64=xb();x.EventEmitter=Nb();x.float=jb();x.inquire=Wb();x.utf8=$b();x.pool=Gb();x.LongBits=Qb();x.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);x.global=x.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||Eu;x.emptyArray=Object.freeze?Object.freeze([]):[];x.emptyObject=Object.freeze?Object.freeze({}):{};x.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};x.isString=function(t){return typeof t=="string"||t instanceof String};x.isObject=function(t){return t&&typeof t=="object"};x.isset=x.isSet=function(t,e){var i=t[e];return i!=null&&t.hasOwnProperty(e)?typeof i!="object"||(Array.isArray(i)?i.length:Object.keys(i).length)>0:!1};x.Buffer=(function(){try{var n=x.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}})();x._Buffer_from=null;x._Buffer_allocUnsafe=null;x.newBuffer=function(t){return typeof t=="number"?x.Buffer?x._Buffer_allocUnsafe(t):new x.Array(t):x.Buffer?x._Buffer_from(t):typeof Uint8Array>"u"?t:new Uint8Array(t)};x.Array=typeof Uint8Array<"u"?Uint8Array:Array;x.Long=x.global.dcodeIO&&x.global.dcodeIO.Long||x.global.Long||x.inquire("long");x.key2Re=/^true|false|0|1$/;x.key32Re=/^-?(?:0|[1-9][0-9]*)$/;x.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;x.longToHash=function(t){return t?x.LongBits.from(t).toHash():x.LongBits.zeroHash};x.longFromHash=function(t,e){var i=x.LongBits.fromHash(t);return x.Long?x.Long.fromBits(i.lo,i.hi,e):i.toNumber(!!e)};function Xb(n,t,e){for(var i=Object.keys(t),r=0;r<i.length;++r)(n[i[r]]===void 0||!e)&&(n[i[r]]=t[i[r]]);return n}x.merge=Xb;x.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)};function Zb(n){function t(e,i){if(!(this instanceof t))return new t(e,i);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:new Error().stack||""}),i&&Xb(this,i)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}x.newError=Zb;x.ProtocolError=Zb("ProtocolError");x.oneOfGetter=function(t){for(var e={},i=0;i<t.length;++i)e[t[i]]=1;return function(){for(var r=Object.keys(this),o=r.length-1;o>-1;--o)if(e[r[o]]===1&&this[r[o]]!==void 0&&this[r[o]]!==null)return r[o]}};x.oneOfSetter=function(t){return function(e){for(var i=0;i<t.length;++i)t[i]!==e&&delete this[t[i]]}};x.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};x._configure=function(){var n=x.Buffer;if(!n){x._Buffer_from=x._Buffer_allocUnsafe=null;return}x._Buffer_from=n.from!==Uint8Array.from&&n.from||function(e,i){return new n(e,i)},x._Buffer_allocUnsafe=n.allocUnsafe||function(e){return new n(e)}}});var Vu=g((AU,i_)=>{"use strict";i_.exports=K;var Ne=Kt(),Au,ld=Ne.LongBits,Yb=Ne.base64,e_=Ne.utf8;function xo(n,t,e){this.fn=n,this.len=t,this.next=void 0,this.val=e}function Mu(){}function hO(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function K(){this.len=0,this.head=new xo(Mu,0,0),this.tail=this.head,this.states=null}var t_=function(){return Ne.Buffer?function(){return(K.create=function(){return new Au})()}:function(){return new K}};K.create=t_();K.alloc=function(t){return new Ne.Array(t)};Ne.Array!==Array&&(K.alloc=Ne.pool(K.alloc,Ne.Array.prototype.subarray));K.prototype._push=function(t,e,i){return this.tail=this.tail.next=new xo(t,e,i),this.len+=e,this};function Ru(n,t,e){t[e]=n&255}function pO(n,t,e){for(;n>127;)t[e++]=n&127|128,n>>>=7;t[e]=n}function Du(n,t){this.len=n,this.next=void 0,this.val=t}Du.prototype=Object.create(xo.prototype);Du.prototype.fn=pO;K.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new Du((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};K.prototype.int32=function(t){return t<0?this._push(xu,10,ld.fromNumber(t)):this.uint32(t)};K.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)};function xu(n,t,e){for(;n.hi;)t[e++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)t[e++]=n.lo&127|128,n.lo=n.lo>>>7;t[e++]=n.lo}K.prototype.uint64=function(t){var e=ld.from(t);return this._push(xu,e.length(),e)};K.prototype.int64=K.prototype.uint64;K.prototype.sint64=function(t){var e=ld.from(t).zzEncode();return this._push(xu,e.length(),e)};K.prototype.bool=function(t){return this._push(Ru,1,t?1:0)};function Pu(n,t,e){t[e]=n&255,t[e+1]=n>>>8&255,t[e+2]=n>>>16&255,t[e+3]=n>>>24}K.prototype.fixed32=function(t){return this._push(Pu,4,t>>>0)};K.prototype.sfixed32=K.prototype.fixed32;K.prototype.fixed64=function(t){var e=ld.from(t);return this._push(Pu,4,e.lo)._push(Pu,4,e.hi)};K.prototype.sfixed64=K.prototype.fixed64;K.prototype.float=function(t){return this._push(Ne.float.writeFloatLE,4,t)};K.prototype.double=function(t){return this._push(Ne.float.writeDoubleLE,8,t)};var mO=Ne.Array.prototype.set?function(t,e,i){e.set(t,i)}:function(t,e,i){for(var r=0;r<t.length;++r)e[i+r]=t[r]};K.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(Ru,1,0);if(Ne.isString(t)){var i=K.alloc(e=Yb.length(t));Yb.decode(t,i,0),t=i}return this.uint32(e)._push(mO,e,t)};K.prototype.string=function(t){var e=e_.length(t);return e?this.uint32(e)._push(e_.write,e,t):this._push(Ru,1,0)};K.prototype.fork=function(){return this.states=new hO(this),this.head=this.tail=new xo(Mu,0,0),this.len=0,this};K.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new xo(Mu,0,0),this.len=0),this};K.prototype.ldelim=function(){var t=this.head,e=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=t.next,this.tail=e,this.len+=i),this};K.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),i=0;t;)t.fn(t.val,e,i),i+=t.len,t=t.next;return e};K._configure=function(n){Au=n,K.create=t_(),Au._configure()}});var o_=g((PU,r_)=>{"use strict";r_.exports=ft;var n_=Vu();(ft.prototype=Object.create(n_.prototype)).constructor=ft;var Gt=Kt();function ft(){n_.call(this)}ft._configure=function(){ft.alloc=Gt._Buffer_allocUnsafe,ft.writeBytesBuffer=Gt.Buffer&&Gt.Buffer.prototype instanceof Uint8Array&&Gt.Buffer.prototype.set.name==="set"?function(t,e,i){e.set(t,i)}:function(t,e,i){if(t.copy)t.copy(e,i,0,t.length);else for(var r=0;r<t.length;)e[i++]=t[r++]}};ft.prototype.bytes=function(t){Gt.isString(t)&&(t=Gt._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(ft.writeBytesBuffer,e,t),this};function gO(n,t,e){n.length<40?Gt.utf8.write(n,t,e):t.utf8Write?t.utf8Write(n,e):t.write(n,e)}ft.prototype.string=function(t){var e=Gt.Buffer.byteLength(t);return this.uint32(e),e&&this._push(gO,e,t),this};ft._configure()});var Bu=g((MU,l_)=>{"use strict";l_.exports=ae;var Xe=Kt(),Lu,d_=Xe.LongBits,vO=Xe.utf8;function Ze(n,t){return RangeError("index out of range: "+n.pos+" + "+(t||1)+" > "+n.len)}function ae(n){this.buf=n,this.pos=0,this.len=n.length}var s_=typeof Uint8Array<"u"?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new ae(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new ae(t);throw Error("illegal buffer")},c_=function(){return Xe.Buffer?function(e){return(ae.create=function(r){return Xe.Buffer.isBuffer(r)?new Lu(r):s_(r)})(e)}:s_};ae.create=c_();ae.prototype._slice=Xe.Array.prototype.subarray||Xe.Array.prototype.slice;ae.prototype.uint32=(function(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Ze(this,10);return t}})();ae.prototype.int32=function(){return this.uint32()|0};ae.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(t&1)|0};function Nu(){var n=new d_(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Ze(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,n}if(this.len-this.pos>4){for(;t<5;++t)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;t<5;++t){if(this.pos>=this.len)throw Ze(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}ae.prototype.bool=function(){return this.uint32()!==0};function ud(n,t){return(n[t-4]|n[t-3]<<8|n[t-2]<<16|n[t-1]<<24)>>>0}ae.prototype.fixed32=function(){if(this.pos+4>this.len)throw Ze(this,4);return ud(this.buf,this.pos+=4)};ae.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Ze(this,4);return ud(this.buf,this.pos+=4)|0};function a_(){if(this.pos+8>this.len)throw Ze(this,8);return new d_(ud(this.buf,this.pos+=4),ud(this.buf,this.pos+=4))}ae.prototype.float=function(){if(this.pos+4>this.len)throw Ze(this,4);var t=Xe.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};ae.prototype.double=function(){if(this.pos+8>this.len)throw Ze(this,4);var t=Xe.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};ae.prototype.bytes=function(){var t=this.uint32(),e=this.pos,i=this.pos+t;if(i>this.len)throw Ze(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(e,i);if(e===i){var r=Xe.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,e,i)};ae.prototype.string=function(){var t=this.bytes();return vO.read(t,0,t.length)};ae.prototype.skip=function(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Ze(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Ze(this);while(this.buf[this.pos++]&128);return this};ae.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};ae._configure=function(n){Lu=n,ae.create=c_(),Lu._configure();var t=Xe.Long?"toLong":"toNumber";Xe.merge(ae.prototype,{int64:function(){return Nu.call(this)[t](!1)},uint64:function(){return Nu.call(this)[t](!0)},sint64:function(){return Nu.call(this).zzDecode()[t](!1)},fixed64:function(){return a_.call(this)[t](!0)},sfixed64:function(){return a_.call(this)[t](!1)}})}});var p_=g((RU,h_)=>{"use strict";h_.exports=Ni;var f_=Bu();(Ni.prototype=Object.create(f_.prototype)).constructor=Ni;var u_=Kt();function Ni(n){f_.call(this,n)}Ni._configure=function(){u_.Buffer&&(Ni.prototype._slice=u_.Buffer.prototype.slice)};Ni.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};Ni._configure()});var g_=g((DU,m_)=>{"use strict";m_.exports=Vo;var Fu=Kt();(Vo.prototype=Object.create(Fu.EventEmitter.prototype)).constructor=Vo;function Vo(n,t,e){if(typeof n!="function")throw TypeError("rpcImpl must be a function");Fu.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!t,this.responseDelimited=!!e}Vo.prototype.rpcCall=function n(t,e,i,r,o){if(!r)throw TypeError("request must be specified");var s=this;if(!o)return Fu.asPromise(n,s,t,e,i,r);if(!s.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return s.rpcImpl(t,e[s.requestDelimited?"encodeDelimited":"encode"](r).finish(),function(l,c){if(l)return s.emit("error",l,t),o(l);if(c===null){s.end(!0);return}if(!(c instanceof i))try{c=i[s.responseDelimited?"decodeDelimited":"decode"](c)}catch(a){return s.emit("error",a,t),o(a)}return s.emit("data",c,t),o(null,c)})}catch(d){s.emit("error",d,t),setTimeout(function(){o(d)},0);return}};Vo.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var S_=g(v_=>{"use strict";var SO=v_;SO.Service=g_()});var b_=g((VU,y_)=>{"use strict";y_.exports={}});var T_=g(w_=>{"use strict";var Te=w_;Te.build="minimal";Te.Writer=Vu();Te.BufferWriter=o_();Te.Reader=Bu();Te.BufferReader=p_();Te.util=Kt();Te.rpc=S_();Te.roots=b_();Te.configure=__;function __(){Te.util._configure(),Te.Writer._configure(Te.BufferWriter),Te.Reader._configure(Te.BufferReader)}__()});var I_=g((LU,k_)=>{"use strict";k_.exports=T_()});var oe=g((BU,C_)=>{"use strict";var N=I_(),b=N.Reader,B=N.Writer,v=N.util,f=N.roots.default||(N.roots.default={});f.SdkSignalFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.timestampMs=v.Long?v.Long.fromBits(0,0,!0):0,n.prototype.type=1,n.prototype.error=null,n.prototype.join=null,n.prototype.joinack=null,n.prototype.sub=null,n.prototype.suback=null,n.prototype.index=null,n.prototype.pause=null,n.prototype.leave=null,n.prototype.leaveAck=null,n.prototype.bitrates=null,n.prototype.audioControl=null,n.prototype.audioMetadata=null,n.prototype.audioStreamIdInfo=null,n.prototype.pingPong=null,n.prototype.audioStatus=null,n.prototype.clientMetric=null,n.prototype.dataMessage=null,n.prototype.remoteVideoUpdate=null,n.prototype.primaryMeetingJoin=null,n.prototype.primaryMeetingJoinAck=null,n.prototype.primaryMeetingLeave=null,n.prototype.notification=null,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),i.uint32(8).uint64(e.timestampMs),i.uint32(16).int32(e.type),e.error!=null&&Object.hasOwnProperty.call(e,"error")&&f.SdkErrorFrame.encode(e.error,i.uint32(26).fork()).ldelim(),e.join!=null&&Object.hasOwnProperty.call(e,"join")&&f.SdkJoinFrame.encode(e.join,i.uint32(34).fork()).ldelim(),e.joinack!=null&&Object.hasOwnProperty.call(e,"joinack")&&f.SdkJoinAckFrame.encode(e.joinack,i.uint32(42).fork()).ldelim(),e.sub!=null&&Object.hasOwnProperty.call(e,"sub")&&f.SdkSubscribeFrame.encode(e.sub,i.uint32(50).fork()).ldelim(),e.suback!=null&&Object.hasOwnProperty.call(e,"suback")&&f.SdkSubscribeAckFrame.encode(e.suback,i.uint32(58).fork()).ldelim(),e.index!=null&&Object.hasOwnProperty.call(e,"index")&&f.SdkIndexFrame.encode(e.index,i.uint32(66).fork()).ldelim(),e.pause!=null&&Object.hasOwnProperty.call(e,"pause")&&f.SdkPauseResumeFrame.encode(e.pause,i.uint32(82).fork()).ldelim(),e.leave!=null&&Object.hasOwnProperty.call(e,"leave")&&f.SdkLeaveFrame.encode(e.leave,i.uint32(90).fork()).ldelim(),e.leaveAck!=null&&Object.hasOwnProperty.call(e,"leaveAck")&&f.SdkLeaveAckFrame.encode(e.leaveAck,i.uint32(98).fork()).ldelim(),e.bitrates!=null&&Object.hasOwnProperty.call(e,"bitrates")&&f.SdkBitrateFrame.encode(e.bitrates,i.uint32(114).fork()).ldelim(),e.audioControl!=null&&Object.hasOwnProperty.call(e,"audioControl")&&f.SdkAudioControlFrame.encode(e.audioControl,i.uint32(138).fork()).ldelim(),e.audioMetadata!=null&&Object.hasOwnProperty.call(e,"audioMetadata")&&f.SdkAudioMetadataFrame.encode(e.audioMetadata,i.uint32(146).fork()).ldelim(),e.audioStreamIdInfo!=null&&Object.hasOwnProperty.call(e,"audioStreamIdInfo")&&f.SdkAudioStreamIdInfoFrame.encode(e.audioStreamIdInfo,i.uint32(154).fork()).ldelim(),e.pingPong!=null&&Object.hasOwnProperty.call(e,"pingPong")&&f.SdkPingPongFrame.encode(e.pingPong,i.uint32(162).fork()).ldelim(),e.audioStatus!=null&&Object.hasOwnProperty.call(e,"audioStatus")&&f.SdkAudioStatusFrame.encode(e.audioStatus,i.uint32(170).fork()).ldelim(),e.clientMetric!=null&&Object.hasOwnProperty.call(e,"clientMetric")&&f.SdkClientMetricFrame.encode(e.clientMetric,i.uint32(178).fork()).ldelim(),e.dataMessage!=null&&Object.hasOwnProperty.call(e,"dataMessage")&&f.SdkDataMessageFrame.encode(e.dataMessage,i.uint32(186).fork()).ldelim(),e.remoteVideoUpdate!=null&&Object.hasOwnProperty.call(e,"remoteVideoUpdate")&&f.SdkRemoteVideoUpdateFrame.encode(e.remoteVideoUpdate,i.uint32(202).fork()).ldelim(),e.primaryMeetingJoin!=null&&Object.hasOwnProperty.call(e,"primaryMeetingJoin")&&f.SdkPrimaryMeetingJoinFrame.encode(e.primaryMeetingJoin,i.uint32(210).fork()).ldelim(),e.primaryMeetingJoinAck!=null&&Object.hasOwnProperty.call(e,"primaryMeetingJoinAck")&&f.SdkPrimaryMeetingJoinAckFrame.encode(e.primaryMeetingJoinAck,i.uint32(218).fork()).ldelim(),e.primaryMeetingLeave!=null&&Object.hasOwnProperty.call(e,"primaryMeetingLeave")&&f.SdkPrimaryMeetingLeaveFrame.encode(e.primaryMeetingLeave,i.uint32(226).fork()).ldelim(),e.notification!=null&&Object.hasOwnProperty.call(e,"notification")&&f.SdkNotificationFrame.encode(e.notification,i.uint32(282).fork()).ldelim(),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkSignalFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.timestampMs=e.uint64();break}case 2:{o.type=e.int32();break}case 3:{o.error=f.SdkErrorFrame.decode(e,e.uint32());break}case 4:{o.join=f.SdkJoinFrame.decode(e,e.uint32());break}case 5:{o.joinack=f.SdkJoinAckFrame.decode(e,e.uint32());break}case 6:{o.sub=f.SdkSubscribeFrame.decode(e,e.uint32());break}case 7:{o.suback=f.SdkSubscribeAckFrame.decode(e,e.uint32());break}case 8:{o.index=f.SdkIndexFrame.decode(e,e.uint32());break}case 10:{o.pause=f.SdkPauseResumeFrame.decode(e,e.uint32());break}case 11:{o.leave=f.SdkLeaveFrame.decode(e,e.uint32());break}case 12:{o.leaveAck=f.SdkLeaveAckFrame.decode(e,e.uint32());break}case 14:{o.bitrates=f.SdkBitrateFrame.decode(e,e.uint32());break}case 17:{o.audioControl=f.SdkAudioControlFrame.decode(e,e.uint32());break}case 18:{o.audioMetadata=f.SdkAudioMetadataFrame.decode(e,e.uint32());break}case 19:{o.audioStreamIdInfo=f.SdkAudioStreamIdInfoFrame.decode(e,e.uint32());break}case 20:{o.pingPong=f.SdkPingPongFrame.decode(e,e.uint32());break}case 21:{o.audioStatus=f.SdkAudioStatusFrame.decode(e,e.uint32());break}case 22:{o.clientMetric=f.SdkClientMetricFrame.decode(e,e.uint32());break}case 23:{o.dataMessage=f.SdkDataMessageFrame.decode(e,e.uint32());break}case 25:{o.remoteVideoUpdate=f.SdkRemoteVideoUpdateFrame.decode(e,e.uint32());break}case 26:{o.primaryMeetingJoin=f.SdkPrimaryMeetingJoinFrame.decode(e,e.uint32());break}case 27:{o.primaryMeetingJoinAck=f.SdkPrimaryMeetingJoinAckFrame.decode(e,e.uint32());break}case 28:{o.primaryMeetingLeave=f.SdkPrimaryMeetingLeaveFrame.decode(e,e.uint32());break}case 35:{o.notification=f.SdkNotificationFrame.decode(e,e.uint32());break}default:e.skipType(s&7);break}}if(!o.hasOwnProperty("timestampMs"))throw v.ProtocolError("missing required 'timestampMs'",{instance:o});if(!o.hasOwnProperty("type"))throw v.ProtocolError("missing required 'type'",{instance:o});return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(!v.isInteger(e.timestampMs)&&!(e.timestampMs&&v.isInteger(e.timestampMs.low)&&v.isInteger(e.timestampMs.high)))return"timestampMs: integer|Long expected";switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:case 13:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 24:case 25:case 26:case 27:case 34:break}if(e.error!=null&&e.hasOwnProperty("error")){var i=f.SdkErrorFrame.verify(e.error);if(i)return"error."+i}if(e.join!=null&&e.hasOwnProperty("join")){var i=f.SdkJoinFrame.verify(e.join);if(i)return"join."+i}if(e.joinack!=null&&e.hasOwnProperty("joinack")){var i=f.SdkJoinAckFrame.verify(e.joinack);if(i)return"joinack."+i}if(e.sub!=null&&e.hasOwnProperty("sub")){var i=f.SdkSubscribeFrame.verify(e.sub);if(i)return"sub."+i}if(e.suback!=null&&e.hasOwnProperty("suback")){var i=f.SdkSubscribeAckFrame.verify(e.suback);if(i)return"suback."+i}if(e.index!=null&&e.hasOwnProperty("index")){var i=f.SdkIndexFrame.verify(e.index);if(i)return"index."+i}if(e.pause!=null&&e.hasOwnProperty("pause")){var i=f.SdkPauseResumeFrame.verify(e.pause);if(i)return"pause."+i}if(e.leave!=null&&e.hasOwnProperty("leave")){var i=f.SdkLeaveFrame.verify(e.leave);if(i)return"leave."+i}if(e.leaveAck!=null&&e.hasOwnProperty("leaveAck")){var i=f.SdkLeaveAckFrame.verify(e.leaveAck);if(i)return"leaveAck."+i}if(e.bitrates!=null&&e.hasOwnProperty("bitrates")){var i=f.SdkBitrateFrame.verify(e.bitrates);if(i)return"bitrates."+i}if(e.audioControl!=null&&e.hasOwnProperty("audioControl")){var i=f.SdkAudioControlFrame.verify(e.audioControl);if(i)return"audioControl."+i}if(e.audioMetadata!=null&&e.hasOwnProperty("audioMetadata")){var i=f.SdkAudioMetadataFrame.verify(e.audioMetadata);if(i)return"audioMetadata."+i}if(e.audioStreamIdInfo!=null&&e.hasOwnProperty("audioStreamIdInfo")){var i=f.SdkAudioStreamIdInfoFrame.verify(e.audioStreamIdInfo);if(i)return"audioStreamIdInfo."+i}if(e.pingPong!=null&&e.hasOwnProperty("pingPong")){var i=f.SdkPingPongFrame.verify(e.pingPong);if(i)return"pingPong."+i}if(e.audioStatus!=null&&e.hasOwnProperty("audioStatus")){var i=f.SdkAudioStatusFrame.verify(e.audioStatus);if(i)return"audioStatus."+i}if(e.clientMetric!=null&&e.hasOwnProperty("clientMetric")){var i=f.SdkClientMetricFrame.verify(e.clientMetric);if(i)return"clientMetric."+i}if(e.dataMessage!=null&&e.hasOwnProperty("dataMessage")){var i=f.SdkDataMessageFrame.verify(e.dataMessage);if(i)return"dataMessage."+i}if(e.remoteVideoUpdate!=null&&e.hasOwnProperty("remoteVideoUpdate")){var i=f.SdkRemoteVideoUpdateFrame.verify(e.remoteVideoUpdate);if(i)return"remoteVideoUpdate."+i}if(e.primaryMeetingJoin!=null&&e.hasOwnProperty("primaryMeetingJoin")){var i=f.SdkPrimaryMeetingJoinFrame.verify(e.primaryMeetingJoin);if(i)return"primaryMeetingJoin."+i}if(e.primaryMeetingJoinAck!=null&&e.hasOwnProperty("primaryMeetingJoinAck")){var i=f.SdkPrimaryMeetingJoinAckFrame.verify(e.primaryMeetingJoinAck);if(i)return"primaryMeetingJoinAck."+i}if(e.primaryMeetingLeave!=null&&e.hasOwnProperty("primaryMeetingLeave")){var i=f.SdkPrimaryMeetingLeaveFrame.verify(e.primaryMeetingLeave);if(i)return"primaryMeetingLeave."+i}if(e.notification!=null&&e.hasOwnProperty("notification")){var i=f.SdkNotificationFrame.verify(e.notification);if(i)return"notification."+i}return null},n.fromObject=function(e){if(e instanceof f.SdkSignalFrame)return e;var i=new f.SdkSignalFrame;switch(e.timestampMs!=null&&(v.Long?(i.timestampMs=v.Long.fromValue(e.timestampMs)).unsigned=!0:typeof e.timestampMs=="string"?i.timestampMs=parseInt(e.timestampMs,10):typeof e.timestampMs=="number"?i.timestampMs=e.timestampMs:typeof e.timestampMs=="object"&&(i.timestampMs=new v.LongBits(e.timestampMs.low>>>0,e.timestampMs.high>>>0).toNumber(!0))),e.type){default:if(typeof e.type=="number"){i.type=e.type;break}break;case"JOIN":case 1:i.type=1;break;case"JOIN_ACK":case 2:i.type=2;break;case"SUBSCRIBE":case 3:i.type=3;break;case"SUBSCRIBE_ACK":case 4:i.type=4;break;case"INDEX":case 5:i.type=5;break;case"PAUSE":case 7:i.type=7;break;case"RESUME":case 8:i.type=8;break;case"LEAVE":case 9:i.type=9;break;case"LEAVE_ACK":case 10:i.type=10;break;case"BITRATES":case 13:i.type=13;break;case"AUDIO_CONTROL":case 16:i.type=16;break;case"AUDIO_METADATA":case 17:i.type=17;break;case"AUDIO_STREAM_ID_INFO":case 18:i.type=18;break;case"PING_PONG":case 19:i.type=19;break;case"AUDIO_STATUS":case 20:i.type=20;break;case"CLIENT_METRIC":case 21:i.type=21;break;case"DATA_MESSAGE":case 22:i.type=22;break;case"REMOTE_VIDEO_UPDATE":case 24:i.type=24;break;case"PRIMARY_MEETING_JOIN":case 25:i.type=25;break;case"PRIMARY_MEETING_JOIN_ACK":case 26:i.type=26;break;case"PRIMARY_MEETING_LEAVE":case 27:i.type=27;break;case"NOTIFICATION":case 34:i.type=34;break}if(e.error!=null){if(typeof e.error!="object")throw TypeError(".SdkSignalFrame.error: object expected");i.error=f.SdkErrorFrame.fromObject(e.error)}if(e.join!=null){if(typeof e.join!="object")throw TypeError(".SdkSignalFrame.join: object expected");i.join=f.SdkJoinFrame.fromObject(e.join)}if(e.joinack!=null){if(typeof e.joinack!="object")throw TypeError(".SdkSignalFrame.joinack: object expected");i.joinack=f.SdkJoinAckFrame.fromObject(e.joinack)}if(e.sub!=null){if(typeof e.sub!="object")throw TypeError(".SdkSignalFrame.sub: object expected");i.sub=f.SdkSubscribeFrame.fromObject(e.sub)}if(e.suback!=null){if(typeof e.suback!="object")throw TypeError(".SdkSignalFrame.suback: object expected");i.suback=f.SdkSubscribeAckFrame.fromObject(e.suback)}if(e.index!=null){if(typeof e.index!="object")throw TypeError(".SdkSignalFrame.index: object expected");i.index=f.SdkIndexFrame.fromObject(e.index)}if(e.pause!=null){if(typeof e.pause!="object")throw TypeError(".SdkSignalFrame.pause: object expected");i.pause=f.SdkPauseResumeFrame.fromObject(e.pause)}if(e.leave!=null){if(typeof e.leave!="object")throw TypeError(".SdkSignalFrame.leave: object expected");i.leave=f.SdkLeaveFrame.fromObject(e.leave)}if(e.leaveAck!=null){if(typeof e.leaveAck!="object")throw TypeError(".SdkSignalFrame.leaveAck: object expected");i.leaveAck=f.SdkLeaveAckFrame.fromObject(e.leaveAck)}if(e.bitrates!=null){if(typeof e.bitrates!="object")throw TypeError(".SdkSignalFrame.bitrates: object expected");i.bitrates=f.SdkBitrateFrame.fromObject(e.bitrates)}if(e.audioControl!=null){if(typeof e.audioControl!="object")throw TypeError(".SdkSignalFrame.audioControl: object expected");i.audioControl=f.SdkAudioControlFrame.fromObject(e.audioControl)}if(e.audioMetadata!=null){if(typeof e.audioMetadata!="object")throw TypeError(".SdkSignalFrame.audioMetadata: object expected");i.audioMetadata=f.SdkAudioMetadataFrame.fromObject(e.audioMetadata)}if(e.audioStreamIdInfo!=null){if(typeof e.audioStreamIdInfo!="object")throw TypeError(".SdkSignalFrame.audioStreamIdInfo: object expected");i.audioStreamIdInfo=f.SdkAudioStreamIdInfoFrame.fromObject(e.audioStreamIdInfo)}if(e.pingPong!=null){if(typeof e.pingPong!="object")throw TypeError(".SdkSignalFrame.pingPong: object expected");i.pingPong=f.SdkPingPongFrame.fromObject(e.pingPong)}if(e.audioStatus!=null){if(typeof e.audioStatus!="object")throw TypeError(".SdkSignalFrame.audioStatus: object expected");i.audioStatus=f.SdkAudioStatusFrame.fromObject(e.audioStatus)}if(e.clientMetric!=null){if(typeof e.clientMetric!="object")throw TypeError(".SdkSignalFrame.clientMetric: object expected");i.clientMetric=f.SdkClientMetricFrame.fromObject(e.clientMetric)}if(e.dataMessage!=null){if(typeof e.dataMessage!="object")throw TypeError(".SdkSignalFrame.dataMessage: object expected");i.dataMessage=f.SdkDataMessageFrame.fromObject(e.dataMessage)}if(e.remoteVideoUpdate!=null){if(typeof e.remoteVideoUpdate!="object")throw TypeError(".SdkSignalFrame.remoteVideoUpdate: object expected");i.remoteVideoUpdate=f.SdkRemoteVideoUpdateFrame.fromObject(e.remoteVideoUpdate)}if(e.primaryMeetingJoin!=null){if(typeof e.primaryMeetingJoin!="object")throw TypeError(".SdkSignalFrame.primaryMeetingJoin: object expected");i.primaryMeetingJoin=f.SdkPrimaryMeetingJoinFrame.fromObject(e.primaryMeetingJoin)}if(e.primaryMeetingJoinAck!=null){if(typeof e.primaryMeetingJoinAck!="object")throw TypeError(".SdkSignalFrame.primaryMeetingJoinAck: object expected");i.primaryMeetingJoinAck=f.SdkPrimaryMeetingJoinAckFrame.fromObject(e.primaryMeetingJoinAck)}if(e.primaryMeetingLeave!=null){if(typeof e.primaryMeetingLeave!="object")throw TypeError(".SdkSignalFrame.primaryMeetingLeave: object expected");i.primaryMeetingLeave=f.SdkPrimaryMeetingLeaveFrame.fromObject(e.primaryMeetingLeave)}if(e.notification!=null){if(typeof e.notification!="object")throw TypeError(".SdkSignalFrame.notification: object expected");i.notification=f.SdkNotificationFrame.fromObject(e.notification)}return i},n.toObject=function(e,i){i||(i={});var r={};if(i.defaults){if(v.Long){var o=new v.Long(0,0,!0);r.timestampMs=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.timestampMs=i.longs===String?"0":0;r.type=i.enums===String?"JOIN":1,r.error=null,r.join=null,r.joinack=null,r.sub=null,r.suback=null,r.index=null,r.pause=null,r.leave=null,r.leaveAck=null,r.bitrates=null,r.audioControl=null,r.audioMetadata=null,r.audioStreamIdInfo=null,r.pingPong=null,r.audioStatus=null,r.clientMetric=null,r.dataMessage=null,r.remoteVideoUpdate=null,r.primaryMeetingJoin=null,r.primaryMeetingJoinAck=null,r.primaryMeetingLeave=null,r.notification=null}return e.timestampMs!=null&&e.hasOwnProperty("timestampMs")&&(typeof e.timestampMs=="number"?r.timestampMs=i.longs===String?String(e.timestampMs):e.timestampMs:r.timestampMs=i.longs===String?v.Long.prototype.toString.call(e.timestampMs):i.longs===Number?new v.LongBits(e.timestampMs.low>>>0,e.timestampMs.high>>>0).toNumber(!0):e.timestampMs),e.type!=null&&e.hasOwnProperty("type")&&(r.type=i.enums===String?f.SdkSignalFrame.Type[e.type]===void 0?e.type:f.SdkSignalFrame.Type[e.type]:e.type),e.error!=null&&e.hasOwnProperty("error")&&(r.error=f.SdkErrorFrame.toObject(e.error,i)),e.join!=null&&e.hasOwnProperty("join")&&(r.join=f.SdkJoinFrame.toObject(e.join,i)),e.joinack!=null&&e.hasOwnProperty("joinack")&&(r.joinack=f.SdkJoinAckFrame.toObject(e.joinack,i)),e.sub!=null&&e.hasOwnProperty("sub")&&(r.sub=f.SdkSubscribeFrame.toObject(e.sub,i)),e.suback!=null&&e.hasOwnProperty("suback")&&(r.suback=f.SdkSubscribeAckFrame.toObject(e.suback,i)),e.index!=null&&e.hasOwnProperty("index")&&(r.index=f.SdkIndexFrame.toObject(e.index,i)),e.pause!=null&&e.hasOwnProperty("pause")&&(r.pause=f.SdkPauseResumeFrame.toObject(e.pause,i)),e.leave!=null&&e.hasOwnProperty("leave")&&(r.leave=f.SdkLeaveFrame.toObject(e.leave,i)),e.leaveAck!=null&&e.hasOwnProperty("leaveAck")&&(r.leaveAck=f.SdkLeaveAckFrame.toObject(e.leaveAck,i)),e.bitrates!=null&&e.hasOwnProperty("bitrates")&&(r.bitrates=f.SdkBitrateFrame.toObject(e.bitrates,i)),e.audioControl!=null&&e.hasOwnProperty("audioControl")&&(r.audioControl=f.SdkAudioControlFrame.toObject(e.audioControl,i)),e.audioMetadata!=null&&e.hasOwnProperty("audioMetadata")&&(r.audioMetadata=f.SdkAudioMetadataFrame.toObject(e.audioMetadata,i)),e.audioStreamIdInfo!=null&&e.hasOwnProperty("audioStreamIdInfo")&&(r.audioStreamIdInfo=f.SdkAudioStreamIdInfoFrame.toObject(e.audioStreamIdInfo,i)),e.pingPong!=null&&e.hasOwnProperty("pingPong")&&(r.pingPong=f.SdkPingPongFrame.toObject(e.pingPong,i)),e.audioStatus!=null&&e.hasOwnProperty("audioStatus")&&(r.audioStatus=f.SdkAudioStatusFrame.toObject(e.audioStatus,i)),e.clientMetric!=null&&e.hasOwnProperty("clientMetric")&&(r.clientMetric=f.SdkClientMetricFrame.toObject(e.clientMetric,i)),e.dataMessage!=null&&e.hasOwnProperty("dataMessage")&&(r.dataMessage=f.SdkDataMessageFrame.toObject(e.dataMessage,i)),e.remoteVideoUpdate!=null&&e.hasOwnProperty("remoteVideoUpdate")&&(r.remoteVideoUpdate=f.SdkRemoteVideoUpdateFrame.toObject(e.remoteVideoUpdate,i)),e.primaryMeetingJoin!=null&&e.hasOwnProperty("primaryMeetingJoin")&&(r.primaryMeetingJoin=f.SdkPrimaryMeetingJoinFrame.toObject(e.primaryMeetingJoin,i)),e.primaryMeetingJoinAck!=null&&e.hasOwnProperty("primaryMeetingJoinAck")&&(r.primaryMeetingJoinAck=f.SdkPrimaryMeetingJoinAckFrame.toObject(e.primaryMeetingJoinAck,i)),e.primaryMeetingLeave!=null&&e.hasOwnProperty("primaryMeetingLeave")&&(r.primaryMeetingLeave=f.SdkPrimaryMeetingLeaveFrame.toObject(e.primaryMeetingLeave,i)),e.notification!=null&&e.hasOwnProperty("notification")&&(r.notification=f.SdkNotificationFrame.toObject(e.notification,i)),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkSignalFrame"},n.Type=(function(){var t={},e=Object.create(t);return e[t[1]="JOIN"]=1,e[t[2]="JOIN_ACK"]=2,e[t[3]="SUBSCRIBE"]=3,e[t[4]="SUBSCRIBE_ACK"]=4,e[t[5]="INDEX"]=5,e[t[7]="PAUSE"]=7,e[t[8]="RESUME"]=8,e[t[9]="LEAVE"]=9,e[t[10]="LEAVE_ACK"]=10,e[t[13]="BITRATES"]=13,e[t[16]="AUDIO_CONTROL"]=16,e[t[17]="AUDIO_METADATA"]=17,e[t[18]="AUDIO_STREAM_ID_INFO"]=18,e[t[19]="PING_PONG"]=19,e[t[20]="AUDIO_STATUS"]=20,e[t[21]="CLIENT_METRIC"]=21,e[t[22]="DATA_MESSAGE"]=22,e[t[24]="REMOTE_VIDEO_UPDATE"]=24,e[t[25]="PRIMARY_MEETING_JOIN"]=25,e[t[26]="PRIMARY_MEETING_JOIN_ACK"]=26,e[t[27]="PRIMARY_MEETING_LEAVE"]=27,e[t[34]="NOTIFICATION"]=34,e})(),n})();f.SdkErrorFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.status=0,n.prototype.description="",n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.status!=null&&Object.hasOwnProperty.call(e,"status")&&i.uint32(8).uint32(e.status),e.description!=null&&Object.hasOwnProperty.call(e,"description")&&i.uint32(18).string(e.description),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkErrorFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.status=e.uint32();break}case 2:{o.description=e.string();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.status!=null&&e.hasOwnProperty("status")&&!v.isInteger(e.status)?"status: integer expected":e.description!=null&&e.hasOwnProperty("description")&&!v.isString(e.description)?"description: string expected":null},n.fromObject=function(e){if(e instanceof f.SdkErrorFrame)return e;var i=new f.SdkErrorFrame;return e.status!=null&&(i.status=e.status>>>0),e.description!=null&&(i.description=String(e.description)),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.status=0,r.description=""),e.status!=null&&e.hasOwnProperty("status")&&(r.status=e.status),e.description!=null&&e.hasOwnProperty("description")&&(r.description=e.description),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkErrorFrame"},n})();f.SdkJoinFlags=(function(){var n={},t=Object.create(n);return t[n[2]="HAS_STREAM_UPDATE"]=2,t[n[16]="COMPLETE_VIDEO_SOURCES_LIST"]=16,t[n[32]="EXCLUDE_SELF_CONTENT_IN_INDEX"]=32,t})();f.SdkClientDetails=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.appName="",n.prototype.appVersion="",n.prototype.deviceModel="",n.prototype.deviceMake="",n.prototype.platformName="",n.prototype.platformVersion="",n.prototype.clientSource="",n.prototype.chimeSdkVersion="",n.prototype.clientUtcOffset="",n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.appName!=null&&Object.hasOwnProperty.call(e,"appName")&&i.uint32(10).string(e.appName),e.appVersion!=null&&Object.hasOwnProperty.call(e,"appVersion")&&i.uint32(18).string(e.appVersion),e.deviceModel!=null&&Object.hasOwnProperty.call(e,"deviceModel")&&i.uint32(26).string(e.deviceModel),e.deviceMake!=null&&Object.hasOwnProperty.call(e,"deviceMake")&&i.uint32(34).string(e.deviceMake),e.platformName!=null&&Object.hasOwnProperty.call(e,"platformName")&&i.uint32(42).string(e.platformName),e.platformVersion!=null&&Object.hasOwnProperty.call(e,"platformVersion")&&i.uint32(50).string(e.platformVersion),e.clientSource!=null&&Object.hasOwnProperty.call(e,"clientSource")&&i.uint32(58).string(e.clientSource),e.chimeSdkVersion!=null&&Object.hasOwnProperty.call(e,"chimeSdkVersion")&&i.uint32(66).string(e.chimeSdkVersion),e.clientUtcOffset!=null&&Object.hasOwnProperty.call(e,"clientUtcOffset")&&i.uint32(74).string(e.clientUtcOffset),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkClientDetails;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.appName=e.string();break}case 2:{o.appVersion=e.string();break}case 3:{o.deviceModel=e.string();break}case 4:{o.deviceMake=e.string();break}case 5:{o.platformName=e.string();break}case 6:{o.platformVersion=e.string();break}case 7:{o.clientSource=e.string();break}case 8:{o.chimeSdkVersion=e.string();break}case 9:{o.clientUtcOffset=e.string();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.appName!=null&&e.hasOwnProperty("appName")&&!v.isString(e.appName)?"appName: string expected":e.appVersion!=null&&e.hasOwnProperty("appVersion")&&!v.isString(e.appVersion)?"appVersion: string expected":e.deviceModel!=null&&e.hasOwnProperty("deviceModel")&&!v.isString(e.deviceModel)?"deviceModel: string expected":e.deviceMake!=null&&e.hasOwnProperty("deviceMake")&&!v.isString(e.deviceMake)?"deviceMake: string expected":e.platformName!=null&&e.hasOwnProperty("platformName")&&!v.isString(e.platformName)?"platformName: string expected":e.platformVersion!=null&&e.hasOwnProperty("platformVersion")&&!v.isString(e.platformVersion)?"platformVersion: string expected":e.clientSource!=null&&e.hasOwnProperty("clientSource")&&!v.isString(e.clientSource)?"clientSource: string expected":e.chimeSdkVersion!=null&&e.hasOwnProperty("chimeSdkVersion")&&!v.isString(e.chimeSdkVersion)?"chimeSdkVersion: string expected":e.clientUtcOffset!=null&&e.hasOwnProperty("clientUtcOffset")&&!v.isString(e.clientUtcOffset)?"clientUtcOffset: string expected":null},n.fromObject=function(e){if(e instanceof f.SdkClientDetails)return e;var i=new f.SdkClientDetails;return e.appName!=null&&(i.appName=String(e.appName)),e.appVersion!=null&&(i.appVersion=String(e.appVersion)),e.deviceModel!=null&&(i.deviceModel=String(e.deviceModel)),e.deviceMake!=null&&(i.deviceMake=String(e.deviceMake)),e.platformName!=null&&(i.platformName=String(e.platformName)),e.platformVersion!=null&&(i.platformVersion=String(e.platformVersion)),e.clientSource!=null&&(i.clientSource=String(e.clientSource)),e.chimeSdkVersion!=null&&(i.chimeSdkVersion=String(e.chimeSdkVersion)),e.clientUtcOffset!=null&&(i.clientUtcOffset=String(e.clientUtcOffset)),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.appName="",r.appVersion="",r.deviceModel="",r.deviceMake="",r.platformName="",r.platformVersion="",r.clientSource="",r.chimeSdkVersion="",r.clientUtcOffset=""),e.appName!=null&&e.hasOwnProperty("appName")&&(r.appName=e.appName),e.appVersion!=null&&e.hasOwnProperty("appVersion")&&(r.appVersion=e.appVersion),e.deviceModel!=null&&e.hasOwnProperty("deviceModel")&&(r.deviceModel=e.deviceModel),e.deviceMake!=null&&e.hasOwnProperty("deviceMake")&&(r.deviceMake=e.deviceMake),e.platformName!=null&&e.hasOwnProperty("platformName")&&(r.platformName=e.platformName),e.platformVersion!=null&&e.hasOwnProperty("platformVersion")&&(r.platformVersion=e.platformVersion),e.clientSource!=null&&e.hasOwnProperty("clientSource")&&(r.clientSource=e.clientSource),e.chimeSdkVersion!=null&&e.hasOwnProperty("chimeSdkVersion")&&(r.chimeSdkVersion=e.chimeSdkVersion),e.clientUtcOffset!=null&&e.hasOwnProperty("clientUtcOffset")&&(r.clientUtcOffset=e.clientUtcOffset),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkClientDetails"},n})();f.SdkServerSideNetworkAdaption=(function(){var n={},t=Object.create(n);return t[n[1]="DEFAULT"]=1,t[n[2]="NONE"]=2,t[n[3]="BANDWIDTH_PROBING"]=3,t[n[4]="BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION"]=4,t})();f.SdkJoinFrame=(function(){function n(t){if(this.supportedServerSideNetworkAdaptions=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.protocolVersion=2,n.prototype.maxNumOfVideos=0,n.prototype.flags=0,n.prototype.clientDetails=null,n.prototype.audioSessionId=v.Long?v.Long.fromBits(0,0,!0):0,n.prototype.wantsCompressedSdp=!1,n.prototype.serverSideNetworkAdaption=1,n.prototype.supportedServerSideNetworkAdaptions=v.emptyArray,n.prototype.wantsAllTemporalLayersInIndex=!1,n.prototype.disablePeriodicKeyframeRequestOnContentSender=!1,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.protocolVersion!=null&&Object.hasOwnProperty.call(e,"protocolVersion")&&i.uint32(8).uint32(e.protocolVersion),e.maxNumOfVideos!=null&&Object.hasOwnProperty.call(e,"maxNumOfVideos")&&i.uint32(16).uint32(e.maxNumOfVideos),e.flags!=null&&Object.hasOwnProperty.call(e,"flags")&&i.uint32(24).uint32(e.flags),e.clientDetails!=null&&Object.hasOwnProperty.call(e,"clientDetails")&&f.SdkClientDetails.encode(e.clientDetails,i.uint32(34).fork()).ldelim(),e.audioSessionId!=null&&Object.hasOwnProperty.call(e,"audioSessionId")&&i.uint32(48).uint64(e.audioSessionId),e.wantsCompressedSdp!=null&&Object.hasOwnProperty.call(e,"wantsCompressedSdp")&&i.uint32(56).bool(e.wantsCompressedSdp),e.serverSideNetworkAdaption!=null&&Object.hasOwnProperty.call(e,"serverSideNetworkAdaption")&&i.uint32(80).int32(e.serverSideNetworkAdaption),e.supportedServerSideNetworkAdaptions!=null&&e.supportedServerSideNetworkAdaptions.length)for(var r=0;r<e.supportedServerSideNetworkAdaptions.length;++r)i.uint32(88).int32(e.supportedServerSideNetworkAdaptions[r]);return e.wantsAllTemporalLayersInIndex!=null&&Object.hasOwnProperty.call(e,"wantsAllTemporalLayersInIndex")&&i.uint32(96).bool(e.wantsAllTemporalLayersInIndex),e.disablePeriodicKeyframeRequestOnContentSender!=null&&Object.hasOwnProperty.call(e,"disablePeriodicKeyframeRequestOnContentSender")&&i.uint32(104).bool(e.disablePeriodicKeyframeRequestOnContentSender),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkJoinFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.protocolVersion=e.uint32();break}case 2:{o.maxNumOfVideos=e.uint32();break}case 3:{o.flags=e.uint32();break}case 4:{o.clientDetails=f.SdkClientDetails.decode(e,e.uint32());break}case 6:{o.audioSessionId=e.uint64();break}case 7:{o.wantsCompressedSdp=e.bool();break}case 10:{o.serverSideNetworkAdaption=e.int32();break}case 11:{if(o.supportedServerSideNetworkAdaptions&&o.supportedServerSideNetworkAdaptions.length||(o.supportedServerSideNetworkAdaptions=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)o.supportedServerSideNetworkAdaptions.push(e.int32());else o.supportedServerSideNetworkAdaptions.push(e.int32());break}case 12:{o.wantsAllTemporalLayersInIndex=e.bool();break}case 13:{o.disablePeriodicKeyframeRequestOnContentSender=e.bool();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.protocolVersion!=null&&e.hasOwnProperty("protocolVersion")&&!v.isInteger(e.protocolVersion))return"protocolVersion: integer expected";if(e.maxNumOfVideos!=null&&e.hasOwnProperty("maxNumOfVideos")&&!v.isInteger(e.maxNumOfVideos))return"maxNumOfVideos: integer expected";if(e.flags!=null&&e.hasOwnProperty("flags")&&!v.isInteger(e.flags))return"flags: integer expected";if(e.clientDetails!=null&&e.hasOwnProperty("clientDetails")){var i=f.SdkClientDetails.verify(e.clientDetails);if(i)return"clientDetails."+i}if(e.audioSessionId!=null&&e.hasOwnProperty("audioSessionId")&&!v.isInteger(e.audioSessionId)&&!(e.audioSessionId&&v.isInteger(e.audioSessionId.low)&&v.isInteger(e.audioSessionId.high)))return"audioSessionId: integer|Long expected";if(e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&typeof e.wantsCompressedSdp!="boolean")return"wantsCompressedSdp: boolean expected";if(e.serverSideNetworkAdaption!=null&&e.hasOwnProperty("serverSideNetworkAdaption"))switch(e.serverSideNetworkAdaption){default:return"serverSideNetworkAdaption: enum value expected";case 1:case 2:case 3:case 4:break}if(e.supportedServerSideNetworkAdaptions!=null&&e.hasOwnProperty("supportedServerSideNetworkAdaptions")){if(!Array.isArray(e.supportedServerSideNetworkAdaptions))return"supportedServerSideNetworkAdaptions: array expected";for(var r=0;r<e.supportedServerSideNetworkAdaptions.length;++r)switch(e.supportedServerSideNetworkAdaptions[r]){default:return"supportedServerSideNetworkAdaptions: enum value[] expected";case 1:case 2:case 3:case 4:break}}return e.wantsAllTemporalLayersInIndex!=null&&e.hasOwnProperty("wantsAllTemporalLayersInIndex")&&typeof e.wantsAllTemporalLayersInIndex!="boolean"?"wantsAllTemporalLayersInIndex: boolean expected":e.disablePeriodicKeyframeRequestOnContentSender!=null&&e.hasOwnProperty("disablePeriodicKeyframeRequestOnContentSender")&&typeof e.disablePeriodicKeyframeRequestOnContentSender!="boolean"?"disablePeriodicKeyframeRequestOnContentSender: boolean expected":null},n.fromObject=function(e){if(e instanceof f.SdkJoinFrame)return e;var i=new f.SdkJoinFrame;if(e.protocolVersion!=null&&(i.protocolVersion=e.protocolVersion>>>0),e.maxNumOfVideos!=null&&(i.maxNumOfVideos=e.maxNumOfVideos>>>0),e.flags!=null&&(i.flags=e.flags>>>0),e.clientDetails!=null){if(typeof e.clientDetails!="object")throw TypeError(".SdkJoinFrame.clientDetails: object expected");i.clientDetails=f.SdkClientDetails.fromObject(e.clientDetails)}switch(e.audioSessionId!=null&&(v.Long?(i.audioSessionId=v.Long.fromValue(e.audioSessionId)).unsigned=!0:typeof e.audioSessionId=="string"?i.audioSessionId=parseInt(e.audioSessionId,10):typeof e.audioSessionId=="number"?i.audioSessionId=e.audioSessionId:typeof e.audioSessionId=="object"&&(i.audioSessionId=new v.LongBits(e.audioSessionId.low>>>0,e.audioSessionId.high>>>0).toNumber(!0))),e.wantsCompressedSdp!=null&&(i.wantsCompressedSdp=!!e.wantsCompressedSdp),e.serverSideNetworkAdaption){default:if(typeof e.serverSideNetworkAdaption=="number"){i.serverSideNetworkAdaption=e.serverSideNetworkAdaption;break}break;case"DEFAULT":case 1:i.serverSideNetworkAdaption=1;break;case"NONE":case 2:i.serverSideNetworkAdaption=2;break;case"BANDWIDTH_PROBING":case 3:i.serverSideNetworkAdaption=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:i.serverSideNetworkAdaption=4;break}if(e.supportedServerSideNetworkAdaptions){if(!Array.isArray(e.supportedServerSideNetworkAdaptions))throw TypeError(".SdkJoinFrame.supportedServerSideNetworkAdaptions: array expected");i.supportedServerSideNetworkAdaptions=[];for(var r=0;r<e.supportedServerSideNetworkAdaptions.length;++r)switch(e.supportedServerSideNetworkAdaptions[r]){default:if(typeof e.supportedServerSideNetworkAdaptions[r]=="number"){i.supportedServerSideNetworkAdaptions[r]=e.supportedServerSideNetworkAdaptions[r];break}case"DEFAULT":case 1:i.supportedServerSideNetworkAdaptions[r]=1;break;case"NONE":case 2:i.supportedServerSideNetworkAdaptions[r]=2;break;case"BANDWIDTH_PROBING":case 3:i.supportedServerSideNetworkAdaptions[r]=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:i.supportedServerSideNetworkAdaptions[r]=4;break}}return e.wantsAllTemporalLayersInIndex!=null&&(i.wantsAllTemporalLayersInIndex=!!e.wantsAllTemporalLayersInIndex),e.disablePeriodicKeyframeRequestOnContentSender!=null&&(i.disablePeriodicKeyframeRequestOnContentSender=!!e.disablePeriodicKeyframeRequestOnContentSender),i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.supportedServerSideNetworkAdaptions=[]),i.defaults){if(r.protocolVersion=2,r.maxNumOfVideos=0,r.flags=0,r.clientDetails=null,v.Long){var o=new v.Long(0,0,!0);r.audioSessionId=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.audioSessionId=i.longs===String?"0":0;r.wantsCompressedSdp=!1,r.serverSideNetworkAdaption=i.enums===String?"DEFAULT":1,r.wantsAllTemporalLayersInIndex=!1,r.disablePeriodicKeyframeRequestOnContentSender=!1}if(e.protocolVersion!=null&&e.hasOwnProperty("protocolVersion")&&(r.protocolVersion=e.protocolVersion),e.maxNumOfVideos!=null&&e.hasOwnProperty("maxNumOfVideos")&&(r.maxNumOfVideos=e.maxNumOfVideos),e.flags!=null&&e.hasOwnProperty("flags")&&(r.flags=e.flags),e.clientDetails!=null&&e.hasOwnProperty("clientDetails")&&(r.clientDetails=f.SdkClientDetails.toObject(e.clientDetails,i)),e.audioSessionId!=null&&e.hasOwnProperty("audioSessionId")&&(typeof e.audioSessionId=="number"?r.audioSessionId=i.longs===String?String(e.audioSessionId):e.audioSessionId:r.audioSessionId=i.longs===String?v.Long.prototype.toString.call(e.audioSessionId):i.longs===Number?new v.LongBits(e.audioSessionId.low>>>0,e.audioSessionId.high>>>0).toNumber(!0):e.audioSessionId),e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&(r.wantsCompressedSdp=e.wantsCompressedSdp),e.serverSideNetworkAdaption!=null&&e.hasOwnProperty("serverSideNetworkAdaption")&&(r.serverSideNetworkAdaption=i.enums===String?f.SdkServerSideNetworkAdaption[e.serverSideNetworkAdaption]===void 0?e.serverSideNetworkAdaption:f.SdkServerSideNetworkAdaption[e.serverSideNetworkAdaption]:e.serverSideNetworkAdaption),e.supportedServerSideNetworkAdaptions&&e.supportedServerSideNetworkAdaptions.length){r.supportedServerSideNetworkAdaptions=[];for(var s=0;s<e.supportedServerSideNetworkAdaptions.length;++s)r.supportedServerSideNetworkAdaptions[s]=i.enums===String?f.SdkServerSideNetworkAdaption[e.supportedServerSideNetworkAdaptions[s]]===void 0?e.supportedServerSideNetworkAdaptions[s]:f.SdkServerSideNetworkAdaption[e.supportedServerSideNetworkAdaptions[s]]:e.supportedServerSideNetworkAdaptions[s]}return e.wantsAllTemporalLayersInIndex!=null&&e.hasOwnProperty("wantsAllTemporalLayersInIndex")&&(r.wantsAllTemporalLayersInIndex=e.wantsAllTemporalLayersInIndex),e.disablePeriodicKeyframeRequestOnContentSender!=null&&e.hasOwnProperty("disablePeriodicKeyframeRequestOnContentSender")&&(r.disablePeriodicKeyframeRequestOnContentSender=e.disablePeriodicKeyframeRequestOnContentSender),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkJoinFrame"},n})();f.SdkJoinAckFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.turnCredentials=null,n.prototype.videoSubscriptionLimit=0,n.prototype.wantsCompressedSdp=!1,n.prototype.defaultServerSideNetworkAdaption=1,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.turnCredentials!=null&&Object.hasOwnProperty.call(e,"turnCredentials")&&f.SdkTurnCredentials.encode(e.turnCredentials,i.uint32(10).fork()).ldelim(),e.videoSubscriptionLimit!=null&&Object.hasOwnProperty.call(e,"videoSubscriptionLimit")&&i.uint32(16).uint32(e.videoSubscriptionLimit),e.wantsCompressedSdp!=null&&Object.hasOwnProperty.call(e,"wantsCompressedSdp")&&i.uint32(24).bool(e.wantsCompressedSdp),e.defaultServerSideNetworkAdaption!=null&&Object.hasOwnProperty.call(e,"defaultServerSideNetworkAdaption")&&i.uint32(32).int32(e.defaultServerSideNetworkAdaption),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkJoinAckFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.turnCredentials=f.SdkTurnCredentials.decode(e,e.uint32());break}case 2:{o.videoSubscriptionLimit=e.uint32();break}case 3:{o.wantsCompressedSdp=e.bool();break}case 4:{o.defaultServerSideNetworkAdaption=e.int32();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.turnCredentials!=null&&e.hasOwnProperty("turnCredentials")){var i=f.SdkTurnCredentials.verify(e.turnCredentials);if(i)return"turnCredentials."+i}if(e.videoSubscriptionLimit!=null&&e.hasOwnProperty("videoSubscriptionLimit")&&!v.isInteger(e.videoSubscriptionLimit))return"videoSubscriptionLimit: integer expected";if(e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&typeof e.wantsCompressedSdp!="boolean")return"wantsCompressedSdp: boolean expected";if(e.defaultServerSideNetworkAdaption!=null&&e.hasOwnProperty("defaultServerSideNetworkAdaption"))switch(e.defaultServerSideNetworkAdaption){default:return"defaultServerSideNetworkAdaption: enum value expected";case 1:case 2:case 3:case 4:break}return null},n.fromObject=function(e){if(e instanceof f.SdkJoinAckFrame)return e;var i=new f.SdkJoinAckFrame;if(e.turnCredentials!=null){if(typeof e.turnCredentials!="object")throw TypeError(".SdkJoinAckFrame.turnCredentials: object expected");i.turnCredentials=f.SdkTurnCredentials.fromObject(e.turnCredentials)}switch(e.videoSubscriptionLimit!=null&&(i.videoSubscriptionLimit=e.videoSubscriptionLimit>>>0),e.wantsCompressedSdp!=null&&(i.wantsCompressedSdp=!!e.wantsCompressedSdp),e.defaultServerSideNetworkAdaption){default:if(typeof e.defaultServerSideNetworkAdaption=="number"){i.defaultServerSideNetworkAdaption=e.defaultServerSideNetworkAdaption;break}break;case"DEFAULT":case 1:i.defaultServerSideNetworkAdaption=1;break;case"NONE":case 2:i.defaultServerSideNetworkAdaption=2;break;case"BANDWIDTH_PROBING":case 3:i.defaultServerSideNetworkAdaption=3;break;case"BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION":case 4:i.defaultServerSideNetworkAdaption=4;break}return i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.turnCredentials=null,r.videoSubscriptionLimit=0,r.wantsCompressedSdp=!1,r.defaultServerSideNetworkAdaption=i.enums===String?"DEFAULT":1),e.turnCredentials!=null&&e.hasOwnProperty("turnCredentials")&&(r.turnCredentials=f.SdkTurnCredentials.toObject(e.turnCredentials,i)),e.videoSubscriptionLimit!=null&&e.hasOwnProperty("videoSubscriptionLimit")&&(r.videoSubscriptionLimit=e.videoSubscriptionLimit),e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&(r.wantsCompressedSdp=e.wantsCompressedSdp),e.defaultServerSideNetworkAdaption!=null&&e.hasOwnProperty("defaultServerSideNetworkAdaption")&&(r.defaultServerSideNetworkAdaption=i.enums===String?f.SdkServerSideNetworkAdaption[e.defaultServerSideNetworkAdaption]===void 0?e.defaultServerSideNetworkAdaption:f.SdkServerSideNetworkAdaption[e.defaultServerSideNetworkAdaption]:e.defaultServerSideNetworkAdaption),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkJoinAckFrame"},n})();f.SdkLeaveFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkLeaveFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":null},n.fromObject=function(e){return e instanceof f.SdkLeaveFrame?e:new f.SdkLeaveFrame},n.toObject=function(){return{}},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkLeaveFrame"},n})();f.SdkLeaveAckFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkLeaveAckFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":null},n.fromObject=function(e){return e instanceof f.SdkLeaveAckFrame?e:new f.SdkLeaveAckFrame},n.toObject=function(){return{}},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkLeaveAckFrame"},n})();f.SdkStreamServiceType=(function(){var n={},t=Object.create(n);return t[n[1]="RX"]=1,t[n[2]="TX"]=2,t[n[3]="DUPLEX"]=3,t})();f.SdkStreamMediaType=(function(){var n={},t=Object.create(n);return t[n[1]="AUDIO"]=1,t[n[2]="VIDEO"]=2,t})();f.SdkSubscribeFrame=(function(){function n(t){if(this.sendStreams=[],this.receiveStreamIds=[],this.videoSubscriptionConfiguration=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.duplex=1,n.prototype.sendStreams=v.emptyArray,n.prototype.receiveStreamIds=v.emptyArray,n.prototype.sdpOffer="",n.prototype.audioHost="",n.prototype.audioCheckin=!1,n.prototype.audioMuted=!1,n.prototype.compressedSdpOffer=v.newBuffer([]),n.prototype.videoSubscriptionConfiguration=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.duplex!=null&&Object.hasOwnProperty.call(e,"duplex")&&i.uint32(8).int32(e.duplex),e.sendStreams!=null&&e.sendStreams.length)for(var r=0;r<e.sendStreams.length;++r)f.SdkStreamDescriptor.encode(e.sendStreams[r],i.uint32(18).fork()).ldelim();if(e.receiveStreamIds!=null&&e.receiveStreamIds.length)for(var r=0;r<e.receiveStreamIds.length;++r)i.uint32(24).uint32(e.receiveStreamIds[r]);if(e.sdpOffer!=null&&Object.hasOwnProperty.call(e,"sdpOffer")&&i.uint32(34).string(e.sdpOffer),e.audioHost!=null&&Object.hasOwnProperty.call(e,"audioHost")&&i.uint32(42).string(e.audioHost),e.audioCheckin!=null&&Object.hasOwnProperty.call(e,"audioCheckin")&&i.uint32(48).bool(e.audioCheckin),e.audioMuted!=null&&Object.hasOwnProperty.call(e,"audioMuted")&&i.uint32(56).bool(e.audioMuted),e.compressedSdpOffer!=null&&Object.hasOwnProperty.call(e,"compressedSdpOffer")&&i.uint32(66).bytes(e.compressedSdpOffer),e.videoSubscriptionConfiguration!=null&&e.videoSubscriptionConfiguration.length)for(var r=0;r<e.videoSubscriptionConfiguration.length;++r)f.SdkVideoSubscriptionConfiguration.encode(e.videoSubscriptionConfiguration[r],i.uint32(74).fork()).ldelim();return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkSubscribeFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.duplex=e.int32();break}case 2:{o.sendStreams&&o.sendStreams.length||(o.sendStreams=[]),o.sendStreams.push(f.SdkStreamDescriptor.decode(e,e.uint32()));break}case 3:{if(o.receiveStreamIds&&o.receiveStreamIds.length||(o.receiveStreamIds=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)o.receiveStreamIds.push(e.uint32());else o.receiveStreamIds.push(e.uint32());break}case 4:{o.sdpOffer=e.string();break}case 5:{o.audioHost=e.string();break}case 6:{o.audioCheckin=e.bool();break}case 7:{o.audioMuted=e.bool();break}case 8:{o.compressedSdpOffer=e.bytes();break}case 9:{o.videoSubscriptionConfiguration&&o.videoSubscriptionConfiguration.length||(o.videoSubscriptionConfiguration=[]),o.videoSubscriptionConfiguration.push(f.SdkVideoSubscriptionConfiguration.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.duplex!=null&&e.hasOwnProperty("duplex"))switch(e.duplex){default:return"duplex: enum value expected";case 1:case 2:case 3:break}if(e.sendStreams!=null&&e.hasOwnProperty("sendStreams")){if(!Array.isArray(e.sendStreams))return"sendStreams: array expected";for(var i=0;i<e.sendStreams.length;++i){var r=f.SdkStreamDescriptor.verify(e.sendStreams[i]);if(r)return"sendStreams."+r}}if(e.receiveStreamIds!=null&&e.hasOwnProperty("receiveStreamIds")){if(!Array.isArray(e.receiveStreamIds))return"receiveStreamIds: array expected";for(var i=0;i<e.receiveStreamIds.length;++i)if(!v.isInteger(e.receiveStreamIds[i]))return"receiveStreamIds: integer[] expected"}if(e.sdpOffer!=null&&e.hasOwnProperty("sdpOffer")&&!v.isString(e.sdpOffer))return"sdpOffer: string expected";if(e.audioHost!=null&&e.hasOwnProperty("audioHost")&&!v.isString(e.audioHost))return"audioHost: string expected";if(e.audioCheckin!=null&&e.hasOwnProperty("audioCheckin")&&typeof e.audioCheckin!="boolean")return"audioCheckin: boolean expected";if(e.audioMuted!=null&&e.hasOwnProperty("audioMuted")&&typeof e.audioMuted!="boolean")return"audioMuted: boolean expected";if(e.compressedSdpOffer!=null&&e.hasOwnProperty("compressedSdpOffer")&&!(e.compressedSdpOffer&&typeof e.compressedSdpOffer.length=="number"||v.isString(e.compressedSdpOffer)))return"compressedSdpOffer: buffer expected";if(e.videoSubscriptionConfiguration!=null&&e.hasOwnProperty("videoSubscriptionConfiguration")){if(!Array.isArray(e.videoSubscriptionConfiguration))return"videoSubscriptionConfiguration: array expected";for(var i=0;i<e.videoSubscriptionConfiguration.length;++i){var r=f.SdkVideoSubscriptionConfiguration.verify(e.videoSubscriptionConfiguration[i]);if(r)return"videoSubscriptionConfiguration."+r}}return null},n.fromObject=function(e){if(e instanceof f.SdkSubscribeFrame)return e;var i=new f.SdkSubscribeFrame;switch(e.duplex){default:if(typeof e.duplex=="number"){i.duplex=e.duplex;break}break;case"RX":case 1:i.duplex=1;break;case"TX":case 2:i.duplex=2;break;case"DUPLEX":case 3:i.duplex=3;break}if(e.sendStreams){if(!Array.isArray(e.sendStreams))throw TypeError(".SdkSubscribeFrame.sendStreams: array expected");i.sendStreams=[];for(var r=0;r<e.sendStreams.length;++r){if(typeof e.sendStreams[r]!="object")throw TypeError(".SdkSubscribeFrame.sendStreams: object expected");i.sendStreams[r]=f.SdkStreamDescriptor.fromObject(e.sendStreams[r])}}if(e.receiveStreamIds){if(!Array.isArray(e.receiveStreamIds))throw TypeError(".SdkSubscribeFrame.receiveStreamIds: array expected");i.receiveStreamIds=[];for(var r=0;r<e.receiveStreamIds.length;++r)i.receiveStreamIds[r]=e.receiveStreamIds[r]>>>0}if(e.sdpOffer!=null&&(i.sdpOffer=String(e.sdpOffer)),e.audioHost!=null&&(i.audioHost=String(e.audioHost)),e.audioCheckin!=null&&(i.audioCheckin=!!e.audioCheckin),e.audioMuted!=null&&(i.audioMuted=!!e.audioMuted),e.compressedSdpOffer!=null&&(typeof e.compressedSdpOffer=="string"?v.base64.decode(e.compressedSdpOffer,i.compressedSdpOffer=v.newBuffer(v.base64.length(e.compressedSdpOffer)),0):e.compressedSdpOffer.length>=0&&(i.compressedSdpOffer=e.compressedSdpOffer)),e.videoSubscriptionConfiguration){if(!Array.isArray(e.videoSubscriptionConfiguration))throw TypeError(".SdkSubscribeFrame.videoSubscriptionConfiguration: array expected");i.videoSubscriptionConfiguration=[];for(var r=0;r<e.videoSubscriptionConfiguration.length;++r){if(typeof e.videoSubscriptionConfiguration[r]!="object")throw TypeError(".SdkSubscribeFrame.videoSubscriptionConfiguration: object expected");i.videoSubscriptionConfiguration[r]=f.SdkVideoSubscriptionConfiguration.fromObject(e.videoSubscriptionConfiguration[r])}}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.sendStreams=[],r.receiveStreamIds=[],r.videoSubscriptionConfiguration=[]),i.defaults&&(r.duplex=i.enums===String?"RX":1,r.sdpOffer="",r.audioHost="",r.audioCheckin=!1,r.audioMuted=!1,i.bytes===String?r.compressedSdpOffer="":(r.compressedSdpOffer=[],i.bytes!==Array&&(r.compressedSdpOffer=v.newBuffer(r.compressedSdpOffer)))),e.duplex!=null&&e.hasOwnProperty("duplex")&&(r.duplex=i.enums===String?f.SdkStreamServiceType[e.duplex]===void 0?e.duplex:f.SdkStreamServiceType[e.duplex]:e.duplex),e.sendStreams&&e.sendStreams.length){r.sendStreams=[];for(var o=0;o<e.sendStreams.length;++o)r.sendStreams[o]=f.SdkStreamDescriptor.toObject(e.sendStreams[o],i)}if(e.receiveStreamIds&&e.receiveStreamIds.length){r.receiveStreamIds=[];for(var o=0;o<e.receiveStreamIds.length;++o)r.receiveStreamIds[o]=e.receiveStreamIds[o]}if(e.sdpOffer!=null&&e.hasOwnProperty("sdpOffer")&&(r.sdpOffer=e.sdpOffer),e.audioHost!=null&&e.hasOwnProperty("audioHost")&&(r.audioHost=e.audioHost),e.audioCheckin!=null&&e.hasOwnProperty("audioCheckin")&&(r.audioCheckin=e.audioCheckin),e.audioMuted!=null&&e.hasOwnProperty("audioMuted")&&(r.audioMuted=e.audioMuted),e.compressedSdpOffer!=null&&e.hasOwnProperty("compressedSdpOffer")&&(r.compressedSdpOffer=i.bytes===String?v.base64.encode(e.compressedSdpOffer,0,e.compressedSdpOffer.length):i.bytes===Array?Array.prototype.slice.call(e.compressedSdpOffer):e.compressedSdpOffer),e.videoSubscriptionConfiguration&&e.videoSubscriptionConfiguration.length){r.videoSubscriptionConfiguration=[];for(var o=0;o<e.videoSubscriptionConfiguration.length;++o)r.videoSubscriptionConfiguration[o]=f.SdkVideoSubscriptionConfiguration.toObject(e.videoSubscriptionConfiguration[o],i)}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkSubscribeFrame"},n})();f.SdkSubscribeAckFrame=(function(){function n(t){if(this.allocations=[],this.tracks=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.duplex=1,n.prototype.allocations=v.emptyArray,n.prototype.sdpAnswer="",n.prototype.tracks=v.emptyArray,n.prototype.compressedSdpAnswer=v.newBuffer([]),n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.duplex!=null&&Object.hasOwnProperty.call(e,"duplex")&&i.uint32(8).int32(e.duplex),e.allocations!=null&&e.allocations.length)for(var r=0;r<e.allocations.length;++r)f.SdkStreamAllocation.encode(e.allocations[r],i.uint32(18).fork()).ldelim();if(e.sdpAnswer!=null&&Object.hasOwnProperty.call(e,"sdpAnswer")&&i.uint32(26).string(e.sdpAnswer),e.tracks!=null&&e.tracks.length)for(var r=0;r<e.tracks.length;++r)f.SdkTrackMapping.encode(e.tracks[r],i.uint32(34).fork()).ldelim();return e.compressedSdpAnswer!=null&&Object.hasOwnProperty.call(e,"compressedSdpAnswer")&&i.uint32(42).bytes(e.compressedSdpAnswer),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkSubscribeAckFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.duplex=e.int32();break}case 2:{o.allocations&&o.allocations.length||(o.allocations=[]),o.allocations.push(f.SdkStreamAllocation.decode(e,e.uint32()));break}case 3:{o.sdpAnswer=e.string();break}case 4:{o.tracks&&o.tracks.length||(o.tracks=[]),o.tracks.push(f.SdkTrackMapping.decode(e,e.uint32()));break}case 5:{o.compressedSdpAnswer=e.bytes();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.duplex!=null&&e.hasOwnProperty("duplex"))switch(e.duplex){default:return"duplex: enum value expected";case 1:case 2:case 3:break}if(e.allocations!=null&&e.hasOwnProperty("allocations")){if(!Array.isArray(e.allocations))return"allocations: array expected";for(var i=0;i<e.allocations.length;++i){var r=f.SdkStreamAllocation.verify(e.allocations[i]);if(r)return"allocations."+r}}if(e.sdpAnswer!=null&&e.hasOwnProperty("sdpAnswer")&&!v.isString(e.sdpAnswer))return"sdpAnswer: string expected";if(e.tracks!=null&&e.hasOwnProperty("tracks")){if(!Array.isArray(e.tracks))return"tracks: array expected";for(var i=0;i<e.tracks.length;++i){var r=f.SdkTrackMapping.verify(e.tracks[i]);if(r)return"tracks."+r}}return e.compressedSdpAnswer!=null&&e.hasOwnProperty("compressedSdpAnswer")&&!(e.compressedSdpAnswer&&typeof e.compressedSdpAnswer.length=="number"||v.isString(e.compressedSdpAnswer))?"compressedSdpAnswer: buffer expected":null},n.fromObject=function(e){if(e instanceof f.SdkSubscribeAckFrame)return e;var i=new f.SdkSubscribeAckFrame;switch(e.duplex){default:if(typeof e.duplex=="number"){i.duplex=e.duplex;break}break;case"RX":case 1:i.duplex=1;break;case"TX":case 2:i.duplex=2;break;case"DUPLEX":case 3:i.duplex=3;break}if(e.allocations){if(!Array.isArray(e.allocations))throw TypeError(".SdkSubscribeAckFrame.allocations: array expected");i.allocations=[];for(var r=0;r<e.allocations.length;++r){if(typeof e.allocations[r]!="object")throw TypeError(".SdkSubscribeAckFrame.allocations: object expected");i.allocations[r]=f.SdkStreamAllocation.fromObject(e.allocations[r])}}if(e.sdpAnswer!=null&&(i.sdpAnswer=String(e.sdpAnswer)),e.tracks){if(!Array.isArray(e.tracks))throw TypeError(".SdkSubscribeAckFrame.tracks: array expected");i.tracks=[];for(var r=0;r<e.tracks.length;++r){if(typeof e.tracks[r]!="object")throw TypeError(".SdkSubscribeAckFrame.tracks: object expected");i.tracks[r]=f.SdkTrackMapping.fromObject(e.tracks[r])}}return e.compressedSdpAnswer!=null&&(typeof e.compressedSdpAnswer=="string"?v.base64.decode(e.compressedSdpAnswer,i.compressedSdpAnswer=v.newBuffer(v.base64.length(e.compressedSdpAnswer)),0):e.compressedSdpAnswer.length>=0&&(i.compressedSdpAnswer=e.compressedSdpAnswer)),i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.allocations=[],r.tracks=[]),i.defaults&&(r.duplex=i.enums===String?"RX":1,r.sdpAnswer="",i.bytes===String?r.compressedSdpAnswer="":(r.compressedSdpAnswer=[],i.bytes!==Array&&(r.compressedSdpAnswer=v.newBuffer(r.compressedSdpAnswer)))),e.duplex!=null&&e.hasOwnProperty("duplex")&&(r.duplex=i.enums===String?f.SdkStreamServiceType[e.duplex]===void 0?e.duplex:f.SdkStreamServiceType[e.duplex]:e.duplex),e.allocations&&e.allocations.length){r.allocations=[];for(var o=0;o<e.allocations.length;++o)r.allocations[o]=f.SdkStreamAllocation.toObject(e.allocations[o],i)}if(e.sdpAnswer!=null&&e.hasOwnProperty("sdpAnswer")&&(r.sdpAnswer=e.sdpAnswer),e.tracks&&e.tracks.length){r.tracks=[];for(var o=0;o<e.tracks.length;++o)r.tracks[o]=f.SdkTrackMapping.toObject(e.tracks[o],i)}return e.compressedSdpAnswer!=null&&e.hasOwnProperty("compressedSdpAnswer")&&(r.compressedSdpAnswer=i.bytes===String?v.base64.encode(e.compressedSdpAnswer,0,e.compressedSdpAnswer.length):i.bytes===Array?Array.prototype.slice.call(e.compressedSdpAnswer):e.compressedSdpAnswer),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkSubscribeAckFrame"},n})();f.SdkIndexFrame=(function(){function n(t){if(this.sources=[],this.pausedAtSourceIds=[],this.supportedReceiveCodecIntersection=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.atCapacity=!1,n.prototype.sources=v.emptyArray,n.prototype.pausedAtSourceIds=v.emptyArray,n.prototype.numParticipants=0,n.prototype.supportedReceiveCodecIntersection=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.atCapacity!=null&&Object.hasOwnProperty.call(e,"atCapacity")&&i.uint32(8).bool(e.atCapacity),e.sources!=null&&e.sources.length)for(var r=0;r<e.sources.length;++r)f.SdkStreamDescriptor.encode(e.sources[r],i.uint32(18).fork()).ldelim();if(e.pausedAtSourceIds!=null&&e.pausedAtSourceIds.length)for(var r=0;r<e.pausedAtSourceIds.length;++r)i.uint32(24).uint32(e.pausedAtSourceIds[r]);if(e.numParticipants!=null&&Object.hasOwnProperty.call(e,"numParticipants")&&i.uint32(32).uint32(e.numParticipants),e.supportedReceiveCodecIntersection!=null&&e.supportedReceiveCodecIntersection.length)for(var r=0;r<e.supportedReceiveCodecIntersection.length;++r)i.uint32(40).int32(e.supportedReceiveCodecIntersection[r]);return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkIndexFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.atCapacity=e.bool();break}case 2:{o.sources&&o.sources.length||(o.sources=[]),o.sources.push(f.SdkStreamDescriptor.decode(e,e.uint32()));break}case 3:{if(o.pausedAtSourceIds&&o.pausedAtSourceIds.length||(o.pausedAtSourceIds=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)o.pausedAtSourceIds.push(e.uint32());else o.pausedAtSourceIds.push(e.uint32());break}case 4:{o.numParticipants=e.uint32();break}case 5:{if(o.supportedReceiveCodecIntersection&&o.supportedReceiveCodecIntersection.length||(o.supportedReceiveCodecIntersection=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)o.supportedReceiveCodecIntersection.push(e.int32());else o.supportedReceiveCodecIntersection.push(e.int32());break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.atCapacity!=null&&e.hasOwnProperty("atCapacity")&&typeof e.atCapacity!="boolean")return"atCapacity: boolean expected";if(e.sources!=null&&e.hasOwnProperty("sources")){if(!Array.isArray(e.sources))return"sources: array expected";for(var i=0;i<e.sources.length;++i){var r=f.SdkStreamDescriptor.verify(e.sources[i]);if(r)return"sources."+r}}if(e.pausedAtSourceIds!=null&&e.hasOwnProperty("pausedAtSourceIds")){if(!Array.isArray(e.pausedAtSourceIds))return"pausedAtSourceIds: array expected";for(var i=0;i<e.pausedAtSourceIds.length;++i)if(!v.isInteger(e.pausedAtSourceIds[i]))return"pausedAtSourceIds: integer[] expected"}if(e.numParticipants!=null&&e.hasOwnProperty("numParticipants")&&!v.isInteger(e.numParticipants))return"numParticipants: integer expected";if(e.supportedReceiveCodecIntersection!=null&&e.hasOwnProperty("supportedReceiveCodecIntersection")){if(!Array.isArray(e.supportedReceiveCodecIntersection))return"supportedReceiveCodecIntersection: array expected";for(var i=0;i<e.supportedReceiveCodecIntersection.length;++i)switch(e.supportedReceiveCodecIntersection[i]){default:return"supportedReceiveCodecIntersection: enum value[] expected";case 1:case 2:case 3:case 4:case 5:case 6:case 8:case 11:break}}return null},n.fromObject=function(e){if(e instanceof f.SdkIndexFrame)return e;var i=new f.SdkIndexFrame;if(e.atCapacity!=null&&(i.atCapacity=!!e.atCapacity),e.sources){if(!Array.isArray(e.sources))throw TypeError(".SdkIndexFrame.sources: array expected");i.sources=[];for(var r=0;r<e.sources.length;++r){if(typeof e.sources[r]!="object")throw TypeError(".SdkIndexFrame.sources: object expected");i.sources[r]=f.SdkStreamDescriptor.fromObject(e.sources[r])}}if(e.pausedAtSourceIds){if(!Array.isArray(e.pausedAtSourceIds))throw TypeError(".SdkIndexFrame.pausedAtSourceIds: array expected");i.pausedAtSourceIds=[];for(var r=0;r<e.pausedAtSourceIds.length;++r)i.pausedAtSourceIds[r]=e.pausedAtSourceIds[r]>>>0}if(e.numParticipants!=null&&(i.numParticipants=e.numParticipants>>>0),e.supportedReceiveCodecIntersection){if(!Array.isArray(e.supportedReceiveCodecIntersection))throw TypeError(".SdkIndexFrame.supportedReceiveCodecIntersection: array expected");i.supportedReceiveCodecIntersection=[];for(var r=0;r<e.supportedReceiveCodecIntersection.length;++r)switch(e.supportedReceiveCodecIntersection[r]){default:if(typeof e.supportedReceiveCodecIntersection[r]=="number"){i.supportedReceiveCodecIntersection[r]=e.supportedReceiveCodecIntersection[r];break}case"VP8":case 1:i.supportedReceiveCodecIntersection[r]=1;break;case"H264_BASELINE_PROFILE":case 2:i.supportedReceiveCodecIntersection[r]=2;break;case"H264_CONSTRAINED_BASELINE_PROFILE":case 3:i.supportedReceiveCodecIntersection[r]=3;break;case"H264_MAIN_PROFILE":case 4:i.supportedReceiveCodecIntersection[r]=4;break;case"H264_HIGH_PROFILE":case 5:i.supportedReceiveCodecIntersection[r]=5;break;case"H264_CONSTRAINED_HIGH_PROFILE":case 6:i.supportedReceiveCodecIntersection[r]=6;break;case"VP9_PROFILE_0":case 8:i.supportedReceiveCodecIntersection[r]=8;break;case"AV1_MAIN_PROFILE":case 11:i.supportedReceiveCodecIntersection[r]=11;break}}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.sources=[],r.pausedAtSourceIds=[],r.supportedReceiveCodecIntersection=[]),i.defaults&&(r.atCapacity=!1,r.numParticipants=0),e.atCapacity!=null&&e.hasOwnProperty("atCapacity")&&(r.atCapacity=e.atCapacity),e.sources&&e.sources.length){r.sources=[];for(var o=0;o<e.sources.length;++o)r.sources[o]=f.SdkStreamDescriptor.toObject(e.sources[o],i)}if(e.pausedAtSourceIds&&e.pausedAtSourceIds.length){r.pausedAtSourceIds=[];for(var o=0;o<e.pausedAtSourceIds.length;++o)r.pausedAtSourceIds[o]=e.pausedAtSourceIds[o]}if(e.numParticipants!=null&&e.hasOwnProperty("numParticipants")&&(r.numParticipants=e.numParticipants),e.supportedReceiveCodecIntersection&&e.supportedReceiveCodecIntersection.length){r.supportedReceiveCodecIntersection=[];for(var o=0;o<e.supportedReceiveCodecIntersection.length;++o)r.supportedReceiveCodecIntersection[o]=i.enums===String?f.SdkVideoCodecCapability[e.supportedReceiveCodecIntersection[o]]===void 0?e.supportedReceiveCodecIntersection[o]:f.SdkVideoCodecCapability[e.supportedReceiveCodecIntersection[o]]:e.supportedReceiveCodecIntersection[o]}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkIndexFrame"},n})();f.SdkPauseResumeFrame=(function(){function n(t){if(this.streamIds=[],this.groupIds=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.streamIds=v.emptyArray,n.prototype.groupIds=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.streamIds!=null&&e.streamIds.length)for(var r=0;r<e.streamIds.length;++r)i.uint32(8).uint32(e.streamIds[r]);if(e.groupIds!=null&&e.groupIds.length)for(var r=0;r<e.groupIds.length;++r)i.uint32(16).uint32(e.groupIds[r]);return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkPauseResumeFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{if(o.streamIds&&o.streamIds.length||(o.streamIds=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)o.streamIds.push(e.uint32());else o.streamIds.push(e.uint32());break}case 2:{if(o.groupIds&&o.groupIds.length||(o.groupIds=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)o.groupIds.push(e.uint32());else o.groupIds.push(e.uint32());break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streamIds!=null&&e.hasOwnProperty("streamIds")){if(!Array.isArray(e.streamIds))return"streamIds: array expected";for(var i=0;i<e.streamIds.length;++i)if(!v.isInteger(e.streamIds[i]))return"streamIds: integer[] expected"}if(e.groupIds!=null&&e.hasOwnProperty("groupIds")){if(!Array.isArray(e.groupIds))return"groupIds: array expected";for(var i=0;i<e.groupIds.length;++i)if(!v.isInteger(e.groupIds[i]))return"groupIds: integer[] expected"}return null},n.fromObject=function(e){if(e instanceof f.SdkPauseResumeFrame)return e;var i=new f.SdkPauseResumeFrame;if(e.streamIds){if(!Array.isArray(e.streamIds))throw TypeError(".SdkPauseResumeFrame.streamIds: array expected");i.streamIds=[];for(var r=0;r<e.streamIds.length;++r)i.streamIds[r]=e.streamIds[r]>>>0}if(e.groupIds){if(!Array.isArray(e.groupIds))throw TypeError(".SdkPauseResumeFrame.groupIds: array expected");i.groupIds=[];for(var r=0;r<e.groupIds.length;++r)i.groupIds[r]=e.groupIds[r]>>>0}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.streamIds=[],r.groupIds=[]),e.streamIds&&e.streamIds.length){r.streamIds=[];for(var o=0;o<e.streamIds.length;++o)r.streamIds[o]=e.streamIds[o]}if(e.groupIds&&e.groupIds.length){r.groupIds=[];for(var o=0;o<e.groupIds.length;++o)r.groupIds[o]=e.groupIds[o]}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkPauseResumeFrame"},n})();f.SdkBitrateFrame=(function(){function n(t){if(this.bitrates=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.bitrates=v.emptyArray,n.prototype.serverAvailableOutgoingBitrate=0,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.bitrates!=null&&e.bitrates.length)for(var r=0;r<e.bitrates.length;++r)f.SdkBitrate.encode(e.bitrates[r],i.uint32(10).fork()).ldelim();return e.serverAvailableOutgoingBitrate!=null&&Object.hasOwnProperty.call(e,"serverAvailableOutgoingBitrate")&&i.uint32(16).uint32(e.serverAvailableOutgoingBitrate),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkBitrateFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.bitrates&&o.bitrates.length||(o.bitrates=[]),o.bitrates.push(f.SdkBitrate.decode(e,e.uint32()));break}case 2:{o.serverAvailableOutgoingBitrate=e.uint32();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.bitrates!=null&&e.hasOwnProperty("bitrates")){if(!Array.isArray(e.bitrates))return"bitrates: array expected";for(var i=0;i<e.bitrates.length;++i){var r=f.SdkBitrate.verify(e.bitrates[i]);if(r)return"bitrates."+r}}return e.serverAvailableOutgoingBitrate!=null&&e.hasOwnProperty("serverAvailableOutgoingBitrate")&&!v.isInteger(e.serverAvailableOutgoingBitrate)?"serverAvailableOutgoingBitrate: integer expected":null},n.fromObject=function(e){if(e instanceof f.SdkBitrateFrame)return e;var i=new f.SdkBitrateFrame;if(e.bitrates){if(!Array.isArray(e.bitrates))throw TypeError(".SdkBitrateFrame.bitrates: array expected");i.bitrates=[];for(var r=0;r<e.bitrates.length;++r){if(typeof e.bitrates[r]!="object")throw TypeError(".SdkBitrateFrame.bitrates: object expected");i.bitrates[r]=f.SdkBitrate.fromObject(e.bitrates[r])}}return e.serverAvailableOutgoingBitrate!=null&&(i.serverAvailableOutgoingBitrate=e.serverAvailableOutgoingBitrate>>>0),i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.bitrates=[]),i.defaults&&(r.serverAvailableOutgoingBitrate=0),e.bitrates&&e.bitrates.length){r.bitrates=[];for(var o=0;o<e.bitrates.length;++o)r.bitrates[o]=f.SdkBitrate.toObject(e.bitrates[o],i)}return e.serverAvailableOutgoingBitrate!=null&&e.hasOwnProperty("serverAvailableOutgoingBitrate")&&(r.serverAvailableOutgoingBitrate=e.serverAvailableOutgoingBitrate),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkBitrateFrame"},n})();f.SdkStreamDescriptor=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.streamId=0,n.prototype.framerate=0,n.prototype.maxBitrateKbps=0,n.prototype.trackLabel="",n.prototype.groupId=0,n.prototype.avgBitrateBps=0,n.prototype.attendeeId="",n.prototype.mediaType=1,n.prototype.externalUserId="",n.prototype.width=0,n.prototype.height=0,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&i.uint32(8).uint32(e.streamId),e.framerate!=null&&Object.hasOwnProperty.call(e,"framerate")&&i.uint32(16).uint32(e.framerate),e.maxBitrateKbps!=null&&Object.hasOwnProperty.call(e,"maxBitrateKbps")&&i.uint32(24).uint32(e.maxBitrateKbps),e.trackLabel!=null&&Object.hasOwnProperty.call(e,"trackLabel")&&i.uint32(34).string(e.trackLabel),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&i.uint32(48).uint32(e.groupId),e.avgBitrateBps!=null&&Object.hasOwnProperty.call(e,"avgBitrateBps")&&i.uint32(56).uint32(e.avgBitrateBps),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&i.uint32(66).string(e.attendeeId),e.mediaType!=null&&Object.hasOwnProperty.call(e,"mediaType")&&i.uint32(72).int32(e.mediaType),e.externalUserId!=null&&Object.hasOwnProperty.call(e,"externalUserId")&&i.uint32(82).string(e.externalUserId),e.width!=null&&Object.hasOwnProperty.call(e,"width")&&i.uint32(88).uint32(e.width),e.height!=null&&Object.hasOwnProperty.call(e,"height")&&i.uint32(96).uint32(e.height),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkStreamDescriptor;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.streamId=e.uint32();break}case 2:{o.framerate=e.uint32();break}case 3:{o.maxBitrateKbps=e.uint32();break}case 4:{o.trackLabel=e.string();break}case 6:{o.groupId=e.uint32();break}case 7:{o.avgBitrateBps=e.uint32();break}case 8:{o.attendeeId=e.string();break}case 9:{o.mediaType=e.int32();break}case 10:{o.externalUserId=e.string();break}case 11:{o.width=e.uint32();break}case 12:{o.height=e.uint32();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streamId!=null&&e.hasOwnProperty("streamId")&&!v.isInteger(e.streamId))return"streamId: integer expected";if(e.framerate!=null&&e.hasOwnProperty("framerate")&&!v.isInteger(e.framerate))return"framerate: integer expected";if(e.maxBitrateKbps!=null&&e.hasOwnProperty("maxBitrateKbps")&&!v.isInteger(e.maxBitrateKbps))return"maxBitrateKbps: integer expected";if(e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&!v.isString(e.trackLabel))return"trackLabel: string expected";if(e.groupId!=null&&e.hasOwnProperty("groupId")&&!v.isInteger(e.groupId))return"groupId: integer expected";if(e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&!v.isInteger(e.avgBitrateBps))return"avgBitrateBps: integer expected";if(e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!v.isString(e.attendeeId))return"attendeeId: string expected";if(e.mediaType!=null&&e.hasOwnProperty("mediaType"))switch(e.mediaType){default:return"mediaType: enum value expected";case 1:case 2:break}return e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&!v.isString(e.externalUserId)?"externalUserId: string expected":e.width!=null&&e.hasOwnProperty("width")&&!v.isInteger(e.width)?"width: integer expected":e.height!=null&&e.hasOwnProperty("height")&&!v.isInteger(e.height)?"height: integer expected":null},n.fromObject=function(e){if(e instanceof f.SdkStreamDescriptor)return e;var i=new f.SdkStreamDescriptor;switch(e.streamId!=null&&(i.streamId=e.streamId>>>0),e.framerate!=null&&(i.framerate=e.framerate>>>0),e.maxBitrateKbps!=null&&(i.maxBitrateKbps=e.maxBitrateKbps>>>0),e.trackLabel!=null&&(i.trackLabel=String(e.trackLabel)),e.groupId!=null&&(i.groupId=e.groupId>>>0),e.avgBitrateBps!=null&&(i.avgBitrateBps=e.avgBitrateBps>>>0),e.attendeeId!=null&&(i.attendeeId=String(e.attendeeId)),e.mediaType){default:if(typeof e.mediaType=="number"){i.mediaType=e.mediaType;break}break;case"AUDIO":case 1:i.mediaType=1;break;case"VIDEO":case 2:i.mediaType=2;break}return e.externalUserId!=null&&(i.externalUserId=String(e.externalUserId)),e.width!=null&&(i.width=e.width>>>0),e.height!=null&&(i.height=e.height>>>0),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.streamId=0,r.framerate=0,r.maxBitrateKbps=0,r.trackLabel="",r.groupId=0,r.avgBitrateBps=0,r.attendeeId="",r.mediaType=i.enums===String?"AUDIO":1,r.externalUserId="",r.width=0,r.height=0),e.streamId!=null&&e.hasOwnProperty("streamId")&&(r.streamId=e.streamId),e.framerate!=null&&e.hasOwnProperty("framerate")&&(r.framerate=e.framerate),e.maxBitrateKbps!=null&&e.hasOwnProperty("maxBitrateKbps")&&(r.maxBitrateKbps=e.maxBitrateKbps),e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&(r.trackLabel=e.trackLabel),e.groupId!=null&&e.hasOwnProperty("groupId")&&(r.groupId=e.groupId),e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&(r.avgBitrateBps=e.avgBitrateBps),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(r.attendeeId=e.attendeeId),e.mediaType!=null&&e.hasOwnProperty("mediaType")&&(r.mediaType=i.enums===String?f.SdkStreamMediaType[e.mediaType]===void 0?e.mediaType:f.SdkStreamMediaType[e.mediaType]:e.mediaType),e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&(r.externalUserId=e.externalUserId),e.width!=null&&e.hasOwnProperty("width")&&(r.width=e.width),e.height!=null&&e.hasOwnProperty("height")&&(r.height=e.height),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkStreamDescriptor"},n})();f.SdkStreamAllocation=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.trackLabel="",n.prototype.streamId=0,n.prototype.groupId=0,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.trackLabel!=null&&Object.hasOwnProperty.call(e,"trackLabel")&&i.uint32(10).string(e.trackLabel),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&i.uint32(16).uint32(e.streamId),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&i.uint32(24).uint32(e.groupId),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkStreamAllocation;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.trackLabel=e.string();break}case 2:{o.streamId=e.uint32();break}case 3:{o.groupId=e.uint32();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&!v.isString(e.trackLabel)?"trackLabel: string expected":e.streamId!=null&&e.hasOwnProperty("streamId")&&!v.isInteger(e.streamId)?"streamId: integer expected":e.groupId!=null&&e.hasOwnProperty("groupId")&&!v.isInteger(e.groupId)?"groupId: integer expected":null},n.fromObject=function(e){if(e instanceof f.SdkStreamAllocation)return e;var i=new f.SdkStreamAllocation;return e.trackLabel!=null&&(i.trackLabel=String(e.trackLabel)),e.streamId!=null&&(i.streamId=e.streamId>>>0),e.groupId!=null&&(i.groupId=e.groupId>>>0),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.trackLabel="",r.streamId=0,r.groupId=0),e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&(r.trackLabel=e.trackLabel),e.streamId!=null&&e.hasOwnProperty("streamId")&&(r.streamId=e.streamId),e.groupId!=null&&e.hasOwnProperty("groupId")&&(r.groupId=e.groupId),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkStreamAllocation"},n})();f.SdkTrackMapping=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.streamId=0,n.prototype.ssrc=0,n.prototype.trackLabel="",n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&i.uint32(8).uint32(e.streamId),e.ssrc!=null&&Object.hasOwnProperty.call(e,"ssrc")&&i.uint32(16).uint32(e.ssrc),e.trackLabel!=null&&Object.hasOwnProperty.call(e,"trackLabel")&&i.uint32(26).string(e.trackLabel),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkTrackMapping;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.streamId=e.uint32();break}case 2:{o.ssrc=e.uint32();break}case 3:{o.trackLabel=e.string();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.streamId!=null&&e.hasOwnProperty("streamId")&&!v.isInteger(e.streamId)?"streamId: integer expected":e.ssrc!=null&&e.hasOwnProperty("ssrc")&&!v.isInteger(e.ssrc)?"ssrc: integer expected":e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&!v.isString(e.trackLabel)?"trackLabel: string expected":null},n.fromObject=function(e){if(e instanceof f.SdkTrackMapping)return e;var i=new f.SdkTrackMapping;return e.streamId!=null&&(i.streamId=e.streamId>>>0),e.ssrc!=null&&(i.ssrc=e.ssrc>>>0),e.trackLabel!=null&&(i.trackLabel=String(e.trackLabel)),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.streamId=0,r.ssrc=0,r.trackLabel=""),e.streamId!=null&&e.hasOwnProperty("streamId")&&(r.streamId=e.streamId),e.ssrc!=null&&e.hasOwnProperty("ssrc")&&(r.ssrc=e.ssrc),e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&(r.trackLabel=e.trackLabel),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTrackMapping"},n})();f.SdkBitrate=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.sourceStreamId=0,n.prototype.avgBitrateBps=0,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.sourceStreamId!=null&&Object.hasOwnProperty.call(e,"sourceStreamId")&&i.uint32(8).uint32(e.sourceStreamId),e.avgBitrateBps!=null&&Object.hasOwnProperty.call(e,"avgBitrateBps")&&i.uint32(16).uint32(e.avgBitrateBps),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkBitrate;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.sourceStreamId=e.uint32();break}case 2:{o.avgBitrateBps=e.uint32();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.sourceStreamId!=null&&e.hasOwnProperty("sourceStreamId")&&!v.isInteger(e.sourceStreamId)?"sourceStreamId: integer expected":e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&!v.isInteger(e.avgBitrateBps)?"avgBitrateBps: integer expected":null},n.fromObject=function(e){if(e instanceof f.SdkBitrate)return e;var i=new f.SdkBitrate;return e.sourceStreamId!=null&&(i.sourceStreamId=e.sourceStreamId>>>0),e.avgBitrateBps!=null&&(i.avgBitrateBps=e.avgBitrateBps>>>0),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.sourceStreamId=0,r.avgBitrateBps=0),e.sourceStreamId!=null&&e.hasOwnProperty("sourceStreamId")&&(r.sourceStreamId=e.sourceStreamId),e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&(r.avgBitrateBps=e.avgBitrateBps),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkBitrate"},n})();f.SdkAudioControlFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.muted=!1,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.muted!=null&&Object.hasOwnProperty.call(e,"muted")&&i.uint32(8).bool(e.muted),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkAudioControlFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.muted=e.bool();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.muted!=null&&e.hasOwnProperty("muted")&&typeof e.muted!="boolean"?"muted: boolean expected":null},n.fromObject=function(e){if(e instanceof f.SdkAudioControlFrame)return e;var i=new f.SdkAudioControlFrame;return e.muted!=null&&(i.muted=!!e.muted),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.muted=!1),e.muted!=null&&e.hasOwnProperty("muted")&&(r.muted=e.muted),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioControlFrame"},n})();f.SdkAudioMetadataFrame=(function(){function n(t){if(this.attendeeStates=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.attendeeStates=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.attendeeStates!=null&&e.attendeeStates.length)for(var r=0;r<e.attendeeStates.length;++r)f.SdkAudioAttendeeState.encode(e.attendeeStates[r],i.uint32(10).fork()).ldelim();return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkAudioMetadataFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.attendeeStates&&o.attendeeStates.length||(o.attendeeStates=[]),o.attendeeStates.push(f.SdkAudioAttendeeState.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.attendeeStates!=null&&e.hasOwnProperty("attendeeStates")){if(!Array.isArray(e.attendeeStates))return"attendeeStates: array expected";for(var i=0;i<e.attendeeStates.length;++i){var r=f.SdkAudioAttendeeState.verify(e.attendeeStates[i]);if(r)return"attendeeStates."+r}}return null},n.fromObject=function(e){if(e instanceof f.SdkAudioMetadataFrame)return e;var i=new f.SdkAudioMetadataFrame;if(e.attendeeStates){if(!Array.isArray(e.attendeeStates))throw TypeError(".SdkAudioMetadataFrame.attendeeStates: array expected");i.attendeeStates=[];for(var r=0;r<e.attendeeStates.length;++r){if(typeof e.attendeeStates[r]!="object")throw TypeError(".SdkAudioMetadataFrame.attendeeStates: object expected");i.attendeeStates[r]=f.SdkAudioAttendeeState.fromObject(e.attendeeStates[r])}}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.attendeeStates=[]),e.attendeeStates&&e.attendeeStates.length){r.attendeeStates=[];for(var o=0;o<e.attendeeStates.length;++o)r.attendeeStates[o]=f.SdkAudioAttendeeState.toObject(e.attendeeStates[o],i)}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioMetadataFrame"},n})();f.SdkAudioAttendeeState=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.audioStreamId=0,n.prototype.volume=0,n.prototype.muted=!1,n.prototype.signalStrength=0,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.audioStreamId!=null&&Object.hasOwnProperty.call(e,"audioStreamId")&&i.uint32(8).uint32(e.audioStreamId),e.volume!=null&&Object.hasOwnProperty.call(e,"volume")&&i.uint32(16).uint32(e.volume),e.muted!=null&&Object.hasOwnProperty.call(e,"muted")&&i.uint32(24).bool(e.muted),e.signalStrength!=null&&Object.hasOwnProperty.call(e,"signalStrength")&&i.uint32(32).uint32(e.signalStrength),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkAudioAttendeeState;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.audioStreamId=e.uint32();break}case 2:{o.volume=e.uint32();break}case 3:{o.muted=e.bool();break}case 4:{o.signalStrength=e.uint32();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&!v.isInteger(e.audioStreamId)?"audioStreamId: integer expected":e.volume!=null&&e.hasOwnProperty("volume")&&!v.isInteger(e.volume)?"volume: integer expected":e.muted!=null&&e.hasOwnProperty("muted")&&typeof e.muted!="boolean"?"muted: boolean expected":e.signalStrength!=null&&e.hasOwnProperty("signalStrength")&&!v.isInteger(e.signalStrength)?"signalStrength: integer expected":null},n.fromObject=function(e){if(e instanceof f.SdkAudioAttendeeState)return e;var i=new f.SdkAudioAttendeeState;return e.audioStreamId!=null&&(i.audioStreamId=e.audioStreamId>>>0),e.volume!=null&&(i.volume=e.volume>>>0),e.muted!=null&&(i.muted=!!e.muted),e.signalStrength!=null&&(i.signalStrength=e.signalStrength>>>0),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.audioStreamId=0,r.volume=0,r.muted=!1,r.signalStrength=0),e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&(r.audioStreamId=e.audioStreamId),e.volume!=null&&e.hasOwnProperty("volume")&&(r.volume=e.volume),e.muted!=null&&e.hasOwnProperty("muted")&&(r.muted=e.muted),e.signalStrength!=null&&e.hasOwnProperty("signalStrength")&&(r.signalStrength=e.signalStrength),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioAttendeeState"},n})();f.SdkAudioStreamIdInfoFrame=(function(){function n(t){if(this.streams=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.streams=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.streams!=null&&e.streams.length)for(var r=0;r<e.streams.length;++r)f.SdkAudioStreamIdInfo.encode(e.streams[r],i.uint32(10).fork()).ldelim();return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkAudioStreamIdInfoFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.streams&&o.streams.length||(o.streams=[]),o.streams.push(f.SdkAudioStreamIdInfo.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streams!=null&&e.hasOwnProperty("streams")){if(!Array.isArray(e.streams))return"streams: array expected";for(var i=0;i<e.streams.length;++i){var r=f.SdkAudioStreamIdInfo.verify(e.streams[i]);if(r)return"streams."+r}}return null},n.fromObject=function(e){if(e instanceof f.SdkAudioStreamIdInfoFrame)return e;var i=new f.SdkAudioStreamIdInfoFrame;if(e.streams){if(!Array.isArray(e.streams))throw TypeError(".SdkAudioStreamIdInfoFrame.streams: array expected");i.streams=[];for(var r=0;r<e.streams.length;++r){if(typeof e.streams[r]!="object")throw TypeError(".SdkAudioStreamIdInfoFrame.streams: object expected");i.streams[r]=f.SdkAudioStreamIdInfo.fromObject(e.streams[r])}}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.streams=[]),e.streams&&e.streams.length){r.streams=[];for(var o=0;o<e.streams.length;++o)r.streams[o]=f.SdkAudioStreamIdInfo.toObject(e.streams[o],i)}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioStreamIdInfoFrame"},n})();f.SdkAudioStreamIdInfo=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.audioStreamId=0,n.prototype.attendeeId="",n.prototype.muted=!1,n.prototype.externalUserId="",n.prototype.dropped=!1,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.audioStreamId!=null&&Object.hasOwnProperty.call(e,"audioStreamId")&&i.uint32(8).uint32(e.audioStreamId),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&i.uint32(18).string(e.attendeeId),e.muted!=null&&Object.hasOwnProperty.call(e,"muted")&&i.uint32(24).bool(e.muted),e.externalUserId!=null&&Object.hasOwnProperty.call(e,"externalUserId")&&i.uint32(34).string(e.externalUserId),e.dropped!=null&&Object.hasOwnProperty.call(e,"dropped")&&i.uint32(40).bool(e.dropped),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkAudioStreamIdInfo;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.audioStreamId=e.uint32();break}case 2:{o.attendeeId=e.string();break}case 3:{o.muted=e.bool();break}case 4:{o.externalUserId=e.string();break}case 5:{o.dropped=e.bool();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&!v.isInteger(e.audioStreamId)?"audioStreamId: integer expected":e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!v.isString(e.attendeeId)?"attendeeId: string expected":e.muted!=null&&e.hasOwnProperty("muted")&&typeof e.muted!="boolean"?"muted: boolean expected":e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&!v.isString(e.externalUserId)?"externalUserId: string expected":e.dropped!=null&&e.hasOwnProperty("dropped")&&typeof e.dropped!="boolean"?"dropped: boolean expected":null},n.fromObject=function(e){if(e instanceof f.SdkAudioStreamIdInfo)return e;var i=new f.SdkAudioStreamIdInfo;return e.audioStreamId!=null&&(i.audioStreamId=e.audioStreamId>>>0),e.attendeeId!=null&&(i.attendeeId=String(e.attendeeId)),e.muted!=null&&(i.muted=!!e.muted),e.externalUserId!=null&&(i.externalUserId=String(e.externalUserId)),e.dropped!=null&&(i.dropped=!!e.dropped),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.audioStreamId=0,r.attendeeId="",r.muted=!1,r.externalUserId="",r.dropped=!1),e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&(r.audioStreamId=e.audioStreamId),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(r.attendeeId=e.attendeeId),e.muted!=null&&e.hasOwnProperty("muted")&&(r.muted=e.muted),e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&(r.externalUserId=e.externalUserId),e.dropped!=null&&e.hasOwnProperty("dropped")&&(r.dropped=e.dropped),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioStreamIdInfo"},n})();f.SdkPingPongType=(function(){var n={},t=Object.create(n);return t[n[1]="PING"]=1,t[n[2]="PONG"]=2,t})();f.SdkPingPongFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.type=1,n.prototype.pingId=0,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),i.uint32(8).int32(e.type),i.uint32(16).uint32(e.pingId),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkPingPongFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.type=e.int32();break}case 2:{o.pingId=e.uint32();break}default:e.skipType(s&7);break}}if(!o.hasOwnProperty("type"))throw v.ProtocolError("missing required 'type'",{instance:o});if(!o.hasOwnProperty("pingId"))throw v.ProtocolError("missing required 'pingId'",{instance:o});return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";switch(e.type){default:return"type: enum value expected";case 1:case 2:break}return v.isInteger(e.pingId)?null:"pingId: integer expected"},n.fromObject=function(e){if(e instanceof f.SdkPingPongFrame)return e;var i=new f.SdkPingPongFrame;switch(e.type){default:if(typeof e.type=="number"){i.type=e.type;break}break;case"PING":case 1:i.type=1;break;case"PONG":case 2:i.type=2;break}return e.pingId!=null&&(i.pingId=e.pingId>>>0),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.type=i.enums===String?"PING":1,r.pingId=0),e.type!=null&&e.hasOwnProperty("type")&&(r.type=i.enums===String?f.SdkPingPongType[e.type]===void 0?e.type:f.SdkPingPongType[e.type]:e.type),e.pingId!=null&&e.hasOwnProperty("pingId")&&(r.pingId=e.pingId),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkPingPongFrame"},n})();f.SdkAudioStatusFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.audioStatus=0,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.audioStatus!=null&&Object.hasOwnProperty.call(e,"audioStatus")&&i.uint32(8).uint32(e.audioStatus),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkAudioStatusFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.audioStatus=e.uint32();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.audioStatus!=null&&e.hasOwnProperty("audioStatus")&&!v.isInteger(e.audioStatus)?"audioStatus: integer expected":null},n.fromObject=function(e){if(e instanceof f.SdkAudioStatusFrame)return e;var i=new f.SdkAudioStatusFrame;return e.audioStatus!=null&&(i.audioStatus=e.audioStatus>>>0),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.audioStatus=0),e.audioStatus!=null&&e.hasOwnProperty("audioStatus")&&(r.audioStatus=e.audioStatus),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkAudioStatusFrame"},n})();f.SdkMetric=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.type=1,n.prototype.value=0,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&i.uint32(8).int32(e.type),e.value!=null&&Object.hasOwnProperty.call(e,"value")&&i.uint32(17).double(e.value),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkMetric;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.type=e.int32();break}case 2:{o.value=e.double();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 60:case 64:case 66:case 69:case 72:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:break}return e.value!=null&&e.hasOwnProperty("value")&&typeof e.value!="number"?"value: number expected":null},n.fromObject=function(e){if(e instanceof f.SdkMetric)return e;var i=new f.SdkMetric;switch(e.type){default:if(typeof e.type=="number"){i.type=e.type;break}break;case"VIDEO_ACTUAL_ENCODER_BITRATE":case 1:i.type=1;break;case"VIDEO_AVAILABLE_SEND_BANDWIDTH":case 2:i.type=2;break;case"VIDEO_RETRANSMIT_BITRATE":case 3:i.type=3;break;case"VIDEO_AVAILABLE_RECEIVE_BANDWIDTH":case 4:i.type=4;break;case"VIDEO_TARGET_ENCODER_BITRATE":case 5:i.type=5;break;case"VIDEO_BUCKET_DELAY_MS":case 6:i.type=6;break;case"STUN_RTT_MS":case 7:i.type=7;break;case"SOCKET_DISCARDED_PPS":case 8:i.type=8;break;case"RTC_MIC_JITTER_MS":case 9:i.type=9;break;case"RTC_MIC_PPS":case 10:i.type=10;break;case"RTC_MIC_FRACTION_PACKET_LOST_PERCENT":case 11:i.type=11;break;case"RTC_MIC_BITRATE":case 12:i.type=12;break;case"RTC_MIC_RTT_MS":case 13:i.type=13;break;case"RTC_SPK_PPS":case 14:i.type=14;break;case"RTC_SPK_FRACTION_PACKET_LOST_PERCENT":case 15:i.type=15;break;case"RTC_SPK_JITTER_MS":case 16:i.type=16;break;case"RTC_SPK_FRACTION_DECODER_LOSS_PERCENT":case 17:i.type=17;break;case"RTC_SPK_BITRATE":case 18:i.type=18;break;case"RTC_SPK_CURRENT_DELAY_MS":case 19:i.type=19;break;case"RTC_SPK_JITTER_BUFFER_MS":case 20:i.type=20;break;case"VIDEO_SENT_RTT_MS":case 21:i.type=21;break;case"VIDEO_ENCODE_USAGE_PERCENT":case 22:i.type=22;break;case"VIDEO_NACKS_RECEIVED":case 23:i.type=23;break;case"VIDEO_PLIS_RECEIVED":case 24:i.type=24;break;case"VIDEO_ENCODE_MS":case 25:i.type=25;break;case"VIDEO_INPUT_FPS":case 26:i.type=26;break;case"VIDEO_ENCODE_FPS":case 27:i.type=27;break;case"VIDEO_SENT_FPS":case 28:i.type=28;break;case"VIDEO_FIRS_RECEIVED":case 29:i.type=29;break;case"VIDEO_SENT_PPS":case 30:i.type=30;break;case"VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT":case 31:i.type=31;break;case"VIDEO_SENT_BITRATE":case 32:i.type=32;break;case"VIDEO_DROPPED_FPS":case 33:i.type=33;break;case"VIDEO_TARGET_DELAY_MS":case 34:i.type=34;break;case"VIDEO_DECODE_MS":case 35:i.type=35;break;case"VIDEO_OUTPUT_FPS":case 36:i.type=36;break;case"VIDEO_RECEIVED_PPS":case 37:i.type=37;break;case"VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT":case 38:i.type=38;break;case"VIDEO_RENDER_DELAY_MS":case 39:i.type=39;break;case"VIDEO_RECEIVED_FPS":case 40:i.type=40;break;case"VIDEO_DECODE_FPS":case 41:i.type=41;break;case"VIDEO_NACKS_SENT":case 42:i.type=42;break;case"VIDEO_FIRS_SENT":case 43:i.type=43;break;case"VIDEO_RECEIVED_BITRATE":case 44:i.type=44;break;case"VIDEO_CURRENT_DELAY_MS":case 45:i.type=45;break;case"VIDEO_JITTER_BUFFER_MS":case 46:i.type=46;break;case"VIDEO_DISCARDED_PPS":case 47:i.type=47;break;case"VIDEO_PLIS_SENT":case 48:i.type=48;break;case"VIDEO_RECEIVED_JITTER_MS":case 49:i.type=49;break;case"VIDEO_INPUT_HEIGHT":case 60:i.type=60;break;case"VIDEO_ENCODE_HEIGHT":case 64:i.type=64;break;case"VIDEO_SENT_QP_SUM":case 66:i.type=66;break;case"VIDEO_DECODE_HEIGHT":case 69:i.type=69;break;case"VIDEO_RECEIVED_QP_SUM":case 72:i.type=72;break;case"VIDEO_ENCODE_WIDTH":case 86:i.type=86;break;case"VIDEO_DECODE_WIDTH":case 87:i.type=87;break;case"VIDEO_ENCODER_IS_HARDWARE":case 88:i.type=88;break;case"VIDEO_DECODER_IS_HARDWARE":case 89:i.type=89;break;case"VIDEO_FREEZE_COUNT":case 90:i.type=90;break;case"VIDEO_FREEZE_DURATION":case 91:i.type=91;break;case"VIDEO_PAUSE_COUNT":case 92:i.type=92;break;case"VIDEO_PAUSE_DURATION":case 93:i.type=93;break;case"VIDEO_QUALITY_REASON":case 94:i.type=94;break;case"VIDEO_PROCESSING_TIME":case 95:i.type=95;break;case"RTC_SPK_AUDIO_LEVEL":case 96:i.type=96;break;case"RTC_MIC_AUDIO_LEVEL":case 97:i.type=97;break;case"RTC_SPK_TOTAL_LOST":case 98:i.type=98;break;case"RTC_SPK_TOTAL_EXPECTED":case 99:i.type=99;break;case"RTC_SPK_TOTAL_RECOVERED_RED":case 100:i.type=100;break;case"RTC_SPK_TOTAL_RECOVERED_FEC":case 101:i.type=101;break;case"VIDEO_QUALITY_LIMITATION_DURATION_CPU":case 102:i.type=102;break;case"VIDEO_CODEC_DEGRADATION_HIGH_ENCODE_CPU":case 103:i.type=103;break;case"VIDEO_CODEC_DEGRADATION_ENCODE_FAILURE":case 104:i.type=104;break;case"VIDEO_RENDER_HEIGHT":case 105:i.type=105;break;case"VIDEO_RENDER_WIDTH":case 106:i.type=106;break;case"VIDEO_INPUT_WIDTH":case 107:i.type=107;break;case"VIDEO_SENT_JITTER_MS":case 108:i.type=108;break}return e.value!=null&&(i.value=Number(e.value)),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.type=i.enums===String?"VIDEO_ACTUAL_ENCODER_BITRATE":1,r.value=0),e.type!=null&&e.hasOwnProperty("type")&&(r.type=i.enums===String?f.SdkMetric.Type[e.type]===void 0?e.type:f.SdkMetric.Type[e.type]:e.type),e.value!=null&&e.hasOwnProperty("value")&&(r.value=i.json&&!isFinite(e.value)?String(e.value):e.value),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkMetric"},n.Type=(function(){var t={},e=Object.create(t);return e[t[1]="VIDEO_ACTUAL_ENCODER_BITRATE"]=1,e[t[2]="VIDEO_AVAILABLE_SEND_BANDWIDTH"]=2,e[t[3]="VIDEO_RETRANSMIT_BITRATE"]=3,e[t[4]="VIDEO_AVAILABLE_RECEIVE_BANDWIDTH"]=4,e[t[5]="VIDEO_TARGET_ENCODER_BITRATE"]=5,e[t[6]="VIDEO_BUCKET_DELAY_MS"]=6,e[t[7]="STUN_RTT_MS"]=7,e[t[8]="SOCKET_DISCARDED_PPS"]=8,e[t[9]="RTC_MIC_JITTER_MS"]=9,e[t[10]="RTC_MIC_PPS"]=10,e[t[11]="RTC_MIC_FRACTION_PACKET_LOST_PERCENT"]=11,e[t[12]="RTC_MIC_BITRATE"]=12,e[t[13]="RTC_MIC_RTT_MS"]=13,e[t[14]="RTC_SPK_PPS"]=14,e[t[15]="RTC_SPK_FRACTION_PACKET_LOST_PERCENT"]=15,e[t[16]="RTC_SPK_JITTER_MS"]=16,e[t[17]="RTC_SPK_FRACTION_DECODER_LOSS_PERCENT"]=17,e[t[18]="RTC_SPK_BITRATE"]=18,e[t[19]="RTC_SPK_CURRENT_DELAY_MS"]=19,e[t[20]="RTC_SPK_JITTER_BUFFER_MS"]=20,e[t[21]="VIDEO_SENT_RTT_MS"]=21,e[t[22]="VIDEO_ENCODE_USAGE_PERCENT"]=22,e[t[23]="VIDEO_NACKS_RECEIVED"]=23,e[t[24]="VIDEO_PLIS_RECEIVED"]=24,e[t[25]="VIDEO_ENCODE_MS"]=25,e[t[26]="VIDEO_INPUT_FPS"]=26,e[t[27]="VIDEO_ENCODE_FPS"]=27,e[t[28]="VIDEO_SENT_FPS"]=28,e[t[29]="VIDEO_FIRS_RECEIVED"]=29,e[t[30]="VIDEO_SENT_PPS"]=30,e[t[31]="VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT"]=31,e[t[32]="VIDEO_SENT_BITRATE"]=32,e[t[33]="VIDEO_DROPPED_FPS"]=33,e[t[34]="VIDEO_TARGET_DELAY_MS"]=34,e[t[35]="VIDEO_DECODE_MS"]=35,e[t[36]="VIDEO_OUTPUT_FPS"]=36,e[t[37]="VIDEO_RECEIVED_PPS"]=37,e[t[38]="VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT"]=38,e[t[39]="VIDEO_RENDER_DELAY_MS"]=39,e[t[40]="VIDEO_RECEIVED_FPS"]=40,e[t[41]="VIDEO_DECODE_FPS"]=41,e[t[42]="VIDEO_NACKS_SENT"]=42,e[t[43]="VIDEO_FIRS_SENT"]=43,e[t[44]="VIDEO_RECEIVED_BITRATE"]=44,e[t[45]="VIDEO_CURRENT_DELAY_MS"]=45,e[t[46]="VIDEO_JITTER_BUFFER_MS"]=46,e[t[47]="VIDEO_DISCARDED_PPS"]=47,e[t[48]="VIDEO_PLIS_SENT"]=48,e[t[49]="VIDEO_RECEIVED_JITTER_MS"]=49,e[t[60]="VIDEO_INPUT_HEIGHT"]=60,e[t[64]="VIDEO_ENCODE_HEIGHT"]=64,e[t[66]="VIDEO_SENT_QP_SUM"]=66,e[t[69]="VIDEO_DECODE_HEIGHT"]=69,e[t[72]="VIDEO_RECEIVED_QP_SUM"]=72,e[t[86]="VIDEO_ENCODE_WIDTH"]=86,e[t[87]="VIDEO_DECODE_WIDTH"]=87,e[t[88]="VIDEO_ENCODER_IS_HARDWARE"]=88,e[t[89]="VIDEO_DECODER_IS_HARDWARE"]=89,e[t[90]="VIDEO_FREEZE_COUNT"]=90,e[t[91]="VIDEO_FREEZE_DURATION"]=91,e[t[92]="VIDEO_PAUSE_COUNT"]=92,e[t[93]="VIDEO_PAUSE_DURATION"]=93,e[t[94]="VIDEO_QUALITY_REASON"]=94,e[t[95]="VIDEO_PROCESSING_TIME"]=95,e[t[96]="RTC_SPK_AUDIO_LEVEL"]=96,e[t[97]="RTC_MIC_AUDIO_LEVEL"]=97,e[t[98]="RTC_SPK_TOTAL_LOST"]=98,e[t[99]="RTC_SPK_TOTAL_EXPECTED"]=99,e[t[100]="RTC_SPK_TOTAL_RECOVERED_RED"]=100,e[t[101]="RTC_SPK_TOTAL_RECOVERED_FEC"]=101,e[t[102]="VIDEO_QUALITY_LIMITATION_DURATION_CPU"]=102,e[t[103]="VIDEO_CODEC_DEGRADATION_HIGH_ENCODE_CPU"]=103,e[t[104]="VIDEO_CODEC_DEGRADATION_ENCODE_FAILURE"]=104,e[t[105]="VIDEO_RENDER_HEIGHT"]=105,e[t[106]="VIDEO_RENDER_WIDTH"]=106,e[t[107]="VIDEO_INPUT_WIDTH"]=107,e[t[108]="VIDEO_SENT_JITTER_MS"]=108,e})(),n})();f.SdkStreamMetricFrame=(function(){function n(t){if(this.metrics=[],this.dimensions=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.streamId=0,n.prototype.groupId=0,n.prototype.metrics=v.emptyArray,n.prototype.dimensions=v.emptyArray,n.prototype.mediaType=1,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&i.uint32(24).uint32(e.streamId),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&i.uint32(32).uint32(e.groupId),e.metrics!=null&&e.metrics.length)for(var r=0;r<e.metrics.length;++r)f.SdkMetric.encode(e.metrics[r],i.uint32(42).fork()).ldelim();if(e.dimensions!=null&&e.dimensions.length)for(var r=0;r<e.dimensions.length;++r)f.SdkStreamDimension.encode(e.dimensions[r],i.uint32(50).fork()).ldelim();return e.mediaType!=null&&Object.hasOwnProperty.call(e,"mediaType")&&i.uint32(56).int32(e.mediaType),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkStreamMetricFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 3:{o.streamId=e.uint32();break}case 4:{o.groupId=e.uint32();break}case 5:{o.metrics&&o.metrics.length||(o.metrics=[]),o.metrics.push(f.SdkMetric.decode(e,e.uint32()));break}case 6:{o.dimensions&&o.dimensions.length||(o.dimensions=[]),o.dimensions.push(f.SdkStreamDimension.decode(e,e.uint32()));break}case 7:{o.mediaType=e.int32();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streamId!=null&&e.hasOwnProperty("streamId")&&!v.isInteger(e.streamId))return"streamId: integer expected";if(e.groupId!=null&&e.hasOwnProperty("groupId")&&!v.isInteger(e.groupId))return"groupId: integer expected";if(e.metrics!=null&&e.hasOwnProperty("metrics")){if(!Array.isArray(e.metrics))return"metrics: array expected";for(var i=0;i<e.metrics.length;++i){var r=f.SdkMetric.verify(e.metrics[i]);if(r)return"metrics."+r}}if(e.dimensions!=null&&e.hasOwnProperty("dimensions")){if(!Array.isArray(e.dimensions))return"dimensions: array expected";for(var i=0;i<e.dimensions.length;++i){var r=f.SdkStreamDimension.verify(e.dimensions[i]);if(r)return"dimensions."+r}}if(e.mediaType!=null&&e.hasOwnProperty("mediaType"))switch(e.mediaType){default:return"mediaType: enum value expected";case 1:case 2:break}return null},n.fromObject=function(e){if(e instanceof f.SdkStreamMetricFrame)return e;var i=new f.SdkStreamMetricFrame;if(e.streamId!=null&&(i.streamId=e.streamId>>>0),e.groupId!=null&&(i.groupId=e.groupId>>>0),e.metrics){if(!Array.isArray(e.metrics))throw TypeError(".SdkStreamMetricFrame.metrics: array expected");i.metrics=[];for(var r=0;r<e.metrics.length;++r){if(typeof e.metrics[r]!="object")throw TypeError(".SdkStreamMetricFrame.metrics: object expected");i.metrics[r]=f.SdkMetric.fromObject(e.metrics[r])}}if(e.dimensions){if(!Array.isArray(e.dimensions))throw TypeError(".SdkStreamMetricFrame.dimensions: array expected");i.dimensions=[];for(var r=0;r<e.dimensions.length;++r){if(typeof e.dimensions[r]!="object")throw TypeError(".SdkStreamMetricFrame.dimensions: object expected");i.dimensions[r]=f.SdkStreamDimension.fromObject(e.dimensions[r])}}switch(e.mediaType){default:if(typeof e.mediaType=="number"){i.mediaType=e.mediaType;break}break;case"AUDIO":case 1:i.mediaType=1;break;case"VIDEO":case 2:i.mediaType=2;break}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.metrics=[],r.dimensions=[]),i.defaults&&(r.streamId=0,r.groupId=0,r.mediaType=i.enums===String?"AUDIO":1),e.streamId!=null&&e.hasOwnProperty("streamId")&&(r.streamId=e.streamId),e.groupId!=null&&e.hasOwnProperty("groupId")&&(r.groupId=e.groupId),e.metrics&&e.metrics.length){r.metrics=[];for(var o=0;o<e.metrics.length;++o)r.metrics[o]=f.SdkMetric.toObject(e.metrics[o],i)}if(e.dimensions&&e.dimensions.length){r.dimensions=[];for(var o=0;o<e.dimensions.length;++o)r.dimensions[o]=f.SdkStreamDimension.toObject(e.dimensions[o],i)}return e.mediaType!=null&&e.hasOwnProperty("mediaType")&&(r.mediaType=i.enums===String?f.SdkStreamMediaType[e.mediaType]===void 0?e.mediaType:f.SdkStreamMediaType[e.mediaType]:e.mediaType),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkStreamMetricFrame"},n})();f.SdkClientMetricFrame=(function(){function n(t){if(this.globalMetrics=[],this.streamMetricFrames=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.globalMetrics=v.emptyArray,n.prototype.streamMetricFrames=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.globalMetrics!=null&&e.globalMetrics.length)for(var r=0;r<e.globalMetrics.length;++r)f.SdkMetric.encode(e.globalMetrics[r],i.uint32(10).fork()).ldelim();if(e.streamMetricFrames!=null&&e.streamMetricFrames.length)for(var r=0;r<e.streamMetricFrames.length;++r)f.SdkStreamMetricFrame.encode(e.streamMetricFrames[r],i.uint32(18).fork()).ldelim();return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkClientMetricFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.globalMetrics&&o.globalMetrics.length||(o.globalMetrics=[]),o.globalMetrics.push(f.SdkMetric.decode(e,e.uint32()));break}case 2:{o.streamMetricFrames&&o.streamMetricFrames.length||(o.streamMetricFrames=[]),o.streamMetricFrames.push(f.SdkStreamMetricFrame.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.globalMetrics!=null&&e.hasOwnProperty("globalMetrics")){if(!Array.isArray(e.globalMetrics))return"globalMetrics: array expected";for(var i=0;i<e.globalMetrics.length;++i){var r=f.SdkMetric.verify(e.globalMetrics[i]);if(r)return"globalMetrics."+r}}if(e.streamMetricFrames!=null&&e.hasOwnProperty("streamMetricFrames")){if(!Array.isArray(e.streamMetricFrames))return"streamMetricFrames: array expected";for(var i=0;i<e.streamMetricFrames.length;++i){var r=f.SdkStreamMetricFrame.verify(e.streamMetricFrames[i]);if(r)return"streamMetricFrames."+r}}return null},n.fromObject=function(e){if(e instanceof f.SdkClientMetricFrame)return e;var i=new f.SdkClientMetricFrame;if(e.globalMetrics){if(!Array.isArray(e.globalMetrics))throw TypeError(".SdkClientMetricFrame.globalMetrics: array expected");i.globalMetrics=[];for(var r=0;r<e.globalMetrics.length;++r){if(typeof e.globalMetrics[r]!="object")throw TypeError(".SdkClientMetricFrame.globalMetrics: object expected");i.globalMetrics[r]=f.SdkMetric.fromObject(e.globalMetrics[r])}}if(e.streamMetricFrames){if(!Array.isArray(e.streamMetricFrames))throw TypeError(".SdkClientMetricFrame.streamMetricFrames: array expected");i.streamMetricFrames=[];for(var r=0;r<e.streamMetricFrames.length;++r){if(typeof e.streamMetricFrames[r]!="object")throw TypeError(".SdkClientMetricFrame.streamMetricFrames: object expected");i.streamMetricFrames[r]=f.SdkStreamMetricFrame.fromObject(e.streamMetricFrames[r])}}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.globalMetrics=[],r.streamMetricFrames=[]),e.globalMetrics&&e.globalMetrics.length){r.globalMetrics=[];for(var o=0;o<e.globalMetrics.length;++o)r.globalMetrics[o]=f.SdkMetric.toObject(e.globalMetrics[o],i)}if(e.streamMetricFrames&&e.streamMetricFrames.length){r.streamMetricFrames=[];for(var o=0;o<e.streamMetricFrames.length;++o)r.streamMetricFrames[o]=f.SdkStreamMetricFrame.toObject(e.streamMetricFrames[o],i)}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkClientMetricFrame"},n})();f.SdkStreamDimension=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.type=1,n.prototype.value=null,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&i.uint32(8).int32(e.type),e.value!=null&&Object.hasOwnProperty.call(e,"value")&&f.SdkDimensionValue.encode(e.value,i.uint32(18).fork()).ldelim(),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkStreamDimension;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.type=e.int32();break}case 2:{o.value=f.SdkDimensionValue.decode(e,e.uint32());break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:break}if(e.value!=null&&e.hasOwnProperty("value")){var i=f.SdkDimensionValue.verify(e.value);if(i)return"value."+i}return null},n.fromObject=function(e){if(e instanceof f.SdkStreamDimension)return e;var i=new f.SdkStreamDimension;switch(e.type){default:if(typeof e.type=="number"){i.type=e.type;break}break;case"VIDEO_ENCODER_NAME":case 1:i.type=1;break;case"VIDEO_DECODER_NAME":case 2:i.type=2;break}if(e.value!=null){if(typeof e.value!="object")throw TypeError(".SdkStreamDimension.value: object expected");i.value=f.SdkDimensionValue.fromObject(e.value)}return i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.type=i.enums===String?"VIDEO_ENCODER_NAME":1,r.value=null),e.type!=null&&e.hasOwnProperty("type")&&(r.type=i.enums===String?f.SdkStreamDimension.Type[e.type]===void 0?e.type:f.SdkStreamDimension.Type[e.type]:e.type),e.value!=null&&e.hasOwnProperty("value")&&(r.value=f.SdkDimensionValue.toObject(e.value,i)),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkStreamDimension"},n.Type=(function(){var t={},e=Object.create(t);return e[t[1]="VIDEO_ENCODER_NAME"]=1,e[t[2]="VIDEO_DECODER_NAME"]=2,e})(),n})();f.SdkDimensionValue=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.stringValue="",n.prototype.boolValue=!1,n.prototype.uintValue=v.Long?v.Long.fromBits(0,0,!0):0,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.stringValue!=null&&Object.hasOwnProperty.call(e,"stringValue")&&i.uint32(10).string(e.stringValue),e.boolValue!=null&&Object.hasOwnProperty.call(e,"boolValue")&&i.uint32(16).bool(e.boolValue),e.uintValue!=null&&Object.hasOwnProperty.call(e,"uintValue")&&i.uint32(24).uint64(e.uintValue),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkDimensionValue;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.stringValue=e.string();break}case 2:{o.boolValue=e.bool();break}case 3:{o.uintValue=e.uint64();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.stringValue!=null&&e.hasOwnProperty("stringValue")&&!v.isString(e.stringValue)?"stringValue: string expected":e.boolValue!=null&&e.hasOwnProperty("boolValue")&&typeof e.boolValue!="boolean"?"boolValue: boolean expected":e.uintValue!=null&&e.hasOwnProperty("uintValue")&&!v.isInteger(e.uintValue)&&!(e.uintValue&&v.isInteger(e.uintValue.low)&&v.isInteger(e.uintValue.high))?"uintValue: integer|Long expected":null},n.fromObject=function(e){if(e instanceof f.SdkDimensionValue)return e;var i=new f.SdkDimensionValue;return e.stringValue!=null&&(i.stringValue=String(e.stringValue)),e.boolValue!=null&&(i.boolValue=!!e.boolValue),e.uintValue!=null&&(v.Long?(i.uintValue=v.Long.fromValue(e.uintValue)).unsigned=!0:typeof e.uintValue=="string"?i.uintValue=parseInt(e.uintValue,10):typeof e.uintValue=="number"?i.uintValue=e.uintValue:typeof e.uintValue=="object"&&(i.uintValue=new v.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),i},n.toObject=function(e,i){i||(i={});var r={};if(i.defaults)if(r.stringValue="",r.boolValue=!1,v.Long){var o=new v.Long(0,0,!0);r.uintValue=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.uintValue=i.longs===String?"0":0;return e.stringValue!=null&&e.hasOwnProperty("stringValue")&&(r.stringValue=e.stringValue),e.boolValue!=null&&e.hasOwnProperty("boolValue")&&(r.boolValue=e.boolValue),e.uintValue!=null&&e.hasOwnProperty("uintValue")&&(typeof e.uintValue=="number"?r.uintValue=i.longs===String?String(e.uintValue):e.uintValue:r.uintValue=i.longs===String?v.Long.prototype.toString.call(e.uintValue):i.longs===Number?new v.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkDimensionValue"},n})();f.SdkDataMessageFrame=(function(){function n(t){if(this.messages=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.messages=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.messages!=null&&e.messages.length)for(var r=0;r<e.messages.length;++r)f.SdkDataMessagePayload.encode(e.messages[r],i.uint32(10).fork()).ldelim();return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkDataMessageFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.messages&&o.messages.length||(o.messages=[]),o.messages.push(f.SdkDataMessagePayload.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.messages!=null&&e.hasOwnProperty("messages")){if(!Array.isArray(e.messages))return"messages: array expected";for(var i=0;i<e.messages.length;++i){var r=f.SdkDataMessagePayload.verify(e.messages[i]);if(r)return"messages."+r}}return null},n.fromObject=function(e){if(e instanceof f.SdkDataMessageFrame)return e;var i=new f.SdkDataMessageFrame;if(e.messages){if(!Array.isArray(e.messages))throw TypeError(".SdkDataMessageFrame.messages: array expected");i.messages=[];for(var r=0;r<e.messages.length;++r){if(typeof e.messages[r]!="object")throw TypeError(".SdkDataMessageFrame.messages: object expected");i.messages[r]=f.SdkDataMessagePayload.fromObject(e.messages[r])}}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.messages=[]),e.messages&&e.messages.length){r.messages=[];for(var o=0;o<e.messages.length;++o)r.messages[o]=f.SdkDataMessagePayload.toObject(e.messages[o],i)}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkDataMessageFrame"},n})();f.SdkDataMessagePayload=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.topic="",n.prototype.data=v.newBuffer([]),n.prototype.lifetimeMs=0,n.prototype.senderAttendeeId="",n.prototype.ingestTimeNs=v.Long?v.Long.fromBits(0,0,!1):0,n.prototype.senderExternalUserId="",n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.topic!=null&&Object.hasOwnProperty.call(e,"topic")&&i.uint32(10).string(e.topic),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&i.uint32(18).bytes(e.data),e.lifetimeMs!=null&&Object.hasOwnProperty.call(e,"lifetimeMs")&&i.uint32(24).uint32(e.lifetimeMs),e.senderAttendeeId!=null&&Object.hasOwnProperty.call(e,"senderAttendeeId")&&i.uint32(34).string(e.senderAttendeeId),e.ingestTimeNs!=null&&Object.hasOwnProperty.call(e,"ingestTimeNs")&&i.uint32(40).int64(e.ingestTimeNs),e.senderExternalUserId!=null&&Object.hasOwnProperty.call(e,"senderExternalUserId")&&i.uint32(50).string(e.senderExternalUserId),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkDataMessagePayload;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.topic=e.string();break}case 2:{o.data=e.bytes();break}case 3:{o.lifetimeMs=e.uint32();break}case 4:{o.senderAttendeeId=e.string();break}case 5:{o.ingestTimeNs=e.int64();break}case 6:{o.senderExternalUserId=e.string();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.topic!=null&&e.hasOwnProperty("topic")&&!v.isString(e.topic)?"topic: string expected":e.data!=null&&e.hasOwnProperty("data")&&!(e.data&&typeof e.data.length=="number"||v.isString(e.data))?"data: buffer expected":e.lifetimeMs!=null&&e.hasOwnProperty("lifetimeMs")&&!v.isInteger(e.lifetimeMs)?"lifetimeMs: integer expected":e.senderAttendeeId!=null&&e.hasOwnProperty("senderAttendeeId")&&!v.isString(e.senderAttendeeId)?"senderAttendeeId: string expected":e.ingestTimeNs!=null&&e.hasOwnProperty("ingestTimeNs")&&!v.isInteger(e.ingestTimeNs)&&!(e.ingestTimeNs&&v.isInteger(e.ingestTimeNs.low)&&v.isInteger(e.ingestTimeNs.high))?"ingestTimeNs: integer|Long expected":e.senderExternalUserId!=null&&e.hasOwnProperty("senderExternalUserId")&&!v.isString(e.senderExternalUserId)?"senderExternalUserId: string expected":null},n.fromObject=function(e){if(e instanceof f.SdkDataMessagePayload)return e;var i=new f.SdkDataMessagePayload;return e.topic!=null&&(i.topic=String(e.topic)),e.data!=null&&(typeof e.data=="string"?v.base64.decode(e.data,i.data=v.newBuffer(v.base64.length(e.data)),0):e.data.length>=0&&(i.data=e.data)),e.lifetimeMs!=null&&(i.lifetimeMs=e.lifetimeMs>>>0),e.senderAttendeeId!=null&&(i.senderAttendeeId=String(e.senderAttendeeId)),e.ingestTimeNs!=null&&(v.Long?(i.ingestTimeNs=v.Long.fromValue(e.ingestTimeNs)).unsigned=!1:typeof e.ingestTimeNs=="string"?i.ingestTimeNs=parseInt(e.ingestTimeNs,10):typeof e.ingestTimeNs=="number"?i.ingestTimeNs=e.ingestTimeNs:typeof e.ingestTimeNs=="object"&&(i.ingestTimeNs=new v.LongBits(e.ingestTimeNs.low>>>0,e.ingestTimeNs.high>>>0).toNumber())),e.senderExternalUserId!=null&&(i.senderExternalUserId=String(e.senderExternalUserId)),i},n.toObject=function(e,i){i||(i={});var r={};if(i.defaults){if(r.topic="",i.bytes===String?r.data="":(r.data=[],i.bytes!==Array&&(r.data=v.newBuffer(r.data))),r.lifetimeMs=0,r.senderAttendeeId="",v.Long){var o=new v.Long(0,0,!1);r.ingestTimeNs=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.ingestTimeNs=i.longs===String?"0":0;r.senderExternalUserId=""}return e.topic!=null&&e.hasOwnProperty("topic")&&(r.topic=e.topic),e.data!=null&&e.hasOwnProperty("data")&&(r.data=i.bytes===String?v.base64.encode(e.data,0,e.data.length):i.bytes===Array?Array.prototype.slice.call(e.data):e.data),e.lifetimeMs!=null&&e.hasOwnProperty("lifetimeMs")&&(r.lifetimeMs=e.lifetimeMs),e.senderAttendeeId!=null&&e.hasOwnProperty("senderAttendeeId")&&(r.senderAttendeeId=e.senderAttendeeId),e.ingestTimeNs!=null&&e.hasOwnProperty("ingestTimeNs")&&(typeof e.ingestTimeNs=="number"?r.ingestTimeNs=i.longs===String?String(e.ingestTimeNs):e.ingestTimeNs:r.ingestTimeNs=i.longs===String?v.Long.prototype.toString.call(e.ingestTimeNs):i.longs===Number?new v.LongBits(e.ingestTimeNs.low>>>0,e.ingestTimeNs.high>>>0).toNumber():e.ingestTimeNs),e.senderExternalUserId!=null&&e.hasOwnProperty("senderExternalUserId")&&(r.senderExternalUserId=e.senderExternalUserId),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkDataMessagePayload"},n})();f.SdkTurnCredentials=(function(){function n(t){if(this.uris=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.username="",n.prototype.password="",n.prototype.ttl=0,n.prototype.uris=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.username!=null&&Object.hasOwnProperty.call(e,"username")&&i.uint32(10).string(e.username),e.password!=null&&Object.hasOwnProperty.call(e,"password")&&i.uint32(18).string(e.password),e.ttl!=null&&Object.hasOwnProperty.call(e,"ttl")&&i.uint32(24).uint32(e.ttl),e.uris!=null&&e.uris.length)for(var r=0;r<e.uris.length;++r)i.uint32(34).string(e.uris[r]);return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkTurnCredentials;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.username=e.string();break}case 2:{o.password=e.string();break}case 3:{o.ttl=e.uint32();break}case 4:{o.uris&&o.uris.length||(o.uris=[]),o.uris.push(e.string());break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.username!=null&&e.hasOwnProperty("username")&&!v.isString(e.username))return"username: string expected";if(e.password!=null&&e.hasOwnProperty("password")&&!v.isString(e.password))return"password: string expected";if(e.ttl!=null&&e.hasOwnProperty("ttl")&&!v.isInteger(e.ttl))return"ttl: integer expected";if(e.uris!=null&&e.hasOwnProperty("uris")){if(!Array.isArray(e.uris))return"uris: array expected";for(var i=0;i<e.uris.length;++i)if(!v.isString(e.uris[i]))return"uris: string[] expected"}return null},n.fromObject=function(e){if(e instanceof f.SdkTurnCredentials)return e;var i=new f.SdkTurnCredentials;if(e.username!=null&&(i.username=String(e.username)),e.password!=null&&(i.password=String(e.password)),e.ttl!=null&&(i.ttl=e.ttl>>>0),e.uris){if(!Array.isArray(e.uris))throw TypeError(".SdkTurnCredentials.uris: array expected");i.uris=[];for(var r=0;r<e.uris.length;++r)i.uris[r]=String(e.uris[r])}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.uris=[]),i.defaults&&(r.username="",r.password="",r.ttl=0),e.username!=null&&e.hasOwnProperty("username")&&(r.username=e.username),e.password!=null&&e.hasOwnProperty("password")&&(r.password=e.password),e.ttl!=null&&e.hasOwnProperty("ttl")&&(r.ttl=e.ttl),e.uris&&e.uris.length){r.uris=[];for(var o=0;o<e.uris.length;++o)r.uris[o]=e.uris[o]}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTurnCredentials"},n})();f.SdkTranscriptItem=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.content="",n.prototype.endTime=v.Long?v.Long.fromBits(0,0,!1):0,n.prototype.speakerAttendeeId="",n.prototype.speakerExternalUserId="",n.prototype.startTime=v.Long?v.Long.fromBits(0,0,!1):0,n.prototype.type=1,n.prototype.vocabularyFilterMatch=!1,n.prototype.confidence=0,n.prototype.stable=!1,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.content!=null&&Object.hasOwnProperty.call(e,"content")&&i.uint32(10).string(e.content),e.endTime!=null&&Object.hasOwnProperty.call(e,"endTime")&&i.uint32(16).int64(e.endTime),e.speakerAttendeeId!=null&&Object.hasOwnProperty.call(e,"speakerAttendeeId")&&i.uint32(26).string(e.speakerAttendeeId),e.speakerExternalUserId!=null&&Object.hasOwnProperty.call(e,"speakerExternalUserId")&&i.uint32(34).string(e.speakerExternalUserId),e.startTime!=null&&Object.hasOwnProperty.call(e,"startTime")&&i.uint32(40).int64(e.startTime),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&i.uint32(48).int32(e.type),e.vocabularyFilterMatch!=null&&Object.hasOwnProperty.call(e,"vocabularyFilterMatch")&&i.uint32(56).bool(e.vocabularyFilterMatch),e.confidence!=null&&Object.hasOwnProperty.call(e,"confidence")&&i.uint32(65).double(e.confidence),e.stable!=null&&Object.hasOwnProperty.call(e,"stable")&&i.uint32(72).bool(e.stable),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkTranscriptItem;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.content=e.string();break}case 2:{o.endTime=e.int64();break}case 3:{o.speakerAttendeeId=e.string();break}case 4:{o.speakerExternalUserId=e.string();break}case 5:{o.startTime=e.int64();break}case 6:{o.type=e.int32();break}case 7:{o.vocabularyFilterMatch=e.bool();break}case 8:{o.confidence=e.double();break}case 9:{o.stable=e.bool();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.content!=null&&e.hasOwnProperty("content")&&!v.isString(e.content))return"content: string expected";if(e.endTime!=null&&e.hasOwnProperty("endTime")&&!v.isInteger(e.endTime)&&!(e.endTime&&v.isInteger(e.endTime.low)&&v.isInteger(e.endTime.high)))return"endTime: integer|Long expected";if(e.speakerAttendeeId!=null&&e.hasOwnProperty("speakerAttendeeId")&&!v.isString(e.speakerAttendeeId))return"speakerAttendeeId: string expected";if(e.speakerExternalUserId!=null&&e.hasOwnProperty("speakerExternalUserId")&&!v.isString(e.speakerExternalUserId))return"speakerExternalUserId: string expected";if(e.startTime!=null&&e.hasOwnProperty("startTime")&&!v.isInteger(e.startTime)&&!(e.startTime&&v.isInteger(e.startTime.low)&&v.isInteger(e.startTime.high)))return"startTime: integer|Long expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:break}return e.vocabularyFilterMatch!=null&&e.hasOwnProperty("vocabularyFilterMatch")&&typeof e.vocabularyFilterMatch!="boolean"?"vocabularyFilterMatch: boolean expected":e.confidence!=null&&e.hasOwnProperty("confidence")&&typeof e.confidence!="number"?"confidence: number expected":e.stable!=null&&e.hasOwnProperty("stable")&&typeof e.stable!="boolean"?"stable: boolean expected":null},n.fromObject=function(e){if(e instanceof f.SdkTranscriptItem)return e;var i=new f.SdkTranscriptItem;switch(e.content!=null&&(i.content=String(e.content)),e.endTime!=null&&(v.Long?(i.endTime=v.Long.fromValue(e.endTime)).unsigned=!1:typeof e.endTime=="string"?i.endTime=parseInt(e.endTime,10):typeof e.endTime=="number"?i.endTime=e.endTime:typeof e.endTime=="object"&&(i.endTime=new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),e.speakerAttendeeId!=null&&(i.speakerAttendeeId=String(e.speakerAttendeeId)),e.speakerExternalUserId!=null&&(i.speakerExternalUserId=String(e.speakerExternalUserId)),e.startTime!=null&&(v.Long?(i.startTime=v.Long.fromValue(e.startTime)).unsigned=!1:typeof e.startTime=="string"?i.startTime=parseInt(e.startTime,10):typeof e.startTime=="number"?i.startTime=e.startTime:typeof e.startTime=="object"&&(i.startTime=new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),e.type){default:if(typeof e.type=="number"){i.type=e.type;break}break;case"PRONUNCIATION":case 1:i.type=1;break;case"PUNCTUATION":case 2:i.type=2;break}return e.vocabularyFilterMatch!=null&&(i.vocabularyFilterMatch=!!e.vocabularyFilterMatch),e.confidence!=null&&(i.confidence=Number(e.confidence)),e.stable!=null&&(i.stable=!!e.stable),i},n.toObject=function(e,i){i||(i={});var r={};if(i.defaults){if(r.content="",v.Long){var o=new v.Long(0,0,!1);r.endTime=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.endTime=i.longs===String?"0":0;if(r.speakerAttendeeId="",r.speakerExternalUserId="",v.Long){var o=new v.Long(0,0,!1);r.startTime=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.startTime=i.longs===String?"0":0;r.type=i.enums===String?"PRONUNCIATION":1,r.vocabularyFilterMatch=!1,r.confidence=0,r.stable=!1}return e.content!=null&&e.hasOwnProperty("content")&&(r.content=e.content),e.endTime!=null&&e.hasOwnProperty("endTime")&&(typeof e.endTime=="number"?r.endTime=i.longs===String?String(e.endTime):e.endTime:r.endTime=i.longs===String?v.Long.prototype.toString.call(e.endTime):i.longs===Number?new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),e.speakerAttendeeId!=null&&e.hasOwnProperty("speakerAttendeeId")&&(r.speakerAttendeeId=e.speakerAttendeeId),e.speakerExternalUserId!=null&&e.hasOwnProperty("speakerExternalUserId")&&(r.speakerExternalUserId=e.speakerExternalUserId),e.startTime!=null&&e.hasOwnProperty("startTime")&&(typeof e.startTime=="number"?r.startTime=i.longs===String?String(e.startTime):e.startTime:r.startTime=i.longs===String?v.Long.prototype.toString.call(e.startTime):i.longs===Number?new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),e.type!=null&&e.hasOwnProperty("type")&&(r.type=i.enums===String?f.SdkTranscriptItem.Type[e.type]===void 0?e.type:f.SdkTranscriptItem.Type[e.type]:e.type),e.vocabularyFilterMatch!=null&&e.hasOwnProperty("vocabularyFilterMatch")&&(r.vocabularyFilterMatch=e.vocabularyFilterMatch),e.confidence!=null&&e.hasOwnProperty("confidence")&&(r.confidence=i.json&&!isFinite(e.confidence)?String(e.confidence):e.confidence),e.stable!=null&&e.hasOwnProperty("stable")&&(r.stable=e.stable),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptItem"},n.Type=(function(){var t={},e=Object.create(t);return e[t[1]="PRONUNCIATION"]=1,e[t[2]="PUNCTUATION"]=2,e})(),n})();f.SdkTranscriptEntity=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.category="",n.prototype.confidence=0,n.prototype.content="",n.prototype.endTime=v.Long?v.Long.fromBits(0,0,!1):0,n.prototype.startTime=v.Long?v.Long.fromBits(0,0,!1):0,n.prototype.type="",n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.category!=null&&Object.hasOwnProperty.call(e,"category")&&i.uint32(10).string(e.category),e.confidence!=null&&Object.hasOwnProperty.call(e,"confidence")&&i.uint32(17).double(e.confidence),e.content!=null&&Object.hasOwnProperty.call(e,"content")&&i.uint32(26).string(e.content),e.endTime!=null&&Object.hasOwnProperty.call(e,"endTime")&&i.uint32(32).int64(e.endTime),e.startTime!=null&&Object.hasOwnProperty.call(e,"startTime")&&i.uint32(40).int64(e.startTime),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&i.uint32(50).string(e.type),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkTranscriptEntity;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.category=e.string();break}case 2:{o.confidence=e.double();break}case 3:{o.content=e.string();break}case 4:{o.endTime=e.int64();break}case 5:{o.startTime=e.int64();break}case 6:{o.type=e.string();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.category!=null&&e.hasOwnProperty("category")&&!v.isString(e.category)?"category: string expected":e.confidence!=null&&e.hasOwnProperty("confidence")&&typeof e.confidence!="number"?"confidence: number expected":e.content!=null&&e.hasOwnProperty("content")&&!v.isString(e.content)?"content: string expected":e.endTime!=null&&e.hasOwnProperty("endTime")&&!v.isInteger(e.endTime)&&!(e.endTime&&v.isInteger(e.endTime.low)&&v.isInteger(e.endTime.high))?"endTime: integer|Long expected":e.startTime!=null&&e.hasOwnProperty("startTime")&&!v.isInteger(e.startTime)&&!(e.startTime&&v.isInteger(e.startTime.low)&&v.isInteger(e.startTime.high))?"startTime: integer|Long expected":e.type!=null&&e.hasOwnProperty("type")&&!v.isString(e.type)?"type: string expected":null},n.fromObject=function(e){if(e instanceof f.SdkTranscriptEntity)return e;var i=new f.SdkTranscriptEntity;return e.category!=null&&(i.category=String(e.category)),e.confidence!=null&&(i.confidence=Number(e.confidence)),e.content!=null&&(i.content=String(e.content)),e.endTime!=null&&(v.Long?(i.endTime=v.Long.fromValue(e.endTime)).unsigned=!1:typeof e.endTime=="string"?i.endTime=parseInt(e.endTime,10):typeof e.endTime=="number"?i.endTime=e.endTime:typeof e.endTime=="object"&&(i.endTime=new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),e.startTime!=null&&(v.Long?(i.startTime=v.Long.fromValue(e.startTime)).unsigned=!1:typeof e.startTime=="string"?i.startTime=parseInt(e.startTime,10):typeof e.startTime=="number"?i.startTime=e.startTime:typeof e.startTime=="object"&&(i.startTime=new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),e.type!=null&&(i.type=String(e.type)),i},n.toObject=function(e,i){i||(i={});var r={};if(i.defaults){if(r.category="",r.confidence=0,r.content="",v.Long){var o=new v.Long(0,0,!1);r.endTime=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.endTime=i.longs===String?"0":0;if(v.Long){var o=new v.Long(0,0,!1);r.startTime=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.startTime=i.longs===String?"0":0;r.type=""}return e.category!=null&&e.hasOwnProperty("category")&&(r.category=e.category),e.confidence!=null&&e.hasOwnProperty("confidence")&&(r.confidence=i.json&&!isFinite(e.confidence)?String(e.confidence):e.confidence),e.content!=null&&e.hasOwnProperty("content")&&(r.content=e.content),e.endTime!=null&&e.hasOwnProperty("endTime")&&(typeof e.endTime=="number"?r.endTime=i.longs===String?String(e.endTime):e.endTime:r.endTime=i.longs===String?v.Long.prototype.toString.call(e.endTime):i.longs===Number?new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),e.startTime!=null&&e.hasOwnProperty("startTime")&&(typeof e.startTime=="number"?r.startTime=i.longs===String?String(e.startTime):e.startTime:r.startTime=i.longs===String?v.Long.prototype.toString.call(e.startTime):i.longs===Number?new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),e.type!=null&&e.hasOwnProperty("type")&&(r.type=e.type),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptEntity"},n})();f.SdkTranscriptAlternative=(function(){function n(t){if(this.items=[],this.entities=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.items=v.emptyArray,n.prototype.transcript="",n.prototype.entities=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.items!=null&&e.items.length)for(var r=0;r<e.items.length;++r)f.SdkTranscriptItem.encode(e.items[r],i.uint32(10).fork()).ldelim();if(e.transcript!=null&&Object.hasOwnProperty.call(e,"transcript")&&i.uint32(18).string(e.transcript),e.entities!=null&&e.entities.length)for(var r=0;r<e.entities.length;++r)f.SdkTranscriptEntity.encode(e.entities[r],i.uint32(26).fork()).ldelim();return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkTranscriptAlternative;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.items&&o.items.length||(o.items=[]),o.items.push(f.SdkTranscriptItem.decode(e,e.uint32()));break}case 2:{o.transcript=e.string();break}case 3:{o.entities&&o.entities.length||(o.entities=[]),o.entities.push(f.SdkTranscriptEntity.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.items!=null&&e.hasOwnProperty("items")){if(!Array.isArray(e.items))return"items: array expected";for(var i=0;i<e.items.length;++i){var r=f.SdkTranscriptItem.verify(e.items[i]);if(r)return"items."+r}}if(e.transcript!=null&&e.hasOwnProperty("transcript")&&!v.isString(e.transcript))return"transcript: string expected";if(e.entities!=null&&e.hasOwnProperty("entities")){if(!Array.isArray(e.entities))return"entities: array expected";for(var i=0;i<e.entities.length;++i){var r=f.SdkTranscriptEntity.verify(e.entities[i]);if(r)return"entities."+r}}return null},n.fromObject=function(e){if(e instanceof f.SdkTranscriptAlternative)return e;var i=new f.SdkTranscriptAlternative;if(e.items){if(!Array.isArray(e.items))throw TypeError(".SdkTranscriptAlternative.items: array expected");i.items=[];for(var r=0;r<e.items.length;++r){if(typeof e.items[r]!="object")throw TypeError(".SdkTranscriptAlternative.items: object expected");i.items[r]=f.SdkTranscriptItem.fromObject(e.items[r])}}if(e.transcript!=null&&(i.transcript=String(e.transcript)),e.entities){if(!Array.isArray(e.entities))throw TypeError(".SdkTranscriptAlternative.entities: array expected");i.entities=[];for(var r=0;r<e.entities.length;++r){if(typeof e.entities[r]!="object")throw TypeError(".SdkTranscriptAlternative.entities: object expected");i.entities[r]=f.SdkTranscriptEntity.fromObject(e.entities[r])}}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.items=[],r.entities=[]),i.defaults&&(r.transcript=""),e.items&&e.items.length){r.items=[];for(var o=0;o<e.items.length;++o)r.items[o]=f.SdkTranscriptItem.toObject(e.items[o],i)}if(e.transcript!=null&&e.hasOwnProperty("transcript")&&(r.transcript=e.transcript),e.entities&&e.entities.length){r.entities=[];for(var o=0;o<e.entities.length;++o)r.entities[o]=f.SdkTranscriptEntity.toObject(e.entities[o],i)}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptAlternative"},n})();f.SdkTranscriptLanguageWithScore=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.languageCode="",n.prototype.score=0,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.languageCode!=null&&Object.hasOwnProperty.call(e,"languageCode")&&i.uint32(10).string(e.languageCode),e.score!=null&&Object.hasOwnProperty.call(e,"score")&&i.uint32(17).double(e.score),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkTranscriptLanguageWithScore;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.languageCode=e.string();break}case 2:{o.score=e.double();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.languageCode!=null&&e.hasOwnProperty("languageCode")&&!v.isString(e.languageCode)?"languageCode: string expected":e.score!=null&&e.hasOwnProperty("score")&&typeof e.score!="number"?"score: number expected":null},n.fromObject=function(e){if(e instanceof f.SdkTranscriptLanguageWithScore)return e;var i=new f.SdkTranscriptLanguageWithScore;return e.languageCode!=null&&(i.languageCode=String(e.languageCode)),e.score!=null&&(i.score=Number(e.score)),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.languageCode="",r.score=0),e.languageCode!=null&&e.hasOwnProperty("languageCode")&&(r.languageCode=e.languageCode),e.score!=null&&e.hasOwnProperty("score")&&(r.score=i.json&&!isFinite(e.score)?String(e.score):e.score),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptLanguageWithScore"},n})();f.SdkTranscriptResult=(function(){function n(t){if(this.alternatives=[],this.languageIdentification=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.alternatives=v.emptyArray,n.prototype.channelId="",n.prototype.endTime=v.Long?v.Long.fromBits(0,0,!1):0,n.prototype.isPartial=!1,n.prototype.resultId="",n.prototype.startTime=v.Long?v.Long.fromBits(0,0,!1):0,n.prototype.languageCode="",n.prototype.languageIdentification=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.alternatives!=null&&e.alternatives.length)for(var r=0;r<e.alternatives.length;++r)f.SdkTranscriptAlternative.encode(e.alternatives[r],i.uint32(10).fork()).ldelim();if(e.channelId!=null&&Object.hasOwnProperty.call(e,"channelId")&&i.uint32(18).string(e.channelId),e.endTime!=null&&Object.hasOwnProperty.call(e,"endTime")&&i.uint32(24).int64(e.endTime),e.isPartial!=null&&Object.hasOwnProperty.call(e,"isPartial")&&i.uint32(32).bool(e.isPartial),e.resultId!=null&&Object.hasOwnProperty.call(e,"resultId")&&i.uint32(42).string(e.resultId),e.startTime!=null&&Object.hasOwnProperty.call(e,"startTime")&&i.uint32(48).int64(e.startTime),e.languageCode!=null&&Object.hasOwnProperty.call(e,"languageCode")&&i.uint32(58).string(e.languageCode),e.languageIdentification!=null&&e.languageIdentification.length)for(var r=0;r<e.languageIdentification.length;++r)f.SdkTranscriptLanguageWithScore.encode(e.languageIdentification[r],i.uint32(66).fork()).ldelim();return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkTranscriptResult;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.alternatives&&o.alternatives.length||(o.alternatives=[]),o.alternatives.push(f.SdkTranscriptAlternative.decode(e,e.uint32()));break}case 2:{o.channelId=e.string();break}case 3:{o.endTime=e.int64();break}case 4:{o.isPartial=e.bool();break}case 5:{o.resultId=e.string();break}case 6:{o.startTime=e.int64();break}case 7:{o.languageCode=e.string();break}case 8:{o.languageIdentification&&o.languageIdentification.length||(o.languageIdentification=[]),o.languageIdentification.push(f.SdkTranscriptLanguageWithScore.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.alternatives!=null&&e.hasOwnProperty("alternatives")){if(!Array.isArray(e.alternatives))return"alternatives: array expected";for(var i=0;i<e.alternatives.length;++i){var r=f.SdkTranscriptAlternative.verify(e.alternatives[i]);if(r)return"alternatives."+r}}if(e.channelId!=null&&e.hasOwnProperty("channelId")&&!v.isString(e.channelId))return"channelId: string expected";if(e.endTime!=null&&e.hasOwnProperty("endTime")&&!v.isInteger(e.endTime)&&!(e.endTime&&v.isInteger(e.endTime.low)&&v.isInteger(e.endTime.high)))return"endTime: integer|Long expected";if(e.isPartial!=null&&e.hasOwnProperty("isPartial")&&typeof e.isPartial!="boolean")return"isPartial: boolean expected";if(e.resultId!=null&&e.hasOwnProperty("resultId")&&!v.isString(e.resultId))return"resultId: string expected";if(e.startTime!=null&&e.hasOwnProperty("startTime")&&!v.isInteger(e.startTime)&&!(e.startTime&&v.isInteger(e.startTime.low)&&v.isInteger(e.startTime.high)))return"startTime: integer|Long expected";if(e.languageCode!=null&&e.hasOwnProperty("languageCode")&&!v.isString(e.languageCode))return"languageCode: string expected";if(e.languageIdentification!=null&&e.hasOwnProperty("languageIdentification")){if(!Array.isArray(e.languageIdentification))return"languageIdentification: array expected";for(var i=0;i<e.languageIdentification.length;++i){var r=f.SdkTranscriptLanguageWithScore.verify(e.languageIdentification[i]);if(r)return"languageIdentification."+r}}return null},n.fromObject=function(e){if(e instanceof f.SdkTranscriptResult)return e;var i=new f.SdkTranscriptResult;if(e.alternatives){if(!Array.isArray(e.alternatives))throw TypeError(".SdkTranscriptResult.alternatives: array expected");i.alternatives=[];for(var r=0;r<e.alternatives.length;++r){if(typeof e.alternatives[r]!="object")throw TypeError(".SdkTranscriptResult.alternatives: object expected");i.alternatives[r]=f.SdkTranscriptAlternative.fromObject(e.alternatives[r])}}if(e.channelId!=null&&(i.channelId=String(e.channelId)),e.endTime!=null&&(v.Long?(i.endTime=v.Long.fromValue(e.endTime)).unsigned=!1:typeof e.endTime=="string"?i.endTime=parseInt(e.endTime,10):typeof e.endTime=="number"?i.endTime=e.endTime:typeof e.endTime=="object"&&(i.endTime=new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),e.isPartial!=null&&(i.isPartial=!!e.isPartial),e.resultId!=null&&(i.resultId=String(e.resultId)),e.startTime!=null&&(v.Long?(i.startTime=v.Long.fromValue(e.startTime)).unsigned=!1:typeof e.startTime=="string"?i.startTime=parseInt(e.startTime,10):typeof e.startTime=="number"?i.startTime=e.startTime:typeof e.startTime=="object"&&(i.startTime=new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),e.languageCode!=null&&(i.languageCode=String(e.languageCode)),e.languageIdentification){if(!Array.isArray(e.languageIdentification))throw TypeError(".SdkTranscriptResult.languageIdentification: array expected");i.languageIdentification=[];for(var r=0;r<e.languageIdentification.length;++r){if(typeof e.languageIdentification[r]!="object")throw TypeError(".SdkTranscriptResult.languageIdentification: object expected");i.languageIdentification[r]=f.SdkTranscriptLanguageWithScore.fromObject(e.languageIdentification[r])}}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.alternatives=[],r.languageIdentification=[]),i.defaults){if(r.channelId="",v.Long){var o=new v.Long(0,0,!1);r.endTime=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.endTime=i.longs===String?"0":0;if(r.isPartial=!1,r.resultId="",v.Long){var o=new v.Long(0,0,!1);r.startTime=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.startTime=i.longs===String?"0":0;r.languageCode=""}if(e.alternatives&&e.alternatives.length){r.alternatives=[];for(var s=0;s<e.alternatives.length;++s)r.alternatives[s]=f.SdkTranscriptAlternative.toObject(e.alternatives[s],i)}if(e.channelId!=null&&e.hasOwnProperty("channelId")&&(r.channelId=e.channelId),e.endTime!=null&&e.hasOwnProperty("endTime")&&(typeof e.endTime=="number"?r.endTime=i.longs===String?String(e.endTime):e.endTime:r.endTime=i.longs===String?v.Long.prototype.toString.call(e.endTime):i.longs===Number?new v.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),e.isPartial!=null&&e.hasOwnProperty("isPartial")&&(r.isPartial=e.isPartial),e.resultId!=null&&e.hasOwnProperty("resultId")&&(r.resultId=e.resultId),e.startTime!=null&&e.hasOwnProperty("startTime")&&(typeof e.startTime=="number"?r.startTime=i.longs===String?String(e.startTime):e.startTime:r.startTime=i.longs===String?v.Long.prototype.toString.call(e.startTime):i.longs===Number?new v.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),e.languageCode!=null&&e.hasOwnProperty("languageCode")&&(r.languageCode=e.languageCode),e.languageIdentification&&e.languageIdentification.length){r.languageIdentification=[];for(var s=0;s<e.languageIdentification.length;++s)r.languageIdentification[s]=f.SdkTranscriptLanguageWithScore.toObject(e.languageIdentification[s],i)}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptResult"},n})();f.SdkTranscript=(function(){function n(t){if(this.results=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.results=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.results!=null&&e.results.length)for(var r=0;r<e.results.length;++r)f.SdkTranscriptResult.encode(e.results[r],i.uint32(10).fork()).ldelim();return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkTranscript;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.results&&o.results.length||(o.results=[]),o.results.push(f.SdkTranscriptResult.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.results!=null&&e.hasOwnProperty("results")){if(!Array.isArray(e.results))return"results: array expected";for(var i=0;i<e.results.length;++i){var r=f.SdkTranscriptResult.verify(e.results[i]);if(r)return"results."+r}}return null},n.fromObject=function(e){if(e instanceof f.SdkTranscript)return e;var i=new f.SdkTranscript;if(e.results){if(!Array.isArray(e.results))throw TypeError(".SdkTranscript.results: array expected");i.results=[];for(var r=0;r<e.results.length;++r){if(typeof e.results[r]!="object")throw TypeError(".SdkTranscript.results: object expected");i.results[r]=f.SdkTranscriptResult.fromObject(e.results[r])}}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.results=[]),e.results&&e.results.length){r.results=[];for(var o=0;o<e.results.length;++o)r.results[o]=f.SdkTranscriptResult.toObject(e.results[o],i)}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscript"},n})();f.SdkTranscriptionStatus=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.type=1,n.prototype.eventTime=v.Long?v.Long.fromBits(0,0,!1):0,n.prototype.transcriptionRegion="",n.prototype.transcriptionConfiguration="",n.prototype.message="",n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&i.uint32(8).int32(e.type),e.eventTime!=null&&Object.hasOwnProperty.call(e,"eventTime")&&i.uint32(16).int64(e.eventTime),e.transcriptionRegion!=null&&Object.hasOwnProperty.call(e,"transcriptionRegion")&&i.uint32(26).string(e.transcriptionRegion),e.transcriptionConfiguration!=null&&Object.hasOwnProperty.call(e,"transcriptionConfiguration")&&i.uint32(34).string(e.transcriptionConfiguration),e.message!=null&&Object.hasOwnProperty.call(e,"message")&&i.uint32(42).string(e.message),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkTranscriptionStatus;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.type=e.int32();break}case 2:{o.eventTime=e.int64();break}case 3:{o.transcriptionRegion=e.string();break}case 4:{o.transcriptionConfiguration=e.string();break}case 5:{o.message=e.string();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:break}return e.eventTime!=null&&e.hasOwnProperty("eventTime")&&!v.isInteger(e.eventTime)&&!(e.eventTime&&v.isInteger(e.eventTime.low)&&v.isInteger(e.eventTime.high))?"eventTime: integer|Long expected":e.transcriptionRegion!=null&&e.hasOwnProperty("transcriptionRegion")&&!v.isString(e.transcriptionRegion)?"transcriptionRegion: string expected":e.transcriptionConfiguration!=null&&e.hasOwnProperty("transcriptionConfiguration")&&!v.isString(e.transcriptionConfiguration)?"transcriptionConfiguration: string expected":e.message!=null&&e.hasOwnProperty("message")&&!v.isString(e.message)?"message: string expected":null},n.fromObject=function(e){if(e instanceof f.SdkTranscriptionStatus)return e;var i=new f.SdkTranscriptionStatus;switch(e.type){default:if(typeof e.type=="number"){i.type=e.type;break}break;case"STARTED":case 1:i.type=1;break;case"INTERRUPTED":case 2:i.type=2;break;case"RESUMED":case 3:i.type=3;break;case"STOPPED":case 4:i.type=4;break;case"FAILED":case 5:i.type=5;break}return e.eventTime!=null&&(v.Long?(i.eventTime=v.Long.fromValue(e.eventTime)).unsigned=!1:typeof e.eventTime=="string"?i.eventTime=parseInt(e.eventTime,10):typeof e.eventTime=="number"?i.eventTime=e.eventTime:typeof e.eventTime=="object"&&(i.eventTime=new v.LongBits(e.eventTime.low>>>0,e.eventTime.high>>>0).toNumber())),e.transcriptionRegion!=null&&(i.transcriptionRegion=String(e.transcriptionRegion)),e.transcriptionConfiguration!=null&&(i.transcriptionConfiguration=String(e.transcriptionConfiguration)),e.message!=null&&(i.message=String(e.message)),i},n.toObject=function(e,i){i||(i={});var r={};if(i.defaults){if(r.type=i.enums===String?"STARTED":1,v.Long){var o=new v.Long(0,0,!1);r.eventTime=i.longs===String?o.toString():i.longs===Number?o.toNumber():o}else r.eventTime=i.longs===String?"0":0;r.transcriptionRegion="",r.transcriptionConfiguration="",r.message=""}return e.type!=null&&e.hasOwnProperty("type")&&(r.type=i.enums===String?f.SdkTranscriptionStatus.Type[e.type]===void 0?e.type:f.SdkTranscriptionStatus.Type[e.type]:e.type),e.eventTime!=null&&e.hasOwnProperty("eventTime")&&(typeof e.eventTime=="number"?r.eventTime=i.longs===String?String(e.eventTime):e.eventTime:r.eventTime=i.longs===String?v.Long.prototype.toString.call(e.eventTime):i.longs===Number?new v.LongBits(e.eventTime.low>>>0,e.eventTime.high>>>0).toNumber():e.eventTime),e.transcriptionRegion!=null&&e.hasOwnProperty("transcriptionRegion")&&(r.transcriptionRegion=e.transcriptionRegion),e.transcriptionConfiguration!=null&&e.hasOwnProperty("transcriptionConfiguration")&&(r.transcriptionConfiguration=e.transcriptionConfiguration),e.message!=null&&e.hasOwnProperty("message")&&(r.message=e.message),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptionStatus"},n.Type=(function(){var t={},e=Object.create(t);return e[t[1]="STARTED"]=1,e[t[2]="INTERRUPTED"]=2,e[t[3]="RESUMED"]=3,e[t[4]="STOPPED"]=4,e[t[5]="FAILED"]=5,e})(),n})();f.SdkTranscriptEvent=(function(){function n(e){if(e)for(var i=Object.keys(e),r=0;r<i.length;++r)e[i[r]]!=null&&(this[i[r]]=e[i[r]])}n.prototype.status=null,n.prototype.transcript=null;var t;return Object.defineProperty(n.prototype,"Event",{get:v.oneOfGetter(t=["status","transcript"]),set:v.oneOfSetter(t)}),n.create=function(i){return new n(i)},n.encode=function(i,r){return r||(r=B.create()),i.status!=null&&Object.hasOwnProperty.call(i,"status")&&f.SdkTranscriptionStatus.encode(i.status,r.uint32(10).fork()).ldelim(),i.transcript!=null&&Object.hasOwnProperty.call(i,"transcript")&&f.SdkTranscript.encode(i.transcript,r.uint32(18).fork()).ldelim(),r},n.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},n.decode=function(i,r){i instanceof b||(i=b.create(i));for(var o=r===void 0?i.len:i.pos+r,s=new f.SdkTranscriptEvent;i.pos<o;){var d=i.uint32();switch(d>>>3){case 1:{s.status=f.SdkTranscriptionStatus.decode(i,i.uint32());break}case 2:{s.transcript=f.SdkTranscript.decode(i,i.uint32());break}default:i.skipType(d&7);break}}return s},n.decodeDelimited=function(i){return i instanceof b||(i=new b(i)),this.decode(i,i.uint32())},n.verify=function(i){if(typeof i!="object"||i===null)return"object expected";var r={};if(i.status!=null&&i.hasOwnProperty("status")){r.Event=1;{var o=f.SdkTranscriptionStatus.verify(i.status);if(o)return"status."+o}}if(i.transcript!=null&&i.hasOwnProperty("transcript")){if(r.Event===1)return"Event: multiple values";r.Event=1;{var o=f.SdkTranscript.verify(i.transcript);if(o)return"transcript."+o}}return null},n.fromObject=function(i){if(i instanceof f.SdkTranscriptEvent)return i;var r=new f.SdkTranscriptEvent;if(i.status!=null){if(typeof i.status!="object")throw TypeError(".SdkTranscriptEvent.status: object expected");r.status=f.SdkTranscriptionStatus.fromObject(i.status)}if(i.transcript!=null){if(typeof i.transcript!="object")throw TypeError(".SdkTranscriptEvent.transcript: object expected");r.transcript=f.SdkTranscript.fromObject(i.transcript)}return r},n.toObject=function(i,r){r||(r={});var o={};return i.status!=null&&i.hasOwnProperty("status")&&(o.status=f.SdkTranscriptionStatus.toObject(i.status,r),r.oneofs&&(o.Event="status")),i.transcript!=null&&i.hasOwnProperty("transcript")&&(o.transcript=f.SdkTranscript.toObject(i.transcript,r),r.oneofs&&(o.Event="transcript")),o},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(i){return i===void 0&&(i="type.googleapis.com"),i+"/SdkTranscriptEvent"},n})();f.SdkTranscriptFrame=(function(){function n(t){if(this.events=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.events=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.events!=null&&e.events.length)for(var r=0;r<e.events.length;++r)f.SdkTranscriptEvent.encode(e.events[r],i.uint32(10).fork()).ldelim();return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkTranscriptFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.events&&o.events.length||(o.events=[]),o.events.push(f.SdkTranscriptEvent.decode(e,e.uint32()));break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.events!=null&&e.hasOwnProperty("events")){if(!Array.isArray(e.events))return"events: array expected";for(var i=0;i<e.events.length;++i){var r=f.SdkTranscriptEvent.verify(e.events[i]);if(r)return"events."+r}}return null},n.fromObject=function(e){if(e instanceof f.SdkTranscriptFrame)return e;var i=new f.SdkTranscriptFrame;if(e.events){if(!Array.isArray(e.events))throw TypeError(".SdkTranscriptFrame.events: array expected");i.events=[];for(var r=0;r<e.events.length;++r){if(typeof e.events[r]!="object")throw TypeError(".SdkTranscriptFrame.events: object expected");i.events[r]=f.SdkTranscriptEvent.fromObject(e.events[r])}}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.events=[]),e.events&&e.events.length){r.events=[];for(var o=0;o<e.events.length;++o)r.events[o]=f.SdkTranscriptEvent.toObject(e.events[o],i)}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkTranscriptFrame"},n})();f.SdkRemoteVideoUpdateFrame=(function(){function n(t){if(this.addedOrUpdatedVideoSubscriptions=[],this.removedVideoSubscriptionMids=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.addedOrUpdatedVideoSubscriptions=v.emptyArray,n.prototype.removedVideoSubscriptionMids=v.emptyArray,n.create=function(e){return new n(e)},n.encode=function(e,i){if(i||(i=B.create()),e.addedOrUpdatedVideoSubscriptions!=null&&e.addedOrUpdatedVideoSubscriptions.length)for(var r=0;r<e.addedOrUpdatedVideoSubscriptions.length;++r)f.SdkVideoSubscriptionConfiguration.encode(e.addedOrUpdatedVideoSubscriptions[r],i.uint32(10).fork()).ldelim();if(e.removedVideoSubscriptionMids!=null&&e.removedVideoSubscriptionMids.length)for(var r=0;r<e.removedVideoSubscriptionMids.length;++r)i.uint32(18).string(e.removedVideoSubscriptionMids[r]);return i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkRemoteVideoUpdateFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.addedOrUpdatedVideoSubscriptions&&o.addedOrUpdatedVideoSubscriptions.length||(o.addedOrUpdatedVideoSubscriptions=[]),o.addedOrUpdatedVideoSubscriptions.push(f.SdkVideoSubscriptionConfiguration.decode(e,e.uint32()));break}case 2:{o.removedVideoSubscriptionMids&&o.removedVideoSubscriptionMids.length||(o.removedVideoSubscriptionMids=[]),o.removedVideoSubscriptionMids.push(e.string());break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.addedOrUpdatedVideoSubscriptions!=null&&e.hasOwnProperty("addedOrUpdatedVideoSubscriptions")){if(!Array.isArray(e.addedOrUpdatedVideoSubscriptions))return"addedOrUpdatedVideoSubscriptions: array expected";for(var i=0;i<e.addedOrUpdatedVideoSubscriptions.length;++i){var r=f.SdkVideoSubscriptionConfiguration.verify(e.addedOrUpdatedVideoSubscriptions[i]);if(r)return"addedOrUpdatedVideoSubscriptions."+r}}if(e.removedVideoSubscriptionMids!=null&&e.hasOwnProperty("removedVideoSubscriptionMids")){if(!Array.isArray(e.removedVideoSubscriptionMids))return"removedVideoSubscriptionMids: array expected";for(var i=0;i<e.removedVideoSubscriptionMids.length;++i)if(!v.isString(e.removedVideoSubscriptionMids[i]))return"removedVideoSubscriptionMids: string[] expected"}return null},n.fromObject=function(e){if(e instanceof f.SdkRemoteVideoUpdateFrame)return e;var i=new f.SdkRemoteVideoUpdateFrame;if(e.addedOrUpdatedVideoSubscriptions){if(!Array.isArray(e.addedOrUpdatedVideoSubscriptions))throw TypeError(".SdkRemoteVideoUpdateFrame.addedOrUpdatedVideoSubscriptions: array expected");i.addedOrUpdatedVideoSubscriptions=[];for(var r=0;r<e.addedOrUpdatedVideoSubscriptions.length;++r){if(typeof e.addedOrUpdatedVideoSubscriptions[r]!="object")throw TypeError(".SdkRemoteVideoUpdateFrame.addedOrUpdatedVideoSubscriptions: object expected");i.addedOrUpdatedVideoSubscriptions[r]=f.SdkVideoSubscriptionConfiguration.fromObject(e.addedOrUpdatedVideoSubscriptions[r])}}if(e.removedVideoSubscriptionMids){if(!Array.isArray(e.removedVideoSubscriptionMids))throw TypeError(".SdkRemoteVideoUpdateFrame.removedVideoSubscriptionMids: array expected");i.removedVideoSubscriptionMids=[];for(var r=0;r<e.removedVideoSubscriptionMids.length;++r)i.removedVideoSubscriptionMids[r]=String(e.removedVideoSubscriptionMids[r])}return i},n.toObject=function(e,i){i||(i={});var r={};if((i.arrays||i.defaults)&&(r.addedOrUpdatedVideoSubscriptions=[],r.removedVideoSubscriptionMids=[]),e.addedOrUpdatedVideoSubscriptions&&e.addedOrUpdatedVideoSubscriptions.length){r.addedOrUpdatedVideoSubscriptions=[];for(var o=0;o<e.addedOrUpdatedVideoSubscriptions.length;++o)r.addedOrUpdatedVideoSubscriptions[o]=f.SdkVideoSubscriptionConfiguration.toObject(e.addedOrUpdatedVideoSubscriptions[o],i)}if(e.removedVideoSubscriptionMids&&e.removedVideoSubscriptionMids.length){r.removedVideoSubscriptionMids=[];for(var o=0;o<e.removedVideoSubscriptionMids.length;++o)r.removedVideoSubscriptionMids[o]=e.removedVideoSubscriptionMids[o]}return r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkRemoteVideoUpdateFrame"},n})();f.SdkVideoQualityAdaptationPreference=(function(){var n={},t=Object.create(n);return t[n[1]="BALANCED"]=1,t[n[2]="MAINTAIN_FRAMERATE"]=2,t[n[3]="MAINTAIN_RESOLUTION"]=3,t})();f.SdkVideoSubscriptionConfiguration=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.mid="",n.prototype.attendeeId="",n.prototype.streamId=0,n.prototype.priority=0,n.prototype.targetBitrateKbps=0,n.prototype.groupId=0,n.prototype.qualityAdaptationPreference=1,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),i.uint32(10).string(e.mid),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&i.uint32(18).string(e.attendeeId),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&i.uint32(24).uint32(e.streamId),e.priority!=null&&Object.hasOwnProperty.call(e,"priority")&&i.uint32(32).uint32(e.priority),e.targetBitrateKbps!=null&&Object.hasOwnProperty.call(e,"targetBitrateKbps")&&i.uint32(40).uint32(e.targetBitrateKbps),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&i.uint32(48).uint32(e.groupId),e.qualityAdaptationPreference!=null&&Object.hasOwnProperty.call(e,"qualityAdaptationPreference")&&i.uint32(56).int32(e.qualityAdaptationPreference),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkVideoSubscriptionConfiguration;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.mid=e.string();break}case 2:{o.attendeeId=e.string();break}case 3:{o.streamId=e.uint32();break}case 4:{o.priority=e.uint32();break}case 5:{o.targetBitrateKbps=e.uint32();break}case 6:{o.groupId=e.uint32();break}case 7:{o.qualityAdaptationPreference=e.int32();break}default:e.skipType(s&7);break}}if(!o.hasOwnProperty("mid"))throw v.ProtocolError("missing required 'mid'",{instance:o});return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(!v.isString(e.mid))return"mid: string expected";if(e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!v.isString(e.attendeeId))return"attendeeId: string expected";if(e.streamId!=null&&e.hasOwnProperty("streamId")&&!v.isInteger(e.streamId))return"streamId: integer expected";if(e.priority!=null&&e.hasOwnProperty("priority")&&!v.isInteger(e.priority))return"priority: integer expected";if(e.targetBitrateKbps!=null&&e.hasOwnProperty("targetBitrateKbps")&&!v.isInteger(e.targetBitrateKbps))return"targetBitrateKbps: integer expected";if(e.groupId!=null&&e.hasOwnProperty("groupId")&&!v.isInteger(e.groupId))return"groupId: integer expected";if(e.qualityAdaptationPreference!=null&&e.hasOwnProperty("qualityAdaptationPreference"))switch(e.qualityAdaptationPreference){default:return"qualityAdaptationPreference: enum value expected";case 1:case 2:case 3:break}return null},n.fromObject=function(e){if(e instanceof f.SdkVideoSubscriptionConfiguration)return e;var i=new f.SdkVideoSubscriptionConfiguration;switch(e.mid!=null&&(i.mid=String(e.mid)),e.attendeeId!=null&&(i.attendeeId=String(e.attendeeId)),e.streamId!=null&&(i.streamId=e.streamId>>>0),e.priority!=null&&(i.priority=e.priority>>>0),e.targetBitrateKbps!=null&&(i.targetBitrateKbps=e.targetBitrateKbps>>>0),e.groupId!=null&&(i.groupId=e.groupId>>>0),e.qualityAdaptationPreference){default:if(typeof e.qualityAdaptationPreference=="number"){i.qualityAdaptationPreference=e.qualityAdaptationPreference;break}break;case"BALANCED":case 1:i.qualityAdaptationPreference=1;break;case"MAINTAIN_FRAMERATE":case 2:i.qualityAdaptationPreference=2;break;case"MAINTAIN_RESOLUTION":case 3:i.qualityAdaptationPreference=3;break}return i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.mid="",r.attendeeId="",r.streamId=0,r.priority=0,r.targetBitrateKbps=0,r.groupId=0,r.qualityAdaptationPreference=i.enums===String?"BALANCED":1),e.mid!=null&&e.hasOwnProperty("mid")&&(r.mid=e.mid),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(r.attendeeId=e.attendeeId),e.streamId!=null&&e.hasOwnProperty("streamId")&&(r.streamId=e.streamId),e.priority!=null&&e.hasOwnProperty("priority")&&(r.priority=e.priority),e.targetBitrateKbps!=null&&e.hasOwnProperty("targetBitrateKbps")&&(r.targetBitrateKbps=e.targetBitrateKbps),e.groupId!=null&&e.hasOwnProperty("groupId")&&(r.groupId=e.groupId),e.qualityAdaptationPreference!=null&&e.hasOwnProperty("qualityAdaptationPreference")&&(r.qualityAdaptationPreference=i.enums===String?f.SdkVideoQualityAdaptationPreference[e.qualityAdaptationPreference]===void 0?e.qualityAdaptationPreference:f.SdkVideoQualityAdaptationPreference[e.qualityAdaptationPreference]:e.qualityAdaptationPreference),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkVideoSubscriptionConfiguration"},n})();f.SdkNotificationFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.level=3,n.prototype.message="",n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.level!=null&&Object.hasOwnProperty.call(e,"level")&&i.uint32(8).int32(e.level),e.message!=null&&Object.hasOwnProperty.call(e,"message")&&i.uint32(18).string(e.message),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkNotificationFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.level=e.int32();break}case 2:{o.message=e.string();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.level!=null&&e.hasOwnProperty("level"))switch(e.level){default:return"level: enum value expected";case 1:case 2:case 3:break}return e.message!=null&&e.hasOwnProperty("message")&&!v.isString(e.message)?"message: string expected":null},n.fromObject=function(e){if(e instanceof f.SdkNotificationFrame)return e;var i=new f.SdkNotificationFrame;switch(e.level){case"INFO":case 1:i.level=1;break;case"WARNING":case 2:i.level=2;break;default:if(typeof e.level=="number"){i.level=e.level;break}break;case"ERROR":case 3:i.level=3;break}return e.message!=null&&(i.message=String(e.message)),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.level=i.enums===String?"ERROR":3,r.message=""),e.level!=null&&e.hasOwnProperty("level")&&(r.level=i.enums===String?f.SdkNotificationFrame.NotificationLevel[e.level]===void 0?e.level:f.SdkNotificationFrame.NotificationLevel[e.level]:e.level),e.message!=null&&e.hasOwnProperty("message")&&(r.message=e.message),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkNotificationFrame"},n.NotificationLevel=(function(){var t={},e=Object.create(t);return e[t[1]="INFO"]=1,e[t[2]="WARNING"]=2,e[t[3]="ERROR"]=3,e})(),n})();f.SdkPrimaryMeetingJoinFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.credentials=null,n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.credentials!=null&&Object.hasOwnProperty.call(e,"credentials")&&f.SdkMeetingSessionCredentials.encode(e.credentials,i.uint32(10).fork()).ldelim(),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkPrimaryMeetingJoinFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.credentials=f.SdkMeetingSessionCredentials.decode(e,e.uint32());break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.credentials!=null&&e.hasOwnProperty("credentials")){var i=f.SdkMeetingSessionCredentials.verify(e.credentials);if(i)return"credentials."+i}return null},n.fromObject=function(e){if(e instanceof f.SdkPrimaryMeetingJoinFrame)return e;var i=new f.SdkPrimaryMeetingJoinFrame;if(e.credentials!=null){if(typeof e.credentials!="object")throw TypeError(".SdkPrimaryMeetingJoinFrame.credentials: object expected");i.credentials=f.SdkMeetingSessionCredentials.fromObject(e.credentials)}return i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.credentials=null),e.credentials!=null&&e.hasOwnProperty("credentials")&&(r.credentials=f.SdkMeetingSessionCredentials.toObject(e.credentials,i)),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkPrimaryMeetingJoinFrame"},n})();f.SdkPrimaryMeetingJoinAckFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkPrimaryMeetingJoinAckFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":null},n.fromObject=function(e){return e instanceof f.SdkPrimaryMeetingJoinAckFrame?e:new f.SdkPrimaryMeetingJoinAckFrame},n.toObject=function(){return{}},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkPrimaryMeetingJoinAckFrame"},n})();f.SdkPrimaryMeetingLeaveFrame=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkPrimaryMeetingLeaveFrame;e.pos<r;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":null},n.fromObject=function(e){return e instanceof f.SdkPrimaryMeetingLeaveFrame?e:new f.SdkPrimaryMeetingLeaveFrame},n.toObject=function(){return{}},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkPrimaryMeetingLeaveFrame"},n})();f.SdkMeetingSessionCredentials=(function(){function n(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)t[e[i]]!=null&&(this[e[i]]=t[e[i]])}return n.prototype.attendeeId="",n.prototype.externalUserId="",n.prototype.joinToken="",n.create=function(e){return new n(e)},n.encode=function(e,i){return i||(i=B.create()),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&i.uint32(10).string(e.attendeeId),e.externalUserId!=null&&Object.hasOwnProperty.call(e,"externalUserId")&&i.uint32(18).string(e.externalUserId),e.joinToken!=null&&Object.hasOwnProperty.call(e,"joinToken")&&i.uint32(26).string(e.joinToken),i},n.encodeDelimited=function(e,i){return this.encode(e,i).ldelim()},n.decode=function(e,i){e instanceof b||(e=b.create(e));for(var r=i===void 0?e.len:e.pos+i,o=new f.SdkMeetingSessionCredentials;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:{o.attendeeId=e.string();break}case 2:{o.externalUserId=e.string();break}case 3:{o.joinToken=e.string();break}default:e.skipType(s&7);break}}return o},n.decodeDelimited=function(e){return e instanceof b||(e=new b(e)),this.decode(e,e.uint32())},n.verify=function(e){return typeof e!="object"||e===null?"object expected":e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!v.isString(e.attendeeId)?"attendeeId: string expected":e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&!v.isString(e.externalUserId)?"externalUserId: string expected":e.joinToken!=null&&e.hasOwnProperty("joinToken")&&!v.isString(e.joinToken)?"joinToken: string expected":null},n.fromObject=function(e){if(e instanceof f.SdkMeetingSessionCredentials)return e;var i=new f.SdkMeetingSessionCredentials;return e.attendeeId!=null&&(i.attendeeId=String(e.attendeeId)),e.externalUserId!=null&&(i.externalUserId=String(e.externalUserId)),e.joinToken!=null&&(i.joinToken=String(e.joinToken)),i},n.toObject=function(e,i){i||(i={});var r={};return i.defaults&&(r.attendeeId="",r.externalUserId="",r.joinToken=""),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(r.attendeeId=e.attendeeId),e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&(r.externalUserId=e.externalUserId),e.joinToken!=null&&e.hasOwnProperty("joinToken")&&(r.joinToken=e.joinToken),r},n.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},n.getTypeUrl=function(e){return e===void 0&&(e="type.googleapis.com"),e+"/SdkMeetingSessionCredentials"},n})();f.SdkVideoCodecCapability=(function(){var n={},t=Object.create(n);return t[n[1]="VP8"]=1,t[n[2]="H264_BASELINE_PROFILE"]=2,t[n[3]="H264_CONSTRAINED_BASELINE_PROFILE"]=3,t[n[4]="H264_MAIN_PROFILE"]=4,t[n[5]="H264_HIGH_PROFILE"]=5,t[n[6]="H264_CONSTRAINED_HIGH_PROFILE"]=6,t[n[8]="VP9_PROFILE_0"]=8,t[n[11]="AV1_MAIN_PROFILE"]=11,t})();C_.exports=f;v.Long=void 0;N.configure()});var fr=g(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});ur.ClientMetricReportDirection=void 0;var O_;(function(n){n[n.UPSTREAM=0]="UPSTREAM",n[n.DOWNSTREAM=1]="DOWNSTREAM"})(O_=ur.ClientMetricReportDirection||(ur.ClientMetricReportDirection={}));ur.default=O_});var pr=g(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.ClientMetricReportMediaType=void 0;var E_;(function(n){n[n.AUDIO=0]="AUDIO",n[n.VIDEO=1]="VIDEO"})(E_=hr.ClientMetricReportMediaType||(hr.ClientMetricReportMediaType={}));hr.default=E_});var Hu=g(qu=>{"use strict";Object.defineProperty(qu,"__esModule",{value:!0});var Uu=class{constructor(){this.previousMetrics={},this.currentMetrics={},this.currentStringMetrics={},this.previousObjectMetrics={},this.currentObjectMetrics={}}};qu.default=Uu});var zu=g(No=>{"use strict";var Wu=No&&No.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(No,"__esModule",{value:!0});var M=oe(),j=Wu(fr()),W=Wu(pr()),yO=Wu(Hu()),ju=class n{constructor(t,e,i){this.logger=t,this.videoStreamIndex=e,this.selfAttendeeId=i,this.globalMetricReport=new yO.default,this.streamMetricReports={},this.rtcStatsReport={},this.customStatsReports=[],this.currentTimestampMs=0,this.previousTimestampMs=0,this.currentSsrcs={},this.overriddenObservableMetrics=new Map,this.identityValue=(r,o)=>{let s=o?this.streamMetricReports[o]:this.globalMetricReport;return Number(s.currentMetrics[r])},this.decoderLossPercent=(r,o)=>{let s=this.streamMetricReports[o],d=s.currentMetrics.concealedSamples-(s.previousMetrics.concealedSamples||0),l=s.currentMetrics.totalSamplesReceived-(s.previousMetrics.totalSamplesReceived||0);return l<=0||l-d<=0?0:d/l*100},this.packetLossPercent=(r,o)=>{let s=this.streamMetricReports[o],d=s.currentMetrics[r]-(s.previousMetrics[r]||0),l=s.currentMetrics.packetsLost-(s.previousMetrics.packetsLost||0),c=d+l;return c<=0||l<=0?0:l*100/c},this.jitterBufferMs=(r,o)=>{let s=this.streamMetricReports[o],d=s.currentMetrics.jitterBufferDelay-(s.previousMetrics.jitterBufferDelay||0),l=s.currentMetrics.jitterBufferEmittedCount-(s.previousMetrics.jitterBufferEmittedCount||0);return d<=0||l<=0?0:d/l*1e3},this.countPerSecond=(r,o)=>{let s=o?this.streamMetricReports[o]:this.globalMetricReport,d=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(d<=0)return 0;this.previousTimestampMs<=0&&(d=1);let l=s.currentMetrics[r]-(s.previousMetrics[r]||0);return l<=0?0:Math.trunc(l/d)},this.bitsPerSecond=(r,o)=>{let s=o?this.streamMetricReports[o]:this.globalMetricReport,d=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(d<=0)return 0;this.previousTimestampMs<=0&&(d=1);let l=(s.currentMetrics[r]-(s.previousMetrics[r]||0))*8;return l<=0?0:Math.trunc(l/d)},this.secondsToMilliseconds=(r,o)=>{let s=o?this.streamMetricReports[o]:this.globalMetricReport;return Number(s.currentMetrics[r]*1e3)},this.averageTimeSpentPerSecondInMilliseconds=(r,o)=>{let s=o?this.streamMetricReports[o]:this.globalMetricReport,d=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(d<=0)return 0;this.previousTimestampMs<=0&&(d=1);let l=s.currentMetrics[r]-(s.previousMetrics[r]||0);return l<=0?0:l*1e3/d},this.averageCpuQualityLimitationDurationPerSecondInMilliseconds=(r,o)=>{let s=this.streamMetricReports[o];if(s.previousObjectMetrics[r]===void 0||s.currentObjectMetrics[r]===void 0)return NaN;let d=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(d<=0)return 0;this.previousTimestampMs<=0&&(d=1);let l=0,c=0;for(let[u,p]of Object.entries(s.previousObjectMetrics[r]))u==="cpu"&&(l=p);for(let[u,p]of Object.entries(s.currentObjectMetrics[r]))u==="cpu"&&(c=p);let a=c-l;return a<=0?0:a*1e3/d},this.isHardwareImplementation=(r,o)=>{let s=this.streamMetricReports[o];if(s.currentStringMetrics[r]===void 0)return NaN;let d=String(s.currentStringMetrics[r]),l=d.includes("ExternalDecoder")||d.includes("ExternalEncoder")||d.includes("EncodeAccelerator")||d.includes("DecodeAccelerator"),c=d.includes("fallback from");return l&&!c?1:0},this.globalMetricMap={retransmittedBytesSent:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_RETRANSMIT_BITRATE},totalEncodedBytesTarget:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_TARGET_ENCODER_BITRATE},totalPacketSendDelay:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_BUCKET_DELAY_MS},packetsDiscardedOnSend:{transform:this.countPerSecond,type:M.SdkMetric.Type.SOCKET_DISCARDED_PPS},availableIncomingBitrate:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_AVAILABLE_RECEIVE_BANDWIDTH},availableOutgoingBitrate:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_AVAILABLE_SEND_BANDWIDTH},currentRoundTripTime:{transform:this.secondsToMilliseconds,type:M.SdkMetric.Type.STUN_RTT_MS},audioLevel:{transform:this.identityValue,type:M.SdkMetric.Type.RTC_MIC_AUDIO_LEVEL,source:"audioLevel"}},this.audioUpstreamMetricMap={jitter:{transform:this.secondsToMilliseconds,type:M.SdkMetric.Type.RTC_MIC_JITTER_MS},packetsSent:{transform:this.countPerSecond,type:M.SdkMetric.Type.RTC_MIC_PPS},bytesSent:{transform:this.bitsPerSecond,type:M.SdkMetric.Type.RTC_MIC_BITRATE},roundTripTime:{transform:this.secondsToMilliseconds,type:M.SdkMetric.Type.RTC_MIC_RTT_MS},packetsLost:{transform:this.packetLossPercent,type:M.SdkMetric.Type.RTC_MIC_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"}},this.audioDownstreamMetricMap={concealedSamples:{transform:this.countPerSecond},totalSamplesReceived:{transform:this.countPerSecond},decoderLoss:{transform:this.decoderLossPercent,type:M.SdkMetric.Type.RTC_SPK_FRACTION_DECODER_LOSS_PERCENT},packetsReceived:{transform:this.countPerSecond,type:M.SdkMetric.Type.RTC_SPK_PPS},packetsLost:{transform:this.packetLossPercent,type:M.SdkMetric.Type.RTC_SPK_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},jitter:{transform:this.secondsToMilliseconds,type:M.SdkMetric.Type.RTC_SPK_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:M.SdkMetric.Type.RTC_SPK_JITTER_BUFFER_MS},bytesReceived:{transform:this.bitsPerSecond,type:M.SdkMetric.Type.RTC_SPK_BITRATE},audioLevel:{transform:this.identityValue,type:M.SdkMetric.Type.RTC_SPK_AUDIO_LEVEL},totalAudioPacketsLost:{transform:this.identityValue,type:M.SdkMetric.Type.RTC_SPK_TOTAL_LOST},totalAudioPacketsExpected:{transform:this.identityValue,type:M.SdkMetric.Type.RTC_SPK_TOTAL_EXPECTED},totalAudioPacketsRecoveredRed:{transform:this.identityValue,type:M.SdkMetric.Type.RTC_SPK_TOTAL_RECOVERED_RED},totalAudioPacketsRecoveredFec:{transform:this.identityValue,type:M.SdkMetric.Type.RTC_SPK_TOTAL_RECOVERED_FEC}},this.videoUpstreamMetricMap={roundTripTime:{transform:this.secondsToMilliseconds,type:M.SdkMetric.Type.VIDEO_SENT_RTT_MS},nackCount:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_NACKS_RECEIVED},pliCount:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_PLIS_RECEIVED},firCount:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_FIRS_RECEIVED},framesPerSecond:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_INPUT_FPS},framesEncoded:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_ENCODE_FPS},packetsSent:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_SENT_PPS},packetsLost:{transform:this.packetLossPercent,type:M.SdkMetric.Type.VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"},bytesSent:{transform:this.bitsPerSecond,type:M.SdkMetric.Type.VIDEO_SENT_BITRATE},qpSum:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_SENT_QP_SUM},frameHeight:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_ENCODE_HEIGHT},frameWidth:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_ENCODE_WIDTH},jitter:{transform:this.secondsToMilliseconds,type:M.SdkMetric.Type.VIDEO_SENT_JITTER_MS},totalEncodeTime:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:M.SdkMetric.Type.VIDEO_ENCODE_MS},encoderImplementation:{transform:this.isHardwareImplementation,type:M.SdkMetric.Type.VIDEO_ENCODER_IS_HARDWARE},qualityLimitationDurations:{transform:this.averageCpuQualityLimitationDurationPerSecondInMilliseconds,type:M.SdkMetric.Type.VIDEO_QUALITY_LIMITATION_DURATION_CPU},videoCodecDegradationHighEncodeCpu:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_CODEC_DEGRADATION_HIGH_ENCODE_CPU},videoCodecDegradationEncodeFailure:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_CODEC_DEGRADATION_ENCODE_FAILURE},videoInputWidth:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_INPUT_WIDTH},videoInputHeight:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_INPUT_HEIGHT}},this.videoDownstreamMetricMap={packetsReceived:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_RECEIVED_PPS},packetsLost:{transform:this.packetLossPercent,type:M.SdkMetric.Type.VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},framesReceived:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_RECEIVED_FPS},framesDecoded:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_DECODE_FPS},nackCount:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_NACKS_SENT},firCount:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_FIRS_SENT},pliCount:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_PLIS_SENT},bytesReceived:{transform:this.bitsPerSecond,type:M.SdkMetric.Type.VIDEO_RECEIVED_BITRATE},jitter:{transform:this.secondsToMilliseconds,type:M.SdkMetric.Type.VIDEO_RECEIVED_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:M.SdkMetric.Type.VIDEO_JITTER_BUFFER_MS},qpSum:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_RECEIVED_QP_SUM},frameHeight:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_DECODE_HEIGHT},frameWidth:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_DECODE_WIDTH},totalDecodeTime:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:M.SdkMetric.Type.VIDEO_DECODE_MS},decoderImplementation:{transform:this.isHardwareImplementation,type:M.SdkMetric.Type.VIDEO_DECODER_IS_HARDWARE},totalFreezesDuration:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:M.SdkMetric.Type.VIDEO_FREEZE_DURATION},freezeCount:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_FREEZE_COUNT},totalPausesDuration:{transform:this.averageTimeSpentPerSecondInMilliseconds,type:M.SdkMetric.Type.VIDEO_PAUSE_DURATION},pauseCount:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_PAUSE_COUNT},framesDropped:{transform:this.countPerSecond,type:M.SdkMetric.Type.VIDEO_DROPPED_FPS},videoRenderWidth:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_RENDER_WIDTH},videoRenderHeight:{transform:this.identityValue,type:M.SdkMetric.Type.VIDEO_RENDER_HEIGHT}},this.streamDimensionMap={encoderImplementation:M.SdkStreamDimension.Type.VIDEO_ENCODER_NAME,decoderImplementation:M.SdkStreamDimension.Type.VIDEO_DECODER_NAME},this.observableVideoMetricSpec={videoUpstreamBitrate:{source:"bytesSent",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamPacketsSent:{source:"packetsSent",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamPacketLossPercent:{source:"packetsLost",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamFramesEncodedPerSecond:{source:"framesEncoded",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamFramesInputPerSecond:{source:"framesPerSecond",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamFrameHeight:{source:"frameHeight",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamFrameWidth:{source:"frameWidth",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamJitterMs:{source:"jitter",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamRoundTripTimeMs:{source:"roundTripTime",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamEncoderImplementation:{source:"encoderImplementation",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamTotalEncodeTimePerSecond:{source:"totalEncodeTime",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoUpstreamCpuQualityLimitationDurationPerSecond:{source:"qualityLimitationDurations",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoDownstreamBitrate:{source:"bytesReceived",media:W.default.VIDEO,dir:j.default.DOWNSTREAM},videoDownstreamPacketLossPercent:{source:"packetsLost",media:W.default.VIDEO,dir:j.default.DOWNSTREAM},videoDownstreamPacketsReceived:{source:"packetsReceived",media:W.default.VIDEO,dir:j.default.DOWNSTREAM},videoDownstreamFramesDecodedPerSecond:{source:"framesDecoded",media:W.default.VIDEO,dir:j.default.DOWNSTREAM},videoDownstreamFrameHeight:{source:"frameHeight",media:W.default.VIDEO,dir:j.default.DOWNSTREAM},videoDownstreamFrameWidth:{source:"frameWidth",media:W.default.VIDEO,dir:j.default.DOWNSTREAM},videoDownstreamJitterMs:{source:"jitter",media:W.default.VIDEO,dir:j.default.DOWNSTREAM},videoDownstreamDelayMs:{source:"jitterBufferMs",media:W.default.VIDEO,dir:j.default.DOWNSTREAM}},this.observableMetricSpec={audioPacketsReceived:{source:"packetsReceived",media:W.default.AUDIO,dir:j.default.DOWNSTREAM},audioPacketsReceivedFractionLoss:{source:"packetsLost",media:W.default.AUDIO,dir:j.default.DOWNSTREAM},audioDecoderLoss:{source:"decoderLoss",media:W.default.AUDIO,dir:j.default.DOWNSTREAM},audioPacketsSent:{source:"packetsSent",media:W.default.AUDIO,dir:j.default.UPSTREAM},audioPacketLossPercent:{source:"packetsLost",media:W.default.AUDIO,dir:j.default.UPSTREAM},audioUpstreamRoundTripTimeMs:{source:"roundTripTime",media:W.default.AUDIO,dir:j.default.UPSTREAM},videoUpstreamBitrate:{source:"bytesSent",media:W.default.VIDEO,dir:j.default.UPSTREAM},videoPacketSentPerSecond:{source:"packetsSent",media:W.default.VIDEO,dir:j.default.UPSTREAM},audioSpeakerDelayMs:{source:"jitterBufferMs",media:W.default.AUDIO,dir:j.default.DOWNSTREAM},audioUpstreamJitterMs:{source:"jitter",media:W.default.AUDIO,dir:j.default.UPSTREAM},audioDownstreamJitterMs:{source:"jitter",media:W.default.AUDIO,dir:j.default.DOWNSTREAM},nackCountReceivedPerSecond:{source:"nackCount",media:W.default.VIDEO,dir:j.default.UPSTREAM},availableOutgoingBitrate:{source:"availableOutgoingBitrate"},availableIncomingBitrate:{source:"availableIncomingBitrate"},currentRoundTripTimeMs:{source:"currentRoundTripTime"},audioDownstreamLevel:{source:"audioLevel",media:W.default.AUDIO,dir:j.default.DOWNSTREAM},audioUpstreamLevel:{source:"audioLevel"}}}getMetricMap(t,e){switch(t){case W.default.AUDIO:switch(e){case j.default.UPSTREAM:return this.audioUpstreamMetricMap;case j.default.DOWNSTREAM:return this.audioDownstreamMetricMap}case W.default.VIDEO:switch(e){case j.default.UPSTREAM:return this.videoUpstreamMetricMap;case j.default.DOWNSTREAM:return this.videoDownstreamMetricMap}default:return this.globalMetricMap}}getStreamDimensionMap(){return this.streamDimensionMap}getObservableMetricValue(t){if(this.overriddenObservableMetrics.has(t))return this.overriddenObservableMetrics.get(t);let e=this.observableMetricSpec[t],r=this.getMetricMap(e.media,e.dir)[e.source],{transform:o,source:s}=r;if(e.hasOwnProperty("media"))for(let d in this.streamMetricReports){let l=this.streamMetricReports[d];if(l.direction===e.dir&&l.mediaType===e.media)return o(s||e.source,Number(d))}else return o(s||e.source);return 0}getObservableVideoMetricValue(t,e){let i=this.observableVideoMetricSpec[t],o=this.getMetricMap(i.media,i.dir)[i.source],{transform:s,source:d}=o;return s(d||i.source,e)}getVideoUpstreamSsrcs(){let t=[];for(let e in this.streamMetricReports)this.streamMetricReports[e].mediaType===W.default.VIDEO&&this.streamMetricReports[e].direction===j.default.UPSTREAM&&t.push(Number(e));return t}getObservableMetrics(){let t={};for(let e in this.observableMetricSpec)t[e]=this.getObservableMetricValue(e);return t}getObservableVideoMetrics(){let t={};if(!this.videoStreamIndex||!this.selfAttendeeId)return this.logger.error("Need to define VideoStreamIndex and selfAttendeeId if using getObservableVideoMetrics API"),t;for(let e in this.streamMetricReports)if(this.streamMetricReports[e].mediaType===W.default.VIDEO){let i={};for(let d in this.observableVideoMetricSpec)if(this.observableVideoMetricSpec[d].dir===this.streamMetricReports[e].direction){let l=this.getObservableVideoMetricValue(d,Number(e));isNaN(l)||(i[d]=l)}let r=this.streamMetricReports[e].groupId,o=this.streamMetricReports[e].streamId,s="";this.videoStreamIndex.attendeeIdForGroupId!==void 0?s=r?this.videoStreamIndex.attendeeIdForGroupId(r):this.selfAttendeeId:s=o?this.videoStreamIndex.attendeeIdForStreamId(o):this.selfAttendeeId,t[s]=t[s]?t[s]:{},t[s][e]=i}return t}getRTCStatsReport(){return this.rtcStatsReport}clone(){let t=new n(this.logger,this.videoStreamIndex,this.selfAttendeeId);return t.globalMetricReport=this.globalMetricReport,t.streamMetricReports=this.streamMetricReports,t.rtcStatsReport=this.rtcStatsReport,t.customStatsReports=this.customStatsReports,t.currentTimestampMs=this.currentTimestampMs,t.previousTimestampMs=this.previousTimestampMs,t.overriddenObservableMetrics=this.overriddenObservableMetrics,t}print(){let t={globalMetricReport:this.globalMetricReport,streamMetricReports:this.streamMetricReports,currentTimestampMs:this.currentTimestampMs,previousTimestampMs:this.previousTimestampMs};this.logger.debug(()=>`Client Metric Report: ${JSON.stringify(t)}`)}removeDestroyedSsrcs(){for(let t in this.streamMetricReports)this.currentSsrcs[t]||delete this.streamMetricReports[t]}overrideObservableMetric(t,e){this.overriddenObservableMetrics.set(t,e)}};No.default=ju});var A_=g(Ku=>{"use strict";Object.defineProperty(Ku,"__esModule",{value:!0});var $u=class{};Ku.default=$u});var Qu=g(Ju=>{"use strict";Object.defineProperty(Ju,"__esModule",{value:!0});var Gu=class n{constructor(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.consecutiveStatsWithNoAudioPacketsSent=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.isVideoEncoderHardware=!1,this.videoEncodingTimeInMs=0,this.videoEncodingTimePerFrameInMs=0,this.cpuLimitationDuration=0,this.videoInputFps=0,this.videoEncodeFps=0,this.isContentShare=!1,this.numberOfPublishedVideoSources=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}static isTimestampRecent(t,e){return Date.now()<t+e}setConnectionStartTime(){this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}reset(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.consecutiveStatsWithNoAudioPacketsSent=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now(),this.isVideoEncoderHardware=!1,this.videoEncodingTimeInMs=0,this.videoEncodingTimePerFrameInMs=0,this.cpuLimitationDuration=0,this.videoInputFps=0,this.videoEncodeFps=0,this.isContentShare=!1,this.numberOfPublishedVideoSources=0}isConnectionStartRecent(t){return n.isTimestampRecent(this.connectionStartTimestampMs,t)}isLastPacketLossRecent(t){return n.isTimestampRecent(this.lastPacketLossInboundTimestampMs,t)}isGoodSignalRecent(t){return n.isTimestampRecent(this.lastGoodSignalTimestampMs,t)}isWeakSignalRecent(t){return n.isTimestampRecent(this.lastWeakSignalTimestampMs,t)}isNoSignalRecent(t){return n.isTimestampRecent(this.lastNoSignalTimestampMs,t)}clone(){let t=new n;return t.connectionStartTimestampMs=this.connectionStartTimestampMs,t.consecutiveStatsWithNoPackets=this.consecutiveStatsWithNoPackets,t.consecutiveStatsWithNoAudioPacketsSent=this.consecutiveStatsWithNoAudioPacketsSent,t.lastPacketLossInboundTimestampMs=this.lastPacketLossInboundTimestampMs,t.lastGoodSignalTimestampMs=this.lastGoodSignalTimestampMs,t.lastWeakSignalTimestampMs=this.lastWeakSignalTimestampMs,t.lastNoSignalTimestampMs=this.lastNoSignalTimestampMs,t.consecutiveMissedPongs=this.consecutiveMissedPongs,t.packetsReceivedInLastMinute=this.packetsReceivedInLastMinute.slice(0),t.fractionPacketsLostInboundInLastMinute=this.fractionPacketsLostInboundInLastMinute.slice(0),t.audioSpeakerDelayMs=this.audioSpeakerDelayMs,t.isVideoEncoderHardware=this.isVideoEncoderHardware,t.videoEncodingTimeInMs=this.videoEncodingTimeInMs,t.videoEncodingTimePerFrameInMs=this.videoEncodingTimePerFrameInMs,t.cpuLimitationDuration=this.cpuLimitationDuration,t.videoInputFps=this.videoInputFps,t.videoEncodeFps=this.videoEncodeFps,t.isContentShare=this.isContentShare,t.numberOfPublishedVideoSources=this.numberOfPublishedVideoSources,t}setConsecutiveMissedPongs(t){this.consecutiveMissedPongs=t}setConsecutiveStatsWithNoPackets(t){this.consecutiveStatsWithNoPackets=t}setConsecutiveStatsWithNoAudioPacketsSent(t){this.consecutiveStatsWithNoAudioPacketsSent=t}setLastPacketLossInboundTimestampMs(t){this.lastPacketLossInboundTimestampMs=t}setLastNoSignalTimestampMs(t){this.lastNoSignalTimestampMs=t}setLastWeakSignalTimestampMs(t){this.lastWeakSignalTimestampMs=t}setLastGoodSignalTimestampMs(t){this.lastGoodSignalTimestampMs=t}setAudioSpeakerDelayMs(t){this.audioSpeakerDelayMs=t}setIsVideoEncoderHardware(t){this.isVideoEncoderHardware=t}setVideoEncodingTimeInMs(t){this.videoEncodingTimeInMs=t}setVideoEncodingTimePerFrameInMs(t){this.videoEncodingTimePerFrameInMs=t}setCpuLimitationDuration(t){this.cpuLimitationDuration=t}setVideoInputFps(t){this.videoInputFps=t}setVideoEncodeFps(t){this.videoEncodeFps=t}setIsContentShare(t){this.isContentShare=t}setNumberOfPublishedVideoSources(t){this.numberOfPublishedVideoSources=t}};Ju.default=Gu});var gr=g(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.VideoEncodingConnectionHealthPolicyName=void 0;var P_;(function(n){n.VideoEncodingCpuHealth="Video Encoding CPU Health",n.VideoEncodingFramerateHealth="Video Encoding framerate Health",n.VideoConcurrentSendersHealth="Video Concurrent Senders Health"})(P_=mr.VideoEncodingConnectionHealthPolicyName||(mr.VideoEncodingConnectionHealthPolicyName={}));mr.default=P_});var Zu=g(Lo=>{"use strict";var M_=Lo&&Lo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Lo,"__esModule",{value:!0});var bO=M_(zt()),_O=M_(gr()),Xu=class extends bO.default{constructor(t,e){super(t,e,_O.default.VideoConcurrentSendersHealth),this.concurrentVideoSendersThreshold=t.concurrentVideoSendersThreshold}health(){return this.currentData.isContentShare?this.maximumHealth():this.currentData.numberOfPublishedVideoSources>this.concurrentVideoSendersThreshold?this.minimumHealth():this.maximumHealth()}};Lo.default=Xu});var ef=g(Bo=>{"use strict";var R_=Bo&&Bo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Bo,"__esModule",{value:!0});var wO=R_(zt()),TO=R_(gr()),Yu=class extends wO.default{constructor(t,e){super(t,e,TO.default.VideoEncodingCpuHealth),this.consecutiveHighEncodeCpuCnt=0,this.consecutiveHighEncodeCpuThreshold=t.consecutiveHighEncodeCpuThreshold,this.highEncodeCpuMsThreshold=t.highEncodeCpuMsThreshold,this.highEncodeCpuMsPerFrameThreshold=t.highEncodeCpuMsPerFrameThreshold}health(){let t=this.currentData.videoEncodingTimeInMs>=this.highEncodeCpuMsThreshold&&this.currentData.videoEncodingTimePerFrameInMs>=this.highEncodeCpuMsPerFrameThreshold;if(!this.currentData.isVideoEncoderHardware&&(t||this.currentData.cpuLimitationDuration>0)){if(this.consecutiveHighEncodeCpuCnt++,this.consecutiveHighEncodeCpuCnt>this.consecutiveHighEncodeCpuThreshold)return this.consecutiveHighEncodeCpuCnt=0,this.minimumHealth()}else this.consecutiveHighEncodeCpuCnt=0;return this.maximumHealth()}};Bo.default=Yu});var nf=g(Fo=>{"use strict";var D_=Fo&&Fo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Fo,"__esModule",{value:!0});var kO=D_(zt()),IO=D_(gr()),tf=class extends kO.default{constructor(t,e){super(t,e,IO.default.VideoEncodingFramerateHealth),this.consecutiveEncodeFailureCnt=0,this.consecutiveVideoEncodingFailureThreshold=t.consecutiveVideoEncodingFailureThreshold}health(){if(this.currentData.videoEncodeFps===0&&this.currentData.videoInputFps>0){if(this.consecutiveEncodeFailureCnt++,this.consecutiveEncodeFailureCnt>this.consecutiveVideoEncodingFailureThreshold)return this.consecutiveEncodeFailureCnt=0,this.minimumHealth()}else this.consecutiveEncodeFailureCnt=0;return this.maximumHealth()}};Fo.default=tf});var sf=g(Uo=>{"use strict";var of=Uo&&Uo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Uo,"__esModule",{value:!0});var CO=of(Zu()),OO=of(ef()),EO=of(nf()),rf=class{constructor(){this.minHealth=0,this.maxHealth=1,this.initialHealth=1,this.connectionUnhealthyThreshold=25,this.noSignalThresholdTimeMs=1e4,this.connectionWaitTimeMs=1e4,this.zeroBarsNoSignalTimeMs=5e3,this.oneBarWeakSignalTimeMs=5e3,this.twoBarsTimeMs=5e3,this.threeBarsTimeMs=1e4,this.fourBarsTimeMs=2e4,this.fiveBarsTimeMs=6e4,this.cooldownTimeMs=6e4,this.pastSamplesToConsider=15,this.goodSignalTimeMs=15e3,this.fractionalLoss=.5,this.packetsExpected=50,this.maximumTimesToWarn=2,this.missedPongsLowerThreshold=1,this.missedPongsUpperThreshold=4,this.maximumAudioDelayMs=6e4,this.maximumAudioDelayDataPoints=10,this.sendingAudioFailureSamplesToConsider=2,this.sendingAudioFailureInitialWaitTimeMs=3e3,this.videoEncodingHealthPolicies=[CO.default,OO.default,EO.default],this.consecutiveHighEncodeCpuThreshold=10,this.highEncodeCpuMsThreshold=500,this.highEncodeCpuMsPerFrameThreshold=15,this.consecutiveVideoEncodingFailureThreshold=5,this.concurrentVideoSendersThreshold=15}};Uo.default=rf});var vr=g(df=>{"use strict";Object.defineProperty(df,"__esModule",{value:!0});var af;(function(n){n.Modality="#content"})(af||(af={}));df.default=af});var Jt=g(lf=>{"use strict";Object.defineProperty(lf,"__esModule",{value:!0});var cf=class{constructor(t){this.intervalMs=t}start(t){this.stop(),this.timer=setInterval(t,this.intervalMs)}stop(){this.timer!==void 0&&(clearInterval(this.timer),this.timer=void 0)}running(){return this.timer!==void 0}};lf.default=cf});var uf=g(Li=>{"use strict";var x_=Li&&Li.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},V_=Li&&Li.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Li,"__esModule",{value:!0});var AO=V_(Ve()),PO=V_(Jt()),fd=class n{constructor(){this.scheduler=null,this.devices=null,this.deviceChangeListeners=new Set,this.get=(t,e,i)=>{if(!Reflect.has(t,e))return;if(!("ondevicechange"in navigator.mediaDevices)){if(e==="addEventListener")return this.patchAddEventListener(t,e,i);if(e==="removeEventListener")return this.patchRemoveEventListener(t,e,i)}let r=Reflect.get(t,e,i);return typeof r=="function"?r.bind(t):r},this.patchAddEventListener=(t,e,i)=>{let r=Reflect.get(t,e,i);return(o,s,d)=>{if(o==="devicechange")this.deviceChangeListeners.add(s),this.scheduler||(this.scheduler=new PO.default(n.INTERVAL_MS),this.scheduler.start(this.pollDeviceLists));else return Reflect.apply(r,t,[o,s,d])}},this.patchRemoveEventListener=(t,e,i)=>{let r=Reflect.get(t,e,i);return(o,s,d)=>{if(o==="devicechange")this.deviceChangeListeners.delete(s),this.deviceChangeListeners.size===0&&this.scheduler&&(this.scheduler.stop(),this.scheduler=null);else return Reflect.apply(r,t,[o,s,d])}},this.pollDeviceLists=()=>x_(this,void 0,void 0,function*(){let t=yield this.sortedDeviceList();this.devices&&(t.length!==this.devices.length||t.some((i,r)=>i.deviceId!==this.devices[r].deviceId))&&this.handleDeviceChangeEvent(),this.devices=t})}sortedDeviceList(){return x_(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).sort((e,i)=>e.deviceId<i.deviceId?1:e.deviceId>i.deviceId?-1:0)})}handleDeviceChangeEvent(){for(let t of this.deviceChangeListeners)AO.default.nextTick(()=>{if(this.deviceChangeListeners.has(t)){let e=new Event("devicechange");typeof t=="function"?t(e):t.handleEvent(e)}})}};Li.default=fd;fd.INTERVAL_MS=1e3});var hf=g(qo=>{"use strict";var MO=qo&&qo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(qo,"__esModule",{value:!0});var RO=MO(uf()),ff=class{constructor(){this.isMediaDevicesSupported=typeof navigator<"u"&&!!navigator.mediaDevices}create(){if(this.isMediaDevicesSupported)return new Proxy(navigator.mediaDevices,new RO.default);throw new Error("navigator.mediaDevices is not supported")}};qo.default=ff});var gf=g(mf=>{"use strict";Object.defineProperty(mf,"__esModule",{value:!0});var pf=class{constructor(){this.queue=Promise.resolve()}add(t){return new Promise((e,i)=>{this.queue=this.queue.then(t).then(e).catch(i)})}};mf.default=pf});var Le=g(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.None=Qt.Some=Qt.Maybe=void 0;var Sr=class{static of(t){return t==null?pd.of():hd.of(t)}};Qt.Maybe=Sr;var hd=class n{constructor(t){this.value=t,this.isSome=!0,this.isNone=!1}map(t){return Sr.of(t(this.value))}flatMap(t){return t(this.value)}get(){return this.value}getOrElse(t){return this.value}defaulting(t){return Sr.of(this.getOrElse(t))}static of(t){if(t==null)throw new Error("value is ${value}");return new n(t)}};Qt.Some=hd;var pd=class n{constructor(){this.isSome=!1,this.isNone=!0}get(){throw new Error("value is null")}getOrElse(t){return t}map(t){return new n}flatMap(t){return new n}defaulting(t){return Sr.of(this.getOrElse(t))}static of(){return new n}};Qt.None=pd});var Sf=g(Ho=>{"use strict";var N_=Ho&&Ho.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(Ho,"__esModule",{value:!0});var vf=class{constructor(){this.workerTimer=void 0,this.callback=void 0,this.workerTimer=this.createWorkerTimer()}createWorkerTimer(){try{let t=new Blob([`self.onmessage = async function(e){ 
            var timerID = null;
            const awaitTimeout = delay => new Promise( resolve => {
              timerID = setTimeout(resolve, delay);
            })
            await awaitTimeout(e.data);
            postMessage(timerID);
          }`],{type:"application/javascript"});return new Worker(window.URL.createObjectURL(t))}catch{}}start(t,e){return N_(this,void 0,void 0,function*(){this.callback=e,this.workerTimer?(this.workerTimer.onmessage=i=>{this.lastTimeout=i.data,this.callback()},this.workerTimer.postMessage(t)):this.lastTimeout=setTimeout(()=>{this.callback()},t)})}destroy(){return N_(this,void 0,void 0,function*(){this.callback=void 0,this.lastTimeout&&(clearTimeout(this.lastTimeout),this.lastTimeout=void 0),this.workerTimer&&(this.workerTimer.terminate(),this.workerTimer=void 0)})}};Ho.default=vf});var _f=g(Bi=>{"use strict";var yf=Bi&&Bi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},B_=Bi&&Bi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Bi,"__esModule",{value:!0});var DO=B_(Eo()),xO=B_(Sf()),L_=15,bf=class{constructor(t,e,i=new xO.default){this.logger=t,this.stages=e,this.fr=L_,this.outputMediaStream=new MediaStream,this.videoInput=document.createElement("video"),this.canvasOutput=document.createElement("canvas"),this.outputCtx=this.canvasOutput.getContext("2d"),this.canvasInput=document.createElement("canvas"),this.inputCtx=this.canvasInput.getContext("2d"),this.inputVideoStream=null,this.sourceBuffers=[],this.destBuffers=[],this.observers=new Set,this.hasStarted=!1,this.process=r=>yf(this,void 0,void 0,function*(){if(!this.inputVideoStream)return;let o=performance.now();this.videoInput.videoWidth&&(this.canvasInput.width!==this.videoInput.videoWidth&&(this.canvasInput.width=this.videoInput.videoWidth,this.canvasInput.height=this.videoInput.videoHeight,this.sourceBuffers[0].height=this.canvasInput.height,this.sourceBuffers[0].width=this.canvasInput.width,this.sourceBuffers[0].framerate=this.framerate),this.inputCtx.drawImage(this.videoInput,0,0));let s=[];s.push(this.sourceBuffers[0]);try{for(let m of this.processors)s=yield m.process(s)}catch{this.forEachObserver(S=>{S.processingDidFailToStart&&S.processingDidFailToStart()});return}this.destBuffers=s;let d;try{d=yield this.destBuffers[0].asCanvasImageSource()}catch{this.inputVideoStream&&(this.logger.info("buffers are destroyed and pipeline could not start"),this.forEachObserver(S=>{S.processingDidFailToStart&&S.processingDidFailToStart()}));return}let l=d.width,c=d.height;l!==0&&c!==0&&(this.canvasOutput.width!==l&&this.canvasOutput.height!==c&&(this.canvasOutput.width=l,this.canvasOutput.height=c),this.outputCtx.drawImage(d,0,0,l,c,0,0,l,c),this.hasStarted||(this.hasStarted=!0,this.forEachObserver(m=>{m.processingDidStart&&m.processingDidStart()})));let a=performance.now()-o,u=1e3*2/this.framerate-a,p=Math.max(0,1e3/this.framerate-a);u<=0&&this.forEachObserver(m=>{m.processingLatencyTooHigh&&m.processingLatencyTooHigh(a)}),yield this.timer.start(p,this.process.bind(this))}),this.timer=i}destroy(){if(this.stop(),this.stages)for(let t of this.stages)t.destroy();this.timer.destroy()}get framerate(){return this.fr}set framerate(t){this.fr=t<0||t===void 0?L_:t}stop(){if(this.videoInput.removeEventListener("loadedmetadata",this.process),this.videoInput.srcObject=null,this.destroyInputMediaStreamAndBuffers(),this.outputMediaStream)for(let t of this.outputMediaStream.getVideoTracks())t.stop();this.hasStarted&&(this.hasStarted=!1,this.forEachObserver(t=>{t.processingDidStop&&t.processingDidStop()}))}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}getInputMediaStream(){return yf(this,void 0,void 0,function*(){return this.inputVideoStream})}getActiveOutputMediaStream(){return this.isOutputMediaStreamActive()?this.outputMediaStream:(this.outputMediaStream=this.canvasOutput.captureStream(this.framerate),this.cloneInputAudioTracksToOutput(),this.outputMediaStream)}setInputMediaStream(t){return yf(this,void 0,void 0,function*(){if(!t){this.stop();return}if(t.getVideoTracks().length===0){this.logger.error("No video tracks in input media stream, ignoring");return}this.inputVideoStream=t;let e=this.inputVideoStream.getVideoTracks()[0].getSettings();this.logger.info(`processing pipeline input stream settings ${JSON.stringify(e)}`),this.framerate=e.frameRate,this.canvasOutput.width=e.width,this.canvasOutput.height=e.height,this.videoInput.addEventListener("loadedmetadata",this.process),this.videoInput.srcObject=this.inputVideoStream,this.videoInput.setAttribute("playsinline","true");let i=new DO.default(this.canvasInput);this.sourceBuffers.push(i),this.videoInput.load();try{yield this.videoInput.play()}catch{this.logger.warn("Video element play() overrided by another load().")}this.cloneInputAudioTracksToOutput()})}cloneInputAudioTracksToOutput(){if(!this.isOutputMediaStreamActive()||this.inputVideoStream===null){this.logger.info("Not cloning input audio tracks to output, do not have media streams ready");return}for(let t of this.outputMediaStream.getAudioTracks())this.logger.info(`Removing audio track ${t.id} from output stream`),this.outputMediaStream.removeTrack(t);for(let t of this.inputVideoStream.getAudioTracks())this.logger.info(`Adding audio track ${t.id} to output stream`),this.outputMediaStream.addTrack(t)}isOutputMediaStreamActive(){return this.outputMediaStream&&this.outputMediaStream.active}set processors(t){this.stages=t}get processors(){return this.stages}forEachObserver(t){for(let e of this.observers)setTimeout(()=>{t(e)},0)}destroyInputMediaStreamAndBuffers(){if(this.inputVideoStream)for(let t of this.inputVideoStream.getTracks())t.stop();this.inputVideoStream=null;for(let t of this.sourceBuffers)t.destroy();this.sourceBuffers=[]}};Bi.default=bf});var kf=g(Fi=>{"use strict";var wf=Fi&&Fi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},F_=Fi&&Fi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Fi,"__esModule",{value:!0});var VO=F_(pe()),NO=F_(_f()),Tf=class n{constructor(t,e,i,r=new VO.default){this.logger=t,this.device=e,this.processors=i,this.browserBehavior=r,this.observers=new Set,this.pipe=new NO.default(this.logger,this.processors),this.pipe.addObserver(this)}get outputMediaStream(){return this.pipe.outputMediaStream}passEventControllerToProcessors(t){if(this.pipe.processors)for(let e of this.pipe.processors)typeof e.setEventController=="function"&&e.setEventController(t)}chooseNewInnerDevice(t){let e=new n(this.logger,t,this.processors,this.browserBehavior);return e.pipe=this.pipe,e}getInnerDevice(){return this.device}intrinsicDevice(){return wf(this,void 0,void 0,function*(){return this.device})}transformStream(t){return wf(this,void 0,void 0,function*(){return yield this.pipe.setInputMediaStream(t),this.inputMediaStream=t,this.pipe.getActiveOutputMediaStream()})}onOutputStreamDisconnect(){this.logger.info("DefaultVideoTransformDevice: detach stopping input media stream");let t=this.device&&this.device.id;if(this.pipe.stop(),!t&&this.inputMediaStream)for(let e of this.inputMediaStream.getVideoTracks())e.stop()}stop(){return wf(this,void 0,void 0,function*(){if(this.inputMediaStream)for(let t of this.inputMediaStream.getVideoTracks())t.stop();this.pipe.destroy(),this.inputMediaStream=null})}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}processingDidStart(){this.logger.info("video transform device processing started"),this.forEachObserver(t=>{t.processingDidStart&&t.processingDidStart()})}processingLatencyTooHigh(t){this.forEachObserver(e=>{e.processingLatencyTooHigh&&e.processingLatencyTooHigh(t)})}processingDidFailToStart(){this.logger.info("video transform device processing failed to start"),this.forEachObserver(t=>{t.processingDidFailToStart&&t.processingDidFailToStart()})}processingDidStop(){this.logger.info("video transform device processing stopped"),this.forEachObserver(t=>{t.processingDidStop&&t.processingDidStop()})}forEachObserver(t){for(let e of this.observers)setTimeout(()=>{t(e)},0)}get framerate(){return this.pipe.framerate}set framerate(t){this.pipe.framerate=t}};Fi.default=Tf});var Xt=g(Wo=>{"use strict";var LO=Wo&&Wo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Wo,"__esModule",{value:!0});var U_=LO(vr()),jo=class n{constructor(t){this._id=t}id(){return this._id}base(){return this._id?this._id.split(n.MODALITY_SEPARATOR)[0]:""}modality(){if(!this._id)return"";let t=this._id.split(n.MODALITY_SEPARATOR);return t.length===2?t[1]:""}hasModality(t){return t!==""&&this.modality()===t}withModality(t){let e=new n(this.base()+n.MODALITY_SEPARATOR+t);return t===""||this.base()===""||new n(e._id).modality()!==t?new n(this.base()):e}};Wo.default=jo;jo.MODALITY_SEPARATOR=U_.default.Modality[0];jo.MODALITY_CONTENT=U_.default.Modality.substring(1)});var Of=g(Cf=>{"use strict";Object.defineProperty(Cf,"__esModule",{value:!0});var If=class n{constructor(){this.tileId=null,this.localTile=!1,this.localTileStarted=!1,this.isContent=!1,this.active=!1,this.paused=!1,this.poorConnection=!1,this.boundAttendeeId=null,this.boundExternalUserId=null,this.boundVideoStream=null,this.boundVideoElement=null,this.nameplate=null,this.videoStreamContentWidth=null,this.videoStreamContentHeight=null,this.videoElementCSSWidthPixels=null,this.videoElementCSSHeightPixels=null,this.devicePixelRatio=0,this.videoElementPhysicalWidthPixels=null,this.videoElementPhysicalHeightPixels=null,this.streamId=null,this.groupId=null}clone(){let t=new n;return t.tileId=this.tileId,t.localTile=this.localTile,t.isContent=this.isContent,t.active=this.active,t.paused=this.paused,t.poorConnection=this.poorConnection,t.boundAttendeeId=this.boundAttendeeId,t.boundExternalUserId=this.boundExternalUserId,t.boundVideoStream=this.boundVideoStream,t.boundVideoElement=this.boundVideoElement,t.nameplate=this.nameplate,t.videoStreamContentWidth=this.videoStreamContentWidth,t.videoStreamContentHeight=this.videoStreamContentHeight,t.videoElementCSSWidthPixels=this.videoElementCSSWidthPixels,t.videoElementCSSHeightPixels=this.videoElementCSSHeightPixels,t.devicePixelRatio=this.devicePixelRatio,t.videoElementPhysicalWidthPixels=this.videoElementPhysicalWidthPixels,t.videoElementPhysicalHeightPixels=this.videoElementPhysicalHeightPixels,t.streamId=this.streamId,t.groupId=this.groupId,t}};Cf.default=If});var $o=g(zo=>{"use strict";var Af=zo&&zo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(zo,"__esModule",{value:!0});var BO=Af(pe()),q_=Af(Xt()),H_=Af(Of()),Ef=class n{constructor(t,e,i,r,o=void 0){this.tileController=i,this.devicePixelRatioMonitor=r,this.resolutionMonitor=o,this.tileState=new H_.default,this.tileState.tileId=t,this.tileState.localTile=e,this.devicePixelRatioMonitor.registerObserver(this)}static connectVideoStreamToVideoElement(t,e,i){let r=i&&t.getVideoTracks()[0].getSettings().facingMode!=="environment"?"rotateY(180deg)":"";if(n.setVideoElementFlag(e,"disablePictureInPicture",i),n.setVideoElementFlag(e,"disableRemotePlayback",i),e.style.transform!==r&&(e.style.transform=r),e.hasAttribute("controls")&&e.removeAttribute("controls"),e.hasAttribute("autoplay")||e.setAttribute("autoplay","true"),e.hasAttribute("playsinline")||e.setAttribute("playsinline","true"),e.hasAttribute("muted")||(e.setAttribute("muted","true"),e.muted=!0),e.srcObject!==t&&(e.srcObject=t,new BO.default().requiresVideoPlayWorkaround()&&e.paused)){let o=e.play();o!==void 0&&o.catch(s=>{console.warn("Error playing video in Safari",s)}).then(()=>{console.debug("Video played successfully in Safari")})}}static disconnectVideoStreamFromVideoElement(t,e,i=!1){if(t)if(e)i||(t.srcObject=null,t.style.transform="");else{if(!t.srcObject)return;t.pause(),t.style.transform="",n.setVideoElementFlag(t,"disablePictureInPicture",!1),n.setVideoElementFlag(t,"disableRemotePlayback",!1),t.srcObject=null}}destroy(){this.devicePixelRatioMonitor.removeObserver(this),this.tileState.boundVideoElement&&this.tileState.boundVideoElement.srcObject===this.tileState.boundVideoStream&&n.disconnectVideoStreamFromVideoElement(this.tileState.boundVideoElement,!1),this.tileState=new H_.default}devicePixelRatioChanged(t){this.tileState.devicePixelRatio=t,this.sendTileStateUpdate()}id(){return this.tileState.tileId}state(){return this.tileState.clone()}stateRef(){return this.tileState}bindVideoStream(t,e,i,r,o,s,d,l){let c=!1;this.tileState.boundAttendeeId!==t&&(this.tileState.boundAttendeeId=t,new q_.default(t).hasModality(q_.default.MODALITY_CONTENT)&&(this.tileState.isContent=!0),c=!0),this.tileState.boundExternalUserId!==d&&(this.tileState.boundExternalUserId=d,c=!0),this.tileState.localTile!==e&&(this.tileState.localTile=e,c=!0),this.tileState.boundVideoStream!==i&&(this.tileState.boundVideoStream=i,c=!0),this.tileState.videoStreamContentWidth!==r&&(this.tileState.videoStreamContentWidth=r,c=!0),this.tileState.videoStreamContentHeight!==o&&(this.tileState.videoStreamContentHeight=o,c=!0),this.tileState.streamId!==s&&(this.tileState.streamId=s,c=!0),this.tileState.groupId!==l&&(this.tileState.groupId=l,c=!0),c&&this.sendTileStateUpdate()}bindVideoElement(t){var e;let i=!1;this.tileState.boundVideoElement!==t&&(this.tileState.boundVideoElement=t,(e=this.resolutionMonitor)===null||e===void 0||e.bindVideoElement(this.tileState.boundVideoElement),i=!0),this.tileState.boundVideoElement!==null?(this.tileState.videoElementCSSWidthPixels!==t.clientWidth&&(this.tileState.videoElementCSSWidthPixels=t.clientWidth,i=!0),this.tileState.videoElementCSSHeightPixels!==t.clientHeight&&(this.tileState.videoElementCSSHeightPixels=t.clientHeight,i=!0)):(this.tileState.videoElementCSSWidthPixels=null,this.tileState.videoElementCSSHeightPixels=null),i&&this.sendTileStateUpdate()}pause(){this.tileState.paused||(this.tileState.paused=!0,this.sendTileStateUpdate())}unpause(){this.tileState.paused&&(this.tileState.paused=!1,this.sendTileStateUpdate())}markPoorConnection(){return this.tileState.poorConnection?!1:(this.tileState.poorConnection=!0,this.sendTileStateUpdate(),!0)}unmarkPoorConnection(){return this.tileState.poorConnection?(this.tileState.poorConnection=!1,this.sendTileStateUpdate(),!0):!1}capture(){if(!this.tileState.active)return null;let t=document.createElement("canvas"),e=this.tileState.boundVideoElement;t.width=e.videoWidth||e.width,t.height=e.videoHeight||e.height;let i=t.getContext("2d");return i.drawImage(e,0,0,t.width,t.height),i.getImageData(0,0,t.width,t.height)}setStreamId(t){this.tileState.streamId=t,this.tileController.sendTileStateUpdate(this.state())}sendTileStateUpdate(){this.updateActiveState(),this.updateVideoStreamOnVideoElement(),this.updateVideoElementPhysicalPixels(),this.tileController.sendTileStateUpdate(this.state())}updateActiveState(){this.tileState.active=!!(!this.tileState.paused&&!this.tileState.poorConnection&&this.tileState.boundAttendeeId&&this.tileState.boundVideoElement&&this.tileState.boundVideoStream)}updateVideoElementPhysicalPixels(){typeof this.tileState.videoElementCSSWidthPixels=="number"&&typeof this.tileState.videoElementCSSHeightPixels=="number"?(this.tileState.videoElementPhysicalWidthPixels=this.tileState.devicePixelRatio*this.tileState.videoElementCSSWidthPixels,this.tileState.videoElementPhysicalHeightPixels=this.tileState.devicePixelRatio*this.tileState.videoElementCSSHeightPixels):(this.tileState.videoElementPhysicalWidthPixels=null,this.tileState.videoElementPhysicalHeightPixels=null)}updateVideoStreamOnVideoElement(){this.tileState.active?n.connectVideoStreamToVideoElement(this.tileState.boundVideoStream,this.tileState.boundVideoElement,this.tileState.localTile):n.disconnectVideoStreamFromVideoElement(this.tileState.boundVideoElement,this.tileState.paused,this.tileController.keepLastFrameWhenPaused)}static setVideoElementFlag(t,e,i){e in t&&(t[e]=i)}};zo.default=Ef});var Pf=g(md=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});md.isAudioTransformDevice=void 0;function FO(n){return!!n&&typeof n=="object"&&"mute"in n&&"stop"in n&&"intrinsicDevice"in n}md.isAudioTransformDevice=FO});var Df=g(Rf=>{"use strict";Object.defineProperty(Rf,"__esModule",{value:!0});var Mf=class{constructor(){this.groupId=""}matchesConstraints(t){return JSON.stringify(this.constraints)===JSON.stringify(t)}};Rf.default=Mf});var Zt=g(Vf=>{"use strict";Object.defineProperty(Vf,"__esModule",{value:!0});var xf=class extends Error{constructor(t,e){super(e||"Error fetching device."),this.cause=t,this.name="GetUserMediaError"}};Vf.default=xf});var Lf=g(Ko=>{"use strict";var UO=Ko&&Ko.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ko,"__esModule",{value:!0});var qO=UO(Zt()),Nf=class extends qO.default{constructor(t){super(t),this.name="NotFoundError"}};Ko.default=Nf});var Ff=g(Go=>{"use strict";var HO=Go&&Go.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Go,"__esModule",{value:!0});var jO=HO(Zt()),Bf=class extends jO.default{constructor(t){super(t),this.name="NotReadableError"}};Go.default=Bf});var qf=g(Jo=>{"use strict";var WO=Jo&&Jo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Jo,"__esModule",{value:!0});var zO=WO(Zt()),Uf=class extends zO.default{constructor(t,e){super(t),this.constraint=e,this.name="OverconstrainedError"}};Jo.default=Uf});var gd=g(Qo=>{"use strict";var $O=Qo&&Qo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Qo,"__esModule",{value:!0});var KO=$O(Zt()),Hf=class extends KO.default{constructor(t,e){super(t,e),this.name="PermissionDeniedError"}};Qo.default=Hf});var Wf=g(Xo=>{"use strict";var GO=Xo&&Xo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Xo,"__esModule",{value:!0});var JO=GO(Zt()),jf=class extends JO.default{constructor(t){super(t),this.name="TypeError"}};Xo.default=jf});var Pt=g(zf=>{"use strict";Object.defineProperty(zf,"__esModule",{value:!0});var Ye=class{constructor(t,e,i){this.videoWidth=t,this.videoHeight=e,this.videoFrameRate=i}equals(t){return this.videoWidth===t.videoWidth&&this.videoHeight===t.videoHeight&&this.videoFrameRate===t.videoFrameRate}};zf.default=Ye;Ye.VideoDisabled=new Ye(0,0,0);Ye.VideoResolutionHD=new Ye(1280,720,30);Ye.VideoResolutionFHD=new Ye(1920,1080,30);Ye.VideoResolutionUHD=new Ye(3840,2160,30)});var Sd=g(vd=>{"use strict";Object.defineProperty(vd,"__esModule",{value:!0});vd.isVideoTransformDevice=void 0;function QO(n){return!!n&&typeof n=="object"&&"transformStream"in n&&"stop"in n&&"intrinsicDevice"in n}vd.isVideoTransformDevice=QO});var bd=g(Ui=>{"use strict";var te=Ui&&Ui.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},ke=Ui&&Ui.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ui,"__esModule",{value:!0});var j_=ke(pe()),XO=ke(hf()),yd=ke(Ve()),W_=ke(gf()),Zo=Le(),ZO=ke(kf()),z_=ke($o()),YO=Pf(),eE=ke(Df()),$_=ke(Zt()),tE=ke(Lf()),iE=ke(Ff()),nE=ke(qf()),K_=ke(gd()),rE=ke(Wf()),G_=ke(Pt()),oE=Sd(),et=class n{constructor(t,e,i=new j_.default,r){this.logger=t,this.browserBehavior=i,this.eventController=r,this.deviceInfoCache=null,this.activeDevices={audio:null,video:null},this.chosenVideoTransformDevice=null,this.audioOutputDeviceId=void 0,this.deviceChangeObservers=new Set,this.mediaStreamBrokerObservers=new Set,this.deviceLabelTrigger=()=>navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),this.audioInputDestinationNode=null,this.audioInputSourceNode=null,this.videoInputQualitySettings=null,this.useWebAudio=!1,this.useMediaConstraintsFallback=!0,this.audioInputTaskQueue=new W_.default,this.videoInputTaskQueue=new W_.default,this.muted=!1,this.mediaStreamMuteObserver=(l,c)=>{for(let a of this.deviceChangeObservers)yd.default.nextTick(()=>{this.deviceChangeObservers.has(a)&&a.audioInputMuteStateChanged&&a.audioInputMuteStateChanged(l,c)})},this.alreadyHandlingDeviceChange=!1;let{enableWebAudio:o=!1,useMediaConstraintsFallback:s=!0}=e||{};this.useWebAudio=o,this.useMediaConstraintsFallback=s,this.videoInputQualitySettings=new G_.default(n.defaultVideoWidth,n.defaultVideoHeight,n.defaultVideoFrameRate);let d=this.browserBehavior.requiresResolutionAlignment(this.videoInputQualitySettings.videoWidth,this.videoInputQualitySettings.videoHeight);this.videoInputQualitySettings.videoWidth=d[0],this.videoInputQualitySettings.videoHeight=d[1],this.logger.info(`DefaultDeviceController video dimension ${this.videoInputQualitySettings.videoWidth} x ${this.videoInputQualitySettings.videoHeight}`);try{this.mediaDeviceWrapper=new XO.default().create();let l=navigator.mediaDevices.getSupportedConstraints();this.logger.info(`Supported Constraints in this browser ${JSON.stringify(l)}`)}catch(l){t.error(l.message)}}isWatchingForDeviceChanges(){return!!this.onDeviceChangeCallback}ensureWatchingDeviceChanges(){var t;this.isWatchingForDeviceChanges()||(this.logger.info("Starting devicechange listener."),this.onDeviceChangeCallback=()=>{this.logger.info("Device change event callback is triggered"),this.handleDeviceChange()},(t=this.mediaDeviceWrapper)===null||t===void 0||t.addEventListener("devicechange",this.onDeviceChangeCallback))}stopWatchingDeviceChanges(){var t;this.isWatchingForDeviceChanges()&&(this.logger.info("Stopping devicechange listener."),(t=this.mediaDeviceWrapper)===null||t===void 0||t.removeEventListener("devicechange",this.onDeviceChangeCallback),this.onDeviceChangeCallback=void 0)}shouldObserveDeviceChanges(){return this.deviceChangeObservers.size?!0:this.activeDevices.audio&&this.activeDevices.audio.constraints!==null||this.activeDevices.video&&this.activeDevices.video.constraints!==null||!!this.audioOutputDeviceId}watchForDeviceChangesIfNecessary(){this.shouldObserveDeviceChanges()?this.ensureWatchingDeviceChanges():this.stopWatchingDeviceChanges()}destroy(){return te(this,void 0,void 0,function*(){this.stopWatchingDeviceChanges(),yield this.stopAudioInput(),yield this.stopVideoInput()})}listAudioInputDevices(t=!1){return te(this,void 0,void 0,function*(){let e=yield this.listDevicesOfKind("audioinput",t);return this.trace("listAudioInputDevices",t,e),e})}listVideoInputDevices(t=!1){return te(this,void 0,void 0,function*(){let e=yield this.listDevicesOfKind("videoinput",t);return this.trace("listVideoInputDevices",t,e),e})}listAudioOutputDevices(t=!1){return te(this,void 0,void 0,function*(){let e=yield this.listDevicesOfKind("audiooutput",t);return this.trace("listAudioOutputDevices",t,e),e})}pushAudioMeetingStateForPermissions(t){var e;(e=this.eventController)===null||e===void 0||e.publishEvent(t===void 0?"audioInputUnselected":"audioInputSelected")}pushVideoMeetingStateForPermissions(t){var e;(e=this.eventController)===null||e===void 0||e.publishEvent(t===void 0?"videoInputUnselected":"videoInputSelected")}startAudioInput(t){return te(this,void 0,void 0,function*(){return yield this.audioInputTaskQueue.add(()=>this.startAudioInputTask(t))})}startAudioInputTask(t){var e;return te(this,void 0,void 0,function*(){if(t===void 0){this.logger.error("Audio input device cannot be undefined");return}try{return YO.isAudioTransformDevice(t)?(this.logger.info(`Choosing transform input device ${t}`),yield this.chooseAudioTransformInputDevice(t)):(this.logger.info(`Choosing intrinsic audio input device ${t}`),this.removeTransform(),yield this.chooseInputIntrinsicDevice("audio",t)),this.trace("startAudioInputDevice",t,"success"),this.useWebAudio?(this.attachAudioInputStreamToAudioContext(this.activeDevices.audio.stream),this.pushAudioMeetingStateForPermissions(this.getMediaStreamDestinationNode().stream),yield(e=this.transform)===null||e===void 0?void 0:e.device.mute(this.muted),this.getMediaStreamDestinationNode().stream):(this.publishAudioInputDidChangeEvent(this.activeDevices.audio.stream),this.activeDevices.audio.stream)}catch(i){throw i}})}stopAudioInput(){return te(this,void 0,void 0,function*(){return this.audioInputTaskQueue.add(()=>this.stopAudioInputTask())})}stopAudioInputTask(){return te(this,void 0,void 0,function*(){try{if(this.useWebAudio){this.releaseAudioTransformStream();return}this.stopTracksAndRemoveCallbacks("audio")}finally{this.watchForDeviceChangesIfNecessary(),this.publishAudioInputDidChangeEvent(void 0)}})}chooseAudioTransformInputDevice(t){var e;return te(this,void 0,void 0,function*(){if(((e=this.transform)===null||e===void 0?void 0:e.device)===t)return;if(!this.useWebAudio)throw new Error("Cannot apply transform device without enabling Web Audio.");let i=n.getAudioContext();if(!(i instanceof OfflineAudioContext))switch(i.state){case"running":break;case"closed":throw new Error("Cannot choose a transform device with a closed audio context.");case"suspended":yield i.resume()}let r;try{r=yield t.createAudioNode(i)}catch(s){throw this.logger.error(`Unable to create transform device node: ${s}.`),s}let o=yield t.intrinsicDevice();yield this.chooseInputIntrinsicDevice("audio",o),this.logger.debug(`Got inner stream: ${o}.`),this.setTransform(t,r)})}chooseVideoTransformInputDevice(t){var e;return te(this,void 0,void 0,function*(){if(this.eventController&&t instanceof ZO.default&&t.passEventControllerToProcessors(this.eventController),t===this.chosenVideoTransformDevice){this.logger.info("Reselecting same VideoTransformDevice");return}let i=this.chosenVideoTransformDevice;i&&this.logger.info("Switched from previous VideoTransformDevice");let r=!!i,o=yield t.intrinsicDevice();if(!this.isMediaStreamReusableByDeviceId((e=this.activeDevices.video)===null||e===void 0?void 0:e.stream,o)){this.logger.info("video transform device needs new intrinsic device"),r&&i.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=t,this.activeDevices.video=null,yield this.chooseInputIntrinsicDevice("video",o),this.logger.info("apply processors to transform"),yield this.chosenVideoTransformDevice.transformStream(this.activeDevices.video.stream);return}this.chosenVideoTransformDevice=t,this.logger.info("video transform device uses previous stream"),this.logger.info("apply processors to transform"),yield t.transformStream(this.activeDevices.video.stream)})}startVideoInput(t){return te(this,void 0,void 0,function*(){return yield this.videoInputTaskQueue.add(()=>this.startVideoInputTask(t))})}startVideoInputTask(t){return te(this,void 0,void 0,function*(){if(!t){this.logger.error("Invalid video input device");return}try{return oE.isVideoTransformDevice(t)?(this.logger.info(`Choosing video transform device ${t}`),yield this.chooseVideoTransformInputDevice(t),this.publishVideoInputDidChangeEvent(this.chosenVideoTransformDevice.outputMediaStream),this.chosenVideoTransformDevice.outputMediaStream):(this.chosenVideoInputIsTransformDevice()&&(this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null),yield this.chooseInputIntrinsicDevice("video",t),this.trace("startVideoInputDevice",t),this.publishVideoInputDidChangeEvent(this.activeDevices.video.stream),this.activeDevices.video.stream)}catch(e){throw e}})}stopVideoInput(){return te(this,void 0,void 0,function*(){return this.videoInputTaskQueue.add(()=>this.stopVideoInputTask())})}stopVideoInputTask(){return te(this,void 0,void 0,function*(){try{if(this.chosenVideoInputIsTransformDevice()){this.releaseVideoTransformStream();return}this.stopTracksAndRemoveCallbacks("video")}finally{this.watchForDeviceChangesIfNecessary(),this.publishVideoInputDidChangeEvent(void 0)}})}chooseAudioOutput(t){return te(this,void 0,void 0,function*(){this.audioOutputDeviceId=t,this.watchForDeviceChangesIfNecessary();let e=this.deviceInfoFromDeviceId("audiooutput",this.audioOutputDeviceId);this.publishAudioOutputDidChangeEvent(e),this.trace("chooseAudioOutput",t,null)})}addDeviceChangeObserver(t){this.logger.info("adding device change observer"),this.deviceChangeObservers.add(t),this.watchForDeviceChangesIfNecessary(),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver(t){this.logger.info("removing device change observer"),this.deviceChangeObservers.delete(t),this.watchForDeviceChangesIfNecessary(),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){var t,e;if(!this.activeDevices.audio)return null;let i=(e=(t=this.transform)===null||t===void 0?void 0:t.nodes)===null||e===void 0?void 0:e.end;if(i){let r=i.context.createAnalyser();return r.removeOriginalInputs=()=>{try{i.disconnect(r)}catch{}},i.connect(r),r}return this.createAnalyserNodeForRawAudioInput()}createAnalyserNodeForRawAudioInput(){return this.activeDevices.audio?this.createAnalyserNodeForStream(this.activeDevices.audio.stream):null}createAnalyserNodeForStream(t){let e=n.getAudioContext(),i=e.createAnalyser(),r=e.createMediaStreamSource(t);return r.connect(i),this.trace("createAnalyserNodeForAudioInput"),i.removeOriginalInputs=()=>{try{r.disconnect(i)}catch{}},i}startVideoPreviewForVideoInput(t){if(!this.activeDevices.video){this.logger.warn("cannot bind video preview since video input device has not been chosen"),this.trace("startVideoPreviewForVideoInput",t.id);return}z_.default.connectVideoStreamToVideoElement(this.chosenVideoTransformDevice?this.chosenVideoTransformDevice.outputMediaStream:this.activeDevices.video.stream,t,!0),this.trace("startVideoPreviewForVideoInput",t.id)}stopVideoPreviewForVideoInput(t){z_.default.disconnectVideoStreamFromVideoElement(t,!1),this.trace("stopVideoPreviewForVideoInput",t.id)}setDeviceLabelTrigger(t){if(this.deviceInfoCache){for(let e of this.deviceInfoCache)if(!e.label){this.deviceInfoCache=null;break}}this.deviceLabelTrigger=t,this.trace("setDeviceLabelTrigger")}mixIntoAudioInput(t){let e=null;return this.useWebAudio?(e=n.getAudioContext().createMediaStreamSource(t),e.connect(this.getMediaStreamOutputNode())):this.logger.warn("WebAudio is not enabled, mixIntoAudioInput will not work"),this.trace("mixIntoAudioInput",t.id),e}chooseVideoInputQuality(t,e,i){let r=this.browserBehavior.requiresResolutionAlignment(t,e);this.videoInputQualitySettings=new G_.default(r[0],r[1],i)}getVideoInputQualitySettings(){return this.videoInputQualitySettings}acquireAudioInputStream(){return te(this,void 0,void 0,function*(){return this.activeDevices.audio||(this.logger.info("No audio device chosen, creating empty audio device"),yield this.startAudioInput(null)),this.useWebAudio?this.getMediaStreamDestinationNode().stream:this.activeDevices.audio.stream})}acquireVideoInputStream(){return te(this,void 0,void 0,function*(){if(!this.activeDevices.video)throw new Error("No video device chosen");return this.chosenVideoInputIsTransformDevice()?this.chosenVideoTransformDevice.outputMediaStream:this.activeDevices.video.stream})}acquireDisplayInputStream(t){return te(this,void 0,void 0,function*(){throw new Error("unsupported")})}releaseAudioTransformStream(){this.logger.info("Stopping audio track for Web Audio graph"),this.stopTracksAndRemoveCallbacks("audio"),this.logger.info("Removing audio transform, if there is one."),this.removeTransform(),this.audioInputSourceNode&&(this.audioInputSourceNode.disconnect(),this.audioInputSourceNode=void 0),this.audioInputDestinationNode&&(this.audioInputDestinationNode.disconnect(),this.audioInputDestinationNode=void 0)}releaseVideoTransformStream(){this.logger.info("Stopping video track for transform"),this.stopTracksAndRemoveCallbacks("video"),this.logger.info("Disconnecting video transform"),this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null}stopTracksAndRemoveCallbacks(t){let e=this.activeDevices[t];if(!e)return;let i=e.endedCallback,r=e.trackMuteCallback,o=e.trackUnmuteCallback;for(let s of e.stream.getTracks())s.stop(),i&&s.removeEventListener("ended",i),r&&s.removeEventListener("mute",r),o&&s.removeEventListener("unmute",o),delete e.endedCallback,delete e.trackMuteCallback,delete e.trackUnmuteCallback,delete this.activeDevices[t]}chosenVideoInputIsTransformDevice(){return!!this.chosenVideoTransformDevice}muteLocalAudioInputStream(){this.toggleLocalAudioInputStream(!1)}unmuteLocalAudioInputStream(){this.toggleLocalAudioInputStream(!0)}toggleLocalAudioInputStream(t){var e;let i=this.activeDevices.audio;if(this.useWebAudio&&(i=this.getMediaStreamDestinationNode()),!!i){for(let r of i.stream.getTracks())r.enabled!==t&&(r.enabled=t);this.muted!==!t&&(this.muted=!t,(e=this.transform)===null||e===void 0||e.device.mute(this.muted))}}static getIntrinsicDeviceId(t){if(!t)return;if(typeof t=="string")return t;if(t.id)return t.id;let i=t.deviceId;if(!i)return;if(typeof i=="string"||Array.isArray(i))return i;let r=i;if(typeof r.exact=="string"||Array.isArray(r.exact))return r.exact}static createEmptyAudioDevice(){return n.synthesizeAudioDevice(0)}static synthesizeAudioDevice(t){let e=n.getAudioContext(),i=e.createMediaStreamDestination();if(t){let r=e.createGain();r.gain.value=.1,r.connect(i);let o=e.createOscillator();o.frequency.value=t,o.connect(r),o.start()}else{let r=e.createBufferSource();try{r.buffer=e.createBuffer(1,e.sampleRate*5,e.sampleRate)}catch(o){if(o&&o.name==="NotSupportedError")r.buffer=e.createBuffer(1,n.defaultSampleRate*5,n.defaultSampleRate);else throw o}r.buffer.getChannelData(0)[0]=3e-4,r.loop=!0,r.connect(i),r.start()}return i.stream}listDevicesOfKind(t,e){return te(this,void 0,void 0,function*(){return(e||this.deviceInfoCache===null||!this.isWatchingForDeviceChanges())&&(yield this.updateDeviceInfoCacheFromBrowser()),this.listCachedDevicesOfKind(t)})}updateDeviceInfoCacheFromBrowser(){var t;return te(this,void 0,void 0,function*(){if(typeof MediaDeviceInfo>"u"){this.deviceInfoCache=[];return}let i=yield navigator.mediaDevices.enumerateDevices(),r=!0;for(let o of i)if(!o.label){r=!1;break}if(!r)try{this.logger.info("attempting to trigger media device labels since they are hidden");let o=yield this.deviceLabelTrigger();i=yield navigator.mediaDevices.enumerateDevices();for(let s of o.getTracks())s.stop()}catch(o){this.logger.info("unable to get media device labels"),(t=this.eventController)===null||t===void 0||t.publishEvent("deviceLabelTriggerFailed",{deviceLabelTriggerErrorMessage:this.getErrorMessage(o)})}this.logger.debug(`Update device info cache with devices: ${JSON.stringify(i)}`),this.deviceInfoCache=i})}listCachedDevicesOfKind(t){let e=[];if(this.deviceInfoCache)for(let i of this.deviceInfoCache)i.kind===t&&e.push(i);return e}handleDeviceChange(){return te(this,void 0,void 0,function*(){if(this.deviceInfoCache===null)return;if(this.alreadyHandlingDeviceChange){yd.default.nextTick(()=>{this.handleDeviceChange()});return}this.alreadyHandlingDeviceChange=!0;let t=this.listCachedDevicesOfKind("audioinput"),e=this.listCachedDevicesOfKind("videoinput"),i=this.listCachedDevicesOfKind("audiooutput");yield this.updateDeviceInfoCacheFromBrowser();let r=this.listCachedDevicesOfKind("audioinput"),o=this.listCachedDevicesOfKind("videoinput"),s=this.listCachedDevicesOfKind("audiooutput");this.forEachObserver(d=>{this.areDeviceListsEqual(t,r)||Zo.Maybe.of(d.audioInputsChanged).map(l=>l.bind(d)(r)),this.areDeviceListsEqual(e,o)||Zo.Maybe.of(d.videoInputsChanged).map(l=>l.bind(d)(o)),this.areDeviceListsEqual(i,s)||Zo.Maybe.of(d.audioOutputsChanged).map(l=>l.bind(d)(s))}),this.alreadyHandlingDeviceChange=!1})}handleDeviceStreamEnded(t,e){return te(this,void 0,void 0,function*(){try{t==="audio"?(this.useWebAudio&&this.browserBehavior.requiresAudioContextResetOnDeviceFailureForWebAudio()?(this.logger.warn("Audio input device which was active is no longer available, suspending and resuming audio context before resetting to empty device to ensure packets are sent"),yield this.stopAudioInput(),n.suspendAudioContext(),n.resumeAudioContext()):this.logger.warn("Audio input device which was active is no longer available, resetting to empty device to ensure packets are sent"),yield this.startAudioInput(null)):(this.logger.warn("Video input device which was active is no longer available, stopping video"),yield this.stopVideoInput())}catch{this.logger.error("Failed to choose null device after stream ended.")}t==="audio"?this.forEachObserver(i=>{Zo.Maybe.of(i.audioInputStreamEnded).map(r=>r.bind(i)(e))}):this.forEachObserver(i=>{Zo.Maybe.of(i.videoInputStreamEnded).map(r=>r.bind(i)(e))})})}forEachObserver(t){for(let e of this.deviceChangeObservers)yd.default.nextTick(()=>{this.deviceChangeObservers.has(e)&&t(e)})}forEachMediaStreamBrokerObserver(t){for(let e of this.mediaStreamBrokerObservers)yd.default.nextTick(()=>{this.mediaStreamBrokerObservers.has(e)&&t(e)})}areDeviceListsEqual(t,e){return JSON.stringify(t.map(i=>JSON.stringify(i)).sort())===JSON.stringify(e.map(i=>JSON.stringify(i)).sort())}intrinsicDeviceAsMediaStream(t){return t&&t.id?t:null}hasSameMediaStreamId(t,e,i){var r,o,s,d;let l;return t==="audio"?(l=i?.audio.streamId,!!l&&l===((o=(r=e.constraints)===null||r===void 0?void 0:r.audio)===null||o===void 0?void 0:o.streamId)):(l=i?.video.streamId,!!l&&l===((d=(s=e?.constraints)===null||s===void 0?void 0:s.video)===null||d===void 0?void 0:d.streamId))}hasSameGroupId(t,e,i){if(t==="")return!0;let r=n.getIntrinsicDeviceId(i);return this.logger.debug(`Checking deviceIds ${r} of type ${typeof r} with groupId ${t}`),typeof r=="string"&&t===this.getGroupIdFromDeviceId(e,r)}getGroupIdFromDeviceId(t,e){if(this.deviceInfoCache!==null){let i=this.listCachedDevicesOfKind(`${t}input`).find(r=>r.deviceId===e);if(i&&i.groupId)return this.logger.debug(`GroupId of deviceId ${e} found in cache is ${i.groupId}`),i.groupId}return this.logger.debug(`GroupId of deviceId ${e} found in cache is empty`),""}handleGetUserMediaError(t,e){if(!t)throw new $_.default(t);switch(t.name){case"NotReadableError":case"TrackStartError":throw new iE.default(t);case"NotFoundError":case"DevicesNotFoundError":throw new tE.default(t);case"NotAllowedError":case"PermissionDeniedError":case"SecurityError":throw e&&e<n.permissionDeniedOriginDetectionThresholdMs?new K_.default(t,"Permission denied by browser"):new K_.default(t,"Permission denied by user");case"OverconstrainedError":case"ConstraintNotSatisfiedError":throw new nE.default(t);case"TypeError":throw new rE.default(t);case"AbortError":default:throw new $_.default(t)}}matchesDeviceSelection(t,e,i,r){return i&&i.stream.active&&(this.hasSameMediaStreamId(t,i,r)||i.groupId!==null&&this.hasSameGroupId(i.groupId,t,e))?(this.logger.debug(`Compare current device constraint ${JSON.stringify(i.constraints)} to proposed constraints ${JSON.stringify(r)}`),i.matchesConstraints(r)):!1}chooseInputIntrinsicDevice(t,e){var i,r;return te(this,void 0,void 0,function*(){let o=this.getMediaStreamConstraints(t,e);if(this.matchesDeviceSelection(t,e,this.activeDevices[t],o)){this.logger.info(`reusing existing ${t} input device`);return}this.activeDevices[t]&&this.activeDevices[t].stream&&this.stopTracksAndRemoveCallbacks(t);let s=Date.now(),d=new eE.default;try{this.logger.info(`requesting new ${t} device with constraint ${JSON.stringify(o)}`);let l=this.intrinsicDeviceAsMediaStream(e);t==="audio"&&e===null?(d.stream=n.createEmptyAudioDevice(),d.constraints=null):l?(this.logger.info(`using media stream ${l.id} for ${t} device`),d.stream=l,d.constraints=o):(d.stream=yield navigator.mediaDevices.getUserMedia(o),d.constraints=o),yield this.handleNewInputDevice(t,d)}catch(l){let c=this.getErrorMessage(l);t==="audio"?(i=this.eventController)===null||i===void 0||i.publishEvent("audioInputFailed",{audioInputErrorMessage:c}):(r=this.eventController)===null||r===void 0||r.publishEvent("videoInputFailed",{videoInputErrorMessage:c}),this.logger.error(`failed to get ${t} device for constraints ${JSON.stringify(o)}: ${c}`);let a=!0;if(l&&"constraint"in l&&(this.logger.error(`Over-constrained by constraint: ${l.constraint}`),this.useMediaConstraintsFallback)){let u=this.getMediaStreamConstraints(t,e,!0),p=JSON.stringify(u);if(p!==JSON.stringify(o)){this.logger.info(`retry requesting new ${t} device with minimal constraint ${p}`);try{d.stream=yield navigator.mediaDevices.getUserMedia(u),d.constraints=u,yield this.handleNewInputDevice(t,d),a=!1}catch(m){this.logger.error(`failed to get ${t} device for constraints ${p}: ${this.getErrorMessage(m)}`)}}}if(a){if(t==="audio"){this.logger.info(`choosing null ${t} device instead`);try{d.stream=n.createEmptyAudioDevice(),d.constraints=null,yield this.handleNewInputDevice(t,d)}catch(u){this.logger.error(`failed to choose null ${t} device. ${u.name}: ${u.message}`)}}this.handleGetUserMediaError(l,Date.now()-s)}}finally{this.watchForDeviceChangesIfNecessary()}})}getErrorMessage(t){return t?t.name&&t.message?`${t.name}: ${t.message}`:t.name?t.name:t.message?t.message:"UnknownError":"UnknownError"}handleNewInputDevice(t,e){var i;return te(this,void 0,void 0,function*(){this.logger.info(`got ${t} device for constraints ${JSON.stringify(e.constraints)}`);let r=(i=this.getMediaTrackSettings(e.stream))===null||i===void 0?void 0:i.deviceId;e.groupId=r?this.getGroupIdFromDeviceId(t,r):"",this.activeDevices[t]=e,this.logger.debug(`Set activeDevice to ${JSON.stringify(e)}`),this.watchForDeviceChangesIfNecessary();let o=e.stream.getTracks()[0];if(o&&(e.endedCallback=()=>{this.activeDevices[t]&&this.activeDevices[t].stream===e.stream&&(this.handleDeviceStreamEnded(t,r),delete e.endedCallback)},o.addEventListener("ended",e.endedCallback,{once:!0})),t==="audio"){let s=e.stream.getAudioTracks()[0];if(s){let d=s.getSettings().deviceId||e.stream;e.trackMuteCallback=()=>{this.mediaStreamMuteObserver(d,!0)},e.trackUnmuteCallback=()=>{this.mediaStreamMuteObserver(d,!1)},s.addEventListener("mute",e.trackMuteCallback,{once:!1}),s.addEventListener("unmute",e.trackUnmuteCallback,{once:!1}),this.logger.debug("Notifying mute state after selection"),s.muted?e.trackMuteCallback():e.trackUnmuteCallback()}}})}calculateMediaStreamConstraints(t,e,i,r){if(r&&this.listCachedDevicesOfKind(`${t}input`).length===1)return!0;let o={};return this.browserBehavior.requiresNoExactMediaStreamConstraints()?o.deviceId=e:o.deviceId={exact:e},i&&(o.groupId=i),r?o:t==="video"?(o.width={ideal:this.videoInputQualitySettings.videoWidth},o.height={ideal:this.videoInputQualitySettings.videoHeight},o.frameRate={ideal:this.videoInputQualitySettings.videoFrameRate},o):(this.supportSampleRateConstraint()&&(o.sampleRate={ideal:n.defaultSampleRate}),this.supportSampleSizeConstraint()&&(o.sampleSize={ideal:n.defaultSampleSize}),this.supportChannelCountConstraint()&&(o.channelCount={ideal:n.defaultChannelCount}),Object.assign({echoCancellation:!0,googEchoCancellation:!0,googEchoCancellation2:!0,googAutoGainControl:!0,googAutoGainControl2:!0,googNoiseSuppression:!0,googNoiseSuppression2:!0,googHighpassFilter:!0},o))}getMediaStreamConstraintsFromTrackConstraints(t,e){return t==="audio"?{audio:e}:{video:e}}getMediaStreamConstraints(t,e,i=!1){let r={};if(!e)return null;let o=this.intrinsicDeviceAsMediaStream(e);if(o)return r.streamId=o.id,this.getMediaStreamConstraintsFromTrackConstraints(t,r);if(typeof e=="string"){let s="";return this.browserBehavior.requiresGroupIdMediaStreamConstraints()&&(this.deviceInfoCache!==null?s=this.getGroupIdFromDeviceId(t,e):this.logger.error("Device cache is not populated. Please make sure to call list devices first")),r=this.calculateMediaStreamConstraints(t,e,s,i),this.getMediaStreamConstraintsFromTrackConstraints(t,r)}return sE(e)?(r=this.calculateMediaStreamConstraints(t,e.deviceId,e.groupId,i),this.getMediaStreamConstraintsFromTrackConstraints(t,r)):(r=e,this.getMediaStreamConstraintsFromTrackConstraints(t,r))}deviceInfoFromDeviceId(t,e){if(this.deviceInfoCache===null)return null;for(let i of this.deviceInfoCache)if(i.kind===t&&i.deviceId===e)return i;return null}hasAppliedTransform(){return!!this.transform}isMediaStreamReusableByDeviceId(t,e){if(!t||!t.active||!e)return!1;if(e.id)return t.id===e.id;let i=this.getMediaTrackSettings(t);if(!i.deviceId)return!1;let r=n.getIntrinsicDeviceId(e);return typeof r=="string"?i.deviceId===r:!1}getMediaTrackSettings(t){var e;return(e=t.getTracks()[0])===null||e===void 0?void 0:e.getSettings()}reconnectAudioInputs(){if(!this.audioInputSourceNode)return;this.audioInputSourceNode.disconnect();let t=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(t)}setTransform(t,e){var i,r;(r=(i=this.transform)===null||i===void 0?void 0:i.nodes)===null||r===void 0||r.end.disconnect(),this.transform={nodes:e,device:t};let o=e?.end,s=this.getMediaStreamDestinationNode();this.logger.debug(`Connecting transform node ${o} to destination ${s}.`),o?.connect(s),this.reconnectAudioInputs()}removeTransform(){var t;let e=this.transform;if(e)return(t=this.transform.nodes)===null||t===void 0||t.end.disconnect(),this.transform=void 0,this.reconnectAudioInputs(),e}attachAudioInputStreamToAudioContext(t){var e;(e=this.audioInputSourceNode)===null||e===void 0||e.disconnect(),this.audioInputSourceNode=n.getAudioContext().createMediaStreamSource(t);let i=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(i)}getMediaStreamDestinationNode(){return this.audioInputDestinationNode||(this.audioInputDestinationNode=n.getAudioContext().createMediaStreamDestination()),this.audioInputDestinationNode}getMediaStreamOutputNode(){var t,e;return((e=(t=this.transform)===null||t===void 0?void 0:t.nodes)===null||e===void 0?void 0:e.start)||this.getMediaStreamDestinationNode()}static setDefaultLatencyHint(t){n.defaultLatencyHint=t}static getAudioContext(){if(!n.audioContext){let t={};navigator.mediaDevices.getSupportedConstraints().sampleRate&&(t.sampleRate=n.defaultSampleRate),new j_.default().requiresPlaybackLatencyHintForAudioContext()&&(t.latencyHint="playback"),n.defaultLatencyHint&&(t.latencyHint=n.defaultLatencyHint),n.audioContext=new(window.AudioContext||window.webkitAudioContext)(t)}return n.audioContext}static suspendAudioContext(){return te(this,void 0,void 0,function*(){return n.audioContext?n.audioContext.suspend():Promise.resolve()})}static resumeAudioContext(){return te(this,void 0,void 0,function*(){return n.audioContext?n.audioContext.resume():Promise.resolve()})}static closeAudioContext(){if(n.audioContext)try{n.audioContext.close()}catch{}n.audioContext=null}addMediaStreamBrokerObserver(t){this.mediaStreamBrokerObservers.add(t)}removeMediaStreamBrokerObserver(t){this.mediaStreamBrokerObservers.delete(t)}publishVideoInputDidChangeEvent(t){this.forEachMediaStreamBrokerObserver(e=>{e.videoInputDidChange&&e.videoInputDidChange(t)}),this.pushVideoMeetingStateForPermissions(t)}publishAudioInputDidChangeEvent(t){this.forEachMediaStreamBrokerObserver(e=>{e.audioInputDidChange&&e.audioInputDidChange(t)}),this.pushAudioMeetingStateForPermissions(t)}publishAudioOutputDidChangeEvent(t){this.forEachMediaStreamBrokerObserver(e=>{e.audioOutputDidChange&&e.audioOutputDidChange(t)})}supportSampleRateConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleRate}supportSampleSizeConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleSize}supportChannelCountConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().channelCount}trace(t,e,i){let r=`API/DefaultDeviceController/${t}`;typeof e<"u"&&(r+=` ${JSON.stringify(e)}`),typeof i<"u"&&(r+=` -> ${JSON.stringify(i)}`),this.logger.info(r)}};Ui.default=et;et.permissionDeniedOriginDetectionThresholdMs=500;et.defaultVideoWidth=960;et.defaultVideoHeight=540;et.defaultVideoFrameRate=15;et.defaultSampleRate=48e3;et.defaultSampleSize=16;et.defaultChannelCount=1;et.audioContext=null;function sE(n){return typeof n=="object"&&"deviceId"in n&&"groupId"in n&&"kind"in n&&"label"in n}});var $f=g(qi=>{"use strict";var _d=qi&&qi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},J_=qi&&qi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(qi,"__esModule",{value:!0});var aE=J_(pe()),dE=J_(bd()),wd=class n{constructor(t){this.logger=t}get mediaStream(){return this._mediaStream}set mediaStream(t){this._mediaStream=t}acquireAudioInputStream(){return _d(this,void 0,void 0,function*(){return this._mediaStream.getAudioTracks().length===0?(this.logger.info("No audio stream available. Synthesizing an audio stream."),dE.default.synthesizeAudioDevice(0)):this._mediaStream})}acquireVideoInputStream(){return _d(this,void 0,void 0,function*(){return this._mediaStream})}acquireDisplayInputStream(t){return _d(this,void 0,void 0,function*(){return t&&t.video&&t.video.mandatory&&t.video.mandatory.chromeMediaSource&&t.video.mandatory.chromeMediaSourceId?navigator.mediaDevices.getUserMedia(t):navigator.mediaDevices.getDisplayMedia(t)})}acquireScreenCaptureDisplayInputStream(t,e){return _d(this,void 0,void 0,function*(){return this.acquireDisplayInputStream(this.screenCaptureDisplayMediaConstraints(t,e))})}screenCaptureDisplayMediaConstraints(t,e){return{audio:!!(!t&&new aE.default().getDisplayMediaAudioCaptureSupport()),video:Object.assign(Object.assign({},!t&&{frameRate:{max:e||n.defaultFrameRate}}),t&&{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:e||n.defaultFrameRate}})}}toggleMediaStream(t){let e=!1;if(this.mediaStream)for(let i=0;i<this.mediaStream.getTracks().length;i++)this.mediaStream.getTracks()[i].enabled!==t&&(this.mediaStream.getTracks()[i].enabled=t,e=!0);return e}cleanup(){if(this.mediaStream)for(let t=0;t<this.mediaStream.getTracks().length;t++)this.mediaStream.getTracks()[t].stop();this.mediaStream=null}muteLocalAudioInputStream(){throw new Error("unsupported")}unmuteLocalAudioInputStream(){throw new Error("unsupported")}addMediaStreamBrokerObserver(t){}removeMediaStreamBrokerObserver(t){}};qi.default=wd;wd.defaultFrameRate=15});var Kf=g(Hi=>{"use strict";var cE=Hi&&Hi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},lE=Hi&&Hi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Hi,"__esModule",{value:!0});var uE=lE(Z()),Td=class extends uE.default{constructor(t){super(t.logger),this.context=t,this.taskName="CreatePeerConnectionTask",this.removeTrackAddedEventListener=null,this.removeTrackRemovedEventListeners={},this.trackEvents=["ended","mute","unmute","isolationchange","overconstrained"],this.removeVideoTrackEventListeners={},this.trackAddedHandler=e=>{let i=e.track;if(this.context.logger.info(`received track event: kind=${i.kind} id=${i.id} label=${i.label}`),e.transceiver&&e.transceiver.currentDirection==="inactive")return;if(e.streams.length===0){this.context.logger.warn("Track event but no stream");return}let r=e.streams[0];i.kind==="audio"?this.context.audioMixController.bindAudioStream(r):i.kind==="video"&&!this.trackIsVideoInput(i)&&this.addRemoteVideoTrack(i,r)}}removeObserver(){this.removeTrackAddedEventListener&&this.removeTrackAddedEventListener();for(let t in this.removeTrackRemovedEventListeners)this.removeTrackRemovedEventListeners[t]()}addPeerConnectionEventLogger(){let t=this.context.peer;t.addEventListener("connectionstatechange",()=>{this.context.logger.info(`peer connection state changed: ${t.connectionState}`)}),t.addEventListener("negotiationneeded",()=>{this.context.logger.info("peer connection negotiation is needed")}),t.addEventListener("icegatheringstatechange",()=>{this.context.logger.info(`peer connection ice gathering state changed: ${t.iceGatheringState}`)}),t.addEventListener("icecandidate",e=>{this.context.logger.info(`peer connection ice candidate: ${e.candidate?e.candidate.candidate:"(null)"}`)}),t.addEventListener("iceconnectionstatechange",()=>{this.context.logger.info(`peer connection ice connection state changed: ${t.iceConnectionState}`)})}run(){return cE(this,void 0,void 0,function*(){this.context.removableObservers.push(this);let e=this.context.turnCredentials&&this.context.turnCredentials.uris.length>0?{iceServers:[{urls:this.context.turnCredentials.uris,username:this.context.turnCredentials.username,credential:this.context.turnCredentials.password,credentialType:"password"}],iceTransportPolicy:"relay"}:{};e.bundlePolicy=this.context.browserBehavior.requiresBundlePolicy(),e.sdpSemantics="unified-plan",e.encodedInsertableStreams=this.context.audioProfile.hasRedundancyEnabled(),this.context.peer?this.context.logger.info("reusing peer connection"):(this.context.logger.info("creating new peer connection"),this.context.peer=new RTCPeerConnection(e),this.addPeerConnectionEventLogger()),this.removeTrackAddedEventListener=()=>{this.context.peer&&this.context.peer.removeEventListener("track",this.trackAddedHandler),this.removeTrackAddedEventListener=null},this.context.peer.addEventListener("track",this.trackAddedHandler)})}trackIsVideoInput(t){return this.context.transceiverController.useTransceivers()?(this.logger.debug(()=>"getting video track type"),this.context.transceiverController.trackIsVideoInput(t)):!1}addRemoteVideoTrack(t,e){var i;let r=e.id,o=this.context.videoStreamIndex.attendeeIdForTrack(r),s,d;if(this.context.videoTileController.getVideoTileForAttendeeId?(d=this.context.videoTileController.getVideoTileForAttendeeId(o),s=!!(!((i=d?.state())===null||i===void 0)&&i.boundVideoStream)):s=this.context.videoTileController.haveVideoTileForAttendeeId(o),s){this.context.logger.info(`Not adding remote track. Already have tile for attendeeId:  ${o}`);return}d||(d=this.context.videoTileController.addVideoTile(),this.logger.info(`Created video tile ${d.id()}`));let l=this.context.videoStreamIndex.streamIdForTrack(r);typeof l>"u"&&(this.logger.warn(`stream not found for tile=${d.id()} track=${r}`),l=null);let c=this.context.videoStreamIndex.groupIdForStreamId(l);c===void 0&&(c=null);for(let I=0;I<this.trackEvents.length;I++){let _=this.trackEvents[I],k=e.getVideoTracks();if(k&&k.length){let T=k[0],w=()=>{this.context.logger.info(`received the ${_} event for tile=${d.id()} id=${t.id} streamId=${l}`),_==="ended"&&this.removeRemoteVideoTrack(t,d.state())};T.addEventListener(_,w),this.removeVideoTrackEventListeners[t.id]||(this.removeVideoTrackEventListeners[t.id]=[]),this.removeVideoTrackEventListeners[t.id].push(()=>{T.removeEventListener(_,w)})}}let a,u;if(t.getSettings){let I=t.getSettings();a=I.width,u=I.height}else{let I=t.getCapabilities();a=I.width,u=I.height}let p=this.context.videoStreamIndex.externalUserIdForTrack(r);d.bindVideoStream(o,!1,e,a,u,l,p,c),this.logger.info(`video track added, use tile=${d.id()} track=${r} streamId=${l} groupId=${c}`);let m="removetrack",S=e,C=()=>this.removeRemoteVideoTrack(t,d.state());this.removeTrackRemovedEventListeners[t.id]=()=>{S.removeEventListener(m,C),delete this.removeTrackRemovedEventListeners[t.id]},S.addEventListener(m,C)}removeRemoteVideoTrack(t,e){if(this.removeTrackRemovedEventListeners.hasOwnProperty(t.id)){this.removeTrackRemovedEventListeners[t.id]();for(let i of this.removeVideoTrackEventListeners[t.id])i();delete this.removeVideoTrackEventListeners[t.id]}this.logger.info(`video track ended, removing tile=${e.tileId} id=${t.id} stream=${e.streamId}`),e.streamId?this.context.videosPaused.remove(e.streamId):this.logger.warn(`no stream found for tile=${e.tileId}`),this.context.videoTileController.removeVideoTile(e.tileId)}};Hi.default=Td;Td.REMOVE_HANDLER_INTERVAL_MS=1e4});var tt=g(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.MeetingSessionStatusCode=void 0;var Q_;(function(n){n[n.OK=0]="OK",n[n.Left=1]="Left",n[n.AudioJoinedFromAnotherDevice=2]="AudioJoinedFromAnotherDevice",n[n.AudioAuthenticationRejected=3]="AudioAuthenticationRejected",n[n.AudioCallAtCapacity=4]="AudioCallAtCapacity",n[n.MeetingEnded=5]="MeetingEnded",n[n.AudioInternalServerError=6]="AudioInternalServerError",n[n.AudioServiceUnavailable=7]="AudioServiceUnavailable",n[n.AudioDisconnected=8]="AudioDisconnected",n[n.VideoCallSwitchToViewOnly=9]="VideoCallSwitchToViewOnly",n[n.VideoCallAtSourceCapacity=10]="VideoCallAtSourceCapacity",n[n.SignalingBadRequest=11]="SignalingBadRequest",n[n.SignalingInternalServerError=12]="SignalingInternalServerError",n[n.SignalingRequestFailed=13]="SignalingRequestFailed",n[n.SignalingChannelClosedUnexpectedly=14]="SignalingChannelClosedUnexpectedly",n[n.ICEGatheringTimeoutWorkaround=15]="ICEGatheringTimeoutWorkaround",n[n.ConnectionHealthReconnect=16]="ConnectionHealthReconnect",n[n.RealtimeApiFailed=17]="RealtimeApiFailed",n[n.TaskFailed=18]="TaskFailed",n[n.IncompatibleSDP=19]="IncompatibleSDP",n[n.TURNCredentialsForbidden=20]="TURNCredentialsForbidden",n[n.NoAttendeePresent=21]="NoAttendeePresent",n[n.AudioAttendeeRemoved=22]="AudioAttendeeRemoved",n[n.AudioVideoWasRemovedFromPrimaryMeeting=23]="AudioVideoWasRemovedFromPrimaryMeeting",n[n.AudioVideoDisconnectedWhilePromoted=24]="AudioVideoDisconnectedWhilePromoted",n[n.AudioDisconnectAudio=25]="AudioDisconnectAudio"})(Q_=yr.MeetingSessionStatusCode||(yr.MeetingSessionStatusCode={}));yr.default=Q_});var Gf=g(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});br.SDPCandidateType=void 0;var X_;(function(n){n.Host="host",n.ServerReflexive="srflx",n.PeerReflexive="prflx",n.Relay="relay"})(X_=br.SDPCandidateType||(br.SDPCandidateType={}));br.default=X_});var Xf=g(Qf=>{"use strict";Object.defineProperty(Qf,"__esModule",{value:!0});var Jf=class{};Qf.default=Jf});var ji=g(Yf=>{"use strict";Object.defineProperty(Yf,"__esModule",{value:!0});var Yt=oe(),Zf=class n{constructor(t,e){this.codecName=t,this.codecCapability=e}equals(t){if(t===void 0||this.codecName!==t.codecName||this.codecCapability.mimeType!==t.codecCapability.mimeType||this.codecCapability.clockRate!==t.codecCapability.clockRate)return!1;let e=this.codecCapability.sdpFmtpLine?this.cleanupFmtpLine(this.codecCapability.sdpFmtpLine,this.codecName):"",i=t.codecCapability.sdpFmtpLine?this.cleanupFmtpLine(t.codecCapability.sdpFmtpLine,t.codecName):"";return e===i}fmtpLineMatches(t,e){let i=this.codecCapability.sdpFmtpLine;if(!i)return!1;let r=`a=fmtp:${e} `;if(!t.startsWith(r))return!1;let o=t.substring(r.length);return this.cleanupFmtpLine(o,this.codecName)===this.cleanupFmtpLine(i,this.codecName)}cleanupFmtpLine(t,e){let i=/;x-google-start-bitrate=\d+/g,r=t.replace(i,"");if(e==="H264"){let o=/profile-level-id=([0-9a-f]{4})[0-9a-f]{2}/i;r=r.replace(o,"profile-level-id=$1")}return r}static vp8(){return new n("VP8",{clockRate:9e4,mimeType:"video/VP8"})}static h264BaselineProfile(){return new n("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f"})}static h264ConstrainedBaselineProfile(){return new n("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f"})}static h264MainProfile(){return new n("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f"})}static h264HighProfile(){return new n("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f"})}static h264ConstrainedHighProfile(){return new n("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=640c1f"})}static h264(){return n.h264ConstrainedBaselineProfile()}static vp9Profile0(){return new n("VP9",{clockRate:9e4,mimeType:"video/VP9",sdpFmtpLine:"profile-id=0"})}static vp9(){return n.vp9Profile0()}static av1Main(){return new n("AV1",{clockRate:9e4,mimeType:"video/AV1"})}static av1(){return n.av1Main()}static fromSignaled(t){switch(t){case Yt.SdkVideoCodecCapability.VP8:return n.vp8();case Yt.SdkVideoCodecCapability.H264_BASELINE_PROFILE:return n.h264BaselineProfile();case Yt.SdkVideoCodecCapability.H264_CONSTRAINED_BASELINE_PROFILE:return n.h264ConstrainedBaselineProfile();case Yt.SdkVideoCodecCapability.H264_MAIN_PROFILE:return n.h264MainProfile();case Yt.SdkVideoCodecCapability.H264_HIGH_PROFILE:return n.h264HighProfile();case Yt.SdkVideoCodecCapability.H264_CONSTRAINED_HIGH_PROFILE:return n.h264ConstrainedHighProfile();case Yt.SdkVideoCodecCapability.VP9_PROFILE_0:return n.vp9Profile0();case Yt.SdkVideoCodecCapability.AV1_MAIN_PROFILE:return n.av1Main();default:return}}};Yf.default=Zf});var Wi=g(Yo=>{"use strict";var eh=Yo&&Yo.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Yo,"__esModule",{value:!0});var Mt=eh(Gf()),fE=eh(Xf()),Z_=eh(ji()),ei=class n{constructor(t){this.sdp=t}clone(){return new n(this.sdp)}static isRTPCandidate(t){let e=/candidate[:](\S+) (\d+)/g.exec(t);return!(e===null||e[2]!=="1")}static linesToSDP(t){return new n(t.join(n.CRLF))}static candidateTypeFromString(t){switch(t){case Mt.default.Host:return Mt.default.Host;case Mt.default.ServerReflexive:return Mt.default.ServerReflexive;case Mt.default.PeerReflexive:return Mt.default.PeerReflexive;case Mt.default.Relay:return Mt.default.Relay}return null}static candidateType(t){let e=/a[=]candidate[:].* typ ([a-z]+) /g.exec(t);return e===null?null:n.candidateTypeFromString(e[1])}static mediaType(t){let e=/m=(audio|video)/g.exec(t);if(e!==null)return e[1]}static mid(t){if(t.includes("a=mid:"))return t.replace(/^(a=mid:)/,"")}static direction(t){let e=/a=(sendrecv|sendonly|recvonly|inactive)/g.exec(t);if(e!==null)return e[1]}static splitLines(t){return t.trim().split(`
`).map(e=>e.trim())}static splitSections(t){return t.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+n.CRLF)}static findActiveCameraSection(t){let e=0,i=!1;for(let r of t){if(/^m=video/.test(r)&&(r.indexOf("sendrecv")>-1||r.indexOf("sendonly")===-1&&r.indexOf("recvonly")===-1&&r.indexOf("inactive")===-1)){i=!0;break}e++}return i===!1&&(e=-1),e}static extractSSRCsFromFIDGroupLine(t){return/^a=ssrc-group:FID\s(.+)/.exec(t)[1]}static matchPrefix(t,e){return n.splitLines(t).filter(i=>i.indexOf(e)===0)}lines(){return this.sdp.split(n.CRLF)}hasVideo(){return/^m=video/gm.exec(this.sdp)!==null}hasCandidates(){return/a[=]candidate[:]/g.exec(this.sdp)!==null}hasCandidatesForAllMLines(){return!(this.sdp.indexOf("c=IN IP4 0.0.0.0")>-1)}withoutCandidateType(t){return n.linesToSDP(this.lines().filter(e=>n.candidateType(e)!==t))}withoutServerReflexiveCandidates(){return this.withoutCandidateType(Mt.default.ServerReflexive)}withAudioMaxAverageBitrate(t){if(!t)return this.clone();t=Math.trunc(Math.min(Math.max(t,n.rfc7587LowestBitrate),n.rfc7587HighestBitrate));let e=this.lines(),i=n.findOpusFmtpAttributes(e),r=n.updateOpusFmtpAttributes(e,i,[`maxaveragebitrate=${t}`]);return n.linesToSDP(r)}withStereoAudio(){let t=this.lines(),e=n.findOpusFmtpAttributes(t),i=n.updateOpusFmtpAttributes(t,e,["stereo=1","sprop-stereo=1"]);return n.linesToSDP(i)}static findOpusFmtpAttributes(t){let e=/^a=rtpmap:\s*(\d+)\s+opus\/48000/,i=!1,r=[];for(let o of t)if(o.startsWith("m=audio")&&(r.push(null),i=!0),o.startsWith("m=video")&&(i=!1),i){let s=e.exec(o);s!==null&&(r[r.length-1]=`a=fmtp:${s[1]} `)}return r}static updateOpusFmtpAttributes(t,e,i){let r=[],o=0,s=null;for(let d of t)if(d.startsWith("m=audio")&&(s=e[o],o++),d.startsWith("m=video")&&(s=null),s&&d.startsWith(s)){let l=d.slice(s.length).split(";"),c=[];for(let a of l)i.findIndex(p=>p.startsWith(a.split("=")[0]))<0&&c.push(a);for(let a of i)c.push(a);r.push(s+c.join(";"))}else r.push(d);return r}withUnifiedPlanFormat(){let t=this.sdp;return t.includes("mozilla")?this.clone():(t=t.replace("o=-","o=mozilla-chrome"),new n(t))}getUniqueRtpHeaderExtensionId(t){let e=[];for(let r of t)if(/^a=extmap:/.test(r.trim())){let s=+r.split("a=extmap:")[1].split(" ")[0];e.includes(s)||e.push(s)}e.sort((r,o)=>r-o);let i=0;for(let r of e){if(r-i>1)return i+1;i=r}return i===14?-1:i+1}withVideoLayersAllocationRtpHeaderExtension(t){return this.withRtpHeaderExtension(t,n.videoLayersAllocationRtpHeaderExtensionUrl)}withDependencyDescriptorRtpHeaderExtension(t){return this.withRtpHeaderExtension(t,n.dependencyDescriptorRtpHeaderExtensionUrl)}withoutDependencyDescriptorRtpHeaderExtension(){let t=n.splitLines(this.sdp).filter(e=>!e.includes(n.dependencyDescriptorRtpHeaderExtensionUrl));return new n(t.join(n.CRLF)+n.CRLF)}withRtpHeaderExtension(t,e){let i=t?t.getRtpHeaderExtensionId(e):-1,r=i===-1?this.getUniqueRtpHeaderExtensionId(n.splitLines(this.sdp)):i,o=n.splitSections(this.sdp),s=[];for(let l of o){if(/^m=video/.test(l)&&n.getRtpHeaderExtensionIdInSection(l,e)===-1){let c=n.splitLines(l),a=[];if(r===-1||this.hasRtpHeaderExtensionId(r)){s.push(l);continue}for(let u of c)if(a.push(u),/^a=sendrecv/.test(u.trim())){let p="a=extmap:"+r+" "+e;a.push(p)}l=a.join(n.CRLF)+n.CRLF}else if(i!==-1&&/^m=video/.test(l)&&n.getRtpHeaderExtensionIdInSection(l,e)!==i){let c=n.splitLines(l),a=[];for(let u of c){if(/^a=extmap:/.test(u.trim())&&u.split("a=extmap:")[1].split(" ")[1]===e){if(!this.hasRtpHeaderExtensionId(i)){let m="a=extmap:"+i+" "+e;a.push(m)}continue}a.push(u)}l=a.join(n.CRLF)+n.CRLF}s.push(l)}let d=s.join("");return new n(d)}ssrcForVideoSendingSection(){let t=this.sdp,e=n.splitSections(t);if(e.length<2)return"";let i=n.findActiveCameraSection(e);if(i===-1)return"";let r=n.matchPrefix(e[i],"a=ssrc-group:FID ");if(r.length<1)return"";let o=n.extractSSRCsFromFIDGroupLine(r[0]),[s]=o.split(" ").map(d=>parseInt(d,10));return s.toString()}videoSendSectionHasDifferentSSRC(t){let e=this.ssrcForVideoSendingSection(),i=t.ssrcForVideoSendingSection();if(e===""||i==="")return!1;let r=parseInt(e,10),o=parseInt(i,10);return r!==o}removeH264SupportFromSendSection(){let t=this.sdp,e=n.splitSections(t),i=n.findActiveCameraSection(e);if(i===-1)return new n(this.sdp);let r=e[i],o=n.splitLines(r),s=[],d=new Map;o.forEach(u=>{if(/^a=rtpmap:/.test(u)){let p=/^a=rtpmap:([0-9]+)\s/.exec(u);p&&u.toLowerCase().includes("h264")&&s.push(parseInt(p[1],10))}if(/^a=fmtp:/.test(u)){let p=/^a=fmtp:([0-9]+) apt=([0-9]+)/.exec(u);if(p&&p.length===3){let m=parseInt(p[1],10),S=parseInt(p[2],10);d.has(S)?d.get(S).push(m):d.set(S,[m])}}});let l=new Set;for(let u of s){l.add(u);let p=d.get(u);if(p)for(let m of p)l.add(m)}if(s.length>0){let u=o[0].split(" ");o[0]=u.filter(p=>!l.has(parseInt(p))).join(" ")}let c=o.filter(u=>{if(!u.includes("rtpmap")&&!u.includes("rtcp-fb")&&!u.includes("fmtp"))return!0;for(let p of l)if(u.includes(p.toString()))return!1;return!0});e[i]=c.join(n.CRLF)+n.CRLF;let a=e.join("");return new n(a)}mediaSections(){let t=n.splitSections(this.sdp);if(t.length<2)return[];let e=[];for(let i=1;i<t.length;i++){let r=new fE.default,o=n.splitLines(t[i]);for(let s of o){let d=n.mediaType(s);if(d!==void 0){r.mediaType=d;continue}let l=n.direction(s);if(l!==void 0){r.direction=l;continue}let c=n.mid(s);if(c!==void 0){r.mid=c;continue}}e.push(r)}return e}static getRtpHeaderExtensionIdInSection(t,e){let i=n.splitLines(t);for(let r of i)if(/^a=extmap:/.test(r.trim())){let o=r.split("a=extmap:")[1].split(" "),s=+o[0];if(o[1]===e)return s}return-1}getRtpHeaderExtensionId(t){let e=n.splitSections(this.sdp);for(let i of e)if(/^m=video/.test(i)){let r=n.getRtpHeaderExtensionIdInSection(i,t);if(r!==-1)return r}return-1}hasRtpHeaderExtensionId(t){let e=n.splitLines(this.sdp);for(let i of e)if(/^a=extmap:/.test(i.trim())&&+i.split("a=extmap:")[1].split(" ")[0]===t)return!0;return!1}withVideoSendCodecPreferences(t){let e=this.sdp,i=n.splitSections(e),r=n.findActiveCameraSection(i);if(r===-1)return new n(this.sdp);i[r]=this.sectionWithCodecPreferences(i[r],t);let o=i.join("");return new n(o)}sectionWithCodecPreferences(t,e){let i=new Map,r=n.splitLines(t);r.forEach(l=>{if(!l.startsWith("a=rtpmap:"))return;let c=/^a=rtpmap:(\d+)\s/.exec(l);if(!c)return;let a=c[1];for(let u of e){if(!l.includes(`${u.codecName}/${u.codecCapability.clockRate}`))continue;let p=!1;if(u.codecCapability.sdpFmtpLine!==void 0){let m=!1;for(let S of r){if(u.fmtpLineMatches(S,parseInt(a))){p=!0;break}m||(m=S.startsWith(`a=fmtp:${a} profile-id=`))}u.equals(Z_.default.vp9Profile0())&&!m&&(p=!0)}else p=!0;if(p){i.set(a,u);break}}});let o=new Set(i.keys()),s=r[0].split(" ").filter(l=>!o.has(l)),d=Array.from(i.entries()).sort(([l,c],[a,u])=>{let p=e.indexOf(c),m=e.indexOf(u);return p-m}).map(([l,c])=>l);return s.splice(3,0,...d),r[0]=s.join(" "),r.join(n.CRLF)+n.CRLF}highestPriorityVideoSendCodec(){let t=this.prioritizedSendVideoCodecCapabilities();return t.length>0?t[0]:void 0}prioritizedSendVideoCodecCapabilities(){let t=this.sdp,e=n.splitSections(t),i=n.findActiveCameraSection(e);if(i===-1)return[];let r=n.splitLines(e[i]),o=r[0].split(" ");return o.length<4?[]:o.slice(3).map(l=>this.videoCodecCapabilityForPayloadType(r,l)).filter(l=>l!==void 0&&["VP8","H264","VP9","AV1"].includes(l.codecName))}videoCodecCapabilityForPayloadType(t,e){let i,r,o;for(let s of t){let d=/^a=rtpmap:([0-9]+)\s/.exec(s);if(d&&d[1]===e){let c=s.split(" ")[1].split("/");c.length>=2&&(i=c[0],r=c[1])}s.startsWith(`a=fmtp:${e} `)&&(o=s.split(" ")[1])}if(i!==void 0)return new Z_.default(i,{clockRate:parseInt(r),mimeType:`video/${i}`,sdpFmtpLine:o})}getAudioPayloadTypes(){let t=new Map,e=this.sdp,i=n.splitSections(e);return t.set("opus",n.findAudioPayloadType("opus",i)),t.set("red",n.findAudioPayloadType("red",i)),t}static findAudioPayloadType(t,e){let i=`a=rtpmap:\\s*(\\d+)\\s+${t}\\/48000`,r=new RegExp(i);for(let o of e)if(/^m=audio/.test(o)){let s=r.exec(o);if(s!==null)return Number(s[1])}return 0}withStartingVideoSendBitrate(t){let e=n.splitSections(this.sdp),i=n.findActiveCameraSection(e);if(i===-1)return this;let r=n.splitLines(e[i]),o=[];for(let d of r)if(/^a=fmtp:\d*/.test(d)){let l=d+`;x-google-start-bitrate=${t}`;o.push(l)}else o.push(d);e[i]=o.join(n.CRLF)+n.CRLF;let s=e.join("");return new n(s)}};Yo.default=ei;ei.CRLF=`\r
`;ei.rfc7587LowestBitrate=6e3;ei.rfc7587HighestBitrate=51e4;ei.dependencyDescriptorRtpHeaderExtensionUrl="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";ei.videoLayersAllocationRtpHeaderExtensionUrl="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00"});var nh=g(zi=>{"use strict";var Y_=zi&&zi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},ih=zi&&zi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(zi,"__esModule",{value:!0});var hE=ih(tt()),pE=ih(Wi()),mE=ih(Z()),th=class extends mE.default{constructor(t){super(t.logger),this.context=t,this.taskName="CreateSDPTask"}cancel(){if(this.cancelPromise){let t=new Error(`canceling ${this.name()}`);this.cancelPromise(t),delete this.cancelPromise}}sessionUsesAudio(){var t,e;return!!(!((e=(t=this.context.meetingSessionConfiguration)===null||t===void 0?void 0:t.urls)===null||e===void 0)&&e.audioHostURL)}sessionUsesVideo(){let e;this.context.transceiverController.useTransceivers()?e=this.context.transceiverController.hasVideoInput():e=this.context.videoTileController.hasStartedLocalVideoTile();let i=!!this.context.videosToReceive&&!this.context.videosToReceive.empty(),r=e||i;return this.context.logger.info(`uses video: ${r} (enabled: true, sending: ${e}, receiving: ${i})`),r}run(){return Y_(this,void 0,void 0,function*(){let t={offerToReceiveAudio:this.sessionUsesAudio(),offerToReceiveVideo:this.sessionUsesVideo()};this.logger.info(`peer connection offerOptions: ${JSON.stringify(t)}`),yield new Promise((e,i)=>Y_(this,void 0,void 0,function*(){this.cancelPromise=r=>{i(r)};try{if(this.context.sdpOfferInit=yield this.context.peer.createOffer(t),this.context.logger.info("peer connection created offer"),this.context.previousSdpOffer&&new pE.default(this.context.sdpOfferInit.sdp).videoSendSectionHasDifferentSSRC(this.context.previousSdpOffer)){let r=new Error(`canceling ${this.name()} due to the meeting status code: ${hE.default.IncompatibleSDP}`);this.context.previousSdpOffer=null,i(r);return}e()}catch(r){i(r)}finally{delete this.cancelPromise}}))})}};zi.default=th});var sh=g(oh=>{"use strict";Object.defineProperty(oh,"__esModule",{value:!0});var rh=class{constructor(t,e,i,r,o,s){this.timestampMs=t,this.topic=e,this.data=i,this.senderAttendeeId=r,this.senderExternalUserId=o,this.throttled=!!s}text(){return new TextDecoder().decode(this.data)}json(){return JSON.parse(new TextDecoder().decode(this.data))}};oh.default=rh});var dh=g($i=>{"use strict";var gE=$i&&$i.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},vE=$i&&$i.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty($i,"__esModule",{value:!0});var ew=vE(Jt()),ah=class{constructor(t,e,i,r=1e3,o=200){this.realtimeController=t,this.selfAttendeeId=e,this.hasBandwidthPriorityCallback=i,this.waitIntervalMs=r,this.updateIntervalMs=o,this.speakerScores={},this.speakerMuteState={},this.detectorCallbackToHandler=new Map,this.detectorCallbackToScoresTimer=new Map,this.detectorCallbackToActivityTimer=new Map,this.hasBandwidthPriority=!1,this.mostRecentUpdateTimestamp={}}needUpdate(t){return this.activeSpeakers?this.speakerScores[t]===0&&this.activeSpeakers.includes(t)||this.speakerScores[t]>0&&!this.activeSpeakers.includes(t):!0}updateActiveSpeakers(t,e,i){if(!this.needUpdate(i))return;let r=[],o=Object.keys(this.speakerScores);for(let a=0;a<o.length;a++){let u=o[a];r.push({attendeeId:u,activeScore:this.speakerScores[u]})}let s=r.sort((a,u)=>u.activeScore-a.activeScore).filter(function(a){return a.activeScore>0}).map(function(a){return a.attendeeId});this.activeSpeakers=s,e(s);let l=s.length>0&&s[0]===this.selfAttendeeId&&t.prioritizeVideoSendBandwidthForActiveSpeaker();this.hasBandwidthPriority!==l&&(this.hasBandwidthPriority=l,this.hasBandwidthPriorityCallback(l))}updateScore(t,e,i,r,o){let s=t.calculateScore(i,r,o);this.speakerScores[i]!==s&&(this.speakerScores[i]=s,this.mostRecentUpdateTimestamp[i]=Date.now(),this.updateActiveSpeakers(t,e,i))}subscribe(t,e,i,r){let o=(d,l)=>{if(!l){this.speakerScores[d]=0,this.mostRecentUpdateTimestamp[d]=Date.now(),this.updateActiveSpeakers(t,e,d);return}this.realtimeController.realtimeSubscribeToVolumeIndicator(d,(c,a,u,p)=>{this.mostRecentUpdateTimestamp[c]=Date.now(),u!==null&&(this.speakerMuteState[c]=u),this.updateScore(t,e,c,a,u)})};this.detectorCallbackToHandler.set(e,o);let s=new ew.default(this.updateIntervalMs);if(s.start(()=>{for(let d in this.speakerScores)Date.now()-this.mostRecentUpdateTimestamp[d]>this.waitIntervalMs&&this.updateScore(t,e,d,0,this.speakerMuteState[d])}),this.detectorCallbackToActivityTimer.set(e,s),i&&r){let d=new ew.default(r);d.start(()=>{i(this.speakerScores)}),this.detectorCallbackToScoresTimer.set(e,d)}this.realtimeController.realtimeSubscribeToAttendeeIdPresence(o)}unsubscribe(t){let e=this.detectorCallbackToHandler.get(t);this.detectorCallbackToHandler.delete(t),e&&this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(e);let i=this.detectorCallbackToActivityTimer.get(t);i&&(i.stop(),this.detectorCallbackToActivityTimer.delete(t));let r=this.detectorCallbackToScoresTimer.get(t);r&&(r.stop(),this.detectorCallbackToHandler.delete(t))}destroy(){return gE(this,void 0,void 0,function*(){for(let t of this.detectorCallbackToHandler.values())this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(t);for(let t of this.detectorCallbackToActivityTimer.values())t.stop();for(let t of this.detectorCallbackToScoresTimer.values())t.stop();this.detectorCallbackToHandler.clear(),this.detectorCallbackToActivityTimer.clear(),this.detectorCallbackToScoresTimer.clear()})}};$i.default=ah});var tw=g(lh=>{"use strict";Object.defineProperty(lh,"__esModule",{value:!0});var ch=class{constructor(t=.9,e=.01,i=.2,r=.2){this.speakerWeight=t,this.cutoffThreshold=e,this.silenceThreshold=i,this.takeoverRate=r,this.volumes={}}calculateScore(t,e,i){(i||e===null)&&(e=0),this.volumes.hasOwnProperty(t)||(this.volumes[t]=0),e>this.silenceThreshold?e=1:e=0;let r=this.volumes[t]*this.speakerWeight+e*(1-this.speakerWeight);this.volumes[t]=r;for(let o in this.volumes)o!==t&&(this.volumes[o]=Math.max(this.volumes[o]-this.takeoverRate*e,0));return r<this.cutoffThreshold?0:r}prioritizeVideoSendBandwidthForActiveSpeaker(){return!0}};lh.default=ch});var kd=g(Ki=>{"use strict";var ti=Ki&&Ki.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},iw=Ki&&Ki.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ki,"__esModule",{value:!0});var SE=iw(pe()),yE=iw(Ve()),uh=class{constructor(t){this.logger=t,this.audioDevice=null,this.audioElement=null,this.audioStream=null,this.browserBehavior=new SE.default,this.observers=new Set}bindAudioElement(t){return ti(this,void 0,void 0,function*(){if(!t)throw new Error(`Cannot bind audio element: ${t}`);return this.audioElement=t,this.audioElement.autoplay=!0,this.bindAudioMix()})}unbindAudioElement(){this.audioElement&&(this.audioElement.srcObject=null,this.audioElement=null,this.forEachObserver(t=>{this.audioStream&&t.meetingAudioStreamBecameInactive(this.audioStream)}))}bindAudioStream(t){return ti(this,void 0,void 0,function*(){if(t){this.audioStream=t;try{yield this.bindAudioMix()}catch(e){this.logger&&this.logger.warn(`Failed to bind audio stream: ${e}`)}}})}bindAudioDevice(t){return ti(this,void 0,void 0,function*(){if(t&&!this.browserBehavior.supportsSetSinkId())throw new Error("Cannot select audio output device. This browser does not support setSinkId.");return this.audioDevice=t,this.bindAudioMix()})}forEachObserver(t){for(let e of this.observers)yE.default.nextTick(()=>{t(e)})}bindAudioMix(){var t,e;return ti(this,void 0,void 0,function*(){if(!this.audioElement)return;let i=this.audioElement.srcObject;this.audioStream&&(this.audioElement.srcObject=this.audioStream),i!==this.audioStream&&this.forEachObserver(c=>{i&&c.meetingAudioStreamBecameInactive(i),this.audioStream&&c.meetingAudioStreamBecameActive(this.audioStream)});let r=((t=this.audioDevice)===null||t===void 0?void 0:t.deviceId)!==this.audioElement.sinkId;if(r&&typeof this.audioElement.sinkId>"u")throw new Error("Cannot select audio output device. This browser does not support setSinkId.");let o=this.audioDevice?this.audioDevice.deviceId:"",s=this.audioElement.sinkId;if(o===s)return;let d=this.audioElement,l=this.audioStream;if(this.browserBehavior.hasChromiumWebRTC()&&(d.srcObject=null),r)try{yield d.setSinkId(o)}catch(c){throw(e=this.logger)===null||e===void 0||e.error(`Failed to set sinkId for audio element: ${c}`),c}this.browserBehavior.hasChromiumWebRTC()&&(d.srcObject=l)})}getCurrentMeetingAudioStream(){return ti(this,void 0,void 0,function*(){return this.audioStream})}addAudioMixObserver(t){return ti(this,void 0,void 0,function*(){this.observers.add(t)})}removeAudioMixObserver(t){return ti(this,void 0,void 0,function*(){this.observers.delete(t)})}audioOutputDidChange(t){return ti(this,void 0,void 0,function*(){return this.logger.info("Receive an audio output change event"),this.bindAudioDevice(t)})}};Ki.default=uh});var ph=g(hh=>{"use strict";Object.defineProperty(hh,"__esModule",{value:!0});var bE=Le(),fh=class{constructor(t,e,i,r,o){this.audioVideoController=t,this.realtimeController=e,this.connectionHealthData=i,this.pingPong=r,this.statsCollector=o,this.isActive=!1,this.hasSeenValidCandidatePairMetricsBefore=!1,this.lastTotalBytesReceived=0,this.lastTotalStunMessagesReceived=0,this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(s=>{this.isActive&&this.receiveSignalStrengthChange(s)})}start(){this.isActive=!0,this.pingPong.addObserver(this),this.pingPong.start(),this.audioVideoController.addObserver(this)}stop(){this.isActive=!1,this.pingPong.removeObserver(this),this.pingPong.stop(),this.audioVideoController.removeObserver(this)}receiveSignalStrengthChange(t){t===0?this.connectionHealthData.setLastNoSignalTimestampMs(Date.now()):t<=.5?this.connectionHealthData.setLastWeakSignalTimestampMs(Date.now()):this.connectionHealthData.setLastGoodSignalTimestampMs(Date.now()),this.updateConnectionHealth()}didReceivePong(t,e,i){this.connectionHealthData.setConsecutiveMissedPongs(0),this.statsCollector.logLatency("ping_pong",e),this.statsCollector.logLatency("ping_pong_clock_skew",i),this.updateConnectionHealth()}didMissPongs(){this.connectionHealthData.setConsecutiveMissedPongs(this.connectionHealthData.consecutiveMissedPongs+1),this.updateConnectionHealth()}metricsDidReceive(t){let e=0,i=0,r=t.getObservableMetrics(),o=r.audioPacketsReceived,s=r.audioPacketsReceivedFractionLoss,d=r.audioSpeakerDelayMs;typeof d=="number"&&!isNaN(d)&&this.connectionHealthData.setAudioSpeakerDelayMs(d);let l=t.getRTCStatsReport(),c=0,a=0;l.forEach(m=>{m.type==="candidate-pair"&&(m.bytesReceived&&(c+=m.bytesReceived),m.requestsReceived&&(a+=m.requestsReceived),m.responsesReceived&&(a+=m.responsesReceived))});let u=c-this.lastTotalBytesReceived;this.lastTotalBytesReceived=c;let p=a-this.lastTotalStunMessagesReceived;if(this.lastTotalStunMessagesReceived=a,typeof o=="number"&&typeof s=="number"){if(e=o,i=s,e<0||i<0||u<0||p<0)return}else return;this.addToMinuteWindow(this.connectionHealthData.packetsReceivedInLastMinute,e),this.addToMinuteWindow(this.connectionHealthData.fractionPacketsLostInboundInLastMinute,i),u>0||p>0?(this.hasSeenValidCandidatePairMetricsBefore=!0,this.connectionHealthData.setConsecutiveStatsWithNoPackets(0)):this.hasSeenValidCandidatePairMetricsBefore&&this.connectionHealthData.setConsecutiveStatsWithNoPackets(this.connectionHealthData.consecutiveStatsWithNoPackets+1),(e===0||i>0)&&this.connectionHealthData.setLastPacketLossInboundTimestampMs(Date.now()),typeof r.audioPacketsSent=="number"&&this.updateAudioPacketsSentInConnectionHealth(r.audioPacketsSent),this.updateVideoEncodingHealth(t),this.updateConnectionHealth()}updateAudioPacketsSentInConnectionHealth(t){t>0?this.connectionHealthData.setConsecutiveStatsWithNoAudioPacketsSent(0):this.connectionHealthData.setConsecutiveStatsWithNoAudioPacketsSent(this.connectionHealthData.consecutiveStatsWithNoAudioPacketsSent+1)}updateVideoEncodingHealth(t){let e=this.audioVideoController.videoTileController.hasStartedLocalVideoTile(),i=t.getVideoUpstreamSsrcs();if(!e||i.length===0){this.connectionHealthData.setIsVideoEncoderHardware(!1),this.connectionHealthData.setVideoEncodingTimePerFrameInMs(0),this.connectionHealthData.setCpuLimitationDuration(0),this.connectionHealthData.setVideoInputFps(0),this.connectionHealthData.setVideoEncodeFps(0);return}let r=!1,o=0,s=0,d=0,l=0;for(let a of i)r||(r=!!t.getObservableVideoMetricValue("videoUpstreamEncoderImplementation",a)),o+=t.getObservableVideoMetricValue("videoUpstreamTotalEncodeTimePerSecond",a),s+=t.getObservableVideoMetricValue("videoUpstreamCpuQualityLimitationDurationPerSecond",a),d+=t.getObservableVideoMetricValue("videoUpstreamFramesInputPerSecond",a),l+=t.getObservableVideoMetricValue("videoUpstreamFramesEncodedPerSecond",a);let c=l>0?o/l:0;this.connectionHealthData.setIsVideoEncoderHardware(!!r),this.connectionHealthData.setVideoEncodingTimeInMs(o),this.connectionHealthData.setVideoEncodingTimePerFrameInMs(c),this.connectionHealthData.setCpuLimitationDuration(s),this.connectionHealthData.setVideoInputFps(d),this.connectionHealthData.setVideoEncodeFps(l)}addToMinuteWindow(t,e){t.unshift(e),t.length>60&&t.pop()}updateConnectionHealth(){this.audioVideoController.forEachObserver(t=>{bE.Maybe.of(t.connectionHealthDidChange).map(e=>e.bind(t)(this.connectionHealthData.clone()))})}};hh.default=fh});var Gi=g(es=>{"use strict";var _E=es&&es.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(es,"__esModule",{value:!0});var nw=oe(),E=_E(tt()),mh=class n{constructor(t){this._statusCode=t}statusCode(){return this._statusCode}isFailure(){switch(this._statusCode){case E.default.AudioAuthenticationRejected:case E.default.AudioCallAtCapacity:case E.default.AudioInternalServerError:case E.default.AudioServiceUnavailable:case E.default.AudioDisconnected:case E.default.VideoCallAtSourceCapacity:case E.default.SignalingBadRequest:case E.default.SignalingInternalServerError:case E.default.SignalingRequestFailed:case E.default.ICEGatheringTimeoutWorkaround:case E.default.ConnectionHealthReconnect:case E.default.RealtimeApiFailed:case E.default.TaskFailed:case E.default.NoAttendeePresent:case E.default.SignalingChannelClosedUnexpectedly:return!0;default:return!1}}isTerminal(){switch(this._statusCode){case E.default.Left:case E.default.AudioJoinedFromAnotherDevice:case E.default.AudioAuthenticationRejected:case E.default.AudioCallAtCapacity:case E.default.MeetingEnded:case E.default.AudioDisconnected:case E.default.TURNCredentialsForbidden:case E.default.SignalingBadRequest:case E.default.SignalingRequestFailed:case E.default.VideoCallAtSourceCapacity:case E.default.RealtimeApiFailed:case E.default.AudioAttendeeRemoved:return!0;default:return!1}}isAudioConnectionFailure(){switch(this._statusCode){case E.default.AudioAuthenticationRejected:case E.default.AudioInternalServerError:case E.default.AudioServiceUnavailable:case E.default.ICEGatheringTimeoutWorkaround:case E.default.SignalingBadRequest:case E.default.SignalingInternalServerError:case E.default.SignalingRequestFailed:case E.default.RealtimeApiFailed:case E.default.NoAttendeePresent:return!0;default:return!1}}toString(){switch(this._statusCode){case E.default.OK:return"Everything is OK so far.";case E.default.Left:return"The attendee left the meeting.";case E.default.AudioJoinedFromAnotherDevice:return"The attendee joined from another device.";case E.default.AudioAuthenticationRejected:return"The meeting rejected the attendee.";case E.default.AudioCallAtCapacity:return"The attendee couldn't join because the meeting was at capacity.";case E.default.MeetingEnded:return"The meeting ended.";case E.default.AudioInternalServerError:case E.default.AudioServiceUnavailable:case E.default.AudioDisconnected:return"The audio connection failed.";case E.default.VideoCallSwitchToViewOnly:return"The attendee couldn't start the local video because the maximum video capacity was reached.";case E.default.VideoCallAtSourceCapacity:return"The connection failed due to an internal server error.";case E.default.SignalingBadRequest:case E.default.SignalingInternalServerError:case E.default.SignalingRequestFailed:return"The signaling connection failed.";case E.default.ICEGatheringTimeoutWorkaround:return"Gathering ICE candidates timed out. In Chrome, this might indicate that the browser is in a bad state after reconnecting to VPN.";case E.default.ConnectionHealthReconnect:return"The meeting was reconnected.";case E.default.RealtimeApiFailed:return"The real-time API failed. This status code might indicate that the callback you passed to the real-time API threw an exception.";case E.default.TaskFailed:return"The connection failed. See the error message for more details.";case E.default.IncompatibleSDP:return"The connection failed due to incompatible SDP.";case E.default.TURNCredentialsForbidden:return"The meeting ended, or the attendee was removed.";case E.default.NoAttendeePresent:return"The attendee was not present.";case E.default.AudioAttendeeRemoved:return"The meeting ended because attendee removed.";case E.default.AudioVideoWasRemovedFromPrimaryMeeting:return"The Primary meeting credentials provided are no longer valid. chime::DeleteAttendee may have been called on them.";case E.default.AudioVideoDisconnectedWhilePromoted:return"The client disconnected while promoted, which will automatically demote. The attendee must promote again to participate.";case E.default.AudioDisconnectAudio:return"The audio connection failed.";case E.default.SignalingChannelClosedUnexpectedly:return"The signaling channel was closed unexpectedly. This may be due to a network change or backend detected failure.";default:{let t=this._statusCode;throw new Error(`Unhandled case: ${t}`)}}}static fromSignalFrame(t){return t.error&&t.error.status?this.fromSignalingStatus(t.error.status):t.type===nw.SdkSignalFrame.Type.AUDIO_STATUS?t.audioStatus?this.fromAudioStatus(t.audioStatus.audioStatus):new n(E.default.SignalingRequestFailed):t.type===nw.SdkSignalFrame.Type.PRIMARY_MEETING_LEAVE?new n(E.default.AudioVideoWasRemovedFromPrimaryMeeting):new n(E.default.OK)}static fromAudioStatus(t){switch(t){case 200:return new n(E.default.OK);case 301:return new n(E.default.AudioJoinedFromAnotherDevice);case 302:return new n(E.default.AudioDisconnectAudio);case 403:return new n(E.default.AudioAuthenticationRejected);case 409:return new n(E.default.AudioCallAtCapacity);case 410:return new n(E.default.MeetingEnded);case 411:return new n(E.default.AudioAttendeeRemoved);case 500:return new n(E.default.AudioInternalServerError);case 503:return new n(E.default.AudioServiceUnavailable);default:switch(Math.floor(t/100)){case 2:return new n(E.default.OK);default:return new n(E.default.AudioDisconnected)}}}static fromSignalingStatus(t){switch(t){case 206:return new n(E.default.VideoCallSwitchToViewOnly);case 509:return new n(E.default.VideoCallAtSourceCapacity);case 403:return new n(E.default.AudioAuthenticationRejected);case 409:return new n(E.default.AudioCallAtCapacity);default:switch(Math.floor(t/100)){case 2:return new n(E.default.OK);case 4:return new n(E.default.SignalingBadRequest);case 5:return new n(E.default.SignalingInternalServerError);default:return new n(E.default.SignalingRequestFailed)}}}};es.default=mh});var Id=g(vh=>{"use strict";Object.defineProperty(vh,"__esModule",{value:!0});var gh=class n{constructor(){this.remoteVideoAvailable=!1,this.canStartLocalVideo=!1}equal(t){return this.remoteVideoAvailable===t.remoteVideoAvailable&&this.canStartLocalVideo===t.canStartLocalVideo}clone(){let t=new n;return t.remoteVideoAvailable=this.remoteVideoAvailable,t.canStartLocalVideo=this.canStartLocalVideo,t}};vh.default=gh});var bh=g(ts=>{"use strict";var yh=ts&&ts.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ts,"__esModule",{value:!0});var wE=yh(Ve()),TE=yh(Jt()),ii=yh(me()),_r=oe(),rw=Le(),Sh=class{constructor(t,e,i){this.signalingClient=t,this.intervalMs=e,this.logger=i,this.observerQueue=new Set,this.consecutivePongsUnaccountedFor=0,this.intervalScheduler=new TE.default(this.intervalMs),this.pingId=0}addObserver(t){this.logger.info("adding a ping-pong observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing a ping-pong observer"),this.observerQueue.delete(t)}forEachObserver(t){for(let e of this.observerQueue)wE.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}start(){this.stop(),this.signalingClient.registerObserver(this),this.signalingClient.ready()&&this.startPingInterval()}stop(){this.stopPingInterval(),this.signalingClient.removeObserver(this)}startPingInterval(){this.intervalScheduler.start(()=>{this.ping()}),this.ping()}stopPingInterval(){this.intervalScheduler.stop(),this.pingId=0,this.consecutivePongsUnaccountedFor=0}ping(){this.consecutivePongsUnaccountedFor>0&&(this.logger.warn(`missed pong ${this.consecutivePongsUnaccountedFor} time(s)`),this.forEachObserver(e=>{rw.Maybe.of(e.didMissPongs).map(i=>i.bind(e)(this.consecutivePongsUnaccountedFor))})),this.consecutivePongsUnaccountedFor+=1,this.pingId=this.pingId+1&4294967295;let t=_r.SdkPingPongFrame.create();t.pingId=this.pingId,t.type=_r.SdkPingPongType.PING,this.pingTimestampLocalMs=this.signalingClient.pingPong(t),this.logger.debug(()=>`sent ping ${this.pingId}`)}pong(t){let e=_r.SdkPingPongFrame.create();e.pingId=t,e.type=_r.SdkPingPongType.PONG,this.signalingClient.pingPong(e)}handleSignalingClientEvent(t){switch(t.type){case ii.default.WebSocketOpen:this.startPingInterval();break;case ii.default.WebSocketFailed:case ii.default.WebSocketError:this.logger.warn(`stopped pinging (${ii.default[t.type]})`),this.stopPingInterval();break;case ii.default.WebSocketClosing:case ii.default.WebSocketClosed:this.logger.info(`stopped pinging (${ii.default[t.type]})`),this.stopPingInterval();break;case ii.default.ReceivedSignalFrame:if(t.message.type!==_r.SdkSignalFrame.Type.PING_PONG)break;if(t.message.pingPong.type===_r.SdkPingPongType.PONG){let e=t.message.pingPong.pingId;if(e!==this.pingId){this.logger.warn(`unexpected ping id ${e} (expected ${this.pingId})`);break}this.consecutivePongsUnaccountedFor=0;let i;if(typeof t.message.timestampMs=="number")i=t.message.timestampMs;else break;this.logger.debug(()=>`received pong ${e} with timestamp ${i}`);let o=t.timestampMs-this.pingTimestampLocalMs,s=Math.round(i-o/2),d=this.pingTimestampLocalMs-s;this.logger.info(`local clock skew estimate=${d}ms from ping-pong time=${o}ms`),this.forEachObserver(l=>{rw.Maybe.of(l.didReceivePong).map(c=>c.bind(l)(e,d,o))})}else this.pong(t.message.pingPong.pingId);break}}};ts.default=Sh});var Th=g(wh=>{"use strict";Object.defineProperty(wh,"__esModule",{value:!0});var _h=class{};wh.default=_h});var Ch=g(Ih=>{"use strict";Object.defineProperty(Ih,"__esModule",{value:!0});var kh=class{};Ih.default=kh});var Ah=g(Eh=>{"use strict";Object.defineProperty(Eh,"__esModule",{value:!0});var Oh;(function(n){n.STARTED="started",n.INTERRUPTED="interrupted",n.RESUMED="resumed",n.STOPPED="stopped",n.FAILED="failed"})(Oh||(Oh={}));Eh.default=Oh});var Rh=g(Mh=>{"use strict";Object.defineProperty(Mh,"__esModule",{value:!0});var Ph;(function(n){n.PRONUNCIATION="pronunciation",n.PUNCTUATION="punctuation"})(Ph||(Ph={}));Mh.default=Ph});var sw=g(wr=>{"use strict";var Cd=wr&&wr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(wr,"__esModule",{value:!0});wr.TranscriptEventConverter=void 0;var ni=oe(),kE=Cd(Th()),IE=Cd(Ch()),is=Cd(Ah()),ow=Cd(Rh()),CE={[ni.SdkTranscriptionStatus.Type.STARTED]:is.default.STARTED,[ni.SdkTranscriptionStatus.Type.INTERRUPTED]:is.default.INTERRUPTED,[ni.SdkTranscriptionStatus.Type.RESUMED]:is.default.RESUMED,[ni.SdkTranscriptionStatus.Type.STOPPED]:is.default.STOPPED,[ni.SdkTranscriptionStatus.Type.FAILED]:is.default.FAILED},Dh=class{static from(t){let e;try{e=ni.SdkTranscriptFrame.decode(t.data)}catch(r){throw new Error("Cannot decode transcript data message: "+r)}let i=[];for(let r of e.events)if(r.status){let o=CE[r.status.type];if(!o)continue;let s=new IE.default;s.type=o,s.eventTimeMs=r.status.eventTime,s.transcriptionRegion=r.status.transcriptionRegion,s.transcriptionConfiguration=r.status.transcriptionConfiguration,r.status.message&&(s.message=r.status.message),i.push(s)}else if(r.transcript){let o=new kE.default;o.results=[];for(let s of r.transcript.results){let d={channelId:s.channelId,isPartial:s.isPartial,resultId:s.resultId,startTimeMs:s.startTime,endTimeMs:s.endTime,alternatives:[]};if(s.languageCode&&(d.languageCode=s.languageCode),s.languageIdentification&&s.languageIdentification.length>0){d.languageIdentification=[];for(let l of s.languageIdentification){let c={languageCode:l.languageCode,score:l.score};d.languageIdentification.push(c)}}for(let l of s.alternatives){let c={items:[],transcript:l.transcript};for(let a of l.items){let u={content:a.content,attendee:{attendeeId:a.speakerAttendeeId,externalUserId:a.speakerExternalUserId},startTimeMs:a.startTime,endTimeMs:a.endTime,type:null};switch(a.vocabularyFilterMatch&&(u.vocabularyFilterMatch=a.vocabularyFilterMatch),a.hasOwnProperty("stable")&&(u.stable=a.stable),a.hasOwnProperty("confidence")&&(u.confidence=a.confidence),a.type){case ni.SdkTranscriptItem.Type.PRONUNCIATION:u.type=ow.default.PRONUNCIATION;break;case ni.SdkTranscriptItem.Type.PUNCTUATION:u.type=ow.default.PUNCTUATION;break}c.items.push(u)}for(let a of l.entities){c.entities||(c.entities=[]);let u={category:a.category,confidence:a.confidence,content:a.content,startTimeMs:a.startTime,endTimeMs:a.endTime};a.type&&(u.type=a.type),c.entities.push(u)}d.alternatives.push(c)}o.results.push(d)}i.push(o)}return i}};wr.TranscriptEventConverter=Dh});var Vh=g(Ji=>{"use strict";Object.defineProperty(Ji,"__esModule",{value:!0});Ji.TRANSCRIPTION_DATA_MESSAGE_TOPIC=void 0;var OE=sw();Ji.TRANSCRIPTION_DATA_MESSAGE_TOPIC="aws:chime:transcription";var xh=class{constructor(t){this.realtimeController=t,this.transcriptEventCallbacks=new Set}subscribeToTranscriptEvent(t){this.transcriptEventCallbacks.size===0&&this.realtimeController.realtimeSubscribeToReceiveDataMessage(Ji.TRANSCRIPTION_DATA_MESSAGE_TOPIC,e=>{for(let i of OE.TranscriptEventConverter.from(e))for(let r of this.transcriptEventCallbacks)r(i)}),this.transcriptEventCallbacks.add(t)}unsubscribeFromTranscriptEvent(t){this.transcriptEventCallbacks.delete(t),this.transcriptEventCallbacks.size===0&&this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage(Ji.TRANSCRIPTION_DATA_MESSAGE_TOPIC)}};Ji.default=xh});var ri=g(le=>{"use strict";var EE=le&&le.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(le,"__esModule",{value:!0});le.iterateEvery=le.SuppressedError=le.getRandomValues=le.getFormattedOffset=le.getDefaultAssetSpec=le.toLowerCasePropertyNames=le.isIFramed=le.wait=void 0;var AE=EE(Je());function PE(n){return new Promise(t=>setTimeout(t,n))}le.wait=PE;function ME(){var n;try{return((n=window.frameElement)===null||n===void 0?void 0:n.nodeName)==="IFRAME"||parent!==top}catch{return!0}}le.isIFramed=ME;function Nh(n){return n===null?null:typeof n!="object"?n:Array.isArray(n)?n.map(Nh):Object.keys(n).reduce((t,e)=>{let i=n[e],r=typeof i=="object"?Nh(i):i;return t[e.toLowerCase()]=r,t},{})}le.toLowerCasePropertyNames=Nh;function RE(){let n=AE.default.sdkVersionSemVer;return{assetGroup:`sdk-${n.major}.${n.minor}`}}le.getDefaultAssetSpec=RE;function DE(n){let t=Math.abs(n),e=n<=0?"+":"-",i=Math.floor(t/60).toString().padStart(2,"0"),r=Math.floor(t%60).toString().padStart(2,"0");return`${e}${i}:${r}`}le.getFormattedOffset=DE;function xE(n){try{window.crypto.getRandomValues(n)}catch{new DataView(n.buffer).setUint32(0,Math.trunc(Math.random()*Math.pow(2,32)),!0)}}le.getRandomValues=xE;var Od=class extends Error{constructor(t,e,i){var r;super(i??`${(r=t?.message)!==null&&r!==void 0?r:t}`),this.error=t,this.suppressed=e}};le.SuppressedError=Od;function VE(n,t){if(!n)return;let e;for(let i of n)try{t(i)}catch(r){e=new Od(r,e)}if(e)throw e}le.iterateEvery=VE});var Fh=g(Bh=>{"use strict";Object.defineProperty(Bh,"__esModule",{value:!0});var Lh=class{constructor(){this.localAttendeeId=null,this.localExternalUserId=null,this.attendeeIdChangesCallbacks=[],this.canUnmute=!0,this.setCanUnmuteLocalAudioCallbacks=[],this.muted=!1,this.muteAndUnmuteLocalAudioCallbacks=[],this.volumeIndicatorState={},this.attendeeIdToExternalUserId={},this.volumeIndicatorCallbacks={},this.localSignalStrengthChangeCallbacks=[],this.fatalErrorCallbacks=[],this.sendDataMessageCallbacks=[],this.receiveDataMessageCallbacks=new Map}};Bh.default=Lh});var Hh=g(qh=>{"use strict";Object.defineProperty(qh,"__esModule",{value:!0});var Uh=class{constructor(){this.volume=null,this.muted=null,this.signalStrength=null}};qh.default=Uh});var zh=g(ns=>{"use strict";var Wh=ns&&ns.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ns,"__esModule",{value:!0});var NE=Wh(Vh()),LE=ri(),BE=Wh(Fh()),aw=Wh(Hh()),jh=class{constructor(t,e){this.mediaStreamBroker=t,this.state=new BE.default,this._transcriptionController=e||new NE.default(this)}realtimeSetLocalAttendeeId(t,e){this.state.localAttendeeId=t,this.state.localExternalUserId=e}realtimeSetAttendeeIdPresence(t,e,i,r,o){try{e&&(this.state.attendeeIdToExternalUserId[t]=i);for(let s of this.state.attendeeIdChangesCallbacks)s(t,e,i,r,o)}catch(s){this.onError(s)}}realtimeSubscribeToAttendeeIdPresence(t){try{this.state.attendeeIdChangesCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToAttendeeIdPresence(t){try{let e=this.state.attendeeIdChangesCallbacks.indexOf(t);e!==-1&&this.state.attendeeIdChangesCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeSetCanUnmuteLocalAudio(t){try{if(this.state.canUnmute===t)return;this.state.canUnmute=t;for(let e of this.state.setCanUnmuteLocalAudioCallbacks)e(t)}catch(e){this.onError(e)}}realtimeSubscribeToSetCanUnmuteLocalAudio(t){try{this.state.setCanUnmuteLocalAudioCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToSetCanUnmuteLocalAudio(t){try{let e=this.state.setCanUnmuteLocalAudioCallbacks.indexOf(t);e!==-1&&this.state.setCanUnmuteLocalAudioCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeCanUnmuteLocalAudio(){return this.state.canUnmute}realtimeMuteLocalAudio(){if(!this.state.muted)try{this.setAudioInputEnabled(!1),this.state.muted=!0,this.realtimeUpdateVolumeIndicator(this.state.localAttendeeId,null,null,null,this.state.localExternalUserId);for(let t of this.state.muteAndUnmuteLocalAudioCallbacks)t(!0)}catch(t){this.onError(t)}}realtimeUnmuteLocalAudio(){if(!this.state.muted)return!0;if(!this.state.canUnmute)return!1;try{this.setAudioInputEnabled(!0),this.state.muted=!1,this.realtimeUpdateVolumeIndicator(this.state.localAttendeeId,null,null,null,this.state.localExternalUserId);for(let t of this.state.muteAndUnmuteLocalAudioCallbacks)t(!1);return!0}catch(t){return this.onError(t),!1}}realtimeSubscribeToMuteAndUnmuteLocalAudio(t){try{this.state.muteAndUnmuteLocalAudioCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToMuteAndUnmuteLocalAudio(t){try{let e=this.state.muteAndUnmuteLocalAudioCallbacks.indexOf(t);e!==-1&&this.state.muteAndUnmuteLocalAudioCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeIsLocalAudioMuted(){return this.state.muted}realtimeSubscribeToVolumeIndicator(t,e){try{this.state.volumeIndicatorCallbacks.hasOwnProperty(t)||(this.state.volumeIndicatorCallbacks[t]=[]),this.state.volumeIndicatorCallbacks[t].push(e),this.sendVolumeIndicatorChange(t,!0,!0,!0,this.state.attendeeIdToExternalUserId[t])}catch(i){this.onError(i)}}realtimeUnsubscribeFromVolumeIndicator(t,e){if(this.state.volumeIndicatorCallbacks[t])if(e){let r=this.state.volumeIndicatorCallbacks[t].indexOf(e);r>=0&&this.state.volumeIndicatorCallbacks[t].splice(r,1)}else delete this.state.volumeIndicatorCallbacks[t]}realtimeUpdateVolumeIndicator(t,e,i,r,o){try{i=this.applyLocalMuteOverride(t,i);let s=this.getVolumeIndicatorState(t),d=!1,l=!1,c=!1;i!==null&&s.muted!==i&&(s.muted=i,l=!0,s.muted&&s.volume!==0&&(s.volume=0,d=!0)),!s.muted&&e!==null&&(s.volume!==e&&(s.volume=e,d=!0),s.muted===null&&(s.muted=!1,l=!0)),r!==null&&s.signalStrength!==r&&(s.signalStrength=r,c=!0),this.sendVolumeIndicatorChange(t,d,l,c,o)}catch(s){this.onError(s)}}realtimeSubscribeToLocalSignalStrengthChange(t){try{if(this.state.localSignalStrengthChangeCallbacks.push(t),this.state.localAttendeeId===null)return;this.sendLocalSignalStrengthChange(this.state.localAttendeeId,!0)}catch(e){this.onError(e)}}realtimeUnsubscribeToLocalSignalStrengthChange(t){try{let e=this.state.localSignalStrengthChangeCallbacks.indexOf(t);e!==-1&&this.state.localSignalStrengthChangeCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeSubscribeToSendDataMessage(t){try{this.state.sendDataMessageCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeFromSendDataMessage(t){try{let e=this.state.sendDataMessageCallbacks.indexOf(t);e!==-1&&this.state.sendDataMessageCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeSendDataMessage(t,e,i){try{for(let r of this.state.sendDataMessageCallbacks)r(t,e,i)}catch(r){this.onError(r)}}realtimeSubscribeToReceiveDataMessage(t,e){try{this.state.receiveDataMessageCallbacks.has(t)?this.state.receiveDataMessageCallbacks.get(t).push(e):this.state.receiveDataMessageCallbacks.set(t,[e])}catch(i){this.onError(i)}}realtimeUnsubscribeFromReceiveDataMessage(t){try{this.state.receiveDataMessageCallbacks.delete(t)}catch(e){this.onError(e)}}realtimeReceiveDataMessage(t){try{LE.iterateEvery(this.state.receiveDataMessageCallbacks.get(t.topic),e=>{e(t)})}catch(e){Promise.reject(e)}}realtimeSubscribeToFatalError(t){try{this.state.fatalErrorCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToFatalError(t){try{let e=this.state.fatalErrorCallbacks.indexOf(t);e!==-1&&this.state.fatalErrorCallbacks.splice(e,1)}catch(e){this.onError(e)}}get transcriptionController(){return this._transcriptionController}setAudioInputEnabled(t){t?this.mediaStreamBroker.unmuteLocalAudioInputStream():this.mediaStreamBroker.muteLocalAudioInputStream()}applyLocalMuteOverride(t,e){let i=this.state.localAttendeeId,r=this.state.muted;return t!==i||!("activeDevices"in this.mediaStreamBroker&&this.mediaStreamBroker.activeDevices.audio)?e:r}sendVolumeIndicatorChange(t,e,i,r,o){if(this.sendLocalSignalStrengthChange(t,r),!this.state.volumeIndicatorCallbacks.hasOwnProperty(t))return;let s=this.getVolumeIndicatorState(t),d=new aw.default;if(e&&(d.volume=s.volume),i&&(d.muted=s.muted),r&&(d.signalStrength=s.signalStrength),!this.stateIsEmpty(d))for(let l of this.state.volumeIndicatorCallbacks[t])l(t,d.volume,d.muted,d.signalStrength,o)}sendLocalSignalStrengthChange(t,e){if(!e||t!==this.state.localAttendeeId)return;let r=this.getVolumeIndicatorState(t).signalStrength;if(r!==null)for(let o of this.state.localSignalStrengthChangeCallbacks)o(r)}getVolumeIndicatorState(t){return this.state.volumeIndicatorState.hasOwnProperty(t)||(this.state.volumeIndicatorState[t]=new aw.default),this.state.volumeIndicatorState[t]}stateIsEmpty(t){return t.volume===null&&t.muted===null&&t.signalStrength===null}onError(t){try{for(let e of this.state.fatalErrorCallbacks)e(t)}catch(e){try{console.error(t),console.error(e)}catch{}}}};ns.default=jh});var Ed=g(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.SessionStateControllerAction=void 0;var dw;(function(n){n[n.Connect=0]="Connect",n[n.FinishConnecting=1]="FinishConnecting",n[n.Update=2]="Update",n[n.FinishUpdating=3]="FinishUpdating",n[n.Reconnect=4]="Reconnect",n[n.Disconnect=5]="Disconnect",n[n.Fail=6]="Fail",n[n.FinishDisconnecting=7]="FinishDisconnecting"})(dw=Tr.SessionStateControllerAction||(Tr.SessionStateControllerAction={}));Tr.default=dw});var $h=g(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.SessionStateControllerDeferPriority=void 0;var cw;(function(n){n[n.DoNotDefer=0]="DoNotDefer",n[n.Low=1]="Low",n[n.Medium=2]="Medium",n[n.High=3]="High",n[n.VeryHigh=4]="VeryHigh"})(cw=kr.SessionStateControllerDeferPriority||(kr.SessionStateControllerDeferPriority={}));kr.default=cw});var Ad=g(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});Ir.SessionStateControllerState=void 0;var lw;(function(n){n[n.NotConnected=0]="NotConnected",n[n.Connecting=1]="Connecting",n[n.Connected=2]="Connected",n[n.Updating=3]="Updating",n[n.Disconnecting=4]="Disconnecting"})(lw=Ir.SessionStateControllerState||(Ir.SessionStateControllerState={}));Ir.default=lw});var Pd=g(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.SessionStateControllerTransitionResult=void 0;var uw;(function(n){n[n.Transitioned=0]="Transitioned",n[n.NoTransitionAvailable=1]="NoTransitionAvailable",n[n.DeferredTransition=2]="DeferredTransition",n[n.TransitionFailed=3]="TransitionFailed"})(uw=Cr.SessionStateControllerTransitionResult||(Cr.SessionStateControllerTransitionResult={}));Cr.default=uw});var Jh=g(Gh=>{"use strict";Object.defineProperty(Gh,"__esModule",{value:!0});var ue=Ed(),Or=$h(),X=Ad(),rs=Pd(),Kh=class{constructor(t){this.logger=t,this.currentState=X.SessionStateControllerState.NotConnected,this.deferredAction=null,this.deferredWork=null}perform(t,e){let i=this.currentState;if(i===X.SessionStateControllerState.NotConnected&&t===ue.SessionStateControllerAction.Connect)this.transition(X.SessionStateControllerState.Connecting,t);else if(i===X.SessionStateControllerState.Connecting&&t===ue.SessionStateControllerAction.Fail)this.transition(X.SessionStateControllerState.Disconnecting,t);else if(i===X.SessionStateControllerState.Connecting&&t===ue.SessionStateControllerAction.FinishConnecting)this.transition(X.SessionStateControllerState.Connected,t);else if(i===X.SessionStateControllerState.Connected&&t===ue.SessionStateControllerAction.Disconnect)this.transition(X.SessionStateControllerState.Disconnecting,t);else if(i===X.SessionStateControllerState.Connected&&t===ue.SessionStateControllerAction.Reconnect)this.transition(X.SessionStateControllerState.Connecting,t);else if(i===X.SessionStateControllerState.Connected&&t===ue.SessionStateControllerAction.Fail)this.transition(X.SessionStateControllerState.Disconnecting,t);else if(i===X.SessionStateControllerState.Connected&&t===ue.SessionStateControllerAction.Update)this.transition(X.SessionStateControllerState.Updating,t);else if(i===X.SessionStateControllerState.Updating&&t===ue.SessionStateControllerAction.Fail)this.transition(X.SessionStateControllerState.Disconnecting,t);else if(i===X.SessionStateControllerState.Updating&&t===ue.SessionStateControllerAction.FinishUpdating)this.transition(X.SessionStateControllerState.Connected,t);else if(i===X.SessionStateControllerState.Disconnecting&&t===ue.SessionStateControllerAction.FinishDisconnecting)this.transition(X.SessionStateControllerState.NotConnected,t);else return this.canDefer(t)?(this.logger.info(`deferring transition from ${X.SessionStateControllerState[this.currentState]} with ${ue.SessionStateControllerAction[t]}`),this.deferAction(t,e),rs.SessionStateControllerTransitionResult.DeferredTransition):(this.logger.warn(`no transition found from ${X.SessionStateControllerState[this.currentState]} with ${ue.SessionStateControllerAction[t]}`),rs.SessionStateControllerTransitionResult.NoTransitionAvailable);try{e()}catch(r){return this.logger.error(`error during state ${X.SessionStateControllerState[this.currentState]} with action ${ue.SessionStateControllerAction[t]}: ${r}`),this.logger.info(`rolling back transition to ${X.SessionStateControllerState[i]}`),this.currentState=i,rs.SessionStateControllerTransitionResult.TransitionFailed}return this.performDeferredAction(),rs.SessionStateControllerTransitionResult.Transitioned}state(){return this.currentState}transition(t,e){this.logger.info(`transitioning from ${X.SessionStateControllerState[this.currentState]} to ${X.SessionStateControllerState[t]} with ${ue.SessionStateControllerAction[e]}`),this.currentState=t}deferPriority(t){switch(t){case ue.SessionStateControllerAction.Disconnect:return Or.SessionStateControllerDeferPriority.VeryHigh;case ue.SessionStateControllerAction.Fail:return Or.SessionStateControllerDeferPriority.High;case ue.SessionStateControllerAction.Reconnect:return Or.SessionStateControllerDeferPriority.Medium;case ue.SessionStateControllerAction.Update:return Or.SessionStateControllerDeferPriority.Low;default:return Or.SessionStateControllerDeferPriority.DoNotDefer}}deferAction(t,e){this.deferredAction!==null&&this.deferPriority(this.deferredAction)>this.deferPriority(t)||(this.deferredAction=t,this.deferredWork=e)}canDefer(t){return this.deferPriority(t)!==Or.SessionStateControllerDeferPriority.DoNotDefer&&(this.currentState===X.SessionStateControllerState.Connecting||this.currentState===X.SessionStateControllerState.Updating)}performDeferredAction(){if(!this.deferredAction)return;let t=this.deferredAction,e=this.deferredWork;this.deferredAction=null,this.deferredWork=null,this.logger.info(`performing deferred action ${ue.SessionStateControllerAction[t]}`),this.perform(t,e)!==rs.SessionStateControllerTransitionResult.Transitioned&&this.logger.info(`unable to perform deferred action ${ue.SessionStateControllerAction[t]} in state ${X.SessionStateControllerState[this.currentState]}`)}};Gh.default=Kh});var os=g(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.VideoQualityAdaptationPreference=void 0;var fw;(function(n){n[n.Balanced=0]="Balanced",n[n.MaintainFramerate=1]="MaintainFramerate",n[n.MaintainResolution=2]="MaintainResolution"})(fw=Er.VideoQualityAdaptationPreference||(Er.VideoQualityAdaptationPreference={}));Er.default=fw});var ss=g(Ar=>{"use strict";Object.defineProperty(Ar,"__esModule",{value:!0});Ar.WebSocketReadyState=void 0;var hw;(function(n){n[n.None=0]="None",n[n.Connecting=1]="Connecting",n[n.Open=2]="Open",n[n.Closing=3]="Closing",n[n.Closed=4]="Closed"})(hw=Ar.WebSocketReadyState||(Ar.WebSocketReadyState={}));Ar.default=hw});var ht=g(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.convertServerSideNetworkAdaptionEnumToSignaled=Fe.convertServerSideNetworkAdaptionEnumFromSignaled=Fe.serverSideNetworkAdaptionIsNoneOrDefault=Fe.ServerSideNetworkAdaption=void 0;var oi=oe(),Be;(function(n){n[n.Default=0]="Default",n[n.None=1]="None",n[n.BandwidthProbing=2]="BandwidthProbing",n[n.BandwidthProbingAndRemoteVideoQualityAdaption=3]="BandwidthProbingAndRemoteVideoQualityAdaption"})(Be=Fe.ServerSideNetworkAdaption||(Fe.ServerSideNetworkAdaption={}));Fe.default=Be;function FE(n){return n===Be.None||n===Be.Default}Fe.serverSideNetworkAdaptionIsNoneOrDefault=FE;function UE(n){switch(n){case oi.SdkServerSideNetworkAdaption.DEFAULT:return Be.Default;case oi.SdkServerSideNetworkAdaption.NONE:return Be.None;case oi.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING:return Be.BandwidthProbing;case oi.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION:return Be.BandwidthProbingAndRemoteVideoQualityAdaption}}Fe.convertServerSideNetworkAdaptionEnumFromSignaled=UE;function qE(n){switch(n){case Be.Default:return oi.SdkServerSideNetworkAdaption.DEFAULT;case Be.None:return oi.SdkServerSideNetworkAdaption.NONE;case Be.BandwidthProbing:return oi.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING;case Be.BandwidthProbingAndRemoteVideoQualityAdaption:return oi.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING_AND_VIDEO_QUALITY_ADAPTION}}Fe.convertServerSideNetworkAdaptionEnumToSignaled=qE});var Xh=g(as=>{"use strict";var HE=as&&as.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(as,"__esModule",{value:!0});var Md=HE(me()),Qh=class{constructor(t,e,i,r,o){this.client=t,this.type=e,this.message=i,this.closeCode=r,this.closeReason=o,this.timestampMs=Date.now()}isConnectionTerminated(){switch(this.type){case Md.default.WebSocketFailed:case Md.default.WebSocketError:case Md.default.WebSocketClosing:case Md.default.WebSocketClosed:return!0;default:return!1}}};as.default=Qh});var Yh=g(cs=>{"use strict";var Qi=cs&&cs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(cs,"__esModule",{value:!0});var jE=Qi(pe()),WE=Qi(Qn()),F=oe(),pw=ri(),mw=Qi(Je()),Zh=Qi(os()),ds=Qi(ss()),gw=ht(),Ue=Qi(Xh()),de=Qi(me()),Pr=class n{constructor(t,e){this.webSocket=t,this.logger=e,this.unloadHandler=null,this.closeEventHandler=i=>{this.deactivatePageUnloadHandler(),this.resetConnection(),this.sendEvent(new Ue.default(this,de.default.WebSocketClosed,null,i.code,i.reason)),this.serviceConnectionRequestQueue()},this.observerQueue=new Set,this.connectionRequestQueue=[],this.resetConnection(),this.logger.debug(()=>"signaling client init"),this.audioSessionId=this.generateNewAudioSessionId()}registerObserver(t){this.logger.debug(()=>"registering signaling client observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.debug(()=>"removing signaling client observer"),this.observerQueue.delete(t)}openConnection(t){this.logger.info("adding connection request to queue: "+t.url()),this.connectionRequestQueue.push(t),this.closeConnection()}pingPong(t){this.logger.debug(()=>"sending ping");let e=F.SdkSignalFrame.create();return e.type=F.SdkSignalFrame.Type.PING_PONG,e.pingPong=t,this.sendMessage(e),e.timestampMs}join(t){this.logger.info("sending join");let e=F.SdkJoinFrame.create();e.protocolVersion=2,e.flags=F.SdkJoinFlags.HAS_STREAM_UPDATE;let i=new jE.default,r={platformName:i.name(),platformVersion:i.version(),clientSource:mw.default.sdkName,chimeSdkVersion:mw.default.sdkVersion,clientUtcOffset:pw.getFormattedOffset(new Date().getTimezoneOffset())};if(t.applicationMetadata){let{appName:s,appVersion:d}=t.applicationMetadata;r.appName=s,r.appVersion=d}e.clientDetails=F.SdkClientDetails.create(r),e.audioSessionId=this.audioSessionId,e.wantsCompressedSdp=n.CLIENT_SUPPORTS_COMPRESSION,e.disablePeriodicKeyframeRequestOnContentSender=t.disablePeriodicKeyframeRequestOnContentSender,e.serverSideNetworkAdaption=gw.convertServerSideNetworkAdaptionEnumToSignaled(t.serverSideNetworkAdaption),e.supportedServerSideNetworkAdaptions=t.supportedServerSideNetworkAdaptions.map(gw.convertServerSideNetworkAdaptionEnumToSignaled),e.wantsAllTemporalLayersInIndex=t.wantsAllTemporalLayersInIndex;let o=F.SdkSignalFrame.create();o.type=F.SdkSignalFrame.Type.JOIN,o.join=e,this.sendMessage(o)}subscribe(t){let e=F.SdkSubscribeFrame.create();if(e.sendStreams=[],e.sdpOffer=t.sdpOffer,t.connectionTypeHasVideo&&(e.receiveStreamIds=t.receiveStreamIds),t.audioHost&&(e.audioCheckin=t.audioCheckin,e.audioHost=t.audioHost,e.audioMuted=t.audioMuted,!t.audioCheckin)){let r=F.SdkStreamDescriptor.create();r.mediaType=F.SdkStreamMediaType.AUDIO,r.trackLabel="AmazonChimeExpressAudio",r.attendeeId=t.attendeeId,r.streamId=1,r.groupId=1,r.framerate=15,r.maxBitrateKbps=600,r.avgBitrateBps=4e5,e.sendStreams.push(r)}if(e.compressedSdpOffer=t.compressedSdpOffer,e.duplex=F.SdkStreamServiceType.RX,t.localVideoEnabled){e.duplex=F.SdkStreamServiceType.DUPLEX;for(let r=0;r<t.videoStreamDescriptions.length;r++){let o=t.videoStreamDescriptions[r].clone();o.attendeeId=t.attendeeId,e.sendStreams.push(o.toStreamDescriptor())}}t.videoSubscriptionConfiguration.length>0&&(e.videoSubscriptionConfiguration=t.videoSubscriptionConfiguration.map(this.convertSignalingClientVideoSubscriptionConfiguration));let i=F.SdkSignalFrame.create();i.type=F.SdkSignalFrame.Type.SUBSCRIBE,i.sub=e,this.sendMessage(i)}remoteVideoUpdate(t,e){let i=F.SdkRemoteVideoUpdateFrame.create();i.addedOrUpdatedVideoSubscriptions=t.map(this.convertSignalingClientVideoSubscriptionConfiguration),i.removedVideoSubscriptionMids=e;let r=F.SdkSignalFrame.create();r.type=F.SdkSignalFrame.Type.REMOTE_VIDEO_UPDATE,r.remoteVideoUpdate=i,this.sendMessage(r)}convertSignalingClientVideoSubscriptionConfiguration(t){let e=new F.SdkVideoSubscriptionConfiguration;switch(e.mid=t.mid,e.attendeeId=t.attendeeId,e.streamId=t.streamId,e.groupId=t.groupId,e.priority=t.priority,e.targetBitrateKbps=t.targetBitrateKbps,t.qualityAdaptationPreference){case Zh.default.Balanced:e.qualityAdaptationPreference=F.SdkVideoQualityAdaptationPreference.BALANCED;break;case Zh.default.MaintainFramerate:e.qualityAdaptationPreference=F.SdkVideoQualityAdaptationPreference.MAINTAIN_FRAMERATE;break;case Zh.default.MaintainResolution:e.qualityAdaptationPreference=F.SdkVideoQualityAdaptationPreference.MAINTAIN_RESOLUTION;break;default:e.qualityAdaptationPreference=F.SdkVideoQualityAdaptationPreference.BALANCED}return e}leave(){let t=F.SdkSignalFrame.create();t.type=F.SdkSignalFrame.Type.LEAVE,t.leave=F.SdkLeaveFrame.create(),this.sendMessage(t),this.logger.debug(()=>"sent leave")}sendClientMetrics(t){let e=F.SdkSignalFrame.create();e.type=F.SdkSignalFrame.Type.CLIENT_METRIC,e.clientMetric=t,this.sendMessage(e)}sendDataMessage(t){let e=F.SdkSignalFrame.create();e.type=F.SdkSignalFrame.Type.DATA_MESSAGE,e.dataMessage=t,this.sendMessage(e)}closeConnection(){var t,e;if(this.webSocket.readyState()!==ds.default.None&&this.webSocket.readyState()!==ds.default.Closed){this.isClosing=!0,this.sendEvent(new Ue.default(this,de.default.WebSocketClosing,null));let i=new WE.default(n.CLOSE_EVENT_TIMEOUT_MS),r=o=>{var s,d;(d=(s=this.webSocket).removeEventListener)===null||d===void 0||d.call(s,"close",r),i.stop(),this.closeEventHandler(o)};(e=(t=this.webSocket).removeEventListener)===null||e===void 0||e.call(t,"close",this.closeEventHandler),this.webSocket.addEventListener("close",r),i.start(()=>{r(new CloseEvent("close",{wasClean:!1,code:1005,reason:"",bubbles:!1}))}),this.webSocket.close(),this.deactivatePageUnloadHandler()}else this.logger.info("no existing signaling client connection needs closing"),this.serviceConnectionRequestQueue()}ready(){return this.webSocket.readyState()===ds.default.Open&&!this.isClosing&&this.wasOpened}mute(t){let e=F.SdkSignalFrame.create();e.type=F.SdkSignalFrame.Type.AUDIO_CONTROL;let i=F.SdkAudioControlFrame.create();i.muted=t,e.audioControl=i,this.sendMessage(e)}pause(t){let e=F.SdkSignalFrame.create();e.type=F.SdkSignalFrame.Type.PAUSE,e.pause=F.SdkPauseResumeFrame.create(),e.pause.streamIds=t,this.sendMessage(e)}resume(t){let e=F.SdkSignalFrame.create();e.type=F.SdkSignalFrame.Type.RESUME,e.pause=F.SdkPauseResumeFrame.create(),e.pause.streamIds=t,this.sendMessage(e)}resetConnection(){this.webSocket.destroy(),this.wasOpened=!1}sendMessage(t){t.timestampMs=Date.now(),this.logger.debug(()=>`sending: ${JSON.stringify(t)}`);let e=this.prependWithFrameTypeRTC(F.SdkSignalFrame.encode(t).finish());if(this.ready()){if(!this.webSocket.send(e)){this.sendEvent(new Ue.default(this,de.default.WebSocketSendMessageFailure,null));return}this.sendEvent(new Ue.default(this,de.default.WebSocketSentMessage,null))}else this.sendEvent(new Ue.default(this,de.default.WebSocketSkippedMessage,null))}receiveMessage(t){let e;try{e=F.SdkSignalFrame.decode(t)}catch{this.logger.info(`failed to decode: ${t}`),this.sendEvent(new Ue.default(this,de.default.ProtocolDecodeFailure,null));return}this.logger.debug(()=>`received: ${JSON.stringify(e)}`),this.webSocket.readyState()===ds.default.Open?this.sendEvent(new Ue.default(this,de.default.ReceivedSignalFrame,e)):this.logger.info(`skipping notification of message since WebSocket is not open: ${JSON.stringify(e)}`)}stripFrameTypeRTC(t){let e=t[0];return e!==n.FRAME_TYPE_RTC&&e!==2&&this.logger.warn(`expected FrameTypeRTC for message but got ${e}`),t.slice(1)}prependWithFrameTypeRTC(t){let e=new Uint8Array(t.length+1);return e[0]=n.FRAME_TYPE_RTC,e.set(t,1),e}serviceConnectionRequestQueue(){if(this.connectionRequestQueue.length===0){this.logger.info("no connection requests to service");return}let t=this.connectionRequestQueue.shift();this.logger.info(`opening connection to ${t.url()}`),this.isClosing=!1,this.webSocket.create(t.url(),t.protocols()),this.setUpEventListeners(),this.sendEvent(new Ue.default(this,de.default.WebSocketConnecting,null))}sendEvent(t){switch(t.type){case de.default.WebSocketMessage:case de.default.ReceivedSignalFrame:case de.default.WebSocketSentMessage:this.logger.debug(()=>`notifying event: ${de.default[t.type]}`);break;case de.default.WebSocketSkippedMessage:this.logger.debug(()=>`notifying event: ${de.default[t.type]}, websocket state=${ds.default[this.webSocket.readyState()]}`);break;case de.default.WebSocketClosed:this.logger.info(`notifying event: ${de.default[t.type]}, 
              code: ${t.closeCode} reason: ${t.closeReason}`);break;default:this.logger.info(`notifying event: ${de.default[t.type]}`);break}for(let e of this.observerQueue)e.handleSignalingClientEvent(t)}setUpEventListeners(){this.webSocket.addEventListener("open",()=>{this.activatePageUnloadHandler(),this.wasOpened=!0,this.sendEvent(new Ue.default(this,de.default.WebSocketOpen,null))}),this.webSocket.addEventListener("message",t=>{this.sendEvent(new Ue.default(this,de.default.WebSocketMessage,null)),this.receiveMessage(this.stripFrameTypeRTC(new Uint8Array(t.data)))}),this.webSocket.addEventListener("close",this.closeEventHandler),this.webSocket.addEventListener("error",()=>{if(this.isClosing&&!this.wasOpened){this.logger.info("Signaling WebSocket ignoring error closing while connecting");return}this.wasOpened?(this.logger.error("Signaling WebSocket received error while connected"),this.sendEvent(new Ue.default(this,de.default.WebSocketError,null))):(this.logger.error("Signaling WebSocket received error while connecting"),this.sendEvent(new Ue.default(this,de.default.WebSocketFailed,null)))})}activatePageUnloadHandler(){this.unloadHandler=()=>{this.leave()};let t=global;t.window&&t.window.addEventListener&&window.addEventListener("unload",this.unloadHandler)}deactivatePageUnloadHandler(){let t=global;t.window&&t.window.removeEventListener&&window.removeEventListener("unload",this.unloadHandler),this.unloadHandler=null}generateNewAudioSessionId(){let t=new Uint32Array(1);return pw.getRandomValues(t),t[0]}promoteToPrimaryMeeting(t){let e=F.SdkMeetingSessionCredentials.create();e.attendeeId=t.attendeeId,e.externalUserId=t.externalUserId,e.joinToken=t.joinToken;let i=F.SdkPrimaryMeetingJoinFrame.create();i.credentials=e;let r=F.SdkSignalFrame.create();r.type=F.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN,r.primaryMeetingJoin=i,this.sendMessage(r)}demoteFromPrimaryMeeting(){let t=F.SdkPrimaryMeetingLeaveFrame.create(),e=F.SdkSignalFrame.create();e.type=F.SdkSignalFrame.Type.PRIMARY_MEETING_LEAVE,e.primaryMeetingLeave=t,this.sendMessage(e)}};cs.default=Pr;Pr.FRAME_TYPE_RTC=5;Pr.CLOSE_EVENT_TIMEOUT_MS=2e3;Pr.CLIENT_SUPPORTS_COMPRESSION=!0});var Rd=g(tp=>{"use strict";Object.defineProperty(tp,"__esModule",{value:!0});var ep=class{equals(t){return t!==void 0&&this.mid===t.mid&&this.attendeeId===t.attendeeId&&this.streamId===t.streamId&&this.groupId===t.groupId&&this.priority===t.priority&&this.targetBitrateKbps===t.targetBitrateKbps&&this.qualityAdaptationPreference===t.qualityAdaptationPreference}};tp.default=ep});var Dd=g(np=>{"use strict";Object.defineProperty(np,"__esModule",{value:!0});var ip=class{constructor(){this.currentTimestampMs=0,this.ssrc=0,this.totalAudioPacketsLost=0,this.totalAudioPacketsExpected=0,this.totalAudioPacketsRecoveredRed=0,this.totalAudioPacketsRecoveredFec=0}};np.default=ip});var sp=g(op=>{"use strict";Object.defineProperty(op,"__esModule",{value:!0});var rp=class{constructor(){this.previousMetrics={},this.currentMetrics={},this.currentStringMetrics={},this.previousObjectMetrics={},this.currentObjectMetrics={}}};op.default=rp});var ap=g(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.MeetingSessionLifecycleEvent=void 0;var vw;(function(n){n[n.Connecting=0]="Connecting",n[n.Started=1]="Started",n[n.Stopped=2]="Stopped"})(vw=Mr.MeetingSessionLifecycleEvent||(Mr.MeetingSessionLifecycleEvent={}));Mr.default=vw});var dp=g(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.MeetingSessionLifecycleEventCondition=void 0;var Sw;(function(n){n[n.ConnectingNew=0]="ConnectingNew",n[n.ReconnectingExisting=1]="ReconnectingExisting",n[n.StartedNew=2]="StartedNew",n[n.StartedExisting=3]="StartedExisting",n[n.StartedAfterReconnect=4]="StartedAfterReconnect",n[n.StoppedCleanly=5]="StoppedCleanly",n[n.StoppedWithFailure=6]="StoppedWithFailure"})(Sw=Rr.MeetingSessionLifecycleEventCondition||(Rr.MeetingSessionLifecycleEventCondition={}));Rr.default=Sw});var bw=g(Yi=>{"use strict";var yw=Yi&&Yi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},pt=Yi&&Yi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Yi,"__esModule",{value:!0});var zE=pt(zu()),Xi=pt(fr()),si=pt(pr()),$E=pt(Dd()),KE=pt(sp()),GE=pt(ap()),JE=pt(dp()),QE=pt(Jt()),Zi=oe(),XE=Le(),ZE=pt(Ja()),YE=pt(Ka()),ls=class n{constructor(t,e,i=n.INTERVAL_MS){this.audioVideoController=t,this.logger=e,this.interval=i,this.intervalScheduler=null,this.redRecoveryMetricReport=new $E.default,this.lastRedRecoveryMetricReportConsumedTimestampMs=0,this.videoCodecDegradationHighEncodeCpuCount=0,this.videoCodecDegradationEncodeFailureCount=0,this.videoCodecDegradationConcurrentSendersCount=0,this.resolutionMap=new Map,this.metricsAddTime=(r,o,s)=>{},this.metricsLogEvent=(r,o)=>{}}toAttribute(t){return this.toSuffix(t).substring(1)}toSuffix(t){return t.toLowerCase()===t?`_${t}`:t.toUpperCase()===t?`_${t.toLowerCase()}`:t.replace(/([A-Z][a-z]+)/g,function(e){return`_${e}`}).replace(/([A-Z][A-Z]+)/g,function(e){return`_${e}`}).toLowerCase()}logLatency(t,e,i){let r=this.toSuffix(t);this.logEventTime("meeting"+r,e,i)}logStateTimeout(t,e){let i=this.toSuffix(t);this.logEvent("meeting_session_state_timeout",Object.assign(Object.assign({},e),{state:`state${i}`}))}logAudioEvent(t,e){let i="audio"+this.toSuffix(ZE.default[t]);this.logEvent(i,e)}logVideoEvent(t,e){let i="video"+this.toSuffix(YE.default[t]);this.logEvent(i,e)}logEventTime(t,e,i={}){let r=Object.assign(Object.assign({},i),{call_id:this.audioVideoController.configuration.meetingId,client_type:n.CLIENT_TYPE,metric_type:"latency"});this.logger.debug(()=>`[StatsCollector] ${t}: ${JSON.stringify(r)}`),this.metricsAddTime(t,e,r)}logMeetingSessionStatus(t){let e=`${t.statusCode()}`;this.logEvent(e);let i={status:e,status_code:`${t.statusCode()}`};this.logEvent("meeting_session_status",i),t.isTerminal()&&this.logEvent("meeting_session_stopped",i),t.isAudioConnectionFailure()&&this.logEvent("meeting_session_audio_failed",i),t.isFailure()&&this.logEvent("meeting_session_failed",i)}logLifecycleEvent(t,e){let i={lifecycle_event:`lifecycle${this.toSuffix(GE.default[t])}`,lifecycle_event_code:`${t}`,lifecycle_event_condition:`condition${this.toSuffix(JE.default[e])}`,lifecycle_event_condition_code:`${e}`};this.logEvent("meeting_session_lifecycle",i)}logEvent(t,e={}){let i=Object.assign(Object.assign({},e),{call_id:this.audioVideoController.configuration.meetingId,client_type:n.CLIENT_TYPE});this.logger.debug(()=>`[StatsCollector] ${t}: ${JSON.stringify(i)}`),this.metricsLogEvent(t,i)}start(t,e){return this.intervalScheduler?!1:(this.logger.info("Starting StatsCollector"),this.signalingClient=t,this.videoStreamIndex=e,this.clientMetricReport=new zE.default(this.logger,this.videoStreamIndex,this.audioVideoController.configuration.credentials.attendeeId),this.intervalScheduler=new QE.default(this.interval),this.intervalScheduler.start(()=>yw(this,void 0,void 0,function*(){yield this.getStatsWrapper()})),!0)}stop(){this.logger.info("Stopping StatsCollector"),this.intervalScheduler&&this.intervalScheduler.stop(),this.intervalScheduler=null}videoTileResolutionDidChange(t,e,i){this.resolutionMap.set(t,{width:e,height:i})}videoTileUnbound(t){this.resolutionMap.delete(t)}updateMetricValues(t,e){let i=e?this.clientMetricReport.streamMetricReports[Number(t.ssrc)]:this.clientMetricReport.globalMetricReport,r;if(e){let o=i.mediaType,s=i.direction;r=this.clientMetricReport.getMetricMap(o,s),o===si.default.VIDEO&&s===Xi.default.DOWNSTREAM&&this.addRenderResolutionToVideoDownstreamMetrics(i,t.ssrc)}else r=this.clientMetricReport.getMetricMap();for(let o in t)o in r&&(typeof t[o]=="number"?(i.previousMetrics[o]=i.currentMetrics[o],i.currentMetrics[o]=t[o]):typeof t[o]=="string"?i.currentStringMetrics[o]=t[o]:typeof t[o]=="object"?(i.previousObjectMetrics[o]=i.currentObjectMetrics[o]===void 0?t[o]:i.currentObjectMetrics[o],i.currentObjectMetrics[o]=t[o]):this.logger.error(`Unknown metric value type ${typeof t[o]} for metric ${o}`))}processRawMetricReports(t){this.clientMetricReport.currentSsrcs={};let e=Date.now();for(let i of t){if(this.isVideoSourceMetricReport(i))continue;let r=this.isStreamRawMetricReport(i);if(r){let o=this.clientMetricReport.streamMetricReports[Number(i.ssrc)];if(o)o.mediaType===si.default.VIDEO&&o.direction===Xi.default.UPSTREAM?o.streamId=this.videoStreamIndex.sendVideoStreamIdFromRid(i.rid):o.streamId=this.videoStreamIndex.streamIdForSSRC(Number(i.ssrc));else{let s=new KE.default;s.mediaType=this.getMediaType(i),s.direction=this.getDirectionType(i),s.mediaType===si.default.VIDEO&&s.direction===Xi.default.UPSTREAM?s.streamId=this.videoStreamIndex.sendVideoStreamIdFromRid(i.rid):this.videoStreamIndex.allStreams().empty()||(s.streamId=this.videoStreamIndex.streamIdForSSRC(Number(i.ssrc)),this.videoStreamIndex.groupIdForSSRC!==void 0&&(s.groupId=this.videoStreamIndex.groupIdForSSRC(Number(i.ssrc)))),this.clientMetricReport.streamMetricReports[Number(i.ssrc)]=s}this.clientMetricReport.currentSsrcs[Number(i.ssrc)]=1}this.updateMetricValues(i,r)}this.clientMetricReport.removeDestroyedSsrcs(),this.clientMetricReport.previousTimestampMs=this.clientMetricReport.currentTimestampMs,this.clientMetricReport.currentTimestampMs=e,this.clientMetricReport.print()}addStreamMetricDimensionFrames(t,e){let i=this.clientMetricReport.getStreamDimensionMap();for(let r in e.currentStringMetrics)if(r in i){let o=Zi.SdkStreamDimension.create();o.type=i[r];let s=Zi.SdkDimensionValue.create();s.stringValue=e.currentStringMetrics[r],o.value=s,t.dimensions.push(o)}}addMetricFrame(t,e,i,r){let o=i.type,s=i.transform,d=i.source,l=e.streamMetricFrames.length,c=e.streamMetricFrames[l-1];if(o){let a=Zi.SdkMetric.create();a.type=o,a.value=s(d||t,r),r?c.metrics.push(a):e.globalMetrics.push(a)}}addGlobalMetricsToProtobuf(t){let e=this.clientMetricReport.getMetricMap();for(let i in this.clientMetricReport.globalMetricReport.currentMetrics)this.addMetricFrame(i,t,e[i])}addStreamMetricsToProtobuf(t){for(let e in this.clientMetricReport.streamMetricReports){let i=this.clientMetricReport.streamMetricReports[e],r=Zi.SdkStreamMetricFrame.create();r.streamId=i.streamId,r.mediaType=i.mediaType===si.default.AUDIO?Zi.SdkStreamMediaType.AUDIO:Zi.SdkStreamMediaType.VIDEO,r.metrics=[],this.addStreamMetricDimensionFrames(r,i),t.streamMetricFrames.push(r);let o=this.clientMetricReport.getMetricMap(i.mediaType,i.direction);for(let s in o)this.hasMetricDependenciesInReport(s,i)&&this.addMetricFrame(s,t,o[s],Number(e))}}hasMetricDependenciesInReport(t,e){return t==="decoderLoss"&&e.currentMetrics.concealedSamples!==void 0&&e.currentMetrics.totalSamplesReceived!==void 0||t==="jitterBufferMs"&&e.currentMetrics.jitterBufferDelay!==void 0&&e.currentMetrics.jitterBufferEmittedCount!==void 0||t in e.currentMetrics||t in e.currentStringMetrics||t in e.currentObjectMetrics}makeClientMetricProtobuf(){let t=Zi.SdkClientMetricFrame.create();return t.globalMetrics=[],t.streamMetricFrames=[],this.addGlobalMetricsToProtobuf(t),this.addStreamMetricsToProtobuf(t),t}sendClientMetricProtobuf(t){this.signalingClient.sendClientMetrics(t)}isStreamRawMetricReport(t){return["inbound-rtp","inbound-rtp-red","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp"].includes(t.type)||this.isVideoSourceMetricReport(t)}getMediaType(t){return t.kind==="audio"?si.default.AUDIO:si.default.VIDEO}getDirectionType(t){let{type:e}=t;return e==="inbound-rtp"||e==="remote-outbound-rtp"||e==="inbound-rtp-red"?Xi.default.DOWNSTREAM:Xi.default.UPSTREAM}isValidStandardRawMetric(t){return t.type==="inbound-rtp"||t.type==="inbound-rtp-red"||t.type==="outbound-rtp"||t.type==="remote-inbound-rtp"||t.type==="remote-outbound-rtp"||t.type==="candidate-pair"&&t.state==="succeeded"||t.type==="media-source"}isValidSsrc(t){let e=!0;return this.isStreamRawMetricReport(t)&&this.getDirectionType(t)===Xi.default.DOWNSTREAM&&this.getMediaType(t)===si.default.VIDEO&&(e=this.videoStreamIndex.streamIdForSSRC(Number(t.ssrc))>0),e}isValidRawMetricReport(t){return this.isValidStandardRawMetric(t)&&this.isValidSsrc(t)}filterRawMetricReports(t){let e=[];for(let i of t)this.isValidRawMetricReport(i)&&e.push(i);return e}handleRawMetricReports(t){let e=this.filterRawMetricReports(t);this.logger.debug(()=>`Filtered raw metrics : ${JSON.stringify(e)}`);let i=[];this.maybeAddRedRecoveryMetrics(i);let r=this.getVideoUpstreamSsrcFromRawMetricReports(e);r!==null&&this.addVideoCodecDegradationMetrics(i,r),this.clientMetricReport.customStatsReports=i,e.push(...i),this.processRawMetricReports(e),this.updateVideoSourceMetrics(e);let o=this.makeClientMetricProtobuf();this.sendClientMetricProtobuf(o),this.audioVideoController.forEachObserver(s=>{XE.Maybe.of(s.metricsDidReceive).map(d=>d.bind(s)(this.clientMetricReport.clone()))})}getStatsWrapper(){return yw(this,void 0,void 0,function*(){if(!this.audioVideoController.rtcPeerConnection)return;let t=[];try{let e=yield this.audioVideoController.rtcPeerConnection.getStats();this.clientMetricReport.rtcStatsReport=e,e.forEach(i=>{t.push(i)}),this.handleRawMetricReports(t)}catch(e){this.logger.error(e.message)}})}overrideObservableMetric(t,e){this.clientMetricReport.overrideObservableMetric(t,e)}recoveryMetricsDidReceive(t){this.redRecoveryMetricReport=t}maybeAddRedRecoveryMetrics(t){this.redRecoveryMetricReport.currentTimestampMs!==this.lastRedRecoveryMetricReportConsumedTimestampMs&&(t.push({kind:"audio",type:"inbound-rtp-red",ssrc:this.redRecoveryMetricReport.ssrc,timestamp:this.redRecoveryMetricReport.currentTimestampMs,totalAudioPacketsLost:this.redRecoveryMetricReport.totalAudioPacketsLost,totalAudioPacketsExpected:this.redRecoveryMetricReport.totalAudioPacketsExpected,totalAudioPacketsRecoveredRed:this.redRecoveryMetricReport.totalAudioPacketsRecoveredRed,totalAudioPacketsRecoveredFec:this.redRecoveryMetricReport.totalAudioPacketsRecoveredFec}),this.lastRedRecoveryMetricReportConsumedTimestampMs=this.redRecoveryMetricReport.currentTimestampMs)}videoCodecDegradationHighEncodeCpuDidReceive(){this.videoCodecDegradationHighEncodeCpuCount+=1}videoCodecDegradationEncodeFailureDidReceive(){this.videoCodecDegradationEncodeFailureCount+=1}videoCodecDegradationConcurrentSendersDidReceive(){this.videoCodecDegradationConcurrentSendersCount+=1}addVideoCodecDegradationMetrics(t,e){t.push({kind:"video",type:"outbound-rtp",ssrc:e,timestamp:Date.now(),videoCodecDegradationHighEncodeCpu:this.videoCodecDegradationHighEncodeCpuCount,videoCodecDegradationEncodeFailure:this.videoCodecDegradationEncodeFailureCount,videoCodecDegradationConcurrentSenders:this.videoCodecDegradationConcurrentSendersCount}),this.videoCodecDegradationHighEncodeCpuCount=0,this.videoCodecDegradationEncodeFailureCount=0,this.videoCodecDegradationConcurrentSendersCount=0}getVideoUpstreamSsrcFromRawMetricReports(t){for(let e of t)if(this.isStreamRawMetricReport(e)&&this.getMediaType(e)===si.default.VIDEO&&this.getDirectionType(e)===Xi.default.UPSTREAM)return e.ssrc;return null}isVideoSourceMetricReport(t){return t.type==="media-source"&&t.kind==="video"}addRenderResolutionToVideoDownstreamMetrics(t,e){let i=this.videoStreamIndex.streamIdForSSRC(Number(e)),r=this.videoStreamIndex.attendeeIdForStreamId(i);if(i===void 0||r===""){this.logger.warn(`No attendee found for ssrc ${e}`);return}this.resolutionMap.has(r)&&(t.currentMetrics.videoRenderWidth=this.resolutionMap.get(r).width,t.currentMetrics.videoRenderHeight=this.resolutionMap.get(r).height)}updateVideoSourceMetrics(t){for(let e of t)if(this.isVideoSourceMetricReport(e)){let i=this.clientMetricReport.getVideoUpstreamSsrcs();if(i.length===0){this.logger.warn("No video upstream ssrcs found");return}for(let r of i)this.clientMetricReport.streamMetricReports[r].currentMetrics.videoInputWidth=e.width,this.clientMetricReport.streamMetricReports[r].currentMetrics.videoInputHeight=e.height}}};Yi.default=ls;ls.INTERVAL_MS=1e3;ls.CLIENT_TYPE="amazon-chime-sdk-js"});var lp=g(en=>{"use strict";var eA=en&&en.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},cp=en&&en.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(en,"__esModule",{value:!0});var tA=cp(tt()),xd=cp(Wi()),iA=cp(Z()),Vd=class n extends iA.default{constructor(t,e=n.CHROME_VPN_TIMEOUT_MS){super(t.logger),this.context=t,this.chromeVpnTimeoutMs=e,this.taskName="FinishGatheringICECandidatesTask"}removeEventListener(){this.context.peer&&(this.context.peer.removeEventListener("icecandidate",this.context.iceCandidateHandler),this.context.turnCredentials||this.context.peer.removeEventListener("icegatheringstatechange",this.context.iceGatheringStateEventHandler))}cancel(){let t;this.context.browserBehavior.requiresIceCandidateGatheringTimeoutWorkaround()&&this.chromeVpnTimeoutMs<this.context.meetingSessionConfiguration.connectionTimeoutMs&&Date.now()-this.startTimestampMs>this.chromeVpnTimeoutMs&&(t=new Error(`canceling ${this.name()} due to the meeting status code: ${tA.default.ICEGatheringTimeoutWorkaround}`)),this.cancelPromise&&(t=t||new Error(`canceling ${this.name()}`),this.cancelPromise(t),delete this.cancelPromise)}run(){return eA(this,void 0,void 0,function*(){if(this.context.peer||this.logAndThrow("session does not have peer connection; bypass ice gathering"),this.context.browserBehavior.requiresCheckForSdpConnectionAttributes()){if(new xd.default(this.context.peer.localDescription.sdp).hasCandidatesForAllMLines()){this.context.logger.info(`ice gathering already complete; bypass gathering, current local description ${this.context.peer.localDescription.sdp}`);return}}else this.context.logger.info(`iOS device does not require checking for connection attributes in SDP, current local description ${this.context.peer.localDescription.sdp}`);if((this.context.browserBehavior.hasFirefoxWebRTC()||this.context.peer.iceGatheringState==="complete")&&new xd.default(this.context.peer.localDescription.sdp).hasCandidates()){this.context.logger.info("ice gathering state is complete and candidates are in SDP; bypass gathering");return}try{yield new Promise((t,e)=>{this.cancelPromise=i=>{this.removeEventListener(),e(i)},this.context.turnCredentials||(this.context.iceGatheringStateEventHandler=()=>{if(this.context.peer.iceGatheringState==="complete"){this.removeEventListener(),t(),delete this.cancelPromise;return}},this.context.peer.addEventListener("icegatheringstatechange",this.context.iceGatheringStateEventHandler)),this.context.iceCandidateHandler=i=>{if(this.context.logger.info(`ice candidate: ${i.candidate?i.candidate.candidate:"(null)"} state: ${this.context.peer.iceGatheringState}`),i.candidate&&(xd.default.isRTPCandidate(i.candidate.candidate)&&this.context.iceCandidates.push(i.candidate),this.context.turnCredentials&&this.context.iceCandidates.length>=1)){this.context.logger.info("gathered at least one relay candidate"),this.removeEventListener(),t(),delete this.cancelPromise;return}this.context.peer.iceGatheringState==="complete"&&(this.context.logger.info("done gathering ice candidates"),this.removeEventListener(),!new xd.default(this.context.peer.localDescription.sdp).hasCandidates()||this.context.iceCandidates.length===0?(e(new Error("no ice candidates were gathered")),delete this.cancelPromise):(t(),delete this.cancelPromise))},this.context.peer.addEventListener("icecandidate",this.context.iceCandidateHandler),this.startTimestampMs=Date.now()})}catch(t){throw t}finally{this.startTimestampMs&&(this.context.iceGatheringDurationMs=Math.round(Date.now()-this.startTimestampMs))}})}};en.default=Vd;Vd.CHROME_VPN_TIMEOUT_MS=5e3});var hp=g(fp=>{"use strict";Object.defineProperty(fp,"__esModule",{value:!0});var up=class{constructor(){this.username=null,this.password=null,this.ttl=null,this.uris=null}};fp.default=up});var mp=g(us=>{"use strict";var nA=us&&us.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(us,"__esModule",{value:!0});var rA=nA(ht()),pp=class{constructor(t){this.applicationMetadata=t,this.serverSideNetworkAdaption=rA.default.Default,this.supportedServerSideNetworkAdaptions=[],this.wantsAllTemporalLayersInIndex=!1,this.disablePeriodicKeyframeRequestOnContentSender=!1}};us.default=pp});var vp=g(Pe=>{"use strict";var oA=Pe&&Pe.__createBinding||(Object.create?(function(n,t,e,i){i===void 0&&(i=e),Object.defineProperty(n,i,{enumerable:!0,get:function(){return t[e]}})}):(function(n,t,e,i){i===void 0&&(i=e),n[i]=t[e]})),sA=Pe&&Pe.__setModuleDefault||(Object.create?(function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}):function(n,t){n.default=t}),aA=Pe&&Pe.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&oA(t,n,e);return sA(t,n),t},dA=Pe&&Pe.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Dr=Pe&&Pe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Pe,"__esModule",{value:!0});var _w=Dr(Gi()),Nd=Dr(tt()),cA=Dr(hp()),ww=aA(ht()),Tw=Dr(me()),lA=Dr(mp()),kw=oe(),uA=Dr(Z()),gp=class extends uA.default{constructor(t){super(t.logger),this.context=t,this.taskName="JoinAndReceiveIndexTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return dA(this,void 0,void 0,function*(){let t=yield new Promise((e,i)=>{let r=this.context;r.turnCredentials=null;class o{constructor(c){this.signalingClient=c}cancel(){this.signalingClient.removeObserver(this),i(new Error("JoinAndReceiveIndexTask got canceled while waiting for SdkIndexFrame"))}handleSignalingClientEvent(c){if(c.type===Tw.default.WebSocketClosed){let u=`The signaling connection was closed with code ${c.closeCode} and reason: ${c.closeReason}`;r.logger.warn(u);let p=Nd.default.SignalingBadRequest;c.closeCode===4410?(u="The meeting already ended.",r.logger.warn(u),p=Nd.default.MeetingEnded):c.closeCode>=4500&&c.closeCode<4600&&(p=Nd.default.SignalingInternalServerError),r.audioVideoController.handleMeetingSessionStatus(new _w.default(p),new Error(u));return}if(c.type!==Tw.default.ReceivedSignalFrame)return;if(c.message.type===kw.SdkSignalFrame.Type.JOIN_ACK){let u=c.message.joinack;if(!u){r.audioVideoController.handleMeetingSessionStatus(new _w.default(Nd.default.SignalingRequestFailed),new Error("Join ACK message did not include expected frame"));return}if(u.videoSubscriptionLimit&&(r.videoSubscriptionLimit=u.videoSubscriptionLimit),r.serverSupportsCompression=u.wantsCompressedSdp,u.defaultServerSideNetworkAdaption!==void 0&&u.defaultServerSideNetworkAdaption!==ww.default.Default&&r.videoDownlinkBandwidthPolicy.setServerSideNetworkAdaption!==void 0){let p=u.defaultServerSideNetworkAdaption;r.logger.info(`Overriding server side network adaption value to ${p}`),r.videoDownlinkBandwidthPolicy.setServerSideNetworkAdaption(ww.convertServerSideNetworkAdaptionEnumFromSignaled(p))}u&&u.turnCredentials?(r.turnCredentials=new cA.default,r.turnCredentials.username=u.turnCredentials.username,r.turnCredentials.password=u.turnCredentials.password,r.turnCredentials.ttl=u.turnCredentials.ttl,r.turnCredentials.uris=u.turnCredentials.uris.map(p=>r.meetingSessionConfiguration.urls.urlRewriter(p)).filter(p=>!!p)):r.logger.error("missing TURN credentials in JoinAckFrame");return}if(c.message.type!==kw.SdkSignalFrame.Type.INDEX)return;this.signalingClient.removeObserver(this);let a=c.message.index;e(a)}}let s=new o(this.context.signalingClient);this.context.signalingClient.registerObserver(s),this.taskCanceler=s,this.context.previousSdpAnswerAsString="",this.context.previousSdpOffer=null,this.context.serverSupportsCompression=!1;let d=new lA.default(this.context.meetingSessionConfiguration.applicationMetadata);this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&this.context.videoDownlinkBandwidthPolicy.supportedServerSideNetworkAdaptions!==void 0&&(d.serverSideNetworkAdaption=this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption(),d.supportedServerSideNetworkAdaptions=this.context.videoDownlinkBandwidthPolicy.supportedServerSideNetworkAdaptions()),this.context.videoDownlinkBandwidthPolicy.wantsAllTemporalLayersInIndex!==void 0&&(d.wantsAllTemporalLayersInIndex=this.context.videoDownlinkBandwidthPolicy.wantsAllTemporalLayersInIndex()),d.disablePeriodicKeyframeRequestOnContentSender=this.context.meetingSessionConfiguration.disablePeriodicKeyframeRequestOnContentSender,this.context.signalingClient.join(d)});this.context.logger.info(`received first index ${JSON.stringify(t)}`),this.context.indexFrame=t})}};Pe.default=gp});var yp=g(tn=>{"use strict";var fA=tn&&tn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Iw=tn&&tn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(tn,"__esModule",{value:!0});var hA=Iw(me()),pA=oe(),mA=Iw(Z()),Sp=class extends mA.default{constructor(t){super(t.logger),this.context=t,this.taskName="LeaveAndReceiveLeaveAckTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return fA(this,void 0,void 0,function*(){this.context.signalingClient.ready()&&(this.context.signalingClient.leave(),this.context.logger.info("sent leave"),yield this.receiveLeaveAck())})}receiveLeaveAck(){return new Promise((t,e)=>{class i{constructor(s,d){this.signalingClient=s,this.logger=d}cancel(){this.signalingClient.removeObserver(this),e(new Error("LeaveAndReceiveLeaveAckTask got canceled while waiting for IndexFrame"))}handleSignalingClientEvent(s){if(s.isConnectionTerminated()){this.signalingClient.removeObserver(this),this.logger.info("LeaveAndReceiveLeaveAckTask connection terminated"),t();return}s.type===hA.default.ReceivedSignalFrame&&s.message.type===pA.SdkSignalFrame.Type.LEAVE_ACK&&(this.signalingClient.removeObserver(this),this.logger.info("got leave ack"),t())}}let r=new i(this.context.signalingClient,this.context.logger);this.taskCanceler=r,this.context.signalingClient.registerObserver(r)})}};tn.default=Sp});var _p=g(nn=>{"use strict";var gA=nn&&nn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Ow=nn&&nn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(nn,"__esModule",{value:!0});var vA=Ow(me()),Cw=oe(),SA=Ow(Z()),bp=class extends SA.default{constructor(t){super(t.logger),this.context=t,this.taskName="ListenForVolumeIndicatorsTask",this.realtimeMuteAndUnmuteHandler=e=>{this.context.signalingClient.mute(e)}}run(){return gA(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.signalingClient.registerObserver(this),this.context.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(this.realtimeMuteAndUnmuteHandler)})}removeObserver(){this.context.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(this.realtimeMuteAndUnmuteHandler),this.context.signalingClient.removeObserver(this)}handleSignalingClientEvent(t){if(t.type===vA.default.ReceivedSignalFrame){if(t.message.type===Cw.SdkSignalFrame.Type.AUDIO_STREAM_ID_INFO){let e=t.message.audioStreamIdInfo;this.context.volumeIndicatorAdapter.sendRealtimeUpdatesForAudioStreamIdInfo(e)}else if(t.message.type===Cw.SdkSignalFrame.Type.AUDIO_METADATA){let e=t.message.audioMetadata;this.context.volumeIndicatorAdapter.sendRealtimeUpdatesForAudioMetadata(e)}}}};nn.default=bp});var Tp=g(fs=>{"use strict";var yA=fs&&fs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(fs,"__esModule",{value:!0});var bA=yA(zt()),wp=class n extends bA.default{constructor(t,e,i){super(e,i,"Reconnection Health"),this.logger=t,this.audioDelayPointsOverMaximum=0,n.CONNECTION_UNHEALTHY_THRESHOLD=e.connectionUnhealthyThreshold,n.CONNECTION_WAIT_TIME_MS=e.connectionWaitTimeMs,n.MISSED_PONGS_THRESHOLD=e.missedPongsUpperThreshold,n.MAXIMUM_AUDIO_DELAY_MS=e.maximumAudioDelayMs,n.MAXIMUM_AUDIO_DELAY_DATA_POINTS=e.maximumAudioDelayDataPoints}health(){if(this.currentData.isConnectionStartRecent(n.CONNECTION_WAIT_TIME_MS))return 1;let e=this.currentData.consecutiveStatsWithNoPackets>=n.CONNECTION_UNHEALTHY_THRESHOLD,i=this.currentData.consecutiveMissedPongs>=n.MISSED_PONGS_THRESHOLD;this.currentData.audioSpeakerDelayMs>n.MAXIMUM_AUDIO_DELAY_MS?this.audioDelayPointsOverMaximum+=1:this.audioDelayPointsOverMaximum=0;let r=this.audioDelayPointsOverMaximum>n.MAXIMUM_AUDIO_DELAY_DATA_POINTS;return r&&(this.audioDelayPointsOverMaximum=0),e||i||r?(this.logger.warn(`reconnection recommended due to: no packets received: ${e}, missed pongs: ${i}, bad audio delay: ${r}`),0):1}};fs.default=wp});var Ip=g(hs=>{"use strict";var _A=hs&&hs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(hs,"__esModule",{value:!0});var wA=_A(zt()),kp=class extends wA.default{constructor(t,e,i){super(e,i,"Sending Audio Health"),this.logger=t,this.sendingAudioFailureSamplesToConsider=e.sendingAudioFailureSamplesToConsider>0?e.sendingAudioFailureSamplesToConsider:1,this.sendingAudioFailureInitialWaitTimeMs=e.sendingAudioFailureInitialWaitTimeMs,this.maximumTimesToWarn=e.maximumTimesToWarn,this.coolDownTimeMs=e.cooldownTimeMs,this.lastWarnTimestampMs=0,this.warnCount=0}isSendingAudioUnhealthy(){let t=!this.currentData.isConnectionStartRecent(this.sendingAudioFailureInitialWaitTimeMs),e=this.currentData.consecutiveStatsWithNoAudioPacketsSent>=this.sendingAudioFailureSamplesToConsider;return t&&e}health(){if(this.isSendingAudioUnhealthy()){let t=Date.now()-this.lastWarnTimestampMs<this.coolDownTimeMs;return this.currentHealth>this.minimumHealth()&&!t?(this.logger.warn(`Sending Audio is unhealthy for ${this.sendingAudioFailureSamplesToConsider} seconds consecutively.`),this.warnCount++,this.warnCount>this.maximumTimesToWarn?(this.logger.warn("SendingAudioFailure health policy maximum warnings breached. Falling back to reporting healthy."),this.maximumHealth()):(this.lastWarnTimestampMs=Date.now(),this.minimumHealth())):this.currentHealth}return this.maximumHealth()}};hs.default=kp});var Op=g(ps=>{"use strict";var TA=ps&&ps.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ps,"__esModule",{value:!0});var kA=TA(zt()),Cp=class extends kA.default{constructor(t,e){super(t,e,"Unusable Audio Warning"),this.coolDownTimeMs=t.cooldownTimeMs,this.pastSamplesToConsider=t.pastSamplesToConsider,this.fractionalLoss=t.fractionalLoss,this.packetsExpected=t.packetsExpected,this.maximumTimesToWarn=t.maximumTimesToWarn,this.lastWarnTimestampMs=0,this.warnCount=0}calculateFractionalLoss(){if(this.currentData.packetsReceivedInLastMinute.length<this.pastSamplesToConsider)return 0;let t=this.pastSamplesToConsider,e=t*this.packetsExpected,i=0;for(let r=0;r<t;r++)i+=this.currentData.packetsReceivedInLastMinute[r];return Math.min(Math.max(1-i/e,0),1)}health(){return Date.now()-this.lastWarnTimestampMs<this.coolDownTimeMs?this.currentHealth:this.calculateFractionalLoss()>=this.fractionalLoss?this.currentHealth!==0&&(this.lastWarnTimestampMs=Date.now(),this.warnCount++,this.warnCount>this.maximumTimesToWarn)?1:0:1}};ps.default=Cp});var Pp=g(rn=>{"use strict";var IA=rn&&rn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},qe=rn&&rn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(rn,"__esModule",{value:!0});var CA=qe(fr()),OA=qe(pr()),EA=qe(Tp()),AA=qe(Ip()),PA=qe(Op()),Ep=qe(gr()),Ld=qe(Gi()),ms=qe(tt()),Ew=qe(ji()),xr=qe(me()),gs=oe(),Aw=qe(Ja()),vs=Le(),MA=qe(Z()),Ap=class extends MA.default{constructor(t,e,i){super(t.logger),this.context=t,this.initialConnectionHealthData=i,this.taskName="MonitorTask",this.prevSignalStrength=1,this.currentAvailableStreamAvgBitrates=null,this.hasSignalingError=!1,this.presenceHandlerCalled=!1,this.isResubscribeCheckPaused=!1,this.pendingMetricsReport=void 0,this.videoEncodingHealthPolicies=[],this.checkAndSendWeakSignalEvent=r=>{let o=r<1,s=this.prevSignalStrength<1,d=o?s?null:Aw.default.RedmicStartLoss:s?Aw.default.RedmicEndLoss:null;d&&this.context.statsCollector.logAudioEvent(d),this.prevSignalStrength=r},this.realtimeFatalErrorCallback=r=>{this.logger.error(`realtime error: ${r}: ${r.stack}`),this.context.audioVideoController.handleMeetingSessionStatus(new Ld.default(ms.default.RealtimeApiFailed),r)},this.realtimeAttendeeIdPresenceHandler=(r,o)=>{var s;let d=this.context.meetingSessionConfiguration.credentials.attendeeId;this.logger.info(`attendeePresenceReceived: ${d}`),d===r&&o&&!this.presenceHandlerCalled&&(this.presenceHandlerCalled=!0,this.context.attendeePresenceDurationMs=Date.now()-this.context.startAudioVideoTimestamp,(s=this.context.eventController)===null||s===void 0||s.publishEvent("attendeePresenceReceived",{attendeePresenceDurationMs:this.context.attendeePresenceDurationMs}))},this.generateBaseAudioVideoEventAttributes=()=>{let{signalingOpenDurationMs:r,startTimeMs:o,iceGatheringDurationMs:s,attendeePresenceDurationMs:d,meetingStartDurationMs:l}=this.context;return{meetingDurationMs:o===null?0:Math.round(Date.now()-o),signalingOpenDurationMs:r,iceGatheringDurationMs:s,attendeePresenceDurationMs:d,meetingStartDurationMs:l}},this.generateAudioVideoEventAttributesForReceivingAudioDropped=()=>{let r=this.generateBaseAudioVideoEventAttributes();return Object.assign(Object.assign({},r),{maxVideoTileCount:this.context.maxVideoTileCount,poorConnectionCount:this.context.poorConnectionCount})},this.reconnectionHealthPolicy=new EA.default(t.logger,Object.assign({},e),this.initialConnectionHealthData.clone()),this.unusableAudioWarningHealthPolicy=new PA.default(Object.assign({},e),this.initialConnectionHealthData.clone()),this.sendingAudioFailureHealthPolicy=new AA.default(t.logger,Object.assign({},e),this.initialConnectionHealthData.clone());for(let r of e.videoEncodingHealthPolicies)this.videoEncodingHealthPolicies.push(new r(Object.assign({},e),this.initialConnectionHealthData.clone()))}removeObserver(){this.context.audioVideoController.removeObserver(this),this.context.realtimeController.realtimeUnsubscribeToFatalError(this.realtimeFatalErrorCallback),this.context.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange(this.checkAndSendWeakSignalEvent),this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(this.realtimeAttendeeIdPresenceHandler),this.context.signalingClient.removeObserver(this)}run(){return IA(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.audioVideoController.addObserver(this),this.context.realtimeController.realtimeSubscribeToFatalError(this.realtimeFatalErrorCallback),this.context.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(this.checkAndSendWeakSignalEvent),this.context.realtimeController.realtimeSubscribeToAttendeeIdPresence(this.realtimeAttendeeIdPresenceHandler),this.context.connectionMonitor.start(),this.context.statsCollector.start(this.context.signalingClient,this.context.videoStreamIndex),this.context.signalingClient.registerObserver(this)})}pauseResubscribeCheck(){this.isResubscribeCheckPaused=!0}resumeResubscribeCheck(){this.isResubscribeCheckPaused&&(this.isResubscribeCheckPaused=!1,this.pendingMetricsReport&&(this.context.logger.info("Resuming resubscribe check with pending metrics report"),this.checkResubscribe(this.pendingMetricsReport)&&this.context.audioVideoController.update({needsRenegotiation:!1})))}videoTileDidUpdate(t){this.context.maxVideoTileCount=Math.max(this.context.maxVideoTileCount,this.context.videoTileController.getAllVideoTiles().length)}checkResubscribe(t){if(this.isResubscribeCheckPaused){this.context.logger.info("Resubscribe check is paused, setting incoming client metric report as pending"),this.pendingMetricsReport=t;return}else this.pendingMetricsReport=void 0;let e=t.getObservableMetrics(),i=e.availableOutgoingBitrate,r=e.nackCountReceivedPerSecond,o=!1;this.context.videoDownlinkBandwidthPolicy.updateMetrics(t);let s=this.context.videoDownlinkBandwidthPolicy.wantsResubscribe();if(o=o||s,s){let d=this.context.videoDownlinkBandwidthPolicy.chooseSubscriptions();this.context.videosToReceive=d.truncate(this.context.videoSubscriptionLimit),d.size()>this.context.videosToReceive.size()&&this.logger.warn(`Video receive limit exceeded. Limiting the videos to ${this.context.videosToReceive.size()}. Please consider using AllHighestVideoBandwidthPolicy or VideoPriorityBasedPolicy along with chooseRemoteVideoSources api to select the video sources to be displayed.`),this.logger.info(`trigger resubscribe for down=${s}; videosToReceive=[${this.context.videosToReceive.array()}]`)}if(this.context.videoTileController.hasStartedLocalVideoTile()){this.context.videoUplinkBandwidthPolicy.updateConnectionMetric({uplinkKbps:i/1e3,nackCountPerSecond:r});let d=this.context.videoUplinkBandwidthPolicy.wantsResubscribe();o=o||d,d&&(this.logger.info(`trigger resubscribe for up=${d}; videosToReceive=[${this.context.videosToReceive.array()}]`),this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters())}return o}metricsDidReceive(t){if(this.checkResubscribe(t)&&this.context.audioVideoController.update({needsRenegotiation:!1}),!this.currentAvailableStreamAvgBitrates)return;let e=t.streamMetricReports,i=new Map;for(let r in e)e[r].mediaType===OA.default.VIDEO&&e[r].direction===CA.default.DOWNSTREAM&&i.set(e[r].streamId,e[r])}connectionHealthDidChange(t){t.consecutiveMissedPongs===0&&this.context.reconnectController&&this.context.reconnectController.setLastActiveTimestampMs(Date.now()),this.applyHealthPolicy(this.reconnectionHealthPolicy,t,()=>{this.context.audioVideoController.handleMeetingSessionStatus(new Ld.default(ms.default.ConnectionHealthReconnect),null)}),this.applyHealthPolicy(this.unusableAudioWarningHealthPolicy,t,()=>{var e;this.context.poorConnectionCount+=1;let i=this.generateAudioVideoEventAttributesForReceivingAudioDropped();(e=this.context.eventController)===null||e===void 0||e.publishEvent("receivingAudioDropped",i),this.context.videoTileController.haveVideoTilesWithStreams()?this.context.audioVideoController.forEachObserver(r=>{vs.Maybe.of(r.connectionDidSuggestStopVideo).map(o=>o.bind(r)())}):this.context.audioVideoController.forEachObserver(r=>{vs.Maybe.of(r.connectionDidBecomePoor).map(o=>o.bind(r)())})},()=>{this.context.audioVideoController.forEachObserver(e=>{vs.Maybe.of(e.connectionDidBecomeGood).map(i=>i.bind(e)())})});for(let e of this.videoEncodingHealthPolicies)this.applyHealthPolicy(e,t,()=>{switch(this.degradeVideoCodec(e.name),e.name){case Ep.default.VideoEncodingCpuHealth:this.context.statsCollector.videoCodecDegradationHighEncodeCpuDidReceive();break;case Ep.default.VideoEncodingFramerateHealth:this.context.statsCollector.videoCodecDegradationEncodeFailureDidReceive();break;case Ep.default.VideoConcurrentSendersHealth:this.context.statsCollector.videoCodecDegradationConcurrentSendersDidReceive();break}});this.context.isSessionConnected&&this.applyHealthPolicy(this.sendingAudioFailureHealthPolicy,t,()=>{var e;let i=this.generateBaseAudioVideoEventAttributes();(e=this.context.eventController)===null||e===void 0||e.publishEvent("sendingAudioFailed",i)},()=>{var e;let i=this.generateBaseAudioVideoEventAttributes();(e=this.context.eventController)===null||e===void 0||e.publishEvent("sendingAudioRecovered",i)})}applyHealthPolicy(t,e,i,r){t.update(e);let o=t.healthIfChanged();o!==null&&(this.logger.info(`${t.name} value is now ${o}`),o<=t.minimumHealth()?vs.Maybe.of(i).map(s=>s.bind(this)()):vs.Maybe.of(r).map(s=>s.bind(this)()))}handleBitrateFrame(t){this.currentAvailableStreamAvgBitrates=t,t.serverAvailableOutgoingBitrate>0&&(this.logger.info(`Received server side estimation of available incoming bitrate ${t.serverAvailableOutgoingBitrate}kbps`),this.context.statsCollector.overrideObservableMetric("availableIncomingBitrate",t.serverAvailableOutgoingBitrate*1e3))}handleSignalingClientEvent(t){var e;if(t.type===xr.default.WebSocketClosed&&this.isUnexpectedWebsocketCloseCode(t.closeCode)||t.type===xr.default.WebSocketError||t.type===xr.default.WebSocketFailed){if(t.type===xr.default.WebSocketClosed&&this.context.logger.info(`The signaling connection was closed with code ${t.closeCode} and reason: ${t.closeReason}`),!this.hasSignalingError){let i=this.generateAudioVideoEventAttributesForReceivingAudioDropped();(e=this.context.eventController)===null||e===void 0||e.publishEvent("signalingDropped",i),this.hasSignalingError=!0}this.context.isSessionConnected&&this.context.audioVideoController.handleMeetingSessionStatus(new Ld.default(this.isInternalServerFailureCloseCode(t.closeCode)?ms.default.SignalingInternalServerError:ms.default.SignalingChannelClosedUnexpectedly),null)}else t.type===xr.default.WebSocketOpen&&(this.hasSignalingError=!1);if(t.type===xr.default.ReceivedSignalFrame){if(t.message.type===gs.SdkSignalFrame.Type.NOTIFICATION){switch(t.message.notification.level){case gs.SdkNotificationFrame.NotificationLevel.INFO:this.logger.info(`Received notification from server: ${t.message.notification.message}`);break;case gs.SdkNotificationFrame.NotificationLevel.WARNING:this.logger.warn(`Received warning from server: ${t.message.notification.message}`);break;case gs.SdkNotificationFrame.NotificationLevel.ERROR:this.logger.error(`Received error from server: ${t.message.notification.message}`);break;default:this.logger.error(`Received notification from server with unknown level ${t.message.notification.level}: ${t.message.notification.message}`);break}return}if(t.message.bitrates){let r=t.message.bitrates;this.context.videoStreamIndex.integrateBitratesFrame(r),this.context.videoDownlinkBandwidthPolicy.updateIndex(this.context.videoStreamIndex),this.handleBitrateFrame(t.message.bitrates)}let i=Ld.default.fromSignalFrame(t.message);t.message.type!==gs.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN_ACK&&i.statusCode()!==ms.default.OK&&this.context.audioVideoController.handleMeetingSessionStatus(i,null)}}isUnexpectedWebsocketCloseCode(t){return t===1006||this.isInternalServerFailureCloseCode(t)}isInternalServerFailureCloseCode(t){return t>=4500&&t<4600}degradeVideoCodec(t){if(this.context.meetingSupportedVideoSendCodecPreferences!==void 0&&this.context.meetingSupportedVideoSendCodecPreferences.length>1&&!(this.context.meetingSupportedVideoSendCodecPreferences[0].equals(Ew.default.h264ConstrainedBaselineProfile())||this.context.meetingSupportedVideoSendCodecPreferences[0].equals(Ew.default.vp8()))){let e=[];for(let i of this.context.videoSendCodecPreferences)i.equals(this.context.meetingSupportedVideoSendCodecPreferences[0])||e.push(i);e.length>0?(this.context.logger.info(`Downgrading codec from ${this.context.meetingSupportedVideoSendCodecPreferences[0].codecName} to ${e[0].codecName} due to ${t}`),this.context.degradedVideoSendCodecs.push(this.context.meetingSupportedVideoSendCodecPreferences[0]),this.context.meetingSupportedVideoSendCodecPreferences=e,this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs&&this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs(this.context.meetingSupportedVideoSendCodecPreferences,this.context.videoSendCodecPreferences),this.context.audioVideoController.update({needsRenegotiation:!0})):this.context.logger.warn(`Degrading video codec failed since there is no alternative codec to select. Currently degraded codecs: ${this.context.degradedVideoSendCodecs.map(i=>i.codecName).join(",")}`)}}};rn.default=Ap});var Dp=g(Rp=>{"use strict";Object.defineProperty(Rp,"__esModule",{value:!0});var Mp=class{constructor(t,e){this.signalingURL=t,this.joinToken=e}url(){return this.signalingURL+"?X-Chime-Control-Protocol-Version=3&X-Amzn-Chime-Send-Close-On-Error=1"}protocols(){return["_aws_wt_session",this.joinToken]}};Rp.default=Mp});var Np=g(on=>{"use strict";var RA=on&&on.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Vp=on&&on.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(on,"__esModule",{value:!0});var DA=Vp(Dp()),Pw=Vp(me()),xA=Vp(Z()),xp=class extends xA.default{constructor(t){super(t.logger),this.context=t,this.taskName="OpenSignalingConnectionTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return RA(this,void 0,void 0,function*(){let t=this.context.meetingSessionConfiguration;this.context.signalingClient.openConnection(new DA.default(t.urls.signalingURL,t.credentials.joinToken));let e=Date.now();try{yield new Promise((i,r)=>{class o{constructor(l){this.signalingClient=l}cancel(){this.signalingClient.removeObserver(this),r(new Error("OpenSignalingConnectionTask got canceled while waiting to open signaling connection"))}handleSignalingClientEvent(l){switch(l.type){case Pw.default.WebSocketOpen:this.signalingClient.removeObserver(this),i();break;case Pw.default.WebSocketFailed:this.signalingClient.removeObserver(this),r(new Error("WebSocket connection failed"));break}}}let s=new o(this.context.signalingClient);this.context.signalingClient.registerObserver(s),this.taskCanceler=s})}catch(i){throw i}finally{this.context.signalingOpenDurationMs=Math.round(Date.now()-e),this.logger.info(`Opening signaling connection took ${this.context.signalingOpenDurationMs} ms`)}})}};on.default=xp});var Bp=g(sn=>{"use strict";var VA=sn&&sn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},NA=sn&&sn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(sn,"__esModule",{value:!0});var LA=NA(Z()),Lp=class extends LA.default{constructor(t,e,i){super(t),this.taskName=e,this.tasksToRunParallel=i;for(let r of i)r.setParent(this)}cancel(){for(let t of this.tasksToRunParallel)this.logger.info(`canceling parallel group task ${this.name()} subtask ${t.name()}`),t.cancel()}run(){return VA(this,void 0,void 0,function*(){let t=[];for(let i of this.tasksToRunParallel)this.logger.info(`parallel group task ${this.name()} running subtask ${i.name()}`),t.push(i.run());let e=[];for(let i=0;i<t.length;i++){try{yield t[i]}catch(r){e.push(`task ${this.tasksToRunParallel[i].name()} failed: ${r.message}`)}this.logger.info(`parallel group task ${this.name()} completed subtask ${this.tasksToRunParallel[i].name()}`)}if(e.length>0){let i=e.join(", ");this.logAndThrow(`parallel group task ${this.name()} failed for tasks: ${i}`)}this.logger.info(`parallel group task ${this.name()} completed`)})}};sn.default=Lp});var Up=g(dn=>{"use strict";var BA=dn&&dn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Mw=dn&&dn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(dn,"__esModule",{value:!0});var an=qp(),FA=Mw(me()),UA=oe(),qA=Mw(Z()),Fp=class extends qA.default{constructor(t,e,i){super(t.logger),this.context=t,this.credentials=e,this.completionCallback=i,this.taskName="PromoteToPrimaryMeetingTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return BA(this,void 0,void 0,function*(){this.context.signalingClient.ready()?(this.context.signalingClient.promoteToPrimaryMeeting(this.credentials),this.context.logger.info("Sent request to join primary meeting"),yield this.receivePrimaryMeetingJoinAck()):this.completionCallback(new an.MeetingSessionStatus(an.MeetingSessionStatusCode.SignalingRequestFailed))})}receivePrimaryMeetingJoinAck(){return new Promise((t,e)=>{class i{constructor(s,d,l){this.signalingClient=s,this.completionCallback=d,this.logger=l}cancel(){this.signalingClient.removeObserver(this),this.completionCallback(new an.MeetingSessionStatus(an.MeetingSessionStatusCode.SignalingRequestFailed)),t()}handleSignalingClientEvent(s){s.isConnectionTerminated()&&(this.signalingClient.removeObserver(this),this.logger.info("PromoteToPrimaryMeetingTask connection terminated"),this.completionCallback(new an.MeetingSessionStatus(an.MeetingSessionStatusCode.SignalingRequestFailed)),t()),s.type===FA.default.ReceivedSignalFrame&&s.message.type===UA.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN_ACK&&(this.signalingClient.removeObserver(this),this.logger.info("Got a primary meeting join ACK"),this.completionCallback(an.MeetingSessionStatus.fromSignalFrame(s.message)),t())}}let r=new i(this.context.signalingClient,this.completionCallback,this.context.logger);this.taskCanceler=r,this.context.signalingClient.registerObserver(r)})}};dn.default=Fp});var jp=g(cn=>{"use strict";var HA=cn&&cn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},jA=cn&&cn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(cn,"__esModule",{value:!0});var WA=jA(Z()),Hp=class extends WA.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveAudioInputTask"}run(){var t,e;return HA(this,void 0,void 0,function*(){if(!(!((e=(t=this.context.meetingSessionConfiguration)===null||t===void 0?void 0:t.urls)===null||e===void 0)&&e.audioHostURL)){this.context.logger.info("No audio connection: not acquiring audio input");return}if(this.context.activeAudioInput){this.context.logger.info("an active audio input exists");return}let i;try{i=yield this.context.mediaStreamBroker.acquireAudioInputStream()}catch{this.context.logger.warn("could not acquire audio input from current device")}i?this.context.activeAudioInput=i:this.context.logger.warn("an audio input is not available")})}};cn.default=Hp});var zp=g(ln=>{"use strict";var zA=ln&&ln.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Rw=ln&&ln.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ln,"__esModule",{value:!0});var $A=Rw(me()),Bd=oe(),KA=Rw(Z()),Wp=class extends KA.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveRemoteVideoPauseResume",this.serverPausedVideoTileIds=new Set}removeObserver(){this.context.signalingClient.removeObserver(this)}run(){return zA(this,void 0,void 0,function*(){this.context.signalingClient.registerObserver(this),this.context.removableObservers.push(this)})}updateSubscribedGroupdIds(t){let e=new Set;for(let i of t){let r=this.context.videoStreamIndex.attendeeIdForGroupId(i);if(r.length===0){this.logger.warn(`Could not find attendee ID for newly subscribed group ID ${i}`);continue}let o=this.context.videoTileController.getVideoTileForAttendeeId(r);o===void 0&&(this.logger.info(`No existing video tile for attendee ID ${r} with new group ID ${i}. Creating new one.`),o=this.context.videoTileController.addVideoTile(),o.bindVideoStream(r,!1,null,0,0,0,null)),e.add(o.id())}this.serverPausedVideoTileIds.forEach(i=>{e.has(i)||this.serverPausedVideoTileIds.delete(i)})}handleSignalingClientEvent(t){if(t.type!==$A.default.ReceivedSignalFrame||t.message.type!==Bd.SdkSignalFrame.Type.PAUSE&&t.message.type!==Bd.SdkSignalFrame.Type.RESUME)return;let e=t.message.pause,i=t.message.type;if(this.logger.info(`Received new ${i===Bd.SdkSignalFrame.Type.PAUSE?"pause":"resume"} frame: ${JSON.stringify(e)}`),!e||this.context.videoTileController.getVideoTileForAttendeeId===void 0||this.context.videoDownlinkBandwidthPolicy.forEachObserver===void 0||this.context.videoStreamIndex.attendeeIdForGroupId===void 0)return;let r=e.groupIds.map(o=>{let s=this.context.videoStreamIndex.attendeeIdForGroupId(o);if(s.length===0){this.logger.warn(`Could not find attendee ID for paused group ID ${o}`);return}return this.context.videoTileController.getVideoTileForAttendeeId(s)});for(let o of r)o!==void 0&&(i===Bd.SdkSignalFrame.Type.PAUSE?o.state().paused||(this.serverPausedVideoTileIds.add(o.id()),this.context.videoDownlinkBandwidthPolicy.forEachObserver(s=>{s.tileWillBePausedByDownlinkPolicy(o.id())}),o.pause()):o.state().paused&&this.serverPausedVideoTileIds.has(o.id())&&(this.serverPausedVideoTileIds.delete(o.id()),this.context.videoDownlinkBandwidthPolicy.forEachObserver(s=>{s.tileWillBeUnpausedByDownlinkPolicy(o.id())}),o.unpause()))}};ln.default=Wp});var Kp=g(un=>{"use strict";var Dw=un&&un.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Vw=un&&un.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(un,"__esModule",{value:!0});var xw=Vw(Xt()),Ss=oe(),GA=Vw(Z()),$p=class extends GA.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveVideoInputTask"}checkAndApplyVideoConstraint(t,e,i,r,o){return Dw(this,void 0,void 0,function*(){let s=t?this.context.meetingSessionConfiguration.meetingFeatures.contentMaxResolution:this.context.meetingSessionConfiguration.meetingFeatures.videoMaxResolution;if(!t&&i<=s.videoWidth&&r<=s.videoHeight&&o<=s.videoFrameRate)return;let d={resizeMode:{ideal:"none"},width:{max:s.videoWidth},height:{max:s.videoHeight},frameRate:{ideal:o,max:s.videoFrameRate}};try{yield e.applyConstraints(d)}catch{this.context.logger.info(`Could not apply constraint for video track (content = ${t})`)}})}run(){return Dw(this,void 0,void 0,function*(){let t=this.context.videoDuplexMode===Ss.SdkStreamServiceType.RX||this.context.videoDuplexMode===Ss.SdkStreamServiceType.DUPLEX;if(this.context.videoTileController.hasStartedLocalVideoTile()?this.context.videoDuplexMode=t?Ss.SdkStreamServiceType.DUPLEX:Ss.SdkStreamServiceType.TX:this.context.videoDuplexMode=t?Ss.SdkStreamServiceType.RX:0,this.context.videoCaptureAndEncodeParameter=this.context.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters(),!this.context.videoTileController.hasStartedLocalVideoTile()){this.context.logger.info("has not started local video tile"),this.context.activeVideoInput&&(this.context.activeVideoInput=void 0,this.context.videoStreamIndex.integrateUplinkPolicyDecision([]));return}let e=this.context.videoTileController.getLocalVideoTile(),i;try{i=yield this.context.mediaStreamBroker.acquireVideoInputStream()}catch{this.context.logger.warn("could not acquire video input from current device"),this.context.videoTileController.stopLocalVideoTile()}if(this.context.enableSimulcast){let r=this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters();this.context.videoStreamIndex.integrateUplinkPolicyDecision(Array.from(r.values()))}if(this.context.activeVideoInput=i,i){let r=i.getVideoTracks();if(!r||r.length===0)return;let o=this.context.meetingSessionConfiguration.credentials.attendeeId,s=new xw.default(o).hasModality(xw.default.MODALITY_CONTENT),d=r[0].getSettings();this.checkAndApplyVideoConstraint(s,r[0],d.width,d.height,d.frameRate);let l=this.context.audioVideoController.configuration.credentials.externalUserId;e.bindVideoStream(o,!0,i,d.width,d.height,null,l);for(let c of r)this.logger.info(`Using video device label=${c.label} id=${c.id}`),this.context.videoDeviceInformation.current_camera_name=c.label,this.context.videoDeviceInformation.current_camera_id=c.id}})}};un.default=$p});var Qp=g(fn=>{"use strict";var JA=fn&&fn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},ys=fn&&fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(fn,"__esModule",{value:!0});var QA=ys(Id()),Nw=ys(Xt()),XA=ys(ji()),ZA=ys(me()),Gp=oe(),Lw=Le(),YA=ys(Z()),Jp=class extends YA.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveVideoStreamIndexTask",this.isIngestionPaused=!1,this.pendingIndex=null}removeObserver(){this.context.signalingClient.removeObserver(this)}run(){return JA(this,void 0,void 0,function*(){this.handleIndexFrame(this.context.indexFrame),this.context.signalingClient.registerObserver(this),this.context.removableObservers.push(this)})}handleSignalingClientEvent(t){if(t.type!==ZA.default.ReceivedSignalFrame||t.message.type!==Gp.SdkSignalFrame.Type.INDEX)return;let e=t.message.index;this.context.logger.info(`received new index ${JSON.stringify(e)}`),this.handleIndexFrame(e)}pauseIngestion(){this.isIngestionPaused=!0}resumeIngestion(){this.isIngestionPaused&&(this.isIngestionPaused=!1,this.pendingIndex&&(this.context.logger.info("Resuming index ingestion with pending index"),this.handleIndexFrame(this.pendingIndex)))}handleIndexFrame(t){if(!t)return;if(this.isIngestionPaused){this.context.logger.info("Index ingestion is paused, setting most recent index as pending"),this.pendingIndex=t;return}else this.pendingIndex=null;let e=this.context.audioVideoController.configuration.credentials.attendeeId;t.sources=t.sources.filter(l=>{let c=new Nw.default(l.attendeeId);return!(c.base()===e&&c.hasModality(Nw.default.MODALITY_CONTENT))});let{videoStreamIndex:i,videoDownlinkBandwidthPolicy:r,videoUplinkBandwidthPolicy:o}=this.context,s=i.allVideoSendingSourcesExcludingSelf(e);i.integrateIndexFrame(t),r.updateIndex(i),o.updateIndex(i),this.resubscribe(r,o),this.updateVideoAvailability(t),this.handleIndexVideosPausedAtSource(),t.supportedReceiveCodecIntersection.length>0&&this.handleSupportedVideoReceiveCodecIntersection(t);let d=i.allVideoSendingSourcesExcludingSelf(e);this.areVideoSourcesEqual(s,d)||this.context.audioVideoController.forEachObserver(l=>{Lw.Maybe.of(l.remoteVideoSourcesDidChange).map(c=>c.bind(l)(d))})}areVideoSourcesEqual(t,e){if(t.length!==e.length)return!1;let i=(s,d)=>s.attendee.attendeeId.localeCompare(d.attendee.attendeeId),r=[...t].sort(i),o=[...e].sort(i);for(let s=0;s<r.length;s++)if(r[s].attendee.attendeeId!==o[s].attendee.attendeeId)return!1;return!0}resubscribe(t,e){let i=t.wantsResubscribe(),r=(this.context.videoDuplexMode===Gp.SdkStreamServiceType.TX||this.context.videoDuplexMode===Gp.SdkStreamServiceType.DUPLEX)&&e.wantsResubscribe(),o=i||r;if(this.logger.info(`should resubscribe: ${o} (downlink: ${i} uplink: ${r})`),!o)return;let s=t.chooseSubscriptions();this.context.videosToReceive=s.truncate(this.context.videoSubscriptionLimit),s.size()>this.context.videosToReceive.size()&&this.logger.warn(`Video receive limit exceeded. Limiting the videos to ${this.context.videosToReceive.size()}. Please consider using AllHighestVideoBandwidthPolicy or VideoPriorityBasedPolicy along with chooseRemoteVideoSources api to select the video sources to be displayed.`),this.context.videoCaptureAndEncodeParameter=e.chooseCaptureAndEncodeParameters(),this.logger.info(`trigger resubscribe for up=${r} down=${i}; videosToReceive=[${this.context.videosToReceive.array()}] captureParams=${JSON.stringify(this.context.videoCaptureAndEncodeParameter)}`),this.context.audioVideoController.update({needsRenegotiation:!1})}updateVideoAvailability(t){if(!this.context.videosToReceive){this.logger.error("videosToReceive must be set in the meeting context.");return}let e=new QA.default;e.remoteVideoAvailable=!this.context.videosToReceive.empty(),e.canStartLocalVideo=!t.atCapacity,(!this.context.lastKnownVideoAvailability||!this.context.lastKnownVideoAvailability.equal(e))&&(this.context.lastKnownVideoAvailability=e.clone(),this.context.audioVideoController.forEachObserver(i=>{Lw.Maybe.of(i.videoAvailabilityDidChange).map(r=>r.bind(i)(e.clone()))}))}handleSupportedVideoReceiveCodecIntersection(t){if(this.context.videoSendCodecPreferences===void 0)return;let e=[],i=!1;for(let r of this.context.videoSendCodecPreferences){if(this.context.degradedVideoSendCodecs.some(o=>r.equals(o))){this.logger.info(`Skipping ${r.codecName} since the codec has been identfied as degraded`);continue}for(let o of t.supportedReceiveCodecIntersection)if(r.equals(XA.default.fromSignaled(o))){e.push(r);break}}if(e.length>0){let r=e.find(o=>this.context.prioritizedSendVideoCodecCapabilities.some(s=>o.equals(s)));this.context.currentVideoSendCodec!==void 0&&(r===void 0||!this.context.currentVideoSendCodec.equals(r))&&(i=!0),this.context.meetingSupportedVideoSendCodecPreferences=e}else this.logger.warn("Interesection of meeting receive codec support and send codec preferences has no overlap, falling back to just values provided in `setVideoCodecSendPreferences`"),this.context.meetingSupportedVideoSendCodecPreferences=void 0;this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs&&this.context.videoUplinkBandwidthPolicy.setMeetingSupportedVideoSendCodecs(this.context.meetingSupportedVideoSendCodecPreferences,this.context.videoSendCodecPreferences),i&&this.context.audioVideoController.update({needsRenegotiation:!0})}handleIndexVideosPausedAtSource(){let t=this.context.videoStreamIndex.streamsPausedAtSource();for(let e of this.context.videoTileController.getAllVideoTiles()){let i=e.state();t.contain(i.streamId)?e.markPoorConnection()&&this.logger.info(`marks the tile ${i.tileId} as having a poor connection`):e.unmarkPoorConnection()&&this.logger.info(`unmarks the tile ${i.tileId} as having a poor connection`)}}};fn.default=Jp});var Yp=g(hn=>{"use strict";var eP=hn&&hn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Zp=hn&&hn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(hn,"__esModule",{value:!0});var tP=Zp(sh()),iP=Zp(me()),Xp=oe(),nP=Zp(Z()),bs=class n extends nP.default{constructor(t){super(t.logger),this.context=t,this.taskName="SendAndReceiveDataMessagesTask",this.sendDataMessageHandler=(e,i,r)=>{if(this.context.signalingClient.ready()){let o;i instanceof Uint8Array?o=i:typeof i=="string"?o=new TextEncoder().encode(i):o=new TextEncoder().encode(JSON.stringify(i)),this.validateDataMessage(e,o,r);let s=Xp.SdkDataMessagePayload.create();s.topic=e,s.lifetimeMs=r,s.data=o;let d=Xp.SdkDataMessageFrame.create();d.messages=[s],this.context.signalingClient.sendDataMessage(d)}else this.context.logger.error("Cannot send data message because signaling client is not ready")}}run(){return eP(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.signalingClient.registerObserver(this),this.context.realtimeController.realtimeSubscribeToSendDataMessage(this.sendDataMessageHandler)})}removeObserver(){this.context.realtimeController.realtimeUnsubscribeFromSendDataMessage(this.sendDataMessageHandler),this.context.signalingClient.removeObserver(this)}handleSignalingClientEvent(t){if(t.type===iP.default.ReceivedSignalFrame&&t.message.type===Xp.SdkSignalFrame.Type.DATA_MESSAGE)for(let e of t.message.dataMessage.messages){let i=new tP.default(e.ingestTimeNs/1e6,e.topic,e.data,e.senderAttendeeId,e.senderExternalUserId,e.ingestTimeNs===0);this.context.realtimeController.realtimeReceiveDataMessage(i)}}validateDataMessage(t,e,i){if(!n.TOPIC_REGEX.test(t))throw new Error("Invalid topic");if(e.length>n.DATA_SIZE)throw new Error("Data size has to be less than 2048 bytes");if(i&&i<0)throw new Error("The life time of the message has to be non negative")}};hn.default=bs;bs.TOPIC_REGEX=new RegExp(/^[a-zA-Z0-9_-]{1,36}$/);bs.DATA_SIZE=2048});var tm=g(pn=>{"use strict";var rP=pn&&pn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Bw=pn&&pn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(pn,"__esModule",{value:!0});var oP=Bw(Z()),sP=Bw(Ga()),em=class extends oP.default{constructor(t,e,i){super(t),this.taskName=e,this.tasksToRunSerially=i,this.currentTask=null;for(let r of i)r.setParent(this)}cancel(){this.currentTask&&(this.logger.info(`canceling serial group task ${this.name()} subtask ${this.currentTask.name()}`),this.currentTask.cancel())}run(){return rP(this,void 0,void 0,function*(){for(let t of this.tasksToRunSerially){this.getStatus()===sP.default.CANCELED&&this.logAndThrow(`serial group task ${this.name()} was canceled`);try{this.logger.info(`serial group task ${this.name()} running subtask ${t.name()}`),this.currentTask=t,yield t.run(),this.logger.info(`serial group task ${this.name()} completed subtask ${t.name()}`)}catch(e){this.logAndThrow(`serial group task ${this.name()} was canceled due to subtask ${this.currentTask.name()} error: ${e.message}`)}finally{this.currentTask=null}}this.logger.info(`serial group task ${this.name()} completed`)})}};pn.default=em});var rm=g(mn=>{"use strict";var Fw=mn&&mn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},nm=mn&&mn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(mn,"__esModule",{value:!0});var aP=nm(pe()),ai=nm(Wi()),dP=nm(Z()),im=class extends dP.default{constructor(t){super(t.logger),this.context=t,this.taskName="SetLocalDescriptionTask"}cancel(){if(this.cancelPromise){let t=new Error(`canceling ${this.name()}`);this.cancelPromise(t),delete this.cancelPromise}}run(){return Fw(this,void 0,void 0,function*(){let t=this.context.peer,i=this.context.sdpOfferInit.sdp;if(this.context.browserBehavior.supportsVideoLayersAllocationRtpHeaderExtension()&&(i=new ai.default(i).withVideoLayersAllocationRtpHeaderExtension(this.context.previousSdpOffer).sdp),this.context.browserBehavior.supportsDependencyDescriptorRtpHeaderExtension()&&this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension!==void 0&&this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension()&&(i=new ai.default(i).withDependencyDescriptorRtpHeaderExtension(this.context.previousSdpOffer).sdp),new aP.default().requiresDisablingH264Encoding()&&(i=new ai.default(i).removeH264SupportFromSendSection().sdp),i=new ai.default(i).withStartingVideoSendBitrate(1e3).sdp,this.context.videoSendCodecPreferences!==void 0&&this.context.videoSendCodecPreferences.length>0&&(i=new ai.default(i).withVideoSendCodecPreferences(this.context.meetingSupportedVideoSendCodecPreferences!==void 0?this.context.meetingSupportedVideoSendCodecPreferences:this.context.videoSendCodecPreferences).sdp),this.context.audioProfile&&(i=new ai.default(i).withAudioMaxAverageBitrate(this.context.audioProfile.audioBitrateBps).sdp,this.context.audioProfile.isStereo()&&(i=new ai.default(i).withStereoAudio().sdp),this.context.audioProfile.hasRedundancyEnabled())){let o=new ai.default(i).getAudioPayloadTypes();this.context.transceiverController&&this.context.transceiverController.setAudioPayloadTypes&&this.context.transceiverController.setAudioPayloadTypes(o)}this.logger.debug(()=>`local description is >>>${i}<<<`);let r={type:"offer",sdp:i,toJSON:null};yield new Promise((o,s)=>Fw(this,void 0,void 0,function*(){this.cancelPromise=d=>{s(d)};try{yield t.setLocalDescription(r),o()}catch(d){s(d)}finally{delete this.cancelPromise}})),this.context.logger.info("set local description")})}};mn.default=im});var sm=g(gn=>{"use strict";var Uw=gn&&gn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Fd=gn&&gn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(gn,"__esModule",{value:!0});var qw=Fd(Xt()),_s=Fd(Wi()),cP=Fd(ji()),lP=Fd(Z()),om=class extends lP.default{constructor(t){super(t.logger),this.context=t,this.taskName="SetRemoteDescriptionTask"}cancel(){this.cancelICEPromise&&this.cancelICEPromise()}run(){var t;return Uw(this,void 0,void 0,function*(){this.context.peer||this.logAndThrow("session does not have peer connection; bypass set remote description");let i=this.context.sdpAnswer;i=new _s.default(i).withoutServerReflexiveCandidates().sdp,this.context.audioProfile&&(i=new _s.default(i).withAudioMaxAverageBitrate(this.context.audioProfile.audioBitrateBps).sdp,this.context.audioProfile.isStereo()&&(i=new _s.default(i).withStereoAudio().sdp)),this.context.videoSendCodecPreferences!==void 0&&this.context.videoSendCodecPreferences.length>0&&(i=new _s.default(i).withVideoSendCodecPreferences(this.context.meetingSupportedVideoSendCodecPreferences!==void 0?this.context.meetingSupportedVideoSendCodecPreferences:this.context.videoSendCodecPreferences).sdp),this.context.prioritizedSendVideoCodecCapabilities=new _s.default(i).prioritizedSendVideoCodecCapabilities(),this.context.currentVideoSendCodec=this.context.prioritizedSendVideoCodecCapabilities.length>0?this.context.prioritizedSendVideoCodecCapabilities[0]:void 0;let r=this.context.activeVideoInput;if(r!==void 0){let s=this.context.audioVideoController.configuration.credentials.attendeeId,d=new qw.default(s).hasModality(qw.default.MODALITY_CONTENT),l=r.getVideoTracks()[0];d&&(((t=this.context.currentVideoSendCodec)===null||t===void 0?void 0:t.codecName)===cP.default.av1Main().codecName?(l.contentHint="text",this.logger.info(`Setting content hint to text for AV1, attendee: ${s}`)):this.context.audioVideoController.configuration.enableSVC&&(l.contentHint="motion",this.logger.info(`Setting content hint to motion to enable SVC, attendee: ${s}`)))}this.logger.info(`processed remote description is >>>${i}<<<`);let o={type:"answer",sdp:i,toJSON:null};try{yield this.createICEConnectionCompletedPromise(o)}catch(s){throw s}})}createICEConnectionCompletedPromise(t){return new Promise((e,i)=>Uw(this,void 0,void 0,function*(){let r=()=>{(this.context.peer.iceConnectionState==="connected"||this.context.peer.iceConnectionState==="completed")&&(this.context.peer.removeEventListener("iceconnectionstatechange",r),e())};this.cancelICEPromise=()=>{this.context.peer&&this.context.peer.removeEventListener("iceconnectionstatechange",r),i(new Error(`${this.name()} got canceled while waiting for the ICE connection state`))},this.context.peer.addEventListener("iceconnectionstatechange",r);try{yield this.context.peer.setRemoteDescription(t),this.logger.info("set remote description, waiting for ICE connection"),r()}catch(o){i(o)}}))}};gn.default=om});var d0=g((Aq,Lr)=>{"use strict";function Nr(n){let t=n.length;for(;--t>=0;)n[t]=0}var uP=0,Kw=1,fP=2,hP=3,pP=258,hm=29,Os=256,Ts=Os+1+hm,Vr=30,pm=19,Gw=2*Ts+1,vn=15,am=16,mP=7,mm=256,Jw=16,Qw=17,Xw=18,um=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ud=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),gP=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Zw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vP=512,Rt=new Array((Ts+2)*2);Nr(Rt);var ws=new Array(Vr*2);Nr(ws);var ks=new Array(vP);Nr(ks);var Is=new Array(pP-hP+1);Nr(Is);var gm=new Array(hm);Nr(gm);var qd=new Array(Vr);Nr(qd);function dm(n,t,e,i,r){this.static_tree=n,this.extra_bits=t,this.extra_base=e,this.elems=i,this.max_length=r,this.has_stree=n&&n.length}var Yw,e0,t0;function cm(n,t){this.dyn_tree=n,this.max_code=0,this.stat_desc=t}var i0=n=>n<256?ks[n]:ks[256+(n>>>7)],Cs=(n,t)=>{n.pending_buf[n.pending++]=t&255,n.pending_buf[n.pending++]=t>>>8&255},Ie=(n,t,e)=>{n.bi_valid>am-e?(n.bi_buf|=t<<n.bi_valid&65535,Cs(n,n.bi_buf),n.bi_buf=t>>am-n.bi_valid,n.bi_valid+=e-am):(n.bi_buf|=t<<n.bi_valid&65535,n.bi_valid+=e)},mt=(n,t,e)=>{Ie(n,e[t*2],e[t*2+1])},n0=(n,t)=>{let e=0;do e|=n&1,n>>>=1,e<<=1;while(--t>0);return e>>>1},SP=n=>{n.bi_valid===16?(Cs(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=n.bi_buf&255,n.bi_buf>>=8,n.bi_valid-=8)},yP=(n,t)=>{let e=t.dyn_tree,i=t.max_code,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,l=t.stat_desc.max_length,c,a,u,p,m,S,C=0;for(p=0;p<=vn;p++)n.bl_count[p]=0;for(e[n.heap[n.heap_max]*2+1]=0,c=n.heap_max+1;c<Gw;c++)a=n.heap[c],p=e[e[a*2+1]*2+1]+1,p>l&&(p=l,C++),e[a*2+1]=p,!(a>i)&&(n.bl_count[p]++,m=0,a>=d&&(m=s[a-d]),S=e[a*2],n.opt_len+=S*(p+m),o&&(n.static_len+=S*(r[a*2+1]+m)));if(C!==0){do{for(p=l-1;n.bl_count[p]===0;)p--;n.bl_count[p]--,n.bl_count[p+1]+=2,n.bl_count[l]--,C-=2}while(C>0);for(p=l;p!==0;p--)for(a=n.bl_count[p];a!==0;)u=n.heap[--c],!(u>i)&&(e[u*2+1]!==p&&(n.opt_len+=(p-e[u*2+1])*e[u*2],e[u*2+1]=p),a--)}},r0=(n,t,e)=>{let i=new Array(vn+1),r=0,o,s;for(o=1;o<=vn;o++)r=r+e[o-1]<<1,i[o]=r;for(s=0;s<=t;s++){let d=n[s*2+1];d!==0&&(n[s*2]=n0(i[d]++,d))}},bP=()=>{let n,t,e,i,r,o=new Array(vn+1);for(e=0,i=0;i<hm-1;i++)for(gm[i]=e,n=0;n<1<<um[i];n++)Is[e++]=i;for(Is[e-1]=i,r=0,i=0;i<16;i++)for(qd[i]=r,n=0;n<1<<Ud[i];n++)ks[r++]=i;for(r>>=7;i<Vr;i++)for(qd[i]=r<<7,n=0;n<1<<Ud[i]-7;n++)ks[256+r++]=i;for(t=0;t<=vn;t++)o[t]=0;for(n=0;n<=143;)Rt[n*2+1]=8,n++,o[8]++;for(;n<=255;)Rt[n*2+1]=9,n++,o[9]++;for(;n<=279;)Rt[n*2+1]=7,n++,o[7]++;for(;n<=287;)Rt[n*2+1]=8,n++,o[8]++;for(r0(Rt,Ts+1,o),n=0;n<Vr;n++)ws[n*2+1]=5,ws[n*2]=n0(n,5);Yw=new dm(Rt,um,Os+1,Ts,vn),e0=new dm(ws,Ud,0,Vr,vn),t0=new dm(new Array(0),gP,0,pm,mP)},o0=n=>{let t;for(t=0;t<Ts;t++)n.dyn_ltree[t*2]=0;for(t=0;t<Vr;t++)n.dyn_dtree[t*2]=0;for(t=0;t<pm;t++)n.bl_tree[t*2]=0;n.dyn_ltree[mm*2]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},s0=n=>{n.bi_valid>8?Cs(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},Hw=(n,t,e,i)=>{let r=t*2,o=e*2;return n[r]<n[o]||n[r]===n[o]&&i[t]<=i[e]},lm=(n,t,e)=>{let i=n.heap[e],r=e<<1;for(;r<=n.heap_len&&(r<n.heap_len&&Hw(t,n.heap[r+1],n.heap[r],n.depth)&&r++,!Hw(t,i,n.heap[r],n.depth));)n.heap[e]=n.heap[r],e=r,r<<=1;n.heap[e]=i},jw=(n,t,e)=>{let i,r,o=0,s,d;if(n.sym_next!==0)do i=n.pending_buf[n.sym_buf+o++]&255,i+=(n.pending_buf[n.sym_buf+o++]&255)<<8,r=n.pending_buf[n.sym_buf+o++],i===0?mt(n,r,t):(s=Is[r],mt(n,s+Os+1,t),d=um[s],d!==0&&(r-=gm[s],Ie(n,r,d)),i--,s=i0(i),mt(n,s,e),d=Ud[s],d!==0&&(i-=qd[s],Ie(n,i,d)));while(o<n.sym_next);mt(n,mm,t)},fm=(n,t)=>{let e=t.dyn_tree,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.elems,s,d,l=-1,c;for(n.heap_len=0,n.heap_max=Gw,s=0;s<o;s++)e[s*2]!==0?(n.heap[++n.heap_len]=l=s,n.depth[s]=0):e[s*2+1]=0;for(;n.heap_len<2;)c=n.heap[++n.heap_len]=l<2?++l:0,e[c*2]=1,n.depth[c]=0,n.opt_len--,r&&(n.static_len-=i[c*2+1]);for(t.max_code=l,s=n.heap_len>>1;s>=1;s--)lm(n,e,s);c=o;do s=n.heap[1],n.heap[1]=n.heap[n.heap_len--],lm(n,e,1),d=n.heap[1],n.heap[--n.heap_max]=s,n.heap[--n.heap_max]=d,e[c*2]=e[s*2]+e[d*2],n.depth[c]=(n.depth[s]>=n.depth[d]?n.depth[s]:n.depth[d])+1,e[s*2+1]=e[d*2+1]=c,n.heap[1]=c++,lm(n,e,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],yP(n,t),r0(e,l,n.bl_count)},Ww=(n,t,e)=>{let i,r=-1,o,s=t[1],d=0,l=7,c=4;for(s===0&&(l=138,c=3),t[(e+1)*2+1]=65535,i=0;i<=e;i++)o=s,s=t[(i+1)*2+1],!(++d<l&&o===s)&&(d<c?n.bl_tree[o*2]+=d:o!==0?(o!==r&&n.bl_tree[o*2]++,n.bl_tree[Jw*2]++):d<=10?n.bl_tree[Qw*2]++:n.bl_tree[Xw*2]++,d=0,r=o,s===0?(l=138,c=3):o===s?(l=6,c=3):(l=7,c=4))},zw=(n,t,e)=>{let i,r=-1,o,s=t[1],d=0,l=7,c=4;for(s===0&&(l=138,c=3),i=0;i<=e;i++)if(o=s,s=t[(i+1)*2+1],!(++d<l&&o===s)){if(d<c)do mt(n,o,n.bl_tree);while(--d!==0);else o!==0?(o!==r&&(mt(n,o,n.bl_tree),d--),mt(n,Jw,n.bl_tree),Ie(n,d-3,2)):d<=10?(mt(n,Qw,n.bl_tree),Ie(n,d-3,3)):(mt(n,Xw,n.bl_tree),Ie(n,d-11,7));d=0,r=o,s===0?(l=138,c=3):o===s?(l=6,c=3):(l=7,c=4)}},_P=n=>{let t;for(Ww(n,n.dyn_ltree,n.l_desc.max_code),Ww(n,n.dyn_dtree,n.d_desc.max_code),fm(n,n.bl_desc),t=pm-1;t>=3&&n.bl_tree[Zw[t]*2+1]===0;t--);return n.opt_len+=3*(t+1)+5+5+4,t},wP=(n,t,e,i)=>{let r;for(Ie(n,t-257,5),Ie(n,e-1,5),Ie(n,i-4,4),r=0;r<i;r++)Ie(n,n.bl_tree[Zw[r]*2+1],3);zw(n,n.dyn_ltree,t-1),zw(n,n.dyn_dtree,e-1)},TP=n=>{let t=4093624447,e;for(e=0;e<=31;e++,t>>>=1)if(t&1&&n.dyn_ltree[e*2]!==0)return 0;if(n.dyn_ltree[18]!==0||n.dyn_ltree[20]!==0||n.dyn_ltree[26]!==0)return 1;for(e=32;e<Os;e++)if(n.dyn_ltree[e*2]!==0)return 1;return 0},$w=!1,kP=n=>{$w||(bP(),$w=!0),n.l_desc=new cm(n.dyn_ltree,Yw),n.d_desc=new cm(n.dyn_dtree,e0),n.bl_desc=new cm(n.bl_tree,t0),n.bi_buf=0,n.bi_valid=0,o0(n)},a0=(n,t,e,i)=>{Ie(n,(uP<<1)+(i?1:0),3),s0(n),Cs(n,e),Cs(n,~e),e&&n.pending_buf.set(n.window.subarray(t,t+e),n.pending),n.pending+=e},IP=n=>{Ie(n,Kw<<1,3),mt(n,mm,Rt),SP(n)},CP=(n,t,e,i)=>{let r,o,s=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=TP(n)),fm(n,n.l_desc),fm(n,n.d_desc),s=_P(n),r=n.opt_len+3+7>>>3,o=n.static_len+3+7>>>3,o<=r&&(r=o)):r=o=e+5,e+4<=r&&t!==-1?a0(n,t,e,i):n.strategy===4||o===r?(Ie(n,(Kw<<1)+(i?1:0),3),jw(n,Rt,ws)):(Ie(n,(fP<<1)+(i?1:0),3),wP(n,n.l_desc.max_code+1,n.d_desc.max_code+1,s+1),jw(n,n.dyn_ltree,n.dyn_dtree)),o0(n),i&&s0(n)},OP=(n,t,e)=>(n.pending_buf[n.sym_buf+n.sym_next++]=t,n.pending_buf[n.sym_buf+n.sym_next++]=t>>8,n.pending_buf[n.sym_buf+n.sym_next++]=e,t===0?n.dyn_ltree[e*2]++:(n.matches++,t--,n.dyn_ltree[(Is[e]+Os+1)*2]++,n.dyn_dtree[i0(t)*2]++),n.sym_next===n.sym_end);Lr.exports._tr_init=kP;Lr.exports._tr_stored_block=a0;Lr.exports._tr_flush_block=CP;Lr.exports._tr_tally=OP;Lr.exports._tr_align=IP});var vm=g((Pq,c0)=>{"use strict";var EP=(n,t,e,i)=>{let r=n&65535|0,o=n>>>16&65535|0,s=0;for(;e!==0;){s=e>2e3?2e3:e,e-=s;do r=r+t[i++]|0,o=o+r|0;while(--s);r%=65521,o%=65521}return r|o<<16|0};c0.exports=EP});var Sm=g((Mq,l0)=>{"use strict";var AP=()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;t[e]=n}return t},PP=new Uint32Array(AP()),MP=(n,t,e,i)=>{let r=PP,o=i+e;n^=-1;for(let s=i;s<o;s++)n=n>>>8^r[(n^t[s])&255];return n^-1};l0.exports=MP});var Hd=g((Rq,u0)=>{"use strict";u0.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}});var di=g((Dq,f0)=>{"use strict";f0.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}});var w0=g((xq,yt)=>{"use strict";var{_tr_init:RP,_tr_stored_block:_m,_tr_flush_block:DP,_tr_tally:fi,_tr_align:xP}=d0(),g0=vm(),ci=Sm(),VP=Hd(),{Z_NO_FLUSH:hi,Z_PARTIAL_FLUSH:NP,Z_FULL_FLUSH:LP,Z_FINISH:He,Z_BLOCK:h0,Z_OK:ge,Z_STREAM_END:p0,Z_STREAM_ERROR:vt,Z_DATA_ERROR:BP,Z_BUF_ERROR:ym,Z_DEFAULT_COMPRESSION:FP,Z_FILTERED:UP,Z_HUFFMAN_ONLY:jd,Z_RLE:qP,Z_FIXED:HP,Z_DEFAULT_STRATEGY:jP,Z_UNKNOWN:WP,Z_DEFLATED:Wd}=di(),zP=9,$P=15,KP=8,GP=29,JP=256,wm=JP+1+GP,QP=30,XP=19,ZP=2*wm+1,YP=15,$=3,ui=258,St=ui+$+1,eM=32,Fr=42,Em=57,Tm=69,km=73,Im=91,Cm=103,Sn=113,As=666,we=1,qr=2,bn=3,Hr=4,tM=3,yn=(n,t)=>(n.msg=VP[t],t),m0=n=>n*2-(n>4?9:0),li=n=>{let t=n.length;for(;--t>=0;)n[t]=0},iM=n=>{let t,e,i,r=n.w_size;t=n.hash_size,i=t;do e=n.head[--i],n.head[i]=e>=r?e-r:0;while(--t);t=r,i=t;do e=n.prev[--i],n.prev[i]=e>=r?e-r:0;while(--t)},nM=(n,t,e)=>(t<<n.hash_shift^e)&n.hash_mask,pi=nM,Me=n=>{let t=n.state,e=t.pending;e>n.avail_out&&(e=n.avail_out),e!==0&&(n.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),n.next_out),n.next_out+=e,t.pending_out+=e,n.total_out+=e,n.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},Re=(n,t)=>{DP(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,t),n.block_start=n.strstart,Me(n.strm)},J=(n,t)=>{n.pending_buf[n.pending++]=t},Es=(n,t)=>{n.pending_buf[n.pending++]=t>>>8&255,n.pending_buf[n.pending++]=t&255},Om=(n,t,e,i)=>{let r=n.avail_in;return r>i&&(r=i),r===0?0:(n.avail_in-=r,t.set(n.input.subarray(n.next_in,n.next_in+r),e),n.state.wrap===1?n.adler=g0(n.adler,t,r,e):n.state.wrap===2&&(n.adler=ci(n.adler,t,r,e)),n.next_in+=r,n.total_in+=r,r)},v0=(n,t)=>{let e=n.max_chain_length,i=n.strstart,r,o,s=n.prev_length,d=n.nice_match,l=n.strstart>n.w_size-St?n.strstart-(n.w_size-St):0,c=n.window,a=n.w_mask,u=n.prev,p=n.strstart+ui,m=c[i+s-1],S=c[i+s];n.prev_length>=n.good_match&&(e>>=2),d>n.lookahead&&(d=n.lookahead);do if(r=t,!(c[r+s]!==S||c[r+s-1]!==m||c[r]!==c[i]||c[++r]!==c[i+1])){i+=2,r++;do;while(c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&i<p);if(o=ui-(p-i),i=p-ui,o>s){if(n.match_start=t,s=o,o>=d)break;m=c[i+s-1],S=c[i+s]}}while((t=u[t&a])>l&&--e!==0);return s<=n.lookahead?s:n.lookahead},Ur=n=>{let t=n.w_size,e,i,r;do{if(i=n.window_size-n.lookahead-n.strstart,n.strstart>=t+(t-St)&&(n.window.set(n.window.subarray(t,t+t-i),0),n.match_start-=t,n.strstart-=t,n.block_start-=t,n.insert>n.strstart&&(n.insert=n.strstart),iM(n),i+=t),n.strm.avail_in===0)break;if(e=Om(n.strm,n.window,n.strstart+n.lookahead,i),n.lookahead+=e,n.lookahead+n.insert>=$)for(r=n.strstart-n.insert,n.ins_h=n.window[r],n.ins_h=pi(n,n.ins_h,n.window[r+1]);n.insert&&(n.ins_h=pi(n,n.ins_h,n.window[r+$-1]),n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++,n.insert--,!(n.lookahead+n.insert<$)););}while(n.lookahead<St&&n.strm.avail_in!==0)},S0=(n,t)=>{let e=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,i,r,o,s=0,d=n.strm.avail_in;do{if(i=65535,o=n.bi_valid+42>>3,n.strm.avail_out<o||(o=n.strm.avail_out-o,r=n.strstart-n.block_start,i>r+n.strm.avail_in&&(i=r+n.strm.avail_in),i>o&&(i=o),i<e&&(i===0&&t!==He||t===hi||i!==r+n.strm.avail_in)))break;s=t===He&&i===r+n.strm.avail_in?1:0,_m(n,0,0,s),n.pending_buf[n.pending-4]=i,n.pending_buf[n.pending-3]=i>>8,n.pending_buf[n.pending-2]=~i,n.pending_buf[n.pending-1]=~i>>8,Me(n.strm),r&&(r>i&&(r=i),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+r),n.strm.next_out),n.strm.next_out+=r,n.strm.avail_out-=r,n.strm.total_out+=r,n.block_start+=r,i-=r),i&&(Om(n.strm,n.strm.output,n.strm.next_out,i),n.strm.next_out+=i,n.strm.avail_out-=i,n.strm.total_out+=i)}while(s===0);return d-=n.strm.avail_in,d&&(d>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=d&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-d,n.strm.next_in),n.strstart),n.strstart+=d,n.insert+=d>n.w_size-n.insert?n.w_size-n.insert:d),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),s?Hr:t!==hi&&t!==He&&n.strm.avail_in===0&&n.strstart===n.block_start?qr:(o=n.window_size-n.strstart,n.strm.avail_in>o&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,o+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),o>n.strm.avail_in&&(o=n.strm.avail_in),o&&(Om(n.strm,n.window,n.strstart,o),n.strstart+=o,n.insert+=o>n.w_size-n.insert?n.w_size-n.insert:o),n.high_water<n.strstart&&(n.high_water=n.strstart),o=n.bi_valid+42>>3,o=n.pending_buf_size-o>65535?65535:n.pending_buf_size-o,e=o>n.w_size?n.w_size:o,r=n.strstart-n.block_start,(r>=e||(r||t===He)&&t!==hi&&n.strm.avail_in===0&&r<=o)&&(i=r>o?o:r,s=t===He&&n.strm.avail_in===0&&i===r?1:0,_m(n,n.block_start,i,s),n.block_start+=i,Me(n.strm)),s?bn:we)},bm=(n,t)=>{let e,i;for(;;){if(n.lookahead<St){if(Ur(n),n.lookahead<St&&t===hi)return we;if(n.lookahead===0)break}if(e=0,n.lookahead>=$&&(n.ins_h=pi(n,n.ins_h,n.window[n.strstart+$-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),e!==0&&n.strstart-e<=n.w_size-St&&(n.match_length=v0(n,e)),n.match_length>=$)if(i=fi(n,n.strstart-n.match_start,n.match_length-$),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=$){n.match_length--;do n.strstart++,n.ins_h=pi(n,n.ins_h,n.window[n.strstart+$-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!==0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=pi(n,n.ins_h,n.window[n.strstart+1]);else i=fi(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(i&&(Re(n,!1),n.strm.avail_out===0))return we}return n.insert=n.strstart<$-1?n.strstart:$-1,t===He?(Re(n,!0),n.strm.avail_out===0?bn:Hr):n.sym_next&&(Re(n,!1),n.strm.avail_out===0)?we:qr},Br=(n,t)=>{let e,i,r;for(;;){if(n.lookahead<St){if(Ur(n),n.lookahead<St&&t===hi)return we;if(n.lookahead===0)break}if(e=0,n.lookahead>=$&&(n.ins_h=pi(n,n.ins_h,n.window[n.strstart+$-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=$-1,e!==0&&n.prev_length<n.max_lazy_match&&n.strstart-e<=n.w_size-St&&(n.match_length=v0(n,e),n.match_length<=5&&(n.strategy===UP||n.match_length===$&&n.strstart-n.match_start>4096)&&(n.match_length=$-1)),n.prev_length>=$&&n.match_length<=n.prev_length){r=n.strstart+n.lookahead-$,i=fi(n,n.strstart-1-n.prev_match,n.prev_length-$),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=r&&(n.ins_h=pi(n,n.ins_h,n.window[n.strstart+$-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!==0);if(n.match_available=0,n.match_length=$-1,n.strstart++,i&&(Re(n,!1),n.strm.avail_out===0))return we}else if(n.match_available){if(i=fi(n,0,n.window[n.strstart-1]),i&&Re(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return we}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(i=fi(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<$-1?n.strstart:$-1,t===He?(Re(n,!0),n.strm.avail_out===0?bn:Hr):n.sym_next&&(Re(n,!1),n.strm.avail_out===0)?we:qr},rM=(n,t)=>{let e,i,r,o,s=n.window;for(;;){if(n.lookahead<=ui){if(Ur(n),n.lookahead<=ui&&t===hi)return we;if(n.lookahead===0)break}if(n.match_length=0,n.lookahead>=$&&n.strstart>0&&(r=n.strstart-1,i=s[r],i===s[++r]&&i===s[++r]&&i===s[++r])){o=n.strstart+ui;do;while(i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&i===s[++r]&&r<o);n.match_length=ui-(o-r),n.match_length>n.lookahead&&(n.match_length=n.lookahead)}if(n.match_length>=$?(e=fi(n,1,n.match_length-$),n.lookahead-=n.match_length,n.strstart+=n.match_length,n.match_length=0):(e=fi(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++),e&&(Re(n,!1),n.strm.avail_out===0))return we}return n.insert=0,t===He?(Re(n,!0),n.strm.avail_out===0?bn:Hr):n.sym_next&&(Re(n,!1),n.strm.avail_out===0)?we:qr},oM=(n,t)=>{let e;for(;;){if(n.lookahead===0&&(Ur(n),n.lookahead===0)){if(t===hi)return we;break}if(n.match_length=0,e=fi(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++,e&&(Re(n,!1),n.strm.avail_out===0))return we}return n.insert=0,t===He?(Re(n,!0),n.strm.avail_out===0?bn:Hr):n.sym_next&&(Re(n,!1),n.strm.avail_out===0)?we:qr};function gt(n,t,e,i,r){this.good_length=n,this.max_lazy=t,this.nice_length=e,this.max_chain=i,this.func=r}var Ps=[new gt(0,0,0,0,S0),new gt(4,4,8,4,bm),new gt(4,5,16,8,bm),new gt(4,6,32,32,bm),new gt(4,4,16,16,Br),new gt(8,16,32,32,Br),new gt(8,16,128,128,Br),new gt(8,32,128,256,Br),new gt(32,128,258,1024,Br),new gt(32,258,258,4096,Br)],sM=n=>{n.window_size=2*n.w_size,li(n.head),n.max_lazy_match=Ps[n.level].max_lazy,n.good_match=Ps[n.level].good_length,n.nice_match=Ps[n.level].nice_length,n.max_chain_length=Ps[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=$-1,n.match_available=0,n.ins_h=0};function aM(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Wd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(ZP*2),this.dyn_dtree=new Uint16Array((2*QP+1)*2),this.bl_tree=new Uint16Array((2*XP+1)*2),li(this.dyn_ltree),li(this.dyn_dtree),li(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(YP+1),this.heap=new Uint16Array(2*wm+1),li(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*wm+1),li(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Ms=n=>{if(!n)return 1;let t=n.state;return!t||t.strm!==n||t.status!==Fr&&t.status!==Em&&t.status!==Tm&&t.status!==km&&t.status!==Im&&t.status!==Cm&&t.status!==Sn&&t.status!==As?1:0},y0=n=>{if(Ms(n))return yn(n,vt);n.total_in=n.total_out=0,n.data_type=WP;let t=n.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?Em:t.wrap?Fr:Sn,n.adler=t.wrap===2?0:1,t.last_flush=-2,RP(t),ge},b0=n=>{let t=y0(n);return t===ge&&sM(n.state),t},dM=(n,t)=>Ms(n)||n.state.wrap!==2?vt:(n.state.gzhead=t,ge),_0=(n,t,e,i,r,o)=>{if(!n)return vt;let s=1;if(t===FP&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),r<1||r>zP||e!==Wd||i<8||i>15||t<0||t>9||o<0||o>HP||i===8&&s!==1)return yn(n,vt);i===8&&(i=9);let d=new aM;return n.state=d,d.strm=n,d.status=Fr,d.wrap=s,d.gzhead=null,d.w_bits=i,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=r+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+$-1)/$),d.window=new Uint8Array(d.w_size*2),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<r+6,d.pending_buf_size=d.lit_bufsize*4,d.pending_buf=new Uint8Array(d.pending_buf_size),d.sym_buf=d.lit_bufsize,d.sym_end=(d.lit_bufsize-1)*3,d.level=t,d.strategy=o,d.method=e,b0(n)},cM=(n,t)=>_0(n,t,Wd,$P,KP,jP),lM=(n,t)=>{if(Ms(n)||t>h0||t<0)return n?yn(n,vt):vt;let e=n.state;if(!n.output||n.avail_in!==0&&!n.input||e.status===As&&t!==He)return yn(n,n.avail_out===0?ym:vt);let i=e.last_flush;if(e.last_flush=t,e.pending!==0){if(Me(n),n.avail_out===0)return e.last_flush=-1,ge}else if(n.avail_in===0&&m0(t)<=m0(i)&&t!==He)return yn(n,ym);if(e.status===As&&n.avail_in!==0)return yn(n,ym);if(e.status===Fr&&e.wrap===0&&(e.status=Sn),e.status===Fr){let r=Wd+(e.w_bits-8<<4)<<8,o=-1;if(e.strategy>=jd||e.level<2?o=0:e.level<6?o=1:e.level===6?o=2:o=3,r|=o<<6,e.strstart!==0&&(r|=eM),r+=31-r%31,Es(e,r),e.strstart!==0&&(Es(e,n.adler>>>16),Es(e,n.adler&65535)),n.adler=1,e.status=Sn,Me(n),e.pending!==0)return e.last_flush=-1,ge}if(e.status===Em){if(n.adler=0,J(e,31),J(e,139),J(e,8),e.gzhead)J(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),J(e,e.gzhead.time&255),J(e,e.gzhead.time>>8&255),J(e,e.gzhead.time>>16&255),J(e,e.gzhead.time>>24&255),J(e,e.level===9?2:e.strategy>=jd||e.level<2?4:0),J(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(J(e,e.gzhead.extra.length&255),J(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(n.adler=ci(n.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Tm;else if(J(e,0),J(e,0),J(e,0),J(e,0),J(e,0),J(e,e.level===9?2:e.strategy>=jd||e.level<2?4:0),J(e,tM),e.status=Sn,Me(n),e.pending!==0)return e.last_flush=-1,ge}if(e.status===Tm){if(e.gzhead.extra){let r=e.pending,o=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+o>e.pending_buf_size;){let d=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+d),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>r&&(n.adler=ci(n.adler,e.pending_buf,e.pending-r,r)),e.gzindex+=d,Me(n),e.pending!==0)return e.last_flush=-1,ge;r=0,o-=d}let s=new Uint8Array(e.gzhead.extra);e.pending_buf.set(s.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending+=o,e.gzhead.hcrc&&e.pending>r&&(n.adler=ci(n.adler,e.pending_buf,e.pending-r,r)),e.gzindex=0}e.status=km}if(e.status===km){if(e.gzhead.name){let r=e.pending,o;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(n.adler=ci(n.adler,e.pending_buf,e.pending-r,r)),Me(n),e.pending!==0)return e.last_flush=-1,ge;r=0}e.gzindex<e.gzhead.name.length?o=e.gzhead.name.charCodeAt(e.gzindex++)&255:o=0,J(e,o)}while(o!==0);e.gzhead.hcrc&&e.pending>r&&(n.adler=ci(n.adler,e.pending_buf,e.pending-r,r)),e.gzindex=0}e.status=Im}if(e.status===Im){if(e.gzhead.comment){let r=e.pending,o;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(n.adler=ci(n.adler,e.pending_buf,e.pending-r,r)),Me(n),e.pending!==0)return e.last_flush=-1,ge;r=0}e.gzindex<e.gzhead.comment.length?o=e.gzhead.comment.charCodeAt(e.gzindex++)&255:o=0,J(e,o)}while(o!==0);e.gzhead.hcrc&&e.pending>r&&(n.adler=ci(n.adler,e.pending_buf,e.pending-r,r))}e.status=Cm}if(e.status===Cm){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(Me(n),e.pending!==0))return e.last_flush=-1,ge;J(e,n.adler&255),J(e,n.adler>>8&255),n.adler=0}if(e.status=Sn,Me(n),e.pending!==0)return e.last_flush=-1,ge}if(n.avail_in!==0||e.lookahead!==0||t!==hi&&e.status!==As){let r=e.level===0?S0(e,t):e.strategy===jd?oM(e,t):e.strategy===qP?rM(e,t):Ps[e.level].func(e,t);if((r===bn||r===Hr)&&(e.status=As),r===we||r===bn)return n.avail_out===0&&(e.last_flush=-1),ge;if(r===qr&&(t===NP?xP(e):t!==h0&&(_m(e,0,0,!1),t===LP&&(li(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),Me(n),n.avail_out===0))return e.last_flush=-1,ge}return t!==He?ge:e.wrap<=0?p0:(e.wrap===2?(J(e,n.adler&255),J(e,n.adler>>8&255),J(e,n.adler>>16&255),J(e,n.adler>>24&255),J(e,n.total_in&255),J(e,n.total_in>>8&255),J(e,n.total_in>>16&255),J(e,n.total_in>>24&255)):(Es(e,n.adler>>>16),Es(e,n.adler&65535)),Me(n),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?ge:p0)},uM=n=>{if(Ms(n))return vt;let t=n.state.status;return n.state=null,t===Sn?yn(n,BP):ge},fM=(n,t)=>{let e=t.length;if(Ms(n))return vt;let i=n.state,r=i.wrap;if(r===2||r===1&&i.status!==Fr||i.lookahead)return vt;if(r===1&&(n.adler=g0(n.adler,t,e,0)),i.wrap=0,e>=i.w_size){r===0&&(li(i.head),i.strstart=0,i.block_start=0,i.insert=0);let l=new Uint8Array(i.w_size);l.set(t.subarray(e-i.w_size,e),0),t=l,e=i.w_size}let o=n.avail_in,s=n.next_in,d=n.input;for(n.avail_in=e,n.next_in=0,n.input=t,Ur(i);i.lookahead>=$;){let l=i.strstart,c=i.lookahead-($-1);do i.ins_h=pi(i,i.ins_h,i.window[l+$-1]),i.prev[l&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=l,l++;while(--c);i.strstart=l,i.lookahead=$-1,Ur(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=$-1,i.match_available=0,n.next_in=s,n.input=d,n.avail_in=o,i.wrap=r,ge};yt.exports.deflateInit=cM;yt.exports.deflateInit2=_0;yt.exports.deflateReset=b0;yt.exports.deflateResetKeep=y0;yt.exports.deflateSetHeader=dM;yt.exports.deflate=lM;yt.exports.deflateEnd=uM;yt.exports.deflateSetDictionary=fM;yt.exports.deflateInfo="pako deflate (from Nodeca project)"});var Pm=g((Vq,Am)=>{"use strict";var hM=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);Am.exports.assign=function(n){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(let i in e)hM(e,i)&&(n[i]=e[i])}}return n};Am.exports.flattenChunks=n=>{let t=0;for(let i=0,r=n.length;i<r;i++)t+=n[i].length;let e=new Uint8Array(t);for(let i=0,r=0,o=n.length;i<o;i++){let s=n[i];e.set(s,r),r+=s.length}return e}});var Mm=g((Nq,zd)=>{"use strict";var T0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{T0=!1}var Rs=new Uint8Array(256);for(let n=0;n<256;n++)Rs[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Rs[254]=Rs[254]=1;zd.exports.string2buf=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,i,r,o,s=n.length,d=0;for(r=0;r<s;r++)e=n.charCodeAt(r),(e&64512)===55296&&r+1<s&&(i=n.charCodeAt(r+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),r++)),d+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(d),o=0,r=0;o<d;r++)e=n.charCodeAt(r),(e&64512)===55296&&r+1<s&&(i=n.charCodeAt(r+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),r++)),e<128?t[o++]=e:e<2048?(t[o++]=192|e>>>6,t[o++]=128|e&63):e<65536?(t[o++]=224|e>>>12,t[o++]=128|e>>>6&63,t[o++]=128|e&63):(t[o++]=240|e>>>18,t[o++]=128|e>>>12&63,t[o++]=128|e>>>6&63,t[o++]=128|e&63);return t};var pM=(n,t)=>{if(t<65534&&n.subarray&&T0)return String.fromCharCode.apply(null,n.length===t?n:n.subarray(0,t));let e="";for(let i=0;i<t;i++)e+=String.fromCharCode(n[i]);return e};zd.exports.buf2string=(n,t)=>{let e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let i,r,o=new Array(e*2);for(r=0,i=0;i<e;){let s=n[i++];if(s<128){o[r++]=s;continue}let d=Rs[s];if(d>4){o[r++]=65533,i+=d-1;continue}for(s&=d===2?31:d===3?15:7;d>1&&i<e;)s=s<<6|n[i++]&63,d--;if(d>1){o[r++]=65533;continue}s<65536?o[r++]=s:(s-=65536,o[r++]=55296|s>>10&1023,o[r++]=56320|s&1023)}return pM(o,r)};zd.exports.utf8border=(n,t)=>{t=t||n.length,t>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(n[e]&192)===128;)e--;return e<0||e===0?t:e+Rs[n[e]]>t?e:t}});var Rm=g((Lq,k0)=>{"use strict";function mM(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}k0.exports=mM});var E0=g((Bq,jr)=>{"use strict";var Ds=w0(),I0=Pm(),C0=Mm(),Dm=Hd(),gM=Rm(),O0=Object.prototype.toString,{Z_NO_FLUSH:vM,Z_SYNC_FLUSH:SM,Z_FULL_FLUSH:yM,Z_FINISH:bM,Z_OK:$d,Z_STREAM_END:_M,Z_DEFAULT_COMPRESSION:wM,Z_DEFAULT_STRATEGY:TM,Z_DEFLATED:kM}=di();function xs(n){this.options=I0.assign({level:wM,method:kM,chunkSize:16384,windowBits:15,memLevel:8,strategy:TM},n||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new gM,this.strm.avail_out=0;let e=Ds.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==$d)throw new Error(Dm[e]);if(t.header&&Ds.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(typeof t.dictionary=="string"?i=C0.string2buf(t.dictionary):O0.call(t.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(t.dictionary):i=t.dictionary,e=Ds.deflateSetDictionary(this.strm,i),e!==$d)throw new Error(Dm[e]);this._dict_set=!0}}xs.prototype.push=function(n,t){let e=this.strm,i=this.options.chunkSize,r,o;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?bM:vM,typeof n=="string"?e.input=C0.string2buf(n):O0.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),(o===SM||o===yM)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(r=Ds.deflate(e,o),r===_M)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),r=Ds.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===$d;if(e.avail_out===0){this.onData(e.output);continue}if(o>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};xs.prototype.onData=function(n){this.chunks.push(n)};xs.prototype.onEnd=function(n){n===$d&&(this.result=I0.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function xm(n,t){let e=new xs(t);if(e.push(n,!0),e.err)throw e.msg||Dm[e.err];return e.result}function IM(n,t){return t=t||{},t.raw=!0,xm(n,t)}function CM(n,t){return t=t||{},t.gzip=!0,xm(n,t)}jr.exports.Deflate=xs;jr.exports.deflate=xm;jr.exports.deflateRaw=IM;jr.exports.gzip=CM;jr.exports.constants=di()});var P0=g((Fq,A0)=>{"use strict";A0.exports=function(t,e){let i,r,o,s,d,l,c,a,u,p,m,S,C,I,_,k,T,w,D,L,O,A,P,V,U=t.state;i=t.next_in,P=t.input,r=i+(t.avail_in-5),o=t.next_out,V=t.output,s=o-(e-t.avail_out),d=o+(t.avail_out-257),l=U.dmax,c=U.wsize,a=U.whave,u=U.wnext,p=U.window,m=U.hold,S=U.bits,C=U.lencode,I=U.distcode,_=(1<<U.lenbits)-1,k=(1<<U.distbits)-1;e:do{S<15&&(m+=P[i++]<<S,S+=8,m+=P[i++]<<S,S+=8),T=C[m&_];t:for(;;){if(w=T>>>24,m>>>=w,S-=w,w=T>>>16&255,w===0)V[o++]=T&65535;else if(w&16){D=T&65535,w&=15,w&&(S<w&&(m+=P[i++]<<S,S+=8),D+=m&(1<<w)-1,m>>>=w,S-=w),S<15&&(m+=P[i++]<<S,S+=8,m+=P[i++]<<S,S+=8),T=I[m&k];i:for(;;){if(w=T>>>24,m>>>=w,S-=w,w=T>>>16&255,w&16){if(L=T&65535,w&=15,S<w&&(m+=P[i++]<<S,S+=8,S<w&&(m+=P[i++]<<S,S+=8)),L+=m&(1<<w)-1,L>l){t.msg="invalid distance too far back",U.mode=16209;break e}if(m>>>=w,S-=w,w=o-s,L>w){if(w=L-w,w>a&&U.sane){t.msg="invalid distance too far back",U.mode=16209;break e}if(O=0,A=p,u===0){if(O+=c-w,w<D){D-=w;do V[o++]=p[O++];while(--w);O=o-L,A=V}}else if(u<w){if(O+=c+u-w,w-=u,w<D){D-=w;do V[o++]=p[O++];while(--w);if(O=0,u<D){w=u,D-=w;do V[o++]=p[O++];while(--w);O=o-L,A=V}}}else if(O+=u-w,w<D){D-=w;do V[o++]=p[O++];while(--w);O=o-L,A=V}for(;D>2;)V[o++]=A[O++],V[o++]=A[O++],V[o++]=A[O++],D-=3;D&&(V[o++]=A[O++],D>1&&(V[o++]=A[O++]))}else{O=o-L;do V[o++]=V[O++],V[o++]=V[O++],V[o++]=V[O++],D-=3;while(D>2);D&&(V[o++]=V[O++],D>1&&(V[o++]=V[O++]))}}else if((w&64)===0){T=I[(T&65535)+(m&(1<<w)-1)];continue i}else{t.msg="invalid distance code",U.mode=16209;break e}break}}else if((w&64)===0){T=C[(T&65535)+(m&(1<<w)-1)];continue t}else if(w&32){U.mode=16191;break e}else{t.msg="invalid literal/length code",U.mode=16209;break e}break}}while(i<r&&o<d);D=S>>3,i-=D,S-=D<<3,m&=(1<<S)-1,t.next_in=i,t.next_out=o,t.avail_in=i<r?5+(r-i):5-(i-r),t.avail_out=o<d?257+(d-o):257-(o-d),U.hold=m,U.bits=S}});var R0=g((Uq,M0)=>{"use strict";var OM=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),EM=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),AM=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),PM=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),MM=(n,t,e,i,r,o,s,d)=>{let l=d.bits,c=0,a=0,u=0,p=0,m=0,S=0,C=0,I=0,_=0,k=0,T,w,D,L,O,A=null,P,V=new Uint16Array(16),U=new Uint16Array(16),fe=null,dt,It,Ct;for(c=0;c<=15;c++)V[c]=0;for(a=0;a<i;a++)V[t[e+a]]++;for(m=l,p=15;p>=1&&V[p]===0;p--);if(m>p&&(m=p),p===0)return r[o++]=1<<24|64<<16|0,r[o++]=1<<24|64<<16|0,d.bits=1,0;for(u=1;u<p&&V[u]===0;u++);for(m<u&&(m=u),I=1,c=1;c<=15;c++)if(I<<=1,I-=V[c],I<0)return-1;if(I>0&&(n===0||p!==1))return-1;for(U[1]=0,c=1;c<15;c++)U[c+1]=U[c]+V[c];for(a=0;a<i;a++)t[e+a]!==0&&(s[U[t[e+a]]++]=a);if(n===0?(A=fe=s,P=20):n===1?(A=OM,fe=EM,P=257):(A=AM,fe=PM,P=0),k=0,a=0,c=u,O=o,S=m,C=0,D=-1,_=1<<m,L=_-1,n===1&&_>852||n===2&&_>592)return 1;for(;;){dt=c-C,s[a]+1<P?(It=0,Ct=s[a]):s[a]>=P?(It=fe[s[a]-P],Ct=A[s[a]-P]):(It=96,Ct=0),T=1<<c-C,w=1<<S,u=w;do w-=T,r[O+(k>>C)+w]=dt<<24|It<<16|Ct|0;while(w!==0);for(T=1<<c-1;k&T;)T>>=1;if(T!==0?(k&=T-1,k+=T):k=0,a++,--V[c]===0){if(c===p)break;c=t[e+s[a]]}if(c>m&&(k&L)!==D){for(C===0&&(C=m),O+=u,S=c-C,I=1<<S;S+C<p&&(I-=V[S+C],!(I<=0));)S++,I<<=1;if(_+=1<<S,n===1&&_>852||n===2&&_>592)return 1;D=k&L,r[D]=m<<24|S<<16|O-o|0}}return k!==0&&(r[O+k]=c-C<<24|64<<16|0),d.bits=m,0};M0.exports=MM});var hT=g((qq,it)=>{"use strict";var Um=vm(),bt=Sm(),RM=P0(),Vs=R0(),DM=0,rT=1,oT=2,{Z_FINISH:D0,Z_BLOCK:xM,Z_TREES:Kd,Z_OK:_n,Z_STREAM_END:VM,Z_NEED_DICT:NM,Z_STREAM_ERROR:je,Z_DATA_ERROR:sT,Z_MEM_ERROR:qm,Z_BUF_ERROR:LM,Z_DEFLATED:x0}=di(),Xd=16180,V0=16181,N0=16182,L0=16183,B0=16184,F0=16185,U0=16186,q0=16187,H0=16188,j0=16189,Qd=16190,Dt=16191,Vm=16192,W0=16193,Nm=16194,z0=16195,$0=16196,K0=16197,G0=16198,Gd=16199,Jd=16200,J0=16201,Q0=16202,X0=16203,Z0=16204,Y0=16205,Lm=16206,eT=16207,tT=16208,re=16209,Hm=16210,aT=16211,BM=852,FM=592,UM=15,qM=UM,iT=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function HM(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var wn=n=>{if(!n)return 1;let t=n.state;return!t||t.strm!==n||t.mode<Xd||t.mode>aT?1:0},dT=n=>{if(wn(n))return je;let t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=t.wrap&1),t.mode=Xd,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(BM),t.distcode=t.distdyn=new Int32Array(FM),t.sane=1,t.back=-1,_n},cT=n=>{if(wn(n))return je;let t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,dT(n)},lT=(n,t)=>{let e;if(wn(n))return je;let i=n.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?je:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=e,i.wbits=t,cT(n))},uT=(n,t)=>{if(!n)return je;let e=new HM;n.state=e,e.strm=n,e.window=null,e.mode=Xd;let i=lT(n,t);return i!==_n&&(n.state=null),i},jM=n=>uT(n,qM),nT=!0,Bm,Fm,WM=n=>{if(nT){Bm=new Int32Array(512),Fm=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(Vs(rT,n.lens,0,288,Bm,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;Vs(oT,n.lens,0,32,Fm,0,n.work,{bits:5}),nT=!1}n.lencode=Bm,n.lenbits=9,n.distcode=Fm,n.distbits=5},fT=(n,t,e,i)=>{let r,o=n.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(t.subarray(e-o.wsize,e),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),o.window.set(t.subarray(e-i,e-i+r),o.wnext),i-=r,i?(o.window.set(t.subarray(e-i,e),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},zM=(n,t)=>{let e,i,r,o,s,d,l,c,a,u,p,m,S,C,I=0,_,k,T,w,D,L,O,A,P=new Uint8Array(4),V,U,fe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(wn(n)||!n.output||!n.input&&n.avail_in!==0)return je;e=n.state,e.mode===Dt&&(e.mode=Vm),s=n.next_out,r=n.output,l=n.avail_out,o=n.next_in,i=n.input,d=n.avail_in,c=e.hold,a=e.bits,u=d,p=l,A=_n;e:for(;;)switch(e.mode){case Xd:if(e.wrap===0){e.mode=Vm;break}for(;a<16;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}if(e.wrap&2&&c===35615){e.wbits===0&&(e.wbits=15),e.check=0,P[0]=c&255,P[1]=c>>>8&255,e.check=bt(e.check,P,2,0),c=0,a=0,e.mode=V0;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((c&255)<<8)+(c>>8))%31){n.msg="incorrect header check",e.mode=re;break}if((c&15)!==x0){n.msg="unknown compression method",e.mode=re;break}if(c>>>=4,a-=4,O=(c&15)+8,e.wbits===0&&(e.wbits=O),O>15||O>e.wbits){n.msg="invalid window size",e.mode=re;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=c&512?j0:Dt,c=0,a=0;break;case V0:for(;a<16;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}if(e.flags=c,(e.flags&255)!==x0){n.msg="unknown compression method",e.mode=re;break}if(e.flags&57344){n.msg="unknown header flags set",e.mode=re;break}e.head&&(e.head.text=c>>8&1),e.flags&512&&e.wrap&4&&(P[0]=c&255,P[1]=c>>>8&255,e.check=bt(e.check,P,2,0)),c=0,a=0,e.mode=N0;case N0:for(;a<32;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}e.head&&(e.head.time=c),e.flags&512&&e.wrap&4&&(P[0]=c&255,P[1]=c>>>8&255,P[2]=c>>>16&255,P[3]=c>>>24&255,e.check=bt(e.check,P,4,0)),c=0,a=0,e.mode=L0;case L0:for(;a<16;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}e.head&&(e.head.xflags=c&255,e.head.os=c>>8),e.flags&512&&e.wrap&4&&(P[0]=c&255,P[1]=c>>>8&255,e.check=bt(e.check,P,2,0)),c=0,a=0,e.mode=B0;case B0:if(e.flags&1024){for(;a<16;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}e.length=c,e.head&&(e.head.extra_len=c),e.flags&512&&e.wrap&4&&(P[0]=c&255,P[1]=c>>>8&255,e.check=bt(e.check,P,2,0)),c=0,a=0}else e.head&&(e.head.extra=null);e.mode=F0;case F0:if(e.flags&1024&&(m=e.length,m>d&&(m=d),m&&(e.head&&(O=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(o,o+m),O)),e.flags&512&&e.wrap&4&&(e.check=bt(e.check,i,m,o)),d-=m,o+=m,e.length-=m),e.length))break e;e.length=0,e.mode=U0;case U0:if(e.flags&2048){if(d===0)break e;m=0;do O=i[o+m++],e.head&&O&&e.length<65536&&(e.head.name+=String.fromCharCode(O));while(O&&m<d);if(e.flags&512&&e.wrap&4&&(e.check=bt(e.check,i,m,o)),d-=m,o+=m,O)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=q0;case q0:if(e.flags&4096){if(d===0)break e;m=0;do O=i[o+m++],e.head&&O&&e.length<65536&&(e.head.comment+=String.fromCharCode(O));while(O&&m<d);if(e.flags&512&&e.wrap&4&&(e.check=bt(e.check,i,m,o)),d-=m,o+=m,O)break e}else e.head&&(e.head.comment=null);e.mode=H0;case H0:if(e.flags&512){for(;a<16;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}if(e.wrap&4&&c!==(e.check&65535)){n.msg="header crc mismatch",e.mode=re;break}c=0,a=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=Dt;break;case j0:for(;a<32;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}n.adler=e.check=iT(c),c=0,a=0,e.mode=Qd;case Qd:if(e.havedict===0)return n.next_out=s,n.avail_out=l,n.next_in=o,n.avail_in=d,e.hold=c,e.bits=a,NM;n.adler=e.check=1,e.mode=Dt;case Dt:if(t===xM||t===Kd)break e;case Vm:if(e.last){c>>>=a&7,a-=a&7,e.mode=Lm;break}for(;a<3;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}switch(e.last=c&1,c>>>=1,a-=1,c&3){case 0:e.mode=W0;break;case 1:if(WM(e),e.mode=Gd,t===Kd){c>>>=2,a-=2;break e}break;case 2:e.mode=$0;break;case 3:n.msg="invalid block type",e.mode=re}c>>>=2,a-=2;break;case W0:for(c>>>=a&7,a-=a&7;a<32;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}if((c&65535)!==(c>>>16^65535)){n.msg="invalid stored block lengths",e.mode=re;break}if(e.length=c&65535,c=0,a=0,e.mode=Nm,t===Kd)break e;case Nm:e.mode=z0;case z0:if(m=e.length,m){if(m>d&&(m=d),m>l&&(m=l),m===0)break e;r.set(i.subarray(o,o+m),s),d-=m,o+=m,l-=m,s+=m,e.length-=m;break}e.mode=Dt;break;case $0:for(;a<14;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}if(e.nlen=(c&31)+257,c>>>=5,a-=5,e.ndist=(c&31)+1,c>>>=5,a-=5,e.ncode=(c&15)+4,c>>>=4,a-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=re;break}e.have=0,e.mode=K0;case K0:for(;e.have<e.ncode;){for(;a<3;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}e.lens[fe[e.have++]]=c&7,c>>>=3,a-=3}for(;e.have<19;)e.lens[fe[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,V={bits:e.lenbits},A=Vs(DM,e.lens,0,19,e.lencode,0,e.work,V),e.lenbits=V.bits,A){n.msg="invalid code lengths set",e.mode=re;break}e.have=0,e.mode=G0;case G0:for(;e.have<e.nlen+e.ndist;){for(;I=e.lencode[c&(1<<e.lenbits)-1],_=I>>>24,k=I>>>16&255,T=I&65535,!(_<=a);){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}if(T<16)c>>>=_,a-=_,e.lens[e.have++]=T;else{if(T===16){for(U=_+2;a<U;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}if(c>>>=_,a-=_,e.have===0){n.msg="invalid bit length repeat",e.mode=re;break}O=e.lens[e.have-1],m=3+(c&3),c>>>=2,a-=2}else if(T===17){for(U=_+3;a<U;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}c>>>=_,a-=_,O=0,m=3+(c&7),c>>>=3,a-=3}else{for(U=_+7;a<U;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}c>>>=_,a-=_,O=0,m=11+(c&127),c>>>=7,a-=7}if(e.have+m>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=re;break}for(;m--;)e.lens[e.have++]=O}}if(e.mode===re)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=re;break}if(e.lenbits=9,V={bits:e.lenbits},A=Vs(rT,e.lens,0,e.nlen,e.lencode,0,e.work,V),e.lenbits=V.bits,A){n.msg="invalid literal/lengths set",e.mode=re;break}if(e.distbits=6,e.distcode=e.distdyn,V={bits:e.distbits},A=Vs(oT,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,V),e.distbits=V.bits,A){n.msg="invalid distances set",e.mode=re;break}if(e.mode=Gd,t===Kd)break e;case Gd:e.mode=Jd;case Jd:if(d>=6&&l>=258){n.next_out=s,n.avail_out=l,n.next_in=o,n.avail_in=d,e.hold=c,e.bits=a,RM(n,p),s=n.next_out,r=n.output,l=n.avail_out,o=n.next_in,i=n.input,d=n.avail_in,c=e.hold,a=e.bits,e.mode===Dt&&(e.back=-1);break}for(e.back=0;I=e.lencode[c&(1<<e.lenbits)-1],_=I>>>24,k=I>>>16&255,T=I&65535,!(_<=a);){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}if(k&&(k&240)===0){for(w=_,D=k,L=T;I=e.lencode[L+((c&(1<<w+D)-1)>>w)],_=I>>>24,k=I>>>16&255,T=I&65535,!(w+_<=a);){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}c>>>=w,a-=w,e.back+=w}if(c>>>=_,a-=_,e.back+=_,e.length=T,k===0){e.mode=Y0;break}if(k&32){e.back=-1,e.mode=Dt;break}if(k&64){n.msg="invalid literal/length code",e.mode=re;break}e.extra=k&15,e.mode=J0;case J0:if(e.extra){for(U=e.extra;a<U;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,a-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Q0;case Q0:for(;I=e.distcode[c&(1<<e.distbits)-1],_=I>>>24,k=I>>>16&255,T=I&65535,!(_<=a);){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}if((k&240)===0){for(w=_,D=k,L=T;I=e.distcode[L+((c&(1<<w+D)-1)>>w)],_=I>>>24,k=I>>>16&255,T=I&65535,!(w+_<=a);){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}c>>>=w,a-=w,e.back+=w}if(c>>>=_,a-=_,e.back+=_,k&64){n.msg="invalid distance code",e.mode=re;break}e.offset=T,e.extra=k&15,e.mode=X0;case X0:if(e.extra){for(U=e.extra;a<U;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,a-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=re;break}e.mode=Z0;case Z0:if(l===0)break e;if(m=p-l,e.offset>m){if(m=e.offset-m,m>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=re;break}m>e.wnext?(m-=e.wnext,S=e.wsize-m):S=e.wnext-m,m>e.length&&(m=e.length),C=e.window}else C=r,S=s-e.offset,m=e.length;m>l&&(m=l),l-=m,e.length-=m;do r[s++]=C[S++];while(--m);e.length===0&&(e.mode=Jd);break;case Y0:if(l===0)break e;r[s++]=e.length,l--,e.mode=Jd;break;case Lm:if(e.wrap){for(;a<32;){if(d===0)break e;d--,c|=i[o++]<<a,a+=8}if(p-=l,n.total_out+=p,e.total+=p,e.wrap&4&&p&&(n.adler=e.check=e.flags?bt(e.check,r,p,s-p):Um(e.check,r,p,s-p)),p=l,e.wrap&4&&(e.flags?c:iT(c))!==e.check){n.msg="incorrect data check",e.mode=re;break}c=0,a=0}e.mode=eT;case eT:if(e.wrap&&e.flags){for(;a<32;){if(d===0)break e;d--,c+=i[o++]<<a,a+=8}if(e.wrap&4&&c!==(e.total&4294967295)){n.msg="incorrect length check",e.mode=re;break}c=0,a=0}e.mode=tT;case tT:A=VM;break e;case re:A=sT;break e;case Hm:return qm;case aT:default:return je}return n.next_out=s,n.avail_out=l,n.next_in=o,n.avail_in=d,e.hold=c,e.bits=a,(e.wsize||p!==n.avail_out&&e.mode<re&&(e.mode<Lm||t!==D0))&&fT(n,n.output,n.next_out,p-n.avail_out)?(e.mode=Hm,qm):(u-=n.avail_in,p-=n.avail_out,n.total_in+=u,n.total_out+=p,e.total+=p,e.wrap&4&&p&&(n.adler=e.check=e.flags?bt(e.check,r,p,n.next_out-p):Um(e.check,r,p,n.next_out-p)),n.data_type=e.bits+(e.last?64:0)+(e.mode===Dt?128:0)+(e.mode===Gd||e.mode===Nm?256:0),(u===0&&p===0||t===D0)&&A===_n&&(A=LM),A)},$M=n=>{if(wn(n))return je;let t=n.state;return t.window&&(t.window=null),n.state=null,_n},KM=(n,t)=>{if(wn(n))return je;let e=n.state;return(e.wrap&2)===0?je:(e.head=t,t.done=!1,_n)},GM=(n,t)=>{let e=t.length,i,r,o;return wn(n)||(i=n.state,i.wrap!==0&&i.mode!==Qd)?je:i.mode===Qd&&(r=1,r=Um(r,t,e,0),r!==i.check)?sT:(o=fT(n,t,e,e),o?(i.mode=Hm,qm):(i.havedict=1,_n))};it.exports.inflateReset=cT;it.exports.inflateReset2=lT;it.exports.inflateResetKeep=dT;it.exports.inflateInit=jM;it.exports.inflateInit2=uT;it.exports.inflate=zM;it.exports.inflateEnd=$M;it.exports.inflateGetHeader=KM;it.exports.inflateSetDictionary=GM;it.exports.inflateInfo="pako inflate (from Nodeca project)"});var mT=g((Hq,pT)=>{"use strict";function JM(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}pT.exports=JM});var yT=g((jq,Wr)=>{"use strict";var xt=hT(),vT=Pm(),zm=Mm(),$m=Hd(),QM=Rm(),XM=mT(),ST=Object.prototype.toString,{Z_NO_FLUSH:ZM,Z_FINISH:YM,Z_OK:Ns,Z_STREAM_END:jm,Z_NEED_DICT:Wm,Z_STREAM_ERROR:eR,Z_DATA_ERROR:gT,Z_MEM_ERROR:tR}=di();function Ls(n){this.options=vT.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(n&&n.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new QM,this.strm.avail_out=0;let e=xt.inflateInit2(this.strm,t.windowBits);if(e!==Ns)throw new Error($m[e]);if(this.header=new XM,xt.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=zm.string2buf(t.dictionary):ST.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=xt.inflateSetDictionary(this.strm,t.dictionary),e!==Ns)))throw new Error($m[e])}Ls.prototype.push=function(n,t){let e=this.strm,i=this.options.chunkSize,r=this.options.dictionary,o,s,d;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?YM:ZM,ST.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),o=xt.inflate(e,s),o===Wm&&r&&(o=xt.inflateSetDictionary(e,r),o===Ns?o=xt.inflate(e,s):o===gT&&(o=Wm));e.avail_in>0&&o===jm&&e.state.wrap>0&&n[e.next_in]!==0;)xt.inflateReset(e),o=xt.inflate(e,s);switch(o){case eR:case gT:case Wm:case tR:return this.onEnd(o),this.ended=!0,!1}if(d=e.avail_out,e.next_out&&(e.avail_out===0||o===jm))if(this.options.to==="string"){let l=zm.utf8border(e.output,e.next_out),c=e.next_out-l,a=zm.buf2string(e.output,l);e.next_out=c,e.avail_out=i-c,c&&e.output.set(e.output.subarray(l,l+c),0),this.onData(a)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(o===Ns&&d===0)){if(o===jm)return o=xt.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Ls.prototype.onData=function(n){this.chunks.push(n)};Ls.prototype.onEnd=function(n){n===Ns&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=vT.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function Km(n,t){let e=new Ls(t);if(e.push(n),e.err)throw e.msg||$m[e.err];return e.result}function iR(n,t){return t=t||{},t.raw=!0,Km(n,t)}Wr.exports.Inflate=Ls;Wr.exports.inflate=Km;Wr.exports.inflateRaw=iR;Wr.exports.ungzip=Km;Wr.exports.constants=di()});var bT=g((Wq,_t)=>{"use strict";var{Deflate:nR,deflate:rR,deflateRaw:oR,gzip:sR}=E0(),{Inflate:aR,inflate:dR,inflateRaw:cR,ungzip:lR}=yT(),uR=di();_t.exports.Deflate=nR;_t.exports.deflate=rR;_t.exports.deflateRaw=oR;_t.exports.gzip=sR;_t.exports.Inflate=aR;_t.exports.inflate=dR;_t.exports.inflateRaw=cR;_t.exports.ungzip=lR;_t.exports.constants=uR});var Jm=g(Gm=>{"use strict";Object.defineProperty(Gm,"__esModule",{value:!0});var _T=bT(),Bs=class n{constructor(t){this.logger=t}compress(t,e){if(e.length>0){let o=Math.min(e.length,n.MAX_DICTIONARY_SIZE);e=e.slice(0,o)}let i={memLevel:n.Z_MEM_LEVEL,dictionary:e};return _T.deflateRaw(t,i)}decompress(t,e){if(e.length>0){let o=Math.min(e.length,n.MAX_DICTIONARY_SIZE);e=e.slice(0,o)}let i={to:"string",dictionary:e,chunkSize:4096},r="";try{r=_T.inflateRaw(t,i)}catch(o){this.logger.error(`failed to decompress the string with error: [${o}]`)}return r}};Gm.default=Bs;Bs.Z_MEM_LEVEL=9;Bs.MAX_DICTIONARY_SIZE=31744});var Zm=g(Xm=>{"use strict";Object.defineProperty(Xm,"__esModule",{value:!0});var Qm=class{constructor(t,e,i,r,o,s,d,l,c,a){this.attendeeId=t,this.sdpOffer=e,this.audioHost=i,this.audioMuted=r,this.audioCheckin=o,this.receiveStreamIds=s,this.localVideoEnabled=d,this.videoStreamDescriptions=l,this.connectionTypeHasVideo=c,this.compressedSdpOffer=a,this.videoSubscriptionConfiguration=[]}};Xm.default=Qm});var Tn=g(nt=>{"use strict";var fR=nt&&nt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(nt,"__esModule",{value:!0});nt.VideoPreferences=nt.MutableVideoPreferences=nt.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration=void 0;var hR=fR(Rd());function pR(n,t,e){if(n.transceiverController.getMidForGroupId===void 0||n.videoStreamIndex.attendeeIdForGroupId===void 0||e===void 0)return[];let i=new Array,r=new Map,o=new Map;for(let s of t){let d=n.transceiverController.getMidForGroupId(s);if(d===void 0)continue;let l=n.videoStreamIndex.attendeeIdForGroupId(s);r.set(l,d),o.set(l,s)}for(let s of e){let d=new hR.default,l=r.get(s.attendeeId);l!==void 0&&(d.mid=l,d.attendeeId=s.attendeeId,d.groupId=o.get(s.attendeeId),d.priority=Number.MAX_SAFE_INTEGER-s.priority,d.targetBitrateKbps=s.targetSizeToBitrateKbps(s.targetSize),d.qualityAdaptationPreference=s.degradationPreference,i.push(d))}return i}nt.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration=pR;var Zd=class n{constructor(t=[]){this.items=t}static default(){return new n([])}[Symbol.iterator](){let t=0,e=this.items;return{next(){return t<e.length?{done:!1,value:e[t++]}:{done:!0,value:null}}}}first(){return this.items[0]}add(t){this.items.push(t)}replaceFirst(t,e){let i=this.items.findIndex(e);i===-1?this.items.push(t):this.has(t)?this.items.splice(i,1):this.items[i]=t}remove(t){this.items=this.items.filter(e=>!e.equals(t))}clear(){this.items=[]}isEmpty(){return this.items.length===0}equals(t){if(t===this)return!0;if(t.items.length!==this.items.length)return!1;for(let e of this.items)if(!t.items.some(i=>i.equals(e)))return!1;return!0}has(t){return this.items.some(e=>e.equals(t))}some(t){return this.items.some(t)}clone(){return new n([...this.items])}sort(){this.items.sort((t,e)=>t.partialCompare(e))}modify(){return new Yd(this)}},Yd=class{constructor(t=new Zd){this.items=t,this.copied=!1}cow(){this.copied||(this.items=this.items.clone(),this.copied=!0)}add(t){this.items.has(t)||(this.cow(),this.items.add(t))}replaceFirst(t,e){this.items.has(t)&&!this.items.some(e)||(this.cow(),this.items.replaceFirst(t,e))}remove(t){this.items.has(t)&&(this.cow(),this.items.remove(t))}some(t){return this.items.some(t)}clear(){this.items.isEmpty()||(this.cow(),this.items.clear())}build(){return this.copied&&this.items.sort(),this.copied=!1,this.items}},Fs=class{constructor(t){this.builder=t}add(t){this.builder.add(t)}replaceFirst(t,e){this.builder.replaceFirst(t,e)}remove(t){this.builder.remove(t)}some(t){return this.builder.some(t)}clear(){this.builder.clear()}build(){return new Us(this.builder.build())}};nt.MutableVideoPreferences=Fs;var Us=class n{constructor(t){this.items=t}static prepare(){return new Fs(new Yd)}static default(){return new n(Zd.default())}[Symbol.iterator](){return this.items[Symbol.iterator]()}highestPriority(){var t;return(t=this.items.first())===null||t===void 0?void 0:t.priority}sorted(){return this.items[Symbol.iterator]()}equals(t){return t===this||this.items.equals(t.items)}modify(){return new Fs(this.items.modify())}some(t){return this.items.some(t)}isEmpty(){return this.items.isEmpty()}clone(){let t=n.prepare();for(let e of this.items)t.add(e.clone());return t.build()}};nt.VideoPreferences=Us;nt.default=Us});var tg=g(kn=>{"use strict";var mR=kn&&kn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},In=kn&&kn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(kn,"__esModule",{value:!0});var gR=In(Gi()),wT=In(tt()),ec=In(Wi()),vR=In(Jm()),SR=ht(),yR=In(me()),bR=In(Zm()),Ym=oe(),_R=Tn(),wR=In(Z()),eg=class extends wR.default{constructor(t){super(t.logger),this.context=t,this.taskName="SubscribeAndReceiveSubscribeAckTask",this.taskCanceler=null,this.textCompressor=new vR.default(t.logger)}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return mR(this,void 0,void 0,function*(){let t="";if(this.context.peer&&this.context.peer.localDescription&&(t=new ec.default(this.context.peer.localDescription.sdp).withUnifiedPlanFormat().sdp),!this.context.enableSimulcast){let c=0,a=0;this.context.videoCaptureAndEncodeParameter&&(c=this.context.videoCaptureAndEncodeParameter.captureFrameRate(),a=this.context.videoCaptureAndEncodeParameter.encodeBitrates()[0]);let u={rid:"hi",maxBitrate:a*1e3,maxFramerate:c,active:!0};this.context.videoStreamIndex.integrateUplinkPolicyDecision([u])}let e=this.fixUpSubscriptionOrder(t,this.context.videoSubscriptions),i=this.context.videoDuplexMode===Ym.SdkStreamServiceType.TX||this.context.videoDuplexMode===Ym.SdkStreamServiceType.DUPLEX,r,o=t;if((this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension===void 0||!this.context.videoUplinkBandwidthPolicy.wantsVideoDependencyDescriptorRtpHeaderExtension())&&(o=new ec.default(o).withoutDependencyDescriptorRtpHeaderExtension().sdp),this.context.serverSupportsCompression){let c=this.context.previousSdpOffer?this.context.previousSdpOffer.sdp:"";r=this.textCompressor.compress(o,c),this.context.logger.info(`Compressed the SDP message from ${o.length} to ${r.length} bytes.`),t=""}this.context.previousSdpOffer=new ec.default(t);let s=new bR.default(this.context.meetingSessionConfiguration.credentials.attendeeId,t,this.context.meetingSessionConfiguration.urls.audioHostURL,this.context.realtimeController.realtimeIsLocalAudioMuted(),!1,e,i,this.context.videoStreamIndex.localStreamDescriptions(),!0,r);this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&!SR.serverSideNetworkAdaptionIsNoneOrDefault(this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption())&&this.context.videoDownlinkBandwidthPolicy.getVideoPreferences!==void 0&&(s.videoSubscriptionConfiguration=_R.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration(this.context,e.map(c=>c===0?0:this.context.videoStreamIndex.groupIdForStreamId(c)),this.context.videoDownlinkBandwidthPolicy.getVideoPreferences())),this.context.logger.info(`sending subscribe: ${JSON.stringify(s)}`),this.context.signalingClient.subscribe(s);let d=yield this.receiveSubscribeAck();this.context.logger.info(`got subscribe ack: ${JSON.stringify(d)}`);let l="";d.compressedSdpAnswer&&d.compressedSdpAnswer.length?(l=this.textCompressor.decompress(d.compressedSdpAnswer,this.context.previousSdpAnswerAsString),l.length===0&&(this.context.sdpAnswer="",this.context.previousSdpAnswerAsString="",this.logAndThrow("Error occurred while trying to decompress the SDP answer.")),this.context.logger.info(`Decompressed the SDP message from ${d.compressedSdpAnswer.length} to ${l.length} bytes.`),this.context.sdpAnswer=l):this.context.sdpAnswer=d.sdpAnswer,this.context.previousSdpAnswerAsString=this.context.sdpAnswer,this.context.videoStreamIndex.integrateSubscribeAckFrame(d)})}fixUpSubscriptionOrder(t,e){if(this.context.transceiverController.getMidForStreamId===void 0)return e;let i=new Map;for(let s of e){let d=this.context.transceiverController.getMidForStreamId(s);if(d===void 0){s!==0&&this.logger.warn(`Could not find MID for stream ID: ${s}`);continue}i.set(d,s)}let r=new ec.default(t).mediaSections(),o=[];for(let s of r)if(s.mediaType==="video")if(s.direction==="recvonly"){let d=i.get(s.mid);if(d===void 0){this.logger.warn(`Could not find stream ID for MID: ${s.mid}`);continue}o.push(d)}else o.push(0);return this.logger.info(`Fixed up ${JSON.stringify(e)} to ${JSON.stringify(o)} (may be same))}`),o}receiveSubscribeAck(){return new Promise((t,e)=>{let i=this.context;class r{constructor(d){this.signalingClient=d}cancel(){this.signalingClient.removeObserver(this),e(new Error("SubscribeAndReceiveSubscribeAckTask got canceled while waiting for SdkSubscribeAckFrame"))}handleSignalingClientEvent(d){if(d.isConnectionTerminated()){let c=`SubscribeAndReceiveSubscribeAckTask connection was terminated with code ${d.closeCode} and reason: ${d.closeReason}`;i.logger.warn(c);let a=wT.default.TaskFailed;d.closeCode>=4500&&d.closeCode<4600&&(a=wT.default.SignalingInternalServerError),i.audioVideoController.handleMeetingSessionStatus(new gR.default(a),new Error(c));return}if(d.type!==yR.default.ReceivedSignalFrame||d.message.type!==Ym.SdkSignalFrame.Type.SUBSCRIBE_ACK)return;this.signalingClient.removeObserver(this);let l=d.message.suback;t(l)}}let o=new r(this.context.signalingClient);this.context.signalingClient.registerObserver(o),this.taskCanceler=o})}};kn.default=eg});var tc=g(Cn=>{"use strict";var TR=Cn&&Cn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},TT=Cn&&Cn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Cn,"__esModule",{value:!0});var kR=TT(Qn()),IR=TT(Z()),ig=class extends IR.default{constructor(t,e,i){super(t),this.taskToRunBeforeTimeout=e,this.timeoutMs=i,this.taskName=`Timeout${this.timeoutMs}ms`,e.setParent(this)}cancel(){this.logger.info(`canceling timeout task ${this.name()} subtask ${this.taskToRunBeforeTimeout}`),this.taskToRunBeforeTimeout.cancel()}run(){return TR(this,void 0,void 0,function*(){let t=new kR.default(this.timeoutMs);t.start(()=>{this.logger.info(`timeout reached for task ${this.name()}`),this.taskToRunBeforeTimeout.cancel()});try{yield this.taskToRunBeforeTimeout.run()}finally{t.stop()}this.logger.info(`timeout task ${this.name()} completed`)})}};Cn.default=ig});var rg=g(On=>{"use strict";var CR=On&&On.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},kT=On&&On.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(On,"__esModule",{value:!0});var OR=kT(tt()),ER=kT(Z()),ng=class extends ER.default{constructor(t){super(t.logger),this.context=t,this.taskName="WaitForAttendeePresenceTask"}cancel(){if(this.cancelPromise){let t=new Error(`canceling ${this.name()} due to the meeting status code: ${OR.default.NoAttendeePresent}`);this.cancelPromise(t),delete this.cancelPromise}}run(){return CR(this,void 0,void 0,function*(){let t=this.context.meetingSessionConfiguration.credentials.attendeeId;return new Promise((e,i)=>{let r=(o,s,d,l,c)=>{t===o&&s&&(this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(r),e(),delete this.cancelPromise)};this.cancelPromise=o=>{this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(r),i(o)},this.context.realtimeController.realtimeSubscribeToAttendeeIdPresence(r)})})}};On.default=ng});var sg=g(og=>{"use strict";Object.defineProperty(og,"__esModule",{value:!0});var qs=class n{constructor(){this.maxRedPacketSizeBytes=1024,this.maxAudioPayloadSizeBytes=1e3,this.maxRedTimestampOffset=16384,this.redHeaderSizeBytes=4,this.redLastHeaderSizeBytes=1,this.redPacketizationTime=960,this.redPacketDistance=2,this.maxRedEncodings=2,this.redMaxRecoveryDistance=this.redPacketDistance*this.maxRedEncodings+1,this.maxEncodingHistorySize=10,this.numRedundantEncodings=0,this.redundancyEnabled=!0,this.lossReportInterval=48e3*5,this.maxOutOfOrderPacketDistance=16,this.OPUS_BAD_ARG=-1,this.OPUS_INVALID_PACKET=-4,this.OPUS_MAX_OPUS_FRAMES=48,this.OPUS_MAX_FRAME_SIZE_BYTES=1275,this.encodingHistory=new Array,this.opusPayloadType=0,this.redPayloadType=0,this.initializePacketLogs()}static initializeWorker(){n.log("Initializing RedundantAudioEncoder");let t=new n;self.RTCRtpScriptTransformer&&(self.onrtctransform=e=>{e.transformer.options.type==="SenderTransform"?t.setupSenderTransform(e.transformer.readable,e.transformer.writable):e.transformer.options.type==="ReceiverTransform"?t.setupReceiverTransform(e.transformer.readable,e.transformer.writable):e.transformer.options.type==="PassthroughTransform"&&t.setupPassthroughTransform(e.transformer.readable,e.transformer.writable)}),self.onmessage=e=>{e.data.msgType==="StartRedWorker"?(t.setupSenderTransform(e.data.send.readable,e.data.send.writable),t.setupReceiverTransform(e.data.receive.readable,e.data.receive.writable)):e.data.msgType==="PassthroughTransform"?(t.setupPassthroughTransform(e.data.send.readable,e.data.send.writable),t.setupPassthroughTransform(e.data.receive.readable,e.data.receive.writable)):e.data.msgType==="RedPayloadType"?t.setRedPayloadType(e.data.payloadType):e.data.msgType==="OpusPayloadType"?t.setOpusPayloadType(e.data.payloadType):e.data.msgType==="UpdateNumRedundantEncodings"?t.setNumRedundantEncodings(e.data.numRedundantEncodings):e.data.msgType==="Enable"?t.setRedundancyEnabled(!0):e.data.msgType==="Disable"&&t.setRedundancyEnabled(!1)}}static log(t){n.shouldLog&&self.postMessage({type:"REDWorkerLog",log:`[AudioRed] ${t}`})}static getNumRedundantEncodingsForPacketLoss(t){let e=0,i=!1;return t<=8?e=0:t<=18?e=1:t<=75?e=2:(e=0,i=!0),[e,i]}setupPassthroughTransform(t,e){n.log("Setting up passthrough transform"),t.pipeTo(e)}setupSenderTransform(t,e){n.log("Setting up sender RED transform");let i=new TransformStream({transform:this.senderTransform.bind(this)});t.pipeThrough(i).pipeTo(e)}setupReceiverTransform(t,e){n.log("Setting up receiver RED transform");let i=new TransformStream({transform:this.receivePacketLogTransform.bind(this)});t.pipeThrough(i).pipeTo(e)}setRedPayloadType(t){this.redPayloadType=t,n.log(`red payload type set to ${this.redPayloadType}`)}setOpusPayloadType(t){this.opusPayloadType=t,n.log(`opus payload type set to ${this.opusPayloadType}`)}setNumRedundantEncodings(t){this.numRedundantEncodings=t,this.numRedundantEncodings>this.maxRedEncodings&&(this.numRedundantEncodings=this.maxRedEncodings),n.log(`Updated numRedundantEncodings to ${this.numRedundantEncodings}`)}setRedundancyEnabled(t){this.redundancyEnabled=t,n.log(`redundancy ${this.redundancyEnabled?"enabled":"disabled"}`)}enqueueAudioFrameIfPayloadSizeIsValid(t,e){t.data.byteLength>this.maxAudioPayloadSizeBytes||e.enqueue(t)}senderTransform(t,e){if(t.getMetadata().payloadType!==this.redPayloadType){this.enqueueAudioFrameIfPayloadSizeIsValid(t,e);return}let r=this.getPrimaryPayload(t.timestamp,t.data);if(!r){this.enqueueAudioFrameIfPayloadSizeIsValid(t,e);return}let o=this.encode(t.timestamp,r);if(!o){this.enqueueAudioFrameIfPayloadSizeIsValid(t,e);return}t.data=o,this.enqueueAudioFrameIfPayloadSizeIsValid(t,e)}getPrimaryPayload(t,e){let i=this.splitEncodings(t,e);return!i||i.length<1?null:i[i.length-1].payload}splitEncodings(t,e,i=!1,r=void 0){let o=new DataView(e),s=o.byteLength,d=0,l=0,c=0,a=0,u=!1,p=new Array,m=new Array,S=new Array;for(;s>0;)if(u=(o.getUint8(a)&128)===0,u){if((o.getUint8(a)&127)!==this.opusPayloadType||(d+=this.redLastHeaderSizeBytes,l+=this.redLastHeaderSizeBytes,d>=o.byteLength))return null;c=o.byteLength-d;break}else{if(s<this.redHeaderSizeBytes)return null;let w=((o.getUint8(a+2)&3)<<8)+o.getUint8(a+3);m.push(w);let D=o.getUint16(a+1)>>2,L=t-D;S.push(L),d+=w+this.redHeaderSizeBytes,l+=this.redHeaderSizeBytes,a+=this.redHeaderSizeBytes,s-=this.redHeaderSizeBytes}if(!u)return r!==void 0?(p.push({payload:e,isRedundant:!1,seq:r}),p):null;let C=l;for(let w=0;w<S.length;w++){let D=new ArrayBuffer(m[w]);new Uint8Array(D).set(new Uint8Array(o.buffer,C,m[w]),0);let O={timestamp:S[w],payload:D,isRedundant:!0};i&&(O.hasFec=this.opusPacketHasFec(new DataView(D),D.byteLength)),p.push(O),C+=m[w]}let I=o.byteLength-c,_=new ArrayBuffer(c);new Uint8Array(_).set(new Uint8Array(o.buffer,I,c),0);let T={timestamp:t,payload:_,isRedundant:!1,seq:r};return i&&(T.hasFec=this.opusPacketHasFec(new DataView(_),_.byteLength)),p.push(T),p}encode(t,e){let i=e.byteLength;if(i===0||i>=this.maxRedPacketSizeBytes||i>=this.maxAudioPayloadSizeBytes)return null;let r=this.numRedundantEncodings,o=this.redLastHeaderSizeBytes,s=i,d=this.maxAudioPayloadSizeBytes-i-o,l=new Array,c=new Array;if(this.redundancyEnabled){let S=this.uint32WrapAround(t-this.redPacketizationTime*this.redPacketDistance);for(let C=0;C<r&&!(this.uint32WrapAround(t-S)>=this.maxRedTimestampOffset);C++){let I=S,_=this.encodingHistory.find(k=>k.timestamp===I);if(_||(I=this.uint32WrapAround(S-this.redPacketizationTime),_=this.encodingHistory.find(k=>k.timestamp===I)),_){let k=_.payload.byteLength;if(d<this.redHeaderSizeBytes+k)break;d-=this.redHeaderSizeBytes+k,o+=this.redHeaderSizeBytes,s+=k,l.unshift(_.timestamp),c.unshift(_.payload)}S-=this.redPacketizationTime*this.redPacketDistance,S=this.uint32WrapAround(S)}}let a=new ArrayBuffer(o+s),u=new DataView(a),p=0;for(let S=0;S<l.length;S++){let C=t-l[S];u.setUint8(p,this.opusPayloadType|128),u.setUint16(p+1,C<<2|c[S].byteLength>>8),u.setUint8(p+3,c[S].byteLength&255),p+=this.redHeaderSizeBytes}u.setUint8(p,this.opusPayloadType),p+=this.redLastHeaderSizeBytes;let m=new Uint8Array(a);for(let S=0;S<c.length;S++)m.set(new Uint8Array(c[S]),p),p+=c[S].byteLength;return m.set(new Uint8Array(e),p),p+=e.byteLength,p!==o+s?null:(this.updateEncodingHistory(t,e),a)}updateEncodingHistory(t,e){for(let r of this.encodingHistory){let o=this.redPacketizationTime*this.redMaxRecoveryDistance;if(t-r.timestamp>=o)this.encodingHistory.shift();else break}let i=new DataView(e);(this.opusPacketIsCeltOnly(i)||this.opusPacketHasVoiceActivity(i,i.byteLength)>0)&&(this.encodingHistory.length+1>this.maxEncodingHistorySize&&(this.encodingHistory.length=0),this.encodingHistory.push({timestamp:t,payload:e}))}initializePacketLogs(){let t=this.maxOutOfOrderPacketDistance+this.redMaxRecoveryDistance;this.primaryPacketLog={window:new Array(t),index:0,windowSize:t},this.redRecoveryLog={window:new Array(t),index:0,windowSize:t},this.fecRecoveryLog={window:new Array(t),index:0,windowSize:t},this.totalAudioPacketsExpected=0,this.totalAudioPacketsLost=0,this.totalAudioPacketsRecoveredRed=0,this.totalAudioPacketsRecoveredFec=0}receivePacketLogTransform(t,e){let i=t.getMetadata();if(i.payloadType!==this.redPayloadType){this.enqueueAudioFrameIfPayloadSizeIsValid(t,e);return}let r=this.splitEncodings(t.timestamp,t.data,!0,i.sequenceNumber);if(!r){this.enqueueAudioFrameIfPayloadSizeIsValid(t,e);return}for(let o=r.length-1;o>=0;o--)this.updateLossStats(r[o])&&(this.updateRedStats(r[o]),this.updateFecStats(r[o]));this.maybeReportLossStats(i.synchronizationSource,r[r.length-1].timestamp),this.enqueueAudioFrameIfPayloadSizeIsValid(t,e)}updateLossStats(t){if(t.isRedundant)return!0;let e=t.timestamp,i=t.seq;if(this.totalAudioPacketsExpected===0)return this.totalAudioPacketsExpected=1,this.newestSequenceNumber=i,this.addTimestamp(this.primaryPacketLog,e),!0;let r=this.int16(i-this.newestSequenceNumber);return r<-this.maxOutOfOrderPacketDistance?!1:(r<0?this.hasTimestamp(this.primaryPacketLog,e)||(this.totalAudioPacketsLost>0&&this.totalAudioPacketsLost--,this.addTimestamp(this.primaryPacketLog,e),this.removeFromRecoveryWindows(e)):r>1&&(this.totalAudioPacketsLost+=r-1),r>0&&(this.totalAudioPacketsExpected+=r,this.newestSequenceNumber=t.seq,this.addTimestamp(this.primaryPacketLog,e)),!0)}updateRedStats(t){if(!t.isRedundant||this.totalAudioPacketsLost===0)return;let e=t.timestamp;this.hasTimestamp(this.primaryPacketLog,e)||(this.hasTimestamp(this.redRecoveryLog,e)||(this.totalAudioPacketsRecoveredRed++,this.addTimestamp(this.redRecoveryLog,e)),this.removeTimestamp(this.fecRecoveryLog,e)&&this.totalAudioPacketsRecoveredFec>0&&this.totalAudioPacketsRecoveredFec--)}updateFecStats(t){if(!t.hasFec||this.totalAudioPacketsLost===0)return;let e=t.timestamp-this.redPacketizationTime;this.hasTimestamp(this.primaryPacketLog,e)||this.hasTimestamp(this.redRecoveryLog,e)||this.hasTimestamp(this.fecRecoveryLog,e)||(this.totalAudioPacketsRecoveredFec++,this.addTimestamp(this.fecRecoveryLog,e))}maybeReportLossStats(t,e){e===void 0||e-this.lastLossReportTimestamp<this.lossReportInterval||(n.shouldReportStats&&self.postMessage({type:"RedundantAudioEncoderStats",ssrc:t,totalAudioPacketsLost:this.totalAudioPacketsLost,totalAudioPacketsExpected:this.totalAudioPacketsExpected,totalAudioPacketsRecoveredRed:this.totalAudioPacketsRecoveredRed,totalAudioPacketsRecoveredFec:this.totalAudioPacketsRecoveredFec}),this.lastLossReportTimestamp=e)}addTimestamp(t,e){e!==void 0&&(t.window[t.index]=e,t.index=(t.index+1)%t.windowSize)}hasTimestamp(t,e){return!!t.window.find(r=>r===e)}removeTimestamp(t,e){let i=t.window.indexOf(e);return i>=0?(t.window[i]=void 0,!0):!1}removeFromRecoveryWindows(t){let e=this.removeTimestamp(this.redRecoveryLog,t);e&&this.totalAudioPacketsRecoveredRed>0&&this.totalAudioPacketsRecoveredRed--,e=this.removeTimestamp(this.fecRecoveryLog,t),e&&this.totalAudioPacketsRecoveredFec>0&&this.totalAudioPacketsRecoveredFec--}uint32WrapAround(t){let i=t;return t>=4294967296?i=t-4294967296:t<0&&(i=4294967296+t),i}int16(t){return t<<16>>16}opusPacketIsCeltOnly(t){return!!(t.getUint8(0)&128)}opusPacketGetSamplesPerFrame(t,e){e=Math.round(e),e=Math.min(Math.max(e,-Math.pow(2,32)),Math.pow(2,32)-1);let i,r;return this.opusPacketIsCeltOnly(t)?(r=t.getUint8(0)>>3&3,i=(e<<r)/400):(t.getUint8(0)&96)===96?i=t.getUint8(0)&8?e/50:e/100:(r=t.getUint8(0)>>3&3,r===3?i=e*60/1e3:i=(e<<r)/100),i}opusNumSilkFrames(t){let e=this.opusPacketGetSamplesPerFrame(t,48e3)/48;switch(e<10&&(e=10),e){case 10:case 20:return 1;case 40:return 2;case 60:return 3;default:return 0}}opusPacketGetNumChannels(t){return t.getUint8(0)&4?2:1}opusParseSize(t,e,i,r){return i<1?(r[0]=-1,-1):t.getUint8(e)<252?(r[0]=t.getUint8(e),1):i<2?(r[0]=-1,-1):(r[0]=4*t.getUint8(e+1)+t.getUint8(e),2)}opusPacketParseImpl(t,e,i,r,o,s,d,l){if(!s||e<0)return this.OPUS_BAD_ARG;if(e===0)return this.OPUS_INVALID_PACKET;let c,a,u=0,p=!1,m=t.getUint8(0);r&&(r[0]=m);let S=e-1,C=1,I=S;switch(m&3){case 0:c=1;break;case 1:if(c=2,p=!0,!i){if(S&1)return this.OPUS_INVALID_PACKET;I=S/2,s[0][0]=I}break;case 2:if(c=2,a=this.opusParseSize(t,C,S,s[0]),S-=a,s[0][0]<0||s[0][0]>S)return this.OPUS_INVALID_PACKET;C+=a,I=S-s[0][0];break;default:if(S<1)return this.OPUS_INVALID_PACKET;let _=t.getUint8(C++);if(--S,c=_&63,c<=0)return this.OPUS_INVALID_PACKET;if(this.opusPacketGetSamplesPerFrame(t,48e3)*c>5760)return this.OPUS_INVALID_PACKET;if(_&64){let T,w;do{if(S<=0)return this.OPUS_INVALID_PACKET;T=t.getUint8(C++),--S,w=T===255?254:T,S-=w,u+=w}while(T===255)}if(S<0)return this.OPUS_INVALID_PACKET;if(p=!(_&128),p){if(!i){if(I=Math.trunc(S/c),I*c!==S)return this.OPUS_INVALID_PACKET;for(let T=0;T<c-1;++T)s[T][0]=I}}else{I=S;for(let T=0;T<c-1;++T){if(a=this.opusParseSize(t,C,S,s[T]),S-=a,s[T][0]<0||s[T][0]>S)return this.OPUS_INVALID_PACKET;C+=a,I-=a+s[T][0]}if(I<0)return this.OPUS_INVALID_PACKET}}if(i){if(a=this.opusParseSize(t,C,S,s[c-1]),S-=a,s[c-1][0]<0||s[c-1][0]>S)return this.OPUS_INVALID_PACKET;if(C+=a,p){if(s[c-1][0]*c>S)return this.OPUS_INVALID_PACKET;for(let _=0;_<c-1;++_)s[_][0]=s[c-1][0]}else if(!(a+s[c-1][0]<=I))return this.OPUS_INVALID_PACKET}else{if(I>this.OPUS_MAX_FRAME_SIZE_BYTES)return this.OPUS_INVALID_PACKET;s[c-1][0]=I}d&&(d[0]=C);for(let _=0;_<c;++_)o&&(o[_][0]=C),C+=s[_][0];return l&&(l[0]=C+u),c}opusPacketParse(t,e,i,r,o,s){return this.opusPacketParseImpl(t,e,!1,i,r,o,s,null)}opusPacketHasVoiceActivity(t,e){if(!t||e<=0)return 0;if(this.opusPacketIsCeltOnly(t))return-1;let i=this.opusNumSilkFrames(t);if(i===0)return-1;let r=new Array(this.OPUS_MAX_OPUS_FRAMES),o=new Array(this.OPUS_MAX_OPUS_FRAMES);for(let d=0;d<this.OPUS_MAX_OPUS_FRAMES;++d)r[d]=[void 0],o[d]=[void 0];let s=this.opusPacketParse(t,e,null,r,o,null);if(s<0)return-1;for(let d=0;d<s;++d){if(o[d][0]<1)continue;if(t.getUint8(r[d][0])>>8-i||this.opusPacketGetNumChannels(t)===2&&t.getUint8(r[d][0])<<i+1>>8-i)return 1}return 0}opusPacketHasFec(t,e){if(!t||e<=0||this.opusPacketIsCeltOnly(t))return!1;let i=new Array(this.OPUS_MAX_OPUS_FRAMES),r=new Array(this.OPUS_MAX_OPUS_FRAMES);for(let l=0;l<this.OPUS_MAX_OPUS_FRAMES;++l)i[l]=[void 0],r[l]=[void 0];if(this.opusPacketParse(t,e,null,i,r,null)<0||r[0][0]<=1)return!1;let s=this.opusNumSilkFrames(t);if(s===0)return!1;let d=this.opusPacketGetNumChannels(t);if(d!==1&&d!==2)return!1;for(let l=0;l<d;l++)if(t.getUint8(i[0][0])&128>>(l+1)*(s+1)-1)return!0;return!1}};og.default=qs;qs.shouldLog=!1;qs.shouldReportStats=!1});var dg=g(ag=>{"use strict";Object.defineProperty(ag,"__esModule",{value:!0});var AR=`class RedundantAudioEncoder {
    constructor() {
        // Each payload must be less than 1024 bytes to fit the 10 bit block length
        this.maxRedPacketSizeBytes = 1 << 10;
        // Limit payload to 1000 bytes to handle small MTU. 1000 is chosen because in Chromium-based browsers, writing audio
        // payloads larger than 1000 bytes using the WebRTC Insertable Streams API (which is used to enable dynamic audio
        // redundancy) will cause an error to be thrown and cause audio flow to permanently stop. See
        // https://crbug.com/1248479.
        this.maxAudioPayloadSizeBytes = 1000;
        // Each payload can encode a timestamp delta of 14 bits
        this.maxRedTimestampOffset = 1 << 14;
        // 4 byte RED header
        this.redHeaderSizeBytes = 4;
        // reduced size for last RED header
        this.redLastHeaderSizeBytes = 1;
        // P-Time for Opus 20 msec packets
        // We do not support other p-times or clock rates
        this.redPacketizationTime = 960;
        // distance between redundant payloads, Opus FEC handles a distance of 1
        // TODO(https://issues.amazon.com/issues/ChimeSDKAudio-55):
        // Consider making this dynamic
        this.redPacketDistance = 2;
        // maximum number of redundant payloads per RTP packet
        this.maxRedEncodings = 2;
        // Maximum number of encodings that can be recovered with a single RED packet, assuming the primary and redundant
        // payloads have FEC.
        this.redMaxRecoveryDistance = this.redPacketDistance * this.maxRedEncodings + 1;
        // maximum history of prior payloads to keep
        // generally we will expire old entries based on timestamp
        // this limit is in place just to make sure the history does not
        // grow too large in the case of erroneous timestamp inputs
        this.maxEncodingHistorySize = 10;
        // Current number of encodings we want to send
        // to the remote end. This will be dynamically
        // updated through the setNumEncodingsFromPacketloss API
        this.numRedundantEncodings = 0;
        // Used to enable or disable redundancy
        // in response to very high packet loss events
        this.redundancyEnabled = true;
        // Loss stats are reported to the main thread every 5 seconds.
        // Since timestamp differences between 2 consecutive packets
        // give us the number of samples in each channel, 1 second
        // is equivalent to 48000 samples:
        // P-time * (1000ms/1s)
        // = (960 samples/20ms) * (1000ms/1s)
        // = 48000 samples/s
        this.lossReportInterval = 48000 * 5;
        // Maximum distance of a packet from the most recent packet timestamp
        // that we will consider for recovery.
        this.maxOutOfOrderPacketDistance = 16;
        /**
         * Below are Opus helper methods and constants.
         */
        this.OPUS_BAD_ARG = -1;
        this.OPUS_INVALID_PACKET = -4;
        // Max number of Opus frames in an Opus packet is 48 (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.5).
        this.OPUS_MAX_OPUS_FRAMES = 48;
        // Max number of bytes that any individual Opus frame can have.
        this.OPUS_MAX_FRAME_SIZE_BYTES = 1275;
        this.encodingHistory = new Array();
        this.opusPayloadType = 0;
        this.redPayloadType = 0;
        this.initializePacketLogs();
    }
    /**
     * Creates an instance of RedundantAudioEncoder and sets up callbacks.
     */
    static initializeWorker() {
        RedundantAudioEncoder.log('Initializing RedundantAudioEncoder');
        const encoder = new RedundantAudioEncoder();
        // RED encoding is done using WebRTC Encoded Transform
        // https://github.com/w3c/webrtc-encoded-transform/blob/main/explainer.md
        // Check the DedicatedWorkerGlobalScope for existence of
        // RTCRtpScriptTransformer interface. If exists, then
        // RTCRtpScriptTransform is supported by this browser.
        // @ts-ignore
        if (self.RTCRtpScriptTransformer) {
            // @ts-ignore
            self.onrtctransform = (event) => {
                if (event.transformer.options.type === 'SenderTransform') {
                    encoder.setupSenderTransform(event.transformer.readable, event.transformer.writable);
                }
                else if (event.transformer.options.type === 'ReceiverTransform') {
                    encoder.setupReceiverTransform(event.transformer.readable, event.transformer.writable);
                }
                else if (event.transformer.options.type === 'PassthroughTransform') {
                    encoder.setupPassthroughTransform(event.transformer.readable, event.transformer.writable);
                }
            };
        }
        self.onmessage = (event) => {
            if (event.data.msgType === 'StartRedWorker') {
                encoder.setupSenderTransform(event.data.send.readable, event.data.send.writable);
                encoder.setupReceiverTransform(event.data.receive.readable, event.data.receive.writable);
            }
            else if (event.data.msgType === 'PassthroughTransform') {
                encoder.setupPassthroughTransform(event.data.send.readable, event.data.send.writable);
                encoder.setupPassthroughTransform(event.data.receive.readable, event.data.receive.writable);
            }
            else if (event.data.msgType === 'RedPayloadType') {
                encoder.setRedPayloadType(event.data.payloadType);
            }
            else if (event.data.msgType === 'OpusPayloadType') {
                encoder.setOpusPayloadType(event.data.payloadType);
            }
            else if (event.data.msgType === 'UpdateNumRedundantEncodings') {
                encoder.setNumRedundantEncodings(event.data.numRedundantEncodings);
            }
            else if (event.data.msgType === 'Enable') {
                encoder.setRedundancyEnabled(true);
            }
            else if (event.data.msgType === 'Disable') {
                encoder.setRedundancyEnabled(false);
            }
        };
    }
    /**
     * Post logs to the main thread
     */
    static log(msg) {
        if (RedundantAudioEncoder.shouldLog) {
            // @ts-ignore
            self.postMessage({
                type: 'REDWorkerLog',
                log: \`[AudioRed] \${msg}\`,
            });
        }
    }
    /**
     * Returns the number of encodings based on packetLoss value. This is used by \`DefaultTransceiverController\` to
     * determine when to alert the encoder to update the number of encodings. It also determines if we need to
     * turn off red in cases of very high packet loss to avoid congestion collapse.
     */
    static getNumRedundantEncodingsForPacketLoss(packetLoss) {
        let recommendedRedundantEncodings = 0;
        let shouldTurnOffRed = false;
        if (packetLoss <= 8) {
            recommendedRedundantEncodings = 0;
        }
        else if (packetLoss <= 18) {
            recommendedRedundantEncodings = 1;
        }
        else if (packetLoss <= 75) {
            recommendedRedundantEncodings = 2;
        }
        else {
            recommendedRedundantEncodings = 0;
            shouldTurnOffRed = true;
        }
        return [recommendedRedundantEncodings, shouldTurnOffRed];
    }
    /**
     * Sets up a passthrough (no-op) transform for the given streams.
     */
    setupPassthroughTransform(readable, writable) {
        RedundantAudioEncoder.log('Setting up passthrough transform');
        readable.pipeTo(writable);
    }
    /**
     * Sets up the transform stream and pipes the outgoing encoded audio frames through the transform function.
     */
    setupSenderTransform(readable, writable) {
        RedundantAudioEncoder.log('Setting up sender RED transform');
        const transformStream = new TransformStream({
            transform: this.senderTransform.bind(this),
        });
        readable.pipeThrough(transformStream).pipeTo(writable);
        return;
    }
    /**
     * Sets up the transform stream and pipes the received encoded audio frames through the transform function.
     */
    setupReceiverTransform(readable, writable) {
        RedundantAudioEncoder.log('Setting up receiver RED transform');
        const transformStream = new TransformStream({
            transform: this.receivePacketLogTransform.bind(this),
        });
        readable.pipeThrough(transformStream).pipeTo(writable);
        return;
    }
    /**
     * Set the RED payload type ideally obtained from local offer.
     */
    setRedPayloadType(payloadType) {
        this.redPayloadType = payloadType;
        RedundantAudioEncoder.log(\`red payload type set to \${this.redPayloadType}\`);
    }
    /**
     * Set the opus payload type ideally obtained from local offer.
     */
    setOpusPayloadType(payloadType) {
        this.opusPayloadType = payloadType;
        RedundantAudioEncoder.log(\`opus payload type set to \${this.opusPayloadType}\`);
    }
    /**
     * Set the number of redundant encodings
     */
    setNumRedundantEncodings(numRedundantEncodings) {
        this.numRedundantEncodings = numRedundantEncodings;
        if (this.numRedundantEncodings > this.maxRedEncodings) {
            this.numRedundantEncodings = this.maxRedEncodings;
        }
        RedundantAudioEncoder.log(\`Updated numRedundantEncodings to \${this.numRedundantEncodings}\`);
    }
    /**
     * Enable or disable redundancy in response to
     * high packet loss event.
     */
    setRedundancyEnabled(enabled) {
        this.redundancyEnabled = enabled;
        RedundantAudioEncoder.log(\`redundancy \${this.redundancyEnabled ? 'enabled' : 'disabled'}\`);
    }
    /**
     * Helper function to only enqueue audio frames if they do not exceed the audio payload byte limit imposed by
     * Chromium-based browsers. Chromium will throw an error (https://crbug.com/1248479) if an audio payload larger than
     * 1000 bytes is enqueued. Any controller that attempts to enqueue an audio payload larger than 1000 bytes will
     * encounter this error and will permanently stop sending or receiving audio.
     */
    enqueueAudioFrameIfPayloadSizeIsValid(
    // @ts-ignore
    frame, controller) {
        if (frame.data.byteLength > this.maxAudioPayloadSizeBytes)
            return;
        controller.enqueue(frame);
    }
    /**
     * Receives encoded frames and modifies as needed before sending to transport.
     */
    senderTransform(
    // @ts-ignore
    frame, controller) {
        const frameMetadata = frame.getMetadata();
        // @ts-ignore
        if (frameMetadata.payloadType !== this.redPayloadType) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        const primaryPayloadBuffer = this.getPrimaryPayload(frame.timestamp, frame.data);
        if (!primaryPayloadBuffer) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        const encodedBuffer = this.encode(frame.timestamp, primaryPayloadBuffer);
        /* istanbul ignore next */
        if (!encodedBuffer) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        frame.data = encodedBuffer;
        this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
        return;
    }
    /**
     * Get the primary payload from encoding
     */
    getPrimaryPayload(primaryTimestamp, frame) {
        const encodings = this.splitEncodings(primaryTimestamp, frame);
        if (!encodings || encodings.length < 1)
            return null;
        return encodings[encodings.length - 1].payload;
    }
    /**
     * Split up the encoding received into primary and redundant encodings
     * These will be ordered oldest to newest which is the same ordering
     * in the RTP red payload.
     */
    splitEncodings(primaryTimestamp, frame, getFecInfo = false, primarySequenceNumber = undefined) {
        // process RED headers (according to RFC 2198)
        //   0                   1                   2                   3
        //   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        //  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        //  |F|   block PT  |  timestamp offset         |   block length    |
        //  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        //
        // last header
        //   0 1 2 3 4 5 6 7
        //  +-+-+-+-+-+-+-+-+
        //  |0|   Block PT  |
        //  +-+-+-+-+-+-+-+-+
        const payload = new DataView(frame);
        let payloadSizeBytes = payload.byteLength;
        let totalPayloadSizeBytes = 0;
        let totalHeaderSizeBytes = 0;
        let primaryPayloadSizeBytes = 0;
        let payloadOffset = 0;
        let gotLastBlock = false;
        const encodings = new Array();
        const redundantEncodingBlockLengths = new Array();
        const redundantEncodingTimestamps = new Array();
        while (payloadSizeBytes > 0) {
            gotLastBlock = (payload.getUint8(payloadOffset) & 0x80) === 0;
            if (gotLastBlock) {
                // Bits 1 through 7 are payload type
                const payloadType = payload.getUint8(payloadOffset) & 0x7f;
                // Unexpected payload type. This is a bad packet.
                if (payloadType !== this.opusPayloadType) {
                    return null;
                }
                totalPayloadSizeBytes += this.redLastHeaderSizeBytes;
                totalHeaderSizeBytes += this.redLastHeaderSizeBytes;
                // Accumulated block lengths are equal to or larger than the buffer, which means there is no primary block. This
                // is a bad packet.
                if (totalPayloadSizeBytes >= payload.byteLength) {
                    return null;
                }
                primaryPayloadSizeBytes = payload.byteLength - totalPayloadSizeBytes;
                break;
            }
            else {
                if (payloadSizeBytes < this.redHeaderSizeBytes) {
                    return null;
                }
                // Bits 22 through 31 are payload length
                const blockLength = ((payload.getUint8(payloadOffset + 2) & 0x03) << 8) + payload.getUint8(payloadOffset + 3);
                redundantEncodingBlockLengths.push(blockLength);
                const timestampOffset = payload.getUint16(payloadOffset + 1) >> 2;
                const timestamp = primaryTimestamp - timestampOffset;
                redundantEncodingTimestamps.push(timestamp);
                totalPayloadSizeBytes += blockLength + this.redHeaderSizeBytes;
                totalHeaderSizeBytes += this.redHeaderSizeBytes;
                payloadOffset += this.redHeaderSizeBytes;
                payloadSizeBytes -= this.redHeaderSizeBytes;
            }
        }
        // The last block was never found. The packet we received
        // does not have a good RED payload.
        if (!gotLastBlock) {
            // Note that sequence numbers only exist for
            // incoming audio frames.
            if (primarySequenceNumber !== undefined) {
                // This could be a possible padding packet used
                // for BWE with a good sequence number.
                // Create a dummy encoding to make sure loss values
                // are calculated correctly by consuming sequence number.
                // Note that for the receive side, we process packets only
                // for loss/recovery calculations and forward the original
                // packet without changing it even in the error case.
                encodings.push({
                    payload: frame,
                    isRedundant: false,
                    seq: primarySequenceNumber,
                });
                return encodings;
            }
            // This is a bad packet.
            return null;
        }
        let redundantPayloadOffset = totalHeaderSizeBytes;
        for (let i = 0; i < redundantEncodingTimestamps.length; i++) {
            const redundantPayloadBuffer = new ArrayBuffer(redundantEncodingBlockLengths[i]);
            const redundantPayloadArray = new Uint8Array(redundantPayloadBuffer);
            redundantPayloadArray.set(new Uint8Array(payload.buffer, redundantPayloadOffset, redundantEncodingBlockLengths[i]), 0);
            const encoding = {
                timestamp: redundantEncodingTimestamps[i],
                payload: redundantPayloadBuffer,
                isRedundant: true,
            };
            if (getFecInfo) {
                encoding.hasFec = this.opusPacketHasFec(new DataView(redundantPayloadBuffer), redundantPayloadBuffer.byteLength);
            }
            encodings.push(encoding);
            redundantPayloadOffset += redundantEncodingBlockLengths[i];
        }
        const primaryPayloadOffset = payload.byteLength - primaryPayloadSizeBytes;
        const primaryPayloadBuffer = new ArrayBuffer(primaryPayloadSizeBytes);
        const primaryArray = new Uint8Array(primaryPayloadBuffer);
        primaryArray.set(new Uint8Array(payload.buffer, primaryPayloadOffset, primaryPayloadSizeBytes), 0);
        const encoding = {
            timestamp: primaryTimestamp,
            payload: primaryPayloadBuffer,
            isRedundant: false,
            seq: primarySequenceNumber,
        };
        if (getFecInfo) {
            encoding.hasFec = this.opusPacketHasFec(new DataView(primaryPayloadBuffer), primaryPayloadBuffer.byteLength);
        }
        encodings.push(encoding);
        return encodings;
    }
    /**
     * Create a new encoding with current primary payload and the older payloads of choice.
     */
    encode(primaryTimestamp, primaryPayload) {
        const primaryPayloadSize = primaryPayload.byteLength;
        // Payload size needs to be valid.
        if (primaryPayloadSize === 0 ||
            primaryPayloadSize >= this.maxRedPacketSizeBytes ||
            primaryPayloadSize >= this.maxAudioPayloadSizeBytes) {
            return null;
        }
        const numRedundantEncodings = this.numRedundantEncodings;
        let headerSizeBytes = this.redLastHeaderSizeBytes;
        let payloadSizeBytes = primaryPayloadSize;
        let bytesAvailable = this.maxAudioPayloadSizeBytes - primaryPayloadSize - headerSizeBytes;
        const redundantEncodingTimestamps = new Array();
        const redundantEncodingPayloads = new Array();
        // If redundancy is disabled then only send the primary payload
        if (this.redundancyEnabled) {
            // Determine how much redundancy we can fit into our packet
            let redundantTimestamp = this.uint32WrapAround(primaryTimestamp - this.redPacketizationTime * this.redPacketDistance);
            for (let i = 0; i < numRedundantEncodings; i++) {
                // Do not add redundant encodings that are beyond the maximum timestamp offset.
                if (this.uint32WrapAround(primaryTimestamp - redundantTimestamp) >= this.maxRedTimestampOffset) {
                    break;
                }
                let findTimestamp = redundantTimestamp;
                let encoding = this.encodingHistory.find(e => e.timestamp === findTimestamp);
                if (!encoding) {
                    // If not found or not important then look for the previous packet.
                    // The current packet may have included FEC for the previous, so just
                    // use the previous packet instead provided that it has voice activity.
                    findTimestamp = this.uint32WrapAround(redundantTimestamp - this.redPacketizationTime);
                    encoding = this.encodingHistory.find(e => e.timestamp === findTimestamp);
                }
                if (encoding) {
                    const redundantEncodingSizeBytes = encoding.payload.byteLength;
                    // Only add redundancy if there are enough bytes available.
                    if (bytesAvailable < this.redHeaderSizeBytes + redundantEncodingSizeBytes)
                        break;
                    bytesAvailable -= this.redHeaderSizeBytes + redundantEncodingSizeBytes;
                    headerSizeBytes += this.redHeaderSizeBytes;
                    payloadSizeBytes += redundantEncodingSizeBytes;
                    redundantEncodingTimestamps.unshift(encoding.timestamp);
                    redundantEncodingPayloads.unshift(encoding.payload);
                }
                redundantTimestamp -= this.redPacketizationTime * this.redPacketDistance;
                redundantTimestamp = this.uint32WrapAround(redundantTimestamp);
            }
        }
        const redPayloadBuffer = new ArrayBuffer(headerSizeBytes + payloadSizeBytes);
        const redPayloadView = new DataView(redPayloadBuffer);
        // Add redundant encoding header(s) to new buffer
        let redPayloadOffset = 0;
        for (let i = 0; i < redundantEncodingTimestamps.length; i++) {
            const timestampDelta = primaryTimestamp - redundantEncodingTimestamps[i];
            redPayloadView.setUint8(redPayloadOffset, this.opusPayloadType | 0x80);
            redPayloadView.setUint16(redPayloadOffset + 1, (timestampDelta << 2) | (redundantEncodingPayloads[i].byteLength >> 8));
            redPayloadView.setUint8(redPayloadOffset + 3, redundantEncodingPayloads[i].byteLength & 0xff);
            redPayloadOffset += this.redHeaderSizeBytes;
        }
        // Add primary encoding header to new buffer
        redPayloadView.setUint8(redPayloadOffset, this.opusPayloadType);
        redPayloadOffset += this.redLastHeaderSizeBytes;
        // Add redundant payload(s) to new buffer
        const redPayloadArray = new Uint8Array(redPayloadBuffer);
        for (let i = 0; i < redundantEncodingPayloads.length; i++) {
            redPayloadArray.set(new Uint8Array(redundantEncodingPayloads[i]), redPayloadOffset);
            redPayloadOffset += redundantEncodingPayloads[i].byteLength;
        }
        // Add primary payload to new buffer
        redPayloadArray.set(new Uint8Array(primaryPayload), redPayloadOffset);
        redPayloadOffset += primaryPayload.byteLength;
        /* istanbul ignore next */
        // Sanity check that we got the expected total payload size.
        if (redPayloadOffset !== headerSizeBytes + payloadSizeBytes)
            return null;
        this.updateEncodingHistory(primaryTimestamp, primaryPayload);
        return redPayloadBuffer;
    }
    /**
     * Update the encoding history with the latest primary encoding
     */
    updateEncodingHistory(primaryTimestamp, primaryPayload) {
        // Remove encodings from the history if they are too old.
        for (const encoding of this.encodingHistory) {
            const maxTimestampDelta = this.redPacketizationTime * this.redMaxRecoveryDistance;
            if (primaryTimestamp - encoding.timestamp >= maxTimestampDelta) {
                this.encodingHistory.shift();
            }
            else {
                break;
            }
        }
        // Only add an encoding to the history if the encoding is deemed to be important. An encoding is important if it is
        // a CELT-only packet or contains voice activity.
        const packet = new DataView(primaryPayload);
        if (this.opusPacketIsCeltOnly(packet) ||
            this.opusPacketHasVoiceActivity(packet, packet.byteLength) > 0) {
            // Check if adding an encoding will cause the length of the encoding history to exceed the maximum history size.
            // This is not expected to happen but could occur if we get incorrect timestamps. We want to make sure our memory
            // usage is bounded. In this case, just clear the history and start over from empty.
            if (this.encodingHistory.length + 1 > this.maxEncodingHistorySize)
                this.encodingHistory.length = 0;
            this.encodingHistory.push({ timestamp: primaryTimestamp, payload: primaryPayload });
        }
    }
    /**
     * Initialize packet logs and metric values.
     */
    initializePacketLogs() {
        // The extra space from the max RED recovery distance is to ensure that we do not incorrectly count recovery for
        // packets that have already been received but are outside of the max out-of-order distance.
        const packetLogSize = this.maxOutOfOrderPacketDistance + this.redMaxRecoveryDistance;
        this.primaryPacketLog = {
            window: new Array(packetLogSize),
            index: 0,
            windowSize: packetLogSize,
        };
        this.redRecoveryLog = {
            window: new Array(packetLogSize),
            index: 0,
            windowSize: packetLogSize,
        };
        this.fecRecoveryLog = {
            window: new Array(packetLogSize),
            index: 0,
            windowSize: packetLogSize,
        };
        this.totalAudioPacketsExpected = 0;
        this.totalAudioPacketsLost = 0;
        this.totalAudioPacketsRecoveredRed = 0;
        this.totalAudioPacketsRecoveredFec = 0;
    }
    /**
     * Receives encoded frames from the server
     * and adds the timestamps to a packet log
     * to calculate an approximate recovery metric.
     */
    receivePacketLogTransform(
    // @ts-ignore
    frame, controller) {
        const frameMetadata = frame.getMetadata();
        // @ts-ignore
        if (frameMetadata.payloadType !== this.redPayloadType) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        // @ts-ignore
        const encodings = this.splitEncodings(frame.timestamp, frame.data, 
        /*getFecInfo*/ true, frameMetadata.sequenceNumber);
        if (!encodings) {
            this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
            return;
        }
        for (let i = encodings.length - 1; i >= 0; i--) {
            if (this.updateLossStats(encodings[i])) {
                this.updateRedStats(encodings[i]);
                this.updateFecStats(encodings[i]);
            }
        }
        this.maybeReportLossStats(frameMetadata.synchronizationSource, encodings[encodings.length - 1].timestamp);
        this.enqueueAudioFrameIfPayloadSizeIsValid(frame, controller);
    }
    /**
     * Adds a timestamp to the primary packet log.
     * This also updates totalAudioPacketsLost and totalAudioPacketsExpected by looking
     * at the difference between timestamps.
     *
     * @param encoding : The encoding to be analyzed
     * @returns false if sequence number was greater than max out of order distance
     *          true otherwise
     */
    updateLossStats(encoding) {
        if (encoding.isRedundant)
            return true;
        const timestamp = encoding.timestamp;
        const seq = encoding.seq;
        if (this.totalAudioPacketsExpected === 0) {
            this.totalAudioPacketsExpected = 1;
            this.newestSequenceNumber = seq;
            this.addTimestamp(this.primaryPacketLog, timestamp);
            return true;
        }
        const diff = this.int16(seq - this.newestSequenceNumber);
        if (diff < -this.maxOutOfOrderPacketDistance)
            return false;
        if (diff < 0) {
            if (!this.hasTimestamp(this.primaryPacketLog, timestamp)) {
                if (this.totalAudioPacketsLost > 0)
                    this.totalAudioPacketsLost--;
                this.addTimestamp(this.primaryPacketLog, timestamp);
                this.removeFromRecoveryWindows(timestamp);
            }
        }
        else if (diff > 1) {
            this.totalAudioPacketsLost += diff - 1;
        }
        if (diff > 0) {
            this.totalAudioPacketsExpected += diff;
            this.newestSequenceNumber = encoding.seq;
            this.addTimestamp(this.primaryPacketLog, timestamp);
        }
        return true;
    }
    /**
     * Adds a timestamp to the red recovery log if it is not present in
     * the primary packet log and if it's not too old.
     *
     * @param encoding : The encoding to be analyzed
     */
    updateRedStats(encoding) {
        if (!encoding.isRedundant || this.totalAudioPacketsLost === 0)
            return;
        const timestamp = encoding.timestamp;
        if (!this.hasTimestamp(this.primaryPacketLog, timestamp)) {
            if (!this.hasTimestamp(this.redRecoveryLog, timestamp)) {
                this.totalAudioPacketsRecoveredRed++;
                this.addTimestamp(this.redRecoveryLog, timestamp);
            }
            if (this.removeTimestamp(this.fecRecoveryLog, timestamp)) {
                /* istanbul ignore else */
                if (this.totalAudioPacketsRecoveredFec > 0)
                    this.totalAudioPacketsRecoveredFec--;
            }
        }
    }
    /**
     * Adds a timestamp to the fec recovery log if it is not present in
     * the primary packet log and red recovery log and if it is not too old.
     *
     * @param encoding : The encoding to be analyzed
     */
    updateFecStats(encoding) {
        if (!encoding.hasFec || this.totalAudioPacketsLost === 0)
            return;
        const fecTimestamp = encoding.timestamp - this.redPacketizationTime;
        if (this.hasTimestamp(this.primaryPacketLog, fecTimestamp) ||
            this.hasTimestamp(this.redRecoveryLog, fecTimestamp) ||
            this.hasTimestamp(this.fecRecoveryLog, fecTimestamp)) {
            return;
        }
        this.totalAudioPacketsRecoveredFec++;
        this.addTimestamp(this.fecRecoveryLog, fecTimestamp);
    }
    /**
     * Reports loss metrics to DefaultTransceiverController
     *
     * @param timestamp : Timestamp of most recent primary packet
     */
    maybeReportLossStats(ssrc, timestamp) {
        if (timestamp === undefined ||
            timestamp - this.lastLossReportTimestamp < this.lossReportInterval)
            return;
        /* istanbul ignore next */
        if (RedundantAudioEncoder.shouldReportStats) {
            // @ts-ignore
            self.postMessage({
                type: 'RedundantAudioEncoderStats',
                ssrc,
                totalAudioPacketsLost: this.totalAudioPacketsLost,
                totalAudioPacketsExpected: this.totalAudioPacketsExpected,
                totalAudioPacketsRecoveredRed: this.totalAudioPacketsRecoveredRed,
                totalAudioPacketsRecoveredFec: this.totalAudioPacketsRecoveredFec,
            });
        }
        this.lastLossReportTimestamp = timestamp;
    }
    /**
     * Adds a timestamp to a packet log
     *
     * @param packetLog : The packetlog to add the timestamp to
     * @param timestamp : The timestamp that should be added
     */
    addTimestamp(packetLog, timestamp) {
        if (timestamp === undefined) {
            return;
        }
        packetLog.window[packetLog.index] = timestamp;
        packetLog.index = (packetLog.index + 1) % packetLog.windowSize;
    }
    /**
     * Checks if a timestamp is in a packetlog
     *
     * @param packetLog : The packetlog to search
     * @param timestamp : The timestamp to search for
     * @returns true if timestamp is present, false otherwise
     */
    hasTimestamp(packetLog, timestamp) {
        const element = packetLog.window.find(t => t === timestamp);
        return !!element;
    }
    /**
     * Removes a timestamp from a packet log
     *
     * @param packetLog : The packetlog from which the timestamp should be removed
     * @param timestamp : The timestamp to be removed
     * @returns true if timestamp was present in the log and removed, false otherwise
     */
    removeTimestamp(packetLog, timestamp) {
        const index = packetLog.window.indexOf(timestamp);
        if (index >= 0) {
            packetLog.window[index] = undefined;
            return true;
        }
        return false;
    }
    /**
     * Removes a timestamp from red and fec recovery windows.
     *
     * @param timestamp : The timestamp to be removed
     */
    removeFromRecoveryWindows(timestamp) {
        let removed = this.removeTimestamp(this.redRecoveryLog, timestamp);
        if (removed) {
            if (this.totalAudioPacketsRecoveredRed > 0)
                this.totalAudioPacketsRecoveredRed--;
        }
        removed = this.removeTimestamp(this.fecRecoveryLog, timestamp);
        if (removed) {
            if (this.totalAudioPacketsRecoveredFec > 0)
                this.totalAudioPacketsRecoveredFec--;
        }
    }
    /**
     * Converts the supplied argument to 32-bit unsigned integer
     */
    uint32WrapAround(num) {
        const mod = 4294967296; // 2^32
        let res = num;
        if (num >= mod) {
            res = num - mod;
        }
        else if (num < 0) {
            res = mod + num;
        }
        return res;
    }
    /**
     * Converts the supplied argument to 16-bit signed integer
     */
    int16(num) {
        return (num << 16) >> 16;
    }
    /**
     * Determines if an Opus packet is in CELT-only mode.
     *
     * @param packet Opus packet.
     * @returns \`true\` if the packet is in CELT-only mode.
     */
    opusPacketIsCeltOnly(packet) {
        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):
        //  0
        //  0 1 2 3 4 5 6 7
        // +-+-+-+-+-+-+-+-+
        // | config  |s| c |
        // +-+-+-+-+-+-+-+-+
        // Since CELT-only packets are represented using configurations 16 to 31, the highest 'config' bit will always be 1
        // for CELT-only packets.
        return !!(packet.getUint8(0) & 0x80);
    }
    /**
     * Gets the number of samples per frame from an Opus packet.
     *
     * @param packet Opus packet. This must contain at least one byte of data.
     * @param sampleRateHz 32-bit integer sampling rate in Hz. This must be a multiple of 400 or inaccurate results will
     *                     be returned.
     * @returns Number of samples per frame.
     */
    opusPacketGetSamplesPerFrame(packet, sampleRateHz) {
        // Sample rate must be a 32-bit integer.
        sampleRateHz = Math.round(sampleRateHz);
        sampleRateHz = Math.min(Math.max(sampleRateHz, -(Math.pow(2, 32))), Math.pow(2, 32) - 1);
        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):
        //  0
        //  0 1 2 3 4 5 6 7
        // +-+-+-+-+-+-+-+-+
        // | config  |s| c |
        // +-+-+-+-+-+-+-+-+
        let numSamples;
        let frameSizeOption;
        // Case for CELT-only packet.
        if (this.opusPacketIsCeltOnly(packet)) {
            // The lower 3 'config' bits indicate the frame size option.
            frameSizeOption = (packet.getUint8(0) >> 3) & 0x3;
            // The frame size options 0, 1, 2, 3 correspond to frame sizes of 2.5, 5, 10, 20 ms. Notice that the frame sizes
            // can be represented as (2.5 * 2^0), (2.5 * 2^1), (2.5 * 2^2), (2.5 * 2^3) ms. So, the number of samples can be
            // calculated as follows:
            // (sample/s) * (1s/1000ms) * (2.5ms) * 2^(frameSizeOption)
            // = (sample/s) * (1s/400) * 2^(frameSizeOption)
            // = (sample/s) * 2^(frameSizeOption) * (1s/400)
            numSamples = (sampleRateHz << frameSizeOption) / 400;
        }
        // Case for Hybrid packet. Since Hybrid packets are represented using configurations 12 to 15, bits 1 and 2 in the
        // above TOC byte diagram will both be 1.
        else if ((packet.getUint8(0) & 0x60) === 0x60) {
            // In the case of configuration 13 or 15, bit 4 in the above TOC byte diagram will be 1. Configurations 13 and 15
            // correspond to a 20ms frame size, so the number of samples is calculated as follows:
            // (sample/s) * (1s/1000ms) * (20ms)
            // = (sample/s) * (1s/50)
            //
            // In the case of configuration 12 or 14, bit 4 in the above TOC byte diagram will be 0. Configurations 12 and 14
            // correspond to a 10ms frame size, so the number of samples is calculated as follows:
            // (sample/s) * (1s/1000ms) * (10ms)
            // = (sample/s) * (1s/100)
            numSamples = packet.getUint8(0) & 0x08 ? sampleRateHz / 50 : sampleRateHz / 100;
        }
        // Case for SILK-only packet.
        else {
            // The lower 3 'config' bits indicate the frame size option for SILK-only packets.
            frameSizeOption = (packet.getUint8(0) >> 3) & 0x3;
            if (frameSizeOption === 3) {
                // Frame size option 3 corresponds to a frame size of 60ms, so the number of samples is calculated as follows:
                // (sample/s) * (1s/1000ms) * (60ms)
                // = (sample/s) * (60ms) * (1s/1000ms)
                numSamples = (sampleRateHz * 60) / 1000;
            }
            else {
                // The frame size options 0, 1, 2 correspond to frame sizes of 10, 20, 40 ms. Notice that the frame sizes can be
                // represented as (10 * 2^0), (10 * 2^1), (10 * 2^2) ms. So, the number of samples can be calculated as follows:
                // (sample/s) * (1s/1000ms) * (10ms) * 2^(frameSizeOption)
                // = (sample/s) * (1s/100) * 2^(frameSizeOption)
                // = (sample/s) * 2^(frameSizeOption) * (1s/100)
                numSamples = (sampleRateHz << frameSizeOption) / 100;
            }
        }
        return numSamples;
    }
    /**
     * Gets the number of SILK frames per Opus frame.
     *
     * @param packet Opus packet.
     * @returns Number of SILK frames per Opus frame.
     */
    opusNumSilkFrames(packet) {
        // For computing the frame length in ms, the sample rate is not important since it cancels out. We use 48 kHz, but
        // any valid sample rate would work.
        //
        // To calculate the length of a frame (with a 48kHz sample rate) in ms:
        // (samples/frame) * (1s/48000 samples) * (1000ms/s)
        // = (samples/frame) * (1000ms/48000 samples)
        // = (samples/frame) * (1ms/48 samples)
        let frameLengthMs = this.opusPacketGetSamplesPerFrame(packet, 48000) / 48;
        if (frameLengthMs < 10)
            frameLengthMs = 10;
        // The number of SILK frames per Opus frame is described in https://www.rfc-editor.org/rfc/rfc6716#section-4.2.2.
        switch (frameLengthMs) {
            case 10:
            case 20:
                return 1;
            case 40:
                return 2;
            case 60:
                return 3;
            // It is not possible to reach the default case since an Opus packet can only encode sizes of 2.5, 5, 10, 20, 40,
            // or 60 ms, so we ignore the default case for test coverage.
            /* istanbul ignore next */
            default:
                return 0;
        }
    }
    /**
     * Gets the number of channels from an Opus packet.
     *
     * @param packet Opus packet.
     * @returns Number of channels.
     */
    opusPacketGetNumChannels(packet) {
        // TOC byte format (https://www.rfc-editor.org/rfc/rfc6716#section-3.1):
        //  0
        //  0 1 2 3 4 5 6 7
        // +-+-+-+-+-+-+-+-+
        // | config  |s| c |
        // +-+-+-+-+-+-+-+-+
        // The 's' bit indicates mono or stereo audio, with 0 indicating mono and 1 indicating stereo.
        return packet.getUint8(0) & 0x4 ? 2 : 1;
    }
    /**
     * Determine the size (in bytes) of an Opus frame.
     *
     * @param packet Opus packet.
     * @param byteOffset Offset (from the start of the packet) to the byte containing the size information.
     * @param remainingBytes Remaining number of bytes to parse from the Opus packet.
     * @param sizeBytes Variable to store the parsed frame size (in bytes).
     * @returns Number of bytes that were parsed to determine the frame size.
     */
    opusParseSize(packet, byteOffset, remainingBytes, sizeBytes) {
        // See https://www.rfc-editor.org/rfc/rfc6716#section-3.2.1 for an explanation of how frame size is represented.
        // If there are no remaining bytes to parse the size from, then the size cannot be determined.
        if (remainingBytes < 1) {
            sizeBytes[0] = -1;
            return -1;
        }
        // If the first byte is in the range 0...251, then this value is the size of the frame.
        else if (packet.getUint8(byteOffset) < 252) {
            sizeBytes[0] = packet.getUint8(byteOffset);
            return 1;
        }
        // If the first byte is in the range 252...255, a second byte is needed. If there is no second byte, then the size
        // cannot be determined.
        else if (remainingBytes < 2) {
            sizeBytes[0] = -1;
            return -1;
        }
        // The total size of the frame given two size bytes is:
        // (4 * secondSizeByte) + firstSizeByte
        else {
            sizeBytes[0] = 4 * packet.getUint8(byteOffset + 1) + packet.getUint8(byteOffset);
            return 2;
        }
    }
    /**
     * Parse binary data containing an Opus packet into one or more Opus frames.
     *
     * @param data Binary data containing an Opus packet to be parsed. The data should begin with the first byte (i.e the
     *             TOC byte) of an Opus packet. Note that the size of the data does not have to equal the size of the
     *             contained Opus packet.
     * @param lenBytes Size of the data (in bytes).
     * @param selfDelimited Indicates if the Opus packet is self-delimiting
     *                      (https://www.rfc-editor.org/rfc/rfc6716#appendix-B).
     * @param tocByte Optional variable to store the TOC (table of contents) byte.
     * @param frameOffsets Optional variable to store the offsets (from the start of the data) to the first bytes of each
     *                     Opus frame.
     * @param frameSizes Required variable to store the sizes (in bytes) of each Opus frame.
     * @param payloadOffset Optional variable to store the offset (from the start of the data) to the first byte of the
     *                      payload.
     * @param packetLenBytes Optional variable to store the length of the Opus packet (in bytes).
     * @returns Number of Opus frames.
     */
    opusPacketParseImpl(data, lenBytes, selfDelimited, tocByte, frameOffsets, frameSizes, payloadOffset, packetLenBytes) {
        if (!frameSizes || lenBytes < 0)
            return this.OPUS_BAD_ARG;
        if (lenBytes === 0)
            return this.OPUS_INVALID_PACKET;
        // The number of Opus frames in the packet.
        let numFrames;
        // Intermediate storage for the number of bytes parsed to determine the size of a frame.
        let numBytesParsed;
        // The number of the padding bytes (excluding the padding count bytes) in the packet.
        let paddingBytes = 0;
        // Indicates whether CBR (constant bitrate) framing is used.
        let cbr = false;
        // The TOC (table of contents) byte (https://www.rfc-editor.org/rfc/rfc6716#section-3.1).
        const toc = data.getUint8(0);
        // Store the TOC byte.
        if (tocByte)
            tocByte[0] = toc;
        // The remaining number of bytes to parse from the packet. Note that the TOC byte has already been parsed, hence the
        // minus 1.
        let remainingBytes = lenBytes - 1;
        // This keeps track of where we are in the packet. This starts at 1 since the TOC byte has already been read.
        let byteOffset = 1;
        // The size of the last Opus frame in bytes.
        let lastSizeBytes = remainingBytes;
        // Read the \`c\` bits (i.e. code bits) from the TOC byte.
        switch (toc & 0x3) {
            // A code 0 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.2) has one frame.
            case 0:
                numFrames = 1;
                break;
            // A code 1 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.3) has two CBR (constant bitrate) frames.
            case 1:
                numFrames = 2;
                cbr = true;
                if (!selfDelimited) {
                    // Undelimited code 1 packets must be an even number of data bytes, otherwise the packet is invalid.
                    if (remainingBytes & 0x1)
                        return this.OPUS_INVALID_PACKET;
                    // The sizes of both frames are equal (i.e. half of the number of data bytes).
                    lastSizeBytes = remainingBytes / 2;
                    // If \`lastSizeBytes\` is too large, we will catch it later.
                    frameSizes[0][0] = lastSizeBytes;
                }
                break;
            // A code 2 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.4) has two VBR (variable bitrate) frames.
            case 2:
                numFrames = 2;
                numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[0]);
                remainingBytes -= numBytesParsed;
                // The parsed size of the first frame cannot be larger than the number of remaining bytes in the packet.
                if (frameSizes[0][0] < 0 || frameSizes[0][0] > remainingBytes) {
                    return this.OPUS_INVALID_PACKET;
                }
                byteOffset += numBytesParsed;
                // The size of the second frame is the remaining number of bytes after the first frame.
                lastSizeBytes = remainingBytes - frameSizes[0][0];
                break;
            // A code 3 packet (https://www.rfc-editor.org/rfc/rfc6716#section-3.2.5) has multiple CBR/VBR frames (from 0 to
            // 120 ms).
            default:
                // Code 3 packets must have at least 2 bytes (i.e. at least 1 byte after the TOC byte).
                if (remainingBytes < 1)
                    return this.OPUS_INVALID_PACKET;
                // Frame count byte format:
                //  0
                //  0 1 2 3 4 5 6 7
                // +-+-+-+-+-+-+-+-+
                // |v|p|     M     |
                // +-+-+-+-+-+-+-+-+
                //
                // Read the frame count byte, which immediately follows the TOC byte.
                const frameCountByte = data.getUint8(byteOffset++);
                --remainingBytes;
                // Read the 'M' bits of the frame count byte, which encode the number of frames.
                numFrames = frameCountByte & 0x3f;
                // The number of frames in a code 3 packet must not be 0.
                if (numFrames <= 0)
                    return this.OPUS_INVALID_PACKET;
                const samplesPerFrame = this.opusPacketGetSamplesPerFrame(data, 48000);
                // A single frame can have at most 2880 samples, which happens in the case where 60ms of 48kHz audio is encoded
                // per frame. A code 3 packet cannot contain more than 120ms of audio, so the total number of samples cannot
                // exceed 2880 * 2 = 5760.
                if (samplesPerFrame * numFrames > 5760)
                    return this.OPUS_INVALID_PACKET;
                // Parse padding bytes if the 'p' bit is 1.
                if (frameCountByte & 0x40) {
                    let paddingCountByte;
                    let numPaddingBytes;
                    // Remove padding bytes (including padding count bytes) from the remaining byte count.
                    do {
                        // Sanity check that there are enough bytes to parse and remove the padding.
                        if (remainingBytes <= 0)
                            return this.OPUS_INVALID_PACKET;
                        // Get the next padding count byte.
                        paddingCountByte = data.getUint8(byteOffset++);
                        --remainingBytes;
                        // If the padding count byte has a value in the range 0...254, then the total size of the padding is the
                        // value in the padding count byte.
                        //
                        // If the padding count byte has value 255, then the total size of the padding is 254 plus the value in the
                        // next padding count byte. Therefore, keep reading padding count bytes while the value is 255.
                        numPaddingBytes = paddingCountByte === 255 ? 254 : paddingCountByte;
                        remainingBytes -= numPaddingBytes;
                        paddingBytes += numPaddingBytes;
                    } while (paddingCountByte === 255);
                }
                // Sanity check that the remaining number of bytes is not negative after removing the padding.
                if (remainingBytes < 0)
                    return this.OPUS_INVALID_PACKET;
                // Read the 'v' bit (i.e. VBR bit).
                cbr = !(frameCountByte & 0x80);
                // VBR case
                if (!cbr) {
                    lastSizeBytes = remainingBytes;
                    // Let M be the number of frames. There will be M - 1 frame length indicators (which can be 1 or 2 bytes)
                    // corresponding to the lengths of frames 0 to M - 2. The size of the last frame (i.e. frame M - 1) is the
                    // number of data bytes after the end of frame M - 2 and before the start of the padding bytes.
                    for (let i = 0; i < numFrames - 1; ++i) {
                        numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[i]);
                        remainingBytes -= numBytesParsed;
                        // The remaining number of data bytes must be enough to contain each frame.
                        if (frameSizes[i][0] < 0 || frameSizes[i][0] > remainingBytes) {
                            return this.OPUS_INVALID_PACKET;
                        }
                        byteOffset += numBytesParsed;
                        lastSizeBytes -= numBytesParsed + frameSizes[i][0];
                    }
                    // Sanity check that the size of the last frame is not negative.
                    if (lastSizeBytes < 0)
                        return this.OPUS_INVALID_PACKET;
                }
                // CBR case
                else if (!selfDelimited) {
                    // The size of each frame is the number of data bytes divided by the number of frames.
                    lastSizeBytes = Math.trunc(remainingBytes / numFrames);
                    // The number of data bytes must be a non-negative integer multiple of the number of frames.
                    if (lastSizeBytes * numFrames !== remainingBytes)
                        return this.OPUS_INVALID_PACKET;
                    // All frames have equal size in the undelimited CBR case.
                    for (let i = 0; i < numFrames - 1; ++i) {
                        frameSizes[i][0] = lastSizeBytes;
                    }
                }
        }
        // Self-delimited framing uses an extra 1 or 2 bytes, immediately preceding the data bytes, to indicate either the
        // size of the last frame (for code 0, code 2, and VBR code 3 packets) or the size of all the frames (for code 1 and
        // CBR code 3 packets). See https://www.rfc-editor.org/rfc/rfc6716#appendix-B.
        if (selfDelimited) {
            // The extra frame size byte(s) will always indicate the size of the last frame.
            numBytesParsed = this.opusParseSize(data, byteOffset, remainingBytes, frameSizes[numFrames - 1]);
            remainingBytes -= numBytesParsed;
            // There must be enough data bytes for the last frame.
            if (frameSizes[numFrames - 1][0] < 0 || frameSizes[numFrames - 1][0] > remainingBytes) {
                return this.OPUS_INVALID_PACKET;
            }
            byteOffset += numBytesParsed;
            // For CBR packets, the sizes of all the frames are equal.
            if (cbr) {
                // There must be enough data bytes for all the frames.
                if (frameSizes[numFrames - 1][0] * numFrames > remainingBytes) {
                    return this.OPUS_INVALID_PACKET;
                }
                for (let i = 0; i < numFrames - 1; ++i) {
                    frameSizes[i][0] = frameSizes[numFrames - 1][0];
                }
            }
            // At this point, \`lastSizeBytes\` contains the size of the last frame plus the size of the extra frame size
            // byte(s), so sanity check that \`lastSizeBytes\` is the upper bound for the size of the last frame.
            else if (!(numBytesParsed + frameSizes[numFrames - 1][0] <= lastSizeBytes)) {
                return this.OPUS_INVALID_PACKET;
            }
        }
        // Undelimited case
        else {
            // Because the size of the last packet is not encoded explicitly, it is possible that the size of the last packet
            // (or of all the packets, for the CBR case) is larger than maximum frame size.
            if (lastSizeBytes > this.OPUS_MAX_FRAME_SIZE_BYTES)
                return this.OPUS_INVALID_PACKET;
            frameSizes[numFrames - 1][0] = lastSizeBytes;
        }
        // Store the offset to the start of the payload.
        if (payloadOffset)
            payloadOffset[0] = byteOffset;
        // Store the offsets to the start of each frame.
        for (let i = 0; i < numFrames; ++i) {
            if (frameOffsets)
                frameOffsets[i][0] = byteOffset;
            byteOffset += frameSizes[i][0];
        }
        // Store the length of the Opus packet.
        if (packetLenBytes)
            packetLenBytes[0] = byteOffset + paddingBytes;
        return numFrames;
    }
    /**
     * Parse a single undelimited Opus packet into one or more Opus frames.
     *
     * @param packet Opus packet to be parsed.
     * @param lenBytes Size of the packet (in bytes).
     * @param tocByte Optional variable to store the TOC (table of contents) byte.
     * @param frameOffsets Optional variable to store the offsets (from the start of the packet) to the first bytes of
     *                     each Opus frame.
     * @param frameSizes Required variable to store the sizes (in bytes) of each Opus frame.
     * @param payloadOffset Optional variable to store the offset (from the start of the packet) to the first byte of the
     *                      payload.
     * @returns Number of Opus frames.
     */
    opusPacketParse(packet, lenBytes, tocByte, frameOffsets, frameSizes, payloadOffset) {
        return this.opusPacketParseImpl(packet, lenBytes, 
        /* selfDelimited */ false, tocByte, frameOffsets, frameSizes, payloadOffset, null);
    }
    /**
     * This function returns the SILK VAD (voice activity detection) information encoded in the Opus packet. For CELT-only
     * packets that do not have VAD information, it returns -1.
     *
     * @param packet Opus packet.
     * @param lenBytes Size of the packet (in bytes).
     * @returns  0: no frame had the VAD flag set.
     *           1: at least one frame had the VAD flag set.
     *          -1: VAD status could not be determined.
     */
    opusPacketHasVoiceActivity(packet, lenBytes) {
        if (!packet || lenBytes <= 0)
            return 0;
        // In CELT-only mode, we can not determine whether there is VAD.
        if (this.opusPacketIsCeltOnly(packet))
            return -1;
        const numSilkFrames = this.opusNumSilkFrames(packet);
        // It is not possible for \`opusNumSilkFrames()\` to return 0, so we ignore the next sanity check for test coverage.
        /* istanbul ignore next */
        if (numSilkFrames === 0)
            return -1;
        const opusFrameOffsets = new Array(this.OPUS_MAX_OPUS_FRAMES);
        const opusFrameSizes = new Array(this.OPUS_MAX_OPUS_FRAMES);
        for (let i = 0; i < this.OPUS_MAX_OPUS_FRAMES; ++i) {
            opusFrameOffsets[i] = [undefined];
            opusFrameSizes[i] = [undefined];
        }
        // Parse packet to get the Opus frames.
        const numOpusFrames = this.opusPacketParse(packet, lenBytes, null, opusFrameOffsets, opusFrameSizes, null);
        // VAD status cannot be determined for invalid packets.
        if (numOpusFrames < 0)
            return -1;
        // Iterate over all Opus frames, which may contain multiple SILK frames, to determine the VAD status.
        for (let i = 0; i < numOpusFrames; ++i) {
            if (opusFrameSizes[i][0] < 1)
                continue;
            // LP layer header bits format (https://www.rfc-editor.org/rfc/rfc6716#section-4.2.3):
            //
            // Mono case:
            // +-----------------+----------+
            // | 1 to 3 VAD bits | LBRR bit |
            // +-----------------+----------+
            //
            // Stereo case:
            // +---------------------+--------------+----------------------+---------------+
            // | 1 to 3 mid VAD bits | mid LBRR bit | 1 to 3 side VAD bits | side LBRR bit |
            // +---------------------+--------------+----------------------+---------------+
            // The upper 1 to 3 bits (dependent on the number of SILK frames) of the LP layer contain VAD bits. If any of
            // these VAD bits are 1, then voice activity is present.
            if (packet.getUint8(opusFrameOffsets[i][0]) >> (8 - numSilkFrames))
                return 1;
            // In the stereo case, there is a second set of 1 to 3 VAD bits, so also check these VAD bits.
            const channels = this.opusPacketGetNumChannels(packet);
            if (channels === 2 &&
                (packet.getUint8(opusFrameOffsets[i][0]) << (numSilkFrames + 1)) >> (8 - numSilkFrames)) {
                return 1;
            }
        }
        // No voice activity was detected.
        return 0;
    }
    /**
     * This method is based on Definition of the Opus Audio Codec
     * (https://tools.ietf.org/html/rfc6716). Basically, this method is based on
     * parsing the LP layer of an Opus packet, particularly the LBRR flag.
     *
     * @param packet Opus packet.
     * @param lenBytes Size of the packet (in bytes).
     * @returns  true: packet has fec encoding about previous packet.
     *           false: no fec encoding present.
     */
    opusPacketHasFec(packet, lenBytes) {
        if (!packet || lenBytes <= 0)
            return false;
        // In CELT-only mode, packets should not have FEC.
        if (this.opusPacketIsCeltOnly(packet))
            return false;
        const opusFrameOffsets = new Array(this.OPUS_MAX_OPUS_FRAMES);
        const opusFrameSizes = new Array(this.OPUS_MAX_OPUS_FRAMES);
        for (let i = 0; i < this.OPUS_MAX_OPUS_FRAMES; ++i) {
            opusFrameOffsets[i] = [undefined];
            opusFrameSizes[i] = [undefined];
        }
        // Parse packet to get the Opus frames.
        const numOpusFrames = this.opusPacketParse(packet, lenBytes, null, opusFrameOffsets, opusFrameSizes, null);
        if (numOpusFrames < 0)
            return false;
        /* istanbul ignore next */
        if (opusFrameSizes[0][0] <= 1)
            return false;
        const numSilkFrames = this.opusNumSilkFrames(packet);
        /* istanbul ignore next */
        if (numSilkFrames === 0)
            return false;
        const channels = this.opusPacketGetNumChannels(packet);
        /* istanbul ignore next */
        if (channels !== 1 && channels !== 2)
            return false;
        // A frame starts with the LP layer. The LP layer begins with two to eight
        // header bits.These consist of one VAD bit per SILK frame (up to 3),
        // followed by a single flag indicating the presence of LBRR frames.
        // For a stereo packet, these first flags correspond to the mid channel, and
        // a second set of flags is included for the side channel. Because these are
        // the first symbols decoded by the range coder and because they are coded
        // as binary values with uniform probability, they can be extracted directly
        // from the most significant bits of the first byte of compressed data.
        for (let i = 0; i < channels; i++) {
            if (packet.getUint8(opusFrameOffsets[0][0]) & (0x80 >> ((i + 1) * (numSilkFrames + 1) - 1)))
                return true;
        }
        return false;
    }
}
RedundantAudioEncoder.shouldLog = true;
RedundantAudioEncoder.shouldReportStats = true;
RedundantAudioEncoder.initializeWorker();
`;ag.default=AR});var js=g(En=>{"use strict";var zr=En&&En.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Hs=En&&En.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(En,"__esModule",{value:!0});var PR=Hs(Za()),MR=Hs(Dd()),RR=Hs(sg()),DR=Hs(dg()),xR=Hs(Ve()),cg=class{constructor(t,e,i){this.logger=t,this.browserBehavior=e,this.meetingSessionContext=i,this._localCameraTransceiver=null,this._localAudioTransceiver=null,this.videoSubscriptions=[],this.defaultMediaStream=null,this.peer=null,this.streamIdToTransceiver=new Map,this.groupIdToTransceiver=new Map,this.audioRedWorker=null,this.audioRedWorkerURL=null,this.audioMetricsHistory=new Array,this.redMetricsObservers=new Set,this.currentNumRedundantEncodings=0,this.lastRedHolddownTimerStartTimestampMs=0,this.lastHighPacketLossEventTimestampMs=0,this.lastAudioRedTurnOffTimestampMs=0,this.maxAudioMetricsHistory=20,this.audioRedPacketLossShortEvalPeriodMs=5*1e3,this.audioRedPacketLossLongEvalPeriodMs=15*1e3,this.audioRedHoldDownTimeMs=300*1e3,this.redRecoveryTimeMs=60*1e3}setEncodingParameters(t){return zr(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;let e=this._localCameraTransceiver.sender;if(!t||t.size===0)return;let i=Array.from(t.values()),r=e.getParameters();if(!r.encodings||r.encodings.length===0)r.encodings=i;else for(let o of r.encodings)for(let s of i){if((o.rid||s.rid)&&o.rid!==s.rid)continue;let d;for(d in s)d==="rid"||d==="codecPayloadType"||s.hasOwnProperty(d)&&(o[d]=s[d])}yield e.setParameters(r)})}localAudioTransceiver(){return this._localAudioTransceiver}localVideoTransceiver(){return this._localCameraTransceiver}setVideoSendingBitrateKbps(t){return zr(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;let e=this._localCameraTransceiver.sender;if(!e||t<=0)return;let i=e.getParameters();i.encodings||(i.encodings=[{}]);for(let r of i.encodings)r.maxBitrate=t*1e3;yield e.setParameters(i)})}setPeer(t){this.peer=t}reset(){this.destroyAudioRedWorkerAndStates(),this._localCameraTransceiver=null,this._localAudioTransceiver=null,this.videoSubscriptions=[],this.defaultMediaStream=null,this.peer=null}useTransceivers(){return!!this.peer&&typeof this.peer.getTransceivers<"u"}hasVideoInput(){return!(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")}trackIsVideoInput(t){return this._localCameraTransceiver?t===this._localCameraTransceiver.sender.track||t===this._localCameraTransceiver.receiver.track:!1}setupLocalTransceivers(){var t,e;this.useTransceivers()&&(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localAudioTransceiver||(this._localAudioTransceiver=this.peer.addTransceiver("audio",{direction:"inactive",streams:[this.defaultMediaStream]}),!((e=(t=this.meetingSessionContext)===null||t===void 0?void 0:t.audioProfile)===null||e===void 0)&&e.hasRedundancyEnabled()&&this.setupAudioRedWorker()),this._localCameraTransceiver||(this._localCameraTransceiver=this.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream]})))}replaceAudioTrack(t){return zr(this,void 0,void 0,function*(){return!this._localAudioTransceiver||this._localAudioTransceiver.direction!=="sendrecv"?(this.logger.info("audio transceiver direction is not set up or not activated"),!1):(yield this._localAudioTransceiver.sender.replaceTrack(t),!0)})}setAudioInput(t){return zr(this,void 0,void 0,function*(){yield this.setTransceiverInput(this._localAudioTransceiver,t)})}setVideoInput(t){return zr(this,void 0,void 0,function*(){yield this.setTransceiverInput(this._localCameraTransceiver,t)})}updateVideoTransceivers(t,e){if(!this.useTransceivers())return e.array();let i=this.peer.getTransceivers();return this.videoSubscriptions=[0],e=e.clone(),this.updateTransceivers(i,t,e),this.logger.debug(()=>this.debugDumpTransceivers()),this.videoSubscriptions}updateTransceivers(t,e,i){let r=i.array();t.length!==0&&!t[0].stop?(this.logger.info("Updating transceivers without `stop` function"),this.updateTransceiverWithoutStop(t,e,r)):t.length!==0&&this.updateTransceiverWithStop(t,e,r);for(let o of r){let s=this.addTransceiver("video",{direction:"recvonly",streams:[new MediaStream]});this.streamIdToTransceiver.set(o,s),this.groupIdToTransceiver.set(e.groupIdForStreamId(o),s),this.videoSubscriptions.push(o),this.logger.info(`adding transceiver mid: ${s.mid} subscription: ${o} direction: recvonly`)}}updateTransceiverWithStop(t,e,i){let r=1;this.videoSubscriptions=[0];for(let o of t){if(o===this._localCameraTransceiver||!this.transceiverIsVideo(o)||!o.mid)continue;let s=!1,d=e.streamIdForTrack("v_"+o.mid);if(o.direction!=="inactive"&&d!==void 0){for(let[l,c]of i.entries())if(e.StreamIdsInSameGroup(d,c)){o.direction="recvonly",this.videoSubscriptions[r]=c,s=!0,this.streamIdToTransceiver.delete(d),this.streamIdToTransceiver.set(c,o),i.splice(l,1);break}}if(!s){this.videoSubscriptions[r]=0,this.logger.info(`Stopping MID: ${o.mid}, direction: ${o.direction}, current direction: ${o.currentDirection}`),o.stop();for(let[l,c]of this.streamIdToTransceiver.entries())o.mid===c.mid&&(this.streamIdToTransceiver.delete(l),this.groupIdToTransceiver.delete(e.groupIdForStreamId(l)))}r+=1}}updateTransceiverWithoutStop(t,e,i){let r=1;for(let o of t)if(!(o===this._localCameraTransceiver||!this.transceiverIsVideo(o))){if(this.videoSubscriptions[r]=0,o.direction!=="inactive"){let s=e.streamIdForTrack("v_"+o.mid);if(s!==void 0){for(let[d,l]of i.entries())if(e.StreamIdsInSameGroup(s,l)){o.direction="recvonly",this.videoSubscriptions[r]=l,this.streamIdToTransceiver.delete(s),this.streamIdToTransceiver.set(l,o),i.splice(d,1);break}}}r+=1}r=1;for(let o of t)if(!(o===this._localCameraTransceiver||!this.transceiverIsVideo(o))){if(o.direction==="inactive"&&i.length>0){o.direction="recvonly";let s=i.shift();this.videoSubscriptions[r]=s,this.streamIdToTransceiver.set(s,o),this.groupIdToTransceiver.set(e.groupIdForStreamId(s),o)}else if(this.videoSubscriptions[r]===0){o.direction="inactive";for(let[s,d]of this.streamIdToTransceiver.entries())o===d&&(this.streamIdToTransceiver.delete(s),this.groupIdToTransceiver.delete(e.groupIdForStreamId(s)))}r+=1}}getMidForStreamId(t){var e;return(e=this.streamIdToTransceiver.get(t))===null||e===void 0?void 0:e.mid}setStreamIdForMid(t,e){for(let[i,r]of this.streamIdToTransceiver.entries())if(r.mid===t){this.streamIdToTransceiver.delete(i),this.streamIdToTransceiver.set(e,r);return}}getMidForGroupId(t){var e,i;return(i=(e=this.groupIdToTransceiver.get(t))===null||e===void 0?void 0:e.mid)!==null&&i!==void 0?i:void 0}transceiverIsVideo(t){return t.receiver&&t.receiver.track&&t.receiver.track.kind==="video"||t.sender&&t.sender.track&&t.sender.track.kind==="video"}debugDumpTransceivers(){let t="",e=0;for(let i of this.peer.getTransceivers())this.transceiverIsVideo(i)&&(t+=`transceiver index=${e} mid=${i.mid} subscription=${this.videoSubscriptions[e]} direction=${i.direction}
`,e+=1);return t}setTransceiverInput(t,e){return zr(this,void 0,void 0,function*(){t&&(e?t.direction="sendrecv":t.direction="inactive",yield t.sender.replaceTrack(e))})}forEachRedMetricsObserver(t){for(let e of this.redMetricsObservers)xR.default.nextTick(()=>{this.redMetricsObservers.has(e)&&e.recoveryMetricsDidReceive(t)})}disableAudioRedundancy(){this.meetingSessionContext.audioProfile=new PR.default(this.meetingSessionContext.audioProfile.audioBitrateBps,!1),this.meetingSessionContext.audioVideoController.setAudioProfile(this.meetingSessionContext.audioProfile)}setupAudioRedWorker(){var t,e;let i=!!window.RTCRtpScriptTransform,r=!!RTCRtpSender.prototype.createEncodedStreams;if(i)this.logger.info("[AudioRed] Supports encoded insertable streams using RTCRtpScriptTransform");else if(r)this.logger.info("[AudioRed] Supports encoded insertable streams using TransformStream");else throw this.disableAudioRedundancy(),new Error("[AudioRed] Encoded insertable streams not supported. Recreating peer connection with audio redundancy disabled.");try{this.audioRedWorkerURL=URL.createObjectURL(new Blob([DR.default],{type:"application/javascript"})),this.logger.info(`[AudioRed] Redundant audio worker URL ${this.audioRedWorkerURL}`),this.audioRedWorker=new Worker(this.audioRedWorkerURL)}catch(o){throw this.logger.error(`[AudioRed] Unable to create audio red worker due to ${o}`),URL.revokeObjectURL(this.audioRedWorkerURL),this.audioRedWorkerURL=null,this.audioRedWorker=null,this.disableAudioRedundancy(),this.logger.info("[AudioRed] Recreating peer connection with audio redundancy disabled"),o}if(this.audioRedEnabled=!0,this.audioRedWorker.onmessage=o=>{if(o.data.type==="REDWorkerLog")this.logger.info(o.data.log);else if(o.data.type==="RedundantAudioEncoderStats"){let s=new MR.default;s.currentTimestampMs=Date.now(),s.ssrc=o.data.ssrc,s.totalAudioPacketsLost=o.data.totalAudioPacketsLost,s.totalAudioPacketsExpected=o.data.totalAudioPacketsExpected,s.totalAudioPacketsRecoveredRed=o.data.totalAudioPacketsRecoveredRed,s.totalAudioPacketsRecoveredFec=o.data.totalAudioPacketsRecoveredFec,this.forEachRedMetricsObserver(s)}},i)this._localAudioTransceiver.sender.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"SenderTransform"}),this._localAudioTransceiver.receiver.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"ReceiverTransform"});else if(r){let o=this._localAudioTransceiver.sender.createEncodedStreams(),s=this._localAudioTransceiver.receiver.createEncodedStreams();this.audioRedWorker.postMessage({msgType:"StartRedWorker",send:o,receive:s},[o.readable,o.writable,s.readable,s.writable])}(t=this.meetingSessionContext)===null||t===void 0||t.audioVideoController.addObserver(this),this.addRedundantAudioRecoveryMetricsObserver((e=this.meetingSessionContext)===null||e===void 0?void 0:e.statsCollector)}addTransceiver(t,e){var i;let r=this.peer.addTransceiver(t,e);if(!(!((i=this.peer.getConfiguration())===null||i===void 0)&&i.encodedInsertableStreams)||!this.audioRedWorker)return r;let o=!!window.RTCRtpScriptTransform,s=!!RTCRtpSender.prototype.createEncodedStreams;if(o)r.sender.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"PassthroughTransform"}),r.receiver.transform=new RTCRtpScriptTransform(this.audioRedWorker,{type:"PassthroughTransform"});else if(s){let d=r.sender.createEncodedStreams(),l=r.receiver.createEncodedStreams();this.audioRedWorker.postMessage({msgType:"PassthroughTransform",send:d,receive:l},[d.readable,d.writable,l.readable,l.writable])}return r}destroyAudioRedWorkerAndStates(){var t,e;this.audioRedWorker&&(URL.revokeObjectURL(this.audioRedWorkerURL),this.audioRedWorkerURL=null,this.audioRedWorker.terminate(),this.audioRedWorker=null,this.currentNumRedundantEncodings=0,this.lastRedHolddownTimerStartTimestampMs=0,this.lastAudioRedTurnOffTimestampMs=0,this.lastHighPacketLossEventTimestampMs=0,this.audioRedEnabled=!0,(t=this.meetingSessionContext)===null||t===void 0||t.audioVideoController.removeObserver(this),this.removeRedundantAudioRecoveryMetricsObserver((e=this.meetingSessionContext)===null||e===void 0?void 0:e.statsCollector))}setAudioPayloadTypes(t){this.audioRedWorker&&(this.audioRedWorker.postMessage({msgType:"RedPayloadType",payloadType:t.get("red")}),this.audioRedWorker.postMessage({msgType:"OpusPayloadType",payloadType:t.get("opus")}))}metricsDidReceive(t){let{currentTimestampMs:e}=t,i=t.getRTCStatsReport(),r=0,o=0,s=0;i.forEach(p=>{p.kind==="audio"&&(p.type==="outbound-rtp"?o=p.packetsSent:p.type==="remote-inbound-rtp"&&(r=p.timestamp,s=p.packetsLost))}),(this.audioMetricsHistory.length===0||r>this.audioMetricsHistory[this.audioMetricsHistory.length-1].timestampMs&&o>this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsSent)&&this.audioMetricsHistory.push({timestampMs:r,totalPacketsSent:o,totalPacketsLost:s}),this.audioMetricsHistory.length>this.maxAudioMetricsHistory&&this.audioMetricsHistory.shift();let d=this.lossPercent(this.audioRedPacketLossShortEvalPeriodMs),l=this.lossPercent(this.audioRedPacketLossLongEvalPeriodMs),c=Math.max(d,l),[a,u]=RR.default.getNumRedundantEncodingsForPacketLoss(c);if(u){this.lastHighPacketLossEventTimestampMs=e,this.audioRedEnabled&&(this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"Disable"}),this.audioRedEnabled=!1,this.lastAudioRedTurnOffTimestampMs=e);return}else if(!this.audioRedEnabled){let p=e-this.lastAudioRedTurnOffTimestampMs,m=e-this.lastHighPacketLossEventTimestampMs;if(p>=this.audioRedPacketLossLongEvalPeriodMs&&m<this.redRecoveryTimeMs)return;this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"Enable"}),this.audioRedEnabled=!0,this.maybeResetHoldDownTimer(e)}this.shouldUpdateAudioRedWorkerEncodings(e,a)&&this.audioRedWorker&&this.audioRedWorker.postMessage({msgType:"UpdateNumRedundantEncodings",numRedundantEncodings:a})}maybeResetHoldDownTimer(t){this.currentNumRedundantEncodings>0&&(this.lastRedHolddownTimerStartTimestampMs=t)}lossPercent(t){if(this.audioMetricsHistory.length<2)return 0;let e=this.audioMetricsHistory[this.audioMetricsHistory.length-1].timestampMs,i=this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsSent,r=this.audioMetricsHistory[this.audioMetricsHistory.length-1].totalPacketsLost;for(let o=this.audioMetricsHistory.length-2;o>=0;o--)if(e-this.audioMetricsHistory[o].timestampMs>=t){let s=r-this.audioMetricsHistory[o].totalPacketsLost,d=i-this.audioMetricsHistory[o].totalPacketsSent,l=100*(s/d);return Math.max(0,Math.min(l,100))}return 0}shouldUpdateAudioRedWorkerEncodings(t,e){return this.currentNumRedundantEncodings===e?(this.maybeResetHoldDownTimer(t),!1):e<this.currentNumRedundantEncodings&&t-this.lastRedHolddownTimerStartTimestampMs<this.audioRedHoldDownTimeMs?!1:(this.currentNumRedundantEncodings=e,this.maybeResetHoldDownTimer(t),!0)}addRedundantAudioRecoveryMetricsObserver(t){this.redMetricsObservers.add(t)}removeRedundantAudioRecoveryMetricsObserver(t){this.redMetricsObservers.delete(t)}};En.default=cg});var Ws=g(An=>{"use strict";var IT=An&&An.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},VR=An&&An.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(An,"__esModule",{value:!0});var NR=VR(js()),mi=class n extends NR.default{constructor(t,e,i){super(t,e,i),this.videoQualityControlParameterMap=new Map;let r=4;for(let o=0;o<n.NAME_ARR_ASCENDING.length;o++){let s=n.NAME_ARR_ASCENDING[o];this.videoQualityControlParameterMap.set(s,{rid:s,scaleResolutionDownBy:r,maxBitrate:n.BITRATE_ARR_ASCENDING[o]*1e3}),r=r/2}}setEncodingParameters(t){return IT(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;let e=this._localCameraTransceiver.sender,i=Array.from(t.values());if(i.length<=0)return;let r=e.getParameters();if(!r.encodings)r.encodings=i;else for(let o of r.encodings)o.rid===n.LOW_LEVEL_NAME&&this.copyEncodingParams(t.get(n.LOW_LEVEL_NAME),o),o.rid===n.MID_LEVEL_NAME&&this.copyEncodingParams(t.get(n.MID_LEVEL_NAME),o),o.rid===n.HIGH_LEVEL_NAME&&this.copyEncodingParams(t.get(n.HIGH_LEVEL_NAME),o);yield e.setParameters(r),this.logVideoTransceiverParameters()})}setVideoSendingBitrateKbps(t){return IT(this,void 0,void 0,function*(){})}setupLocalTransceivers(){var t,e;if(this.useTransceivers()&&(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localAudioTransceiver||(this._localAudioTransceiver=this.peer.addTransceiver("audio",{direction:"inactive",streams:[this.defaultMediaStream]}),!((e=(t=this.meetingSessionContext)===null||t===void 0?void 0:t.audioProfile)===null||e===void 0)&&e.hasRedundancyEnabled()&&this.setupAudioRedWorker()),!this._localCameraTransceiver)){let i=Array.from(this.videoQualityControlParameterMap.values());this._localCameraTransceiver=this.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream],sendEncodings:i})}}logVideoTransceiverParameters(){let e=this._localCameraTransceiver.sender.getParameters().encodings,i=`simulcast: current encoding parameters 
`;for(let r of e)i+=`rid=${r.rid} maxBitrate=${r.maxBitrate} active=${r.active} scaleDownBy=${r.scaleResolutionDownBy} maxFrameRate = ${r.maxFramerate} 
`;this.logger.info(i)}copyEncodingParams(t,e){e.active=t.active,e.maxBitrate=t.maxBitrate,e.scaleResolutionDownBy=t.scaleResolutionDownBy,e.maxFramerate=t.maxFramerate}};An.default=mi;mi.LOW_LEVEL_NAME="low";mi.MID_LEVEL_NAME="mid";mi.HIGH_LEVEL_NAME="hi";mi.NAME_ARR_ASCENDING=["low","mid","hi"];mi.BITRATE_ARR_ASCENDING=[200,400,1100]});var ic=g(Pn=>{"use strict";var LR=Pn&&Pn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},BR=Pn&&Pn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Pn,"__esModule",{value:!0});var zs=BR(Ws()),$s=class n extends zs.default{constructor(t,e,i){super(t,e,i);let r=2;this.videoQualityControlParameterMap=new Map;for(let o=0;o<n.NAME_ARR_ASCENDING.length;o++){let s=n.NAME_ARR_ASCENDING[o];this.videoQualityControlParameterMap.set(s,{rid:s,scaleResolutionDownBy:r,maxBitrate:n.BITRATE_ARR_ASCENDING[o]*1e3}),r=r/2}}setEncodingParameters(t){return LR(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;let e=this._localCameraTransceiver.sender,i=Array.from(t.values());if(i.length<=0)return;let r=e.getParameters();if(!r.encodings)r.encodings=i;else for(let o=0;o<r.encodings.length;o++)r.encodings[o].rid===zs.default.LOW_LEVEL_NAME&&this.copyEncodingParams(t.get(zs.default.LOW_LEVEL_NAME),r.encodings[o]),r.encodings[o].rid===zs.default.HIGH_LEVEL_NAME&&this.copyEncodingParams(t.get(zs.default.HIGH_LEVEL_NAME),r.encodings[o]);yield e.setParameters(r),this.logVideoTransceiverParameters()})}};Pn.default=$s;$s.NAME_ARR_ASCENDING=["low","hi"];$s.BITRATE_ARR_ASCENDING=[300,1200]});var ug=g(Ks=>{"use strict";var FR=Ks&&Ks.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ks,"__esModule",{value:!0});var UR=FR(js()),lg=class extends UR.default{constructor(t,e,i){super(t,e,i)}setupLocalTransceivers(){this.useTransceivers()&&(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localCameraTransceiver||(this._localCameraTransceiver=this.peer.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream]})))}};Ks.default=lg});var $r=g(hg=>{"use strict";Object.defineProperty(hg,"__esModule",{value:!0});var fg=class n{constructor(t,e,i,r,o,s=1,d=!1){this.cameraWidth=t,this.cameraHeight=e,this.cameraFrameRate=i,this.maxEncodeBitrateKbps=r,this.isSimulcast=o,this.scaleResolutionDownBy=s,this.isSVC=d}equal(t){let e=t.captureWidth()===this.cameraWidth&&t.captureHeight()===this.cameraHeight&&t.captureFrameRate()===this.cameraFrameRate&&t.encodeBitrates().length===this.encodeBitrates().length&&t.encodeScaleResolutionDownBy().length===this.encodeScaleResolutionDownBy().length&&t.encodeWidths().length===this.encodeWidths().length&&t.encodeHeights().length===this.encodeHeights().length&&t.isSVCEncoding()===this.isSVC;if(e){for(let i=0;i<t.encodeWidths().length;i++)if(t.encodeWidths()[i]!==this.encodeWidths()[i]||t.encodeHeights()[i]!==this.encodeHeights()[i]||t.encodeBitrates()[i]!==this.encodeBitrates()[i]||t.encodeScaleResolutionDownBy()[i]!==this.encodeScaleResolutionDownBy()[i])return e=!1,e}return e}clone(){return new n(this.cameraWidth,this.cameraHeight,this.cameraFrameRate,this.maxEncodeBitrateKbps,this.isSimulcast,this.scaleResolutionDownBy,this.isSVC)}captureWidth(){return this.cameraWidth}captureHeight(){return this.cameraHeight}captureFrameRate(){return this.cameraFrameRate}encodeBitrates(){return[this.maxEncodeBitrateKbps]}encodeScaleResolutionDownBy(){return[this.scaleResolutionDownBy]}encodeWidths(){return[this.cameraWidth]}encodeHeights(){return[this.cameraHeight]}isSVCEncoding(){return this.isSVC}};hg.default=fg});var nc=g(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.TargetDisplaySize=void 0;var CT;(function(n){n[n.Low=0]="Low",n[n.Medium=1]="Medium",n[n.High=2]="High",n[n.Maximum=3]="Maximum"})(CT=Kr.TargetDisplaySize||(Kr.TargetDisplaySize={}));Kr.default=CT});var rc=g(Js=>{"use strict";var OT=Js&&Js.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Js,"__esModule",{value:!0});var Gs=OT(nc()),qR=OT(os()),Mn=class n{constructor(t,e,i,r){this.attendeeId=t,this.priority=e,this.targetSize=i!==void 0?i:Gs.default.Maximum,this.degradationPreference=r!==void 0?r:qR.default.Balanced}partialCompare(t){return this.priority-t.priority}equals(t){return this.attendeeId===t.attendeeId&&this.targetSize===t.targetSize&&this.priority===t.priority&&this.degradationPreference===t.degradationPreference}clone(){return new n(this.attendeeId,this.priority,this.targetSize,this.degradationPreference)}targetSizeToBitrateKbps(t){switch(t){case Gs.default.Maximum:return n.MAXIMUM_BITRATE_KBPS;case Gs.default.High:return n.HIGH_BITRATE_KBPS;case Gs.default.Medium:return n.MID_BITRATE_KBPS;case Gs.default.Low:return n.LOW_BITRATE_KBPS}}};Js.default=Mn;Mn.LOW_BITRATE_KBPS=300;Mn.MID_BITRATE_KBPS=600;Mn.HIGH_BITRATE_KBPS=1500;Mn.MAXIMUM_BITRATE_KBPS=1e4});var gg=g(mg=>{"use strict";Object.defineProperty(mg,"__esModule",{value:!0});var pg=class{};mg.default=pg});var oc=g(Qs=>{"use strict";var HR=Qs&&Qs.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Qs,"__esModule",{value:!0});var jR=HR(ht()),rt=class n{constructor(t=0,e=0){this.networkIssueResponseDelayFactor=t,this.networkIssueRecoveryDelayFactor=e,this.currentNetworkEvent=0,this.bandwidthDecreaseTimestamp=0,this.referenceBitrate=0,this.serverSideNetworkAdaption=jR.default.BandwidthProbingAndRemoteVideoQualityAdaption,t<0?t=0:t>1&&(t=1),this.networkIssueResponseDelayFactor=t,e<0?e=0:e>1&&(e=1),this.networkIssueRecoveryDelayFactor=e}allowSubscribe(t,e){let i=0,r=this.currentNetworkEvent;if(e>this.referenceBitrate)return this.currentNetworkEvent=2,this.referenceBitrate=e,!0;if(e<this.referenceBitrate){if(this.currentNetworkEvent=1,i=this.getSubscribeDelay(this.currentNetworkEvent,t),r!==1)this.bandwidthDecreaseTimestamp=Date.now();else if(Date.now()-this.bandwidthDecreaseTimestamp>i)return this.referenceBitrate=e,!0;return!1}else return this.currentNetworkEvent=0,!1}getSubscribeDelay(t,e){let i=n.MINIMUM_DELAY_MS,r=n.MAXIMUM_DELAY_MS-n.MINIMUM_DELAY_MS,o=this.networkIssueResponseDelayFactor;switch(t){case 1:i+=r*o*(1+e/10),i=Math.min(n.MAXIMUM_DELAY_MS,i);break}return i}};Qs.default=rt;rt.MINIMUM_DELAY_MS=2e3;rt.MAXIMUM_DELAY_MS=8e3;rt.Default=new rt(0,0);rt.UnstableNetworkPreset=new rt(0,1);rt.StableNetworkPreset=new rt(1,0)});var vg=g(ot=>{"use strict";var WR=ot&&ot.__createBinding||(Object.create?(function(n,t,e,i){i===void 0&&(i=e),Object.defineProperty(n,i,{enumerable:!0,get:function(){return t[e]}})}):(function(n,t,e,i){i===void 0&&(i=e),n[i]=t[e]})),zR=ot&&ot.__setModuleDefault||(Object.create?(function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}):function(n,t){n.default=t}),$R=ot&&ot.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&WR(t,n,e);return zR(t,n),t},st=ot&&ot.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ot,"__esModule",{value:!0});var KR=st(Cl()),GR=st(fr()),JR=st(pr()),ET=st(vr()),QR=Ge(),De=$R(ht()),XR=st(gg()),Xs=st(_i()),ZR=st($a()),Zs=st(nc()),YR=st(rc()),AT=Tn(),eD=st(oc()),PT=st(os()),Ys=class{constructor(){this.bandwidthEstimateKbps=0,this.usedBandwidthKbps=0,this.packetsLost=0,this.nackCount=0,this.rttMs=0}},Ce=class n{constructor(t,e=eD.default.Default){this.logger=t,this.videoPriorityBasedPolicyConfig=e,this.shouldPauseTiles=!0,this.observerQueue=new Set,this.pausedBwAttendeeIds=new Set,this.wantsResubscribeObserver=void 0,this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption===De.default.Default&&(this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption=De.default.BandwidthProbingAndRemoteVideoQualityAdaption),this.reset()}reset(){this.allHighestPolicy=new ZR.default(""),this.optimalReceiveSet=new Xs.default,this.optimalReceiveStreams=[],this.optimalNonPausedReceiveStreams=[],this.subscribedReceiveSet=new Xs.default,this.subscribedReceiveStreams=[],this.videoPreferences=void 0,this.defaultVideoPreferences=void 0,this.shouldPauseTiles=!0,this.pausedStreamIds=new Xs.default,this.pausedBwAttendeeIds=new Set,this.videoPreferencesUpdated=!1,this.logCount=0,this.startupPeriod=!0,this.usingPrevTargetRate=!1,this.rateProbeState="Not Probing",this.firstEstimateTimestamp=0,this.lastUpgradeRateKbps=0,this.timeBeforeAllowSubscribeMs=n.MIN_TIME_BETWEEN_SUBSCRIBE_MS,this.lastProbeTimestamp=Date.now(),this.timeBeforeAllowProbeMs=n.MIN_TIME_BETWEEN_PROBE_MS,this.downlinkStats=new Ys,this.prevDownlinkStats=new Ys,this.probeFailed=!1,this.serverSideNetworkAdaption=this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption,this.pendingActionAfterUpdatedPreferences=!1}bindToTileController(t){this.tileController=t,this.logger.info("tileController bound")}setWantsResubscribeObserver(t){this.wantsResubscribeObserver=t}chooseRemoteVideoSources(t){var e;if(!(!((e=this.videoPreferences)===null||e===void 0)&&e.equals(t))){if(this.videoPreferences=t?.clone(),!De.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)&&(this.pendingActionAfterUpdatedPreferences=!0,this.wantsResubscribeObserver!==void 0&&(this.wantsResubscribeObserver(),this.pendingActionAfterUpdatedPreferences=!1),this.serverSideNetworkAdaption===De.default.BandwidthProbingAndRemoteVideoQualityAdaption)){let i=new Array;for(let r of this.videoPreferences){let o=new XR.default;o.attendee=new KR.default,o.attendee.attendeeId=r.attendeeId,i.push(o)}this.allHighestPolicy.chooseRemoteVideoSources(i);return}this.videoPreferencesUpdated=!0,this.logger.info(`bwe: setVideoPreferences bwe: new preferences: ${JSON.stringify(t)}`)}}updateIndex(t){this.videoIndex=t,this.serverSideNetworkAdaption===De.default.BandwidthProbingAndRemoteVideoQualityAdaption&&this.allHighestPolicy.updateIndex(t),this.videoPreferences||this.updateDefaultVideoPreferences()}updateDefaultVideoPreferences(){let t=new Set;for(let o of this.videoIndex.remoteStreamDescriptions())t.add(o.attendeeId);let e=AT.VideoPreferences.prepare(),i=t.size,r=Zs.default.Maximum;i>8?r=Zs.default.Low:i>4&&(r=Zs.default.Medium);for(let o of t)e.add(new YR.default(o,1,r));this.defaultVideoPreferences=e.build()}updateMetrics(t){if(!this.videoIndex||this.videoIndex.allStreams().empty())return;this.prevDownlinkStats=this.downlinkStats,this.downlinkStats=new Ys;let e=t.getObservableMetrics();this.downlinkStats.bandwidthEstimateKbps=e.availableIncomingBitrate/1e3;for(let i in t.streamMetricReports){let r=Number.parseInt(i,10),o=t.streamMetricReports[r];o.direction===GR.default.DOWNSTREAM&&o.mediaType===JR.default.VIDEO&&(o.currentMetrics.hasOwnProperty("nackCount")&&(this.downlinkStats.nackCount+=t.countPerSecond("nackCount",r)),o.currentMetrics.hasOwnProperty("packetsLost")&&(this.downlinkStats.packetsLost+=t.countPerSecond("packetsLost",r)),o.currentMetrics.hasOwnProperty("bytesReceived")&&(this.downlinkStats.usedBandwidthKbps+=t.bitsPerSecond("bytesReceived",r)/1e3))}}wantsResubscribe(){let t=!1;return!De.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)&&(t||(t=this.pendingActionAfterUpdatedPreferences),this.serverSideNetworkAdaption===De.default.BandwidthProbingAndRemoteVideoQualityAdaption)?t||this.allHighestPolicy.wantsResubscribe():(this.calculateOptimalReceiveSet(),t||(t=!this.subscribedReceiveSet.equal(this.optimalReceiveSet)),t)}chooseSubscriptions(){return!De.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption)&&(this.pendingActionAfterUpdatedPreferences=!1,this.serverSideNetworkAdaption===De.default.BandwidthProbingAndRemoteVideoQualityAdaption)?this.allHighestPolicy.chooseSubscriptions():(this.subscribedReceiveSet.equal(this.optimalReceiveSet)||(this.lastSubscribeTimestamp=Date.now()),this.subscribedReceiveSet=this.optimalReceiveSet.clone(),this.subscribedReceiveStreams=this.optimalReceiveStreams.slice(),this.subscribedReceiveSet.clone())}addObserver(t){this.observerQueue.add(t)}removeObserver(t){this.observerQueue.delete(t)}forEachObserver(t){for(let e of this.observerQueue)t(e)}setVideoPriorityBasedPolicyConfigs(t){this.videoPriorityBasedPolicyConfig=t}calculateOptimalReceiveStreams(){var t;let e=[],i=this.videoIndex.remoteStreamDescriptions();if(i.length===0||!((t=this.videoPreferences)===null||t===void 0)&&t.isEmpty()){this.optimalReceiveStreams=[];return}let r=this.rateProbeState;this.cleanBwPausedTiles(i),this.handleAppPausedStreams(e,i);let o=new Map;for(let T of this.getCurrentVideoPreferences())o.set(T.attendeeId,T);let s=i.filter(T=>o.has(T.attendeeId)),d=!this.streamsWithPreferenceDidChange(s),l=!this.startupPeriod&&d;if(l&&Date.now()-this.lastSubscribeTimestamp<this.timeBeforeAllowSubscribeMs)return;s.sort((T,w)=>T.maxBitrateKbps===w.maxBitrateKbps?T.streamId-w.streamId:T.maxBitrateKbps-w.maxBitrateKbps);for(let T of s)(T.avgBitrateKbps===0||T.avgBitrateKbps>T.maxBitrateKbps)&&(T.attendeeId.endsWith(ET.default.Modality)&&T.maxBitrateKbps<100?T.maxBitrateKbps=T.avgBitrateKbps:T.avgBitrateKbps=T.maxBitrateKbps);let c=new Set;for(let T of this.getCurrentVideoPreferences()){let w=s.filter(A=>A.attendeeId===T.attendeeId);if(w.length<3)continue;let D=15,L=320*480;w.forEach(A=>{D=Math.max(D,A.maxFrameRate),L=Math.max(L,A.totalPixels())}),w.sort((A,P)=>{if(T.degradationPreference===PT.default.MaintainResolution)return Math.abs(A.maxFrameRate-P.maxFrameRate)<2?A.totalPixels()-P.totalPixels():A.maxFrameRate-P.maxFrameRate;if(T.degradationPreference===PT.default.MaintainFramerate)return A.totalPixels()===P.totalPixels()?A.maxFrameRate-P.maxFrameRate:A.totalPixels()-P.totalPixels();{let fe=dt=>dt.avgBitrateKbps*Math.pow(2,5*dt.maxFrameRate/D*Math.pow(4,dt.totalPixels()/L));return fe(A)-fe(P)}});let O;for(let A of w){if(O!==void 0&&(A.maxFrameRate<O.maxFrameRate&&Math.abs(O.maxFrameRate-A.maxFrameRate)>2||A.totalPixels()<O.totalPixels())){c.add(A.streamId);continue}O=A}}let a=s.filter(T=>!c.has(T.streamId));this.logger.info(`Filtered to ${JSON.stringify(a)}`);let u={targetDownlinkBitrate:0,chosenTotalBitrate:0,deltaToNextUpgrade:0};u.targetDownlinkBitrate=this.determineTargetRate();let p=this.subscribedReceiveSet.size(),m=this.downlinkStats.bandwidthEstimateKbps,S=!this.videoPriorityBasedPolicyConfig.allowSubscribe(p,m);if(this.probeFailed&&(this.probeFailed=!1,this.timeBeforeAllowSubscribeMs=n.MIN_TIME_BETWEEN_SUBSCRIBE_MS,l&&S))return;let C=this.priorityPolicy(u,a,e),I=!De.serverSideNetworkAdaptionIsNoneOrDefault(this.serverSideNetworkAdaption),_=0;if(!I&&!this.startupPeriod&&d?this.rateProbeState==="Probing"?_=this.handleProbe(e,u.targetDownlinkBitrate):u.deltaToNextUpgrade!==0&&(_=this.maybeOverrideOrProbe(e,u,C)):(this.setProbeState("Not Probing"),this.lastUpgradeRateKbps=0),this.previousStreamsWithPreference=s,this.videoPreferencesUpdated=!1,_===1){this.logger.info(`bwe: keepSameSubscriptions stats:${JSON.stringify(this.downlinkStats)}`),this.prevTargetRateKbps=u.targetDownlinkBitrate;return}if(_===2){let T=this.calculateSubscribeRate(this.preProbeNonPausedReceiveStreams);this.optimalReceiveStreams=this.preProbeReceiveStreams.slice(),this.processBwPausedStreams(s,this.preProbeNonPausedReceiveStreams),this.logger.info("bwe: Use Pre-Probe subscription subscribedRate:"+T);return}this.optimalNonPausedReceiveStreams=e.slice();let k=this.pausedBwAttendeeIds.size;this.processBwPausedStreams(s,e),this.logger.getLogLevel()<=QR.LogLevel.INFO&&(this.logCount%15===0||this.rateProbeState!==r||this.optimalReceiveStreams.length!==e.length||k!==this.pausedBwAttendeeIds.size)&&(this.logger.info(this.policyStateLogStr(i,u.targetDownlinkBitrate)),this.logCount=0),this.logCount++,this.prevTargetRateKbps=u.targetDownlinkBitrate,this.optimalReceiveStreams=e.slice()}calculateOptimalReceiveSet(){let t=new Xs.default;this.calculateOptimalReceiveStreams();for(let e of this.optimalReceiveStreams)t.add(e.streamId);if(!this.optimalReceiveSet.equal(t)){let e=this.calculateSubscribeRate(this.optimalReceiveStreams);this.logger.info(`bwe: new streamSelection: ${JSON.stringify(t)} subscribedRate:${e}`)}this.optimalReceiveSet=t}determineTargetRate(){let t=0,e=Date.now();return this.downlinkStats.bandwidthEstimateKbps!==0?(this.firstEstimateTimestamp===0&&(this.firstEstimateTimestamp=e),this.startupPeriod&&(this.downlinkStats.bandwidthEstimateKbps>n.DEFAULT_BANDWIDTH_KBPS||this.downlinkStats.packetsLost>0||e-this.firstEstimateTimestamp>n.STARTUP_PERIOD_MS&&this.downlinkStats.bandwidthEstimateKbps<=this.prevDownlinkStats.bandwidthEstimateKbps)&&(this.startupPeriod=!1,this.prevTargetRateKbps=this.downlinkStats.bandwidthEstimateKbps),this.startupPeriod?t=n.DEFAULT_BANDWIDTH_KBPS:this.rateProbeState==="Probing"&&this.downlinkStats.usedBandwidthKbps>this.downlinkStats.bandwidthEstimateKbps&&this.downlinkStats.packetsLost<n.SPURIOUS_PACKET_LOST_THRESHOLD?(this.logger.info(`bwe: In probe state, overriding estimate ${this.downlinkStats.bandwidthEstimateKbps} with actual receive bitrate ${this.downlinkStats.usedBandwidthKbps}`),t=this.downlinkStats.usedBandwidthKbps+n.USED_BANDWIDTH_OVERRIDE_BUFFER_KBPS):t=this.downlinkStats.bandwidthEstimateKbps):this.firstEstimateTimestamp===0?t=n.DEFAULT_BANDWIDTH_KBPS:t=this.prevTargetRateKbps,!this.startupPeriod&&(this.usingPrevTargetRate&&this.downlinkStats.bandwidthEstimateKbps<this.prevTargetRateKbps||this.downlinkStats.bandwidthEstimateKbps<this.prevTargetRateKbps*(100-n.LARGE_RATE_CHANGE_TRIGGER_PERCENT)/100||this.downlinkStats.bandwidthEstimateKbps<this.downlinkStats.usedBandwidthKbps*n.LARGE_RATE_CHANGE_TRIGGER_PERCENT/100)&&this.downlinkStats.packetsLost===0?(this.logger.debug(()=>"bwe: ValidateRate: Using Previous rate "+this.prevTargetRateKbps),this.usingPrevTargetRate=!0,t=this.prevTargetRateKbps):this.usingPrevTargetRate=!1,t>15e3&&this.logger.warn("bwe: "+t+" exceeds maximum limit (15000). Limit TargetDisplaySize with VideoPreferences to avoid this."),Math.min(t,15e3)}setProbeState(t){if(this.rateProbeState===t)return!1;let e=Date.now();switch(t){case"Not Probing":this.probePendingStartTimestamp=0;break;case"Probe Pending":if(this.lastProbeTimestamp===0||e-this.lastProbeTimestamp>n.MIN_TIME_BETWEEN_PROBE_MS)this.probePendingStartTimestamp=e;else return!1;break;case"Probing":if(e-this.probePendingStartTimestamp>this.timeBeforeAllowProbeMs)this.lastProbeTimestamp=e,this.preProbeReceiveStreams=this.subscribedReceiveStreams.slice(),this.preProbeNonPausedReceiveStreams=this.optimalNonPausedReceiveStreams,this.timeBeforeAllowProbeMs=Math.min(this.timeBeforeAllowProbeMs*2,n.MAX_HOLD_BEFORE_PROBE_MS);else return!1;break}return this.logger.info("bwe: setProbeState to "+t+" from "+this.rateProbeState),this.rateProbeState=t,!0}upgradeToStream(t,e){for(let i=0;i<t.length;i++)if(t[i].groupId===e.groupId){let r=e.avgBitrateKbps-t[i].avgBitrateKbps;return this.logger.info("bwe: upgradeStream from "+JSON.stringify(t[i])+" to "+e),this.lastUpgradeRateKbps=r,t[i]=e,r}return t.push(e),this.lastUpgradeRateKbps=e.avgBitrateKbps,this.lastUpgradeRateKbps}handleProbe(t,e){if(Date.now()-this.lastProbeTimestamp>n.MAX_ALLOWED_PROBE_TIME_MS)return this.logger.info("bwe: Canceling probe due to timeout"),this.setProbeState("Not Probing"),0;if(this.downlinkStats.packetsLost>0&&(this.logger.info(`bwe: Probe encountering packets lost:${this.downlinkStats.packetsLost}`),this.downlinkStats.packetsLost>n.SPURIOUS_PACKET_LOST_THRESHOLD))return this.setProbeState("Not Probing"),this.logger.info(`bwe: Canceling probe due to packets lost:${this.downlinkStats.packetsLost}`),this.probeFailed=!0,this.timeBeforeAllowSubscribeMs=Math.max(n.MIN_TIME_BETWEEN_SUBSCRIBE_MS,this.timeBeforeAllowSubscribeMs)*3,2;let i=this.calculateSubscribeRate(this.optimalReceiveStreams);return this.chosenStreamsSameAsLast(t)||e>i?(this.logger.info("bwe: Probe successful"),this.setProbeState("Not Probing"),this.timeBeforeAllowProbeMs=n.MIN_TIME_BETWEEN_PROBE_MS,0):1}maybeOverrideOrProbe(t,e,i){let r=this.chosenStreamsSameAsLast(t),o=0,s=e.targetDownlinkBitrate>n.LOW_BITRATE_THRESHOLD_KBPS?n.TARGET_RATE_CHANGE_TRIGGER_PERCENT:n.TARGET_RATE_CHANGE_TRIGGER_PERCENT*2,d=e.targetDownlinkBitrate*s/100;if(this.targetRateBaselineForDeltaCheckKbps=this.targetRateBaselineForDeltaCheckKbps!==void 0?this.targetRateBaselineForDeltaCheckKbps:this.prevTargetRateKbps,!r&&Math.abs(e.targetDownlinkBitrate-this.targetRateBaselineForDeltaCheckKbps)<d?(this.logger.info("bwe: MaybeOverrideOrProbe: Reuse last decision based on delta rate. {"+JSON.stringify(this.subscribedReceiveSet)+"}"),o=1):this.targetRateBaselineForDeltaCheckKbps=e.targetDownlinkBitrate,this.downlinkStats.packetsLost>this.prevDownlinkStats.packetsLost)return this.setProbeState("Not Probing"),this.lastUpgradeRateKbps=0,o;if(r||o===1)switch(this.rateProbeState){case"Not Probing":this.setProbeState("Probe Pending");break;case"Probe Pending":this.setProbeState("Probing")&&(this.upgradeToStream(t,i),o=0);break}else this.setProbeState("Not Probing");return o}calculateSubscribeRate(t){let e=0;for(let i of t)!this.pausedStreamIds.contain(i.streamId)&&!this.pausedBwAttendeeIds.has(i.attendeeId)&&(e+=i.maxBitrateKbps);return e}handleAppPausedStreams(t,e){if(!this.tileController){this.logger.warn("tileController not found!");return}this.pausedStreamIds=new Xs.default;let i=this.tileController.getAllRemoteVideoTiles();for(let r of i){let o=r.state();if(o.paused&&!this.pausedBwAttendeeIds.has(o.boundAttendeeId)){let s=e.length;for(;s--;)e[s].attendeeId===o.boundAttendeeId&&(this.logger.info("bwe: removed paused attendee "+o.boundAttendeeId+" streamId: "+e[s].streamId),this.pausedStreamIds.add(e[s].streamId),this.subscribedReceiveSet.contain(e[s].streamId)&&t.push(e[s]),e.splice(s,1))}}}processBwPausedStreams(t,e){if(!this.tileController){this.logger.warn("tileController not found!");return}let i=this.getCurrentVideoPreferences();if(i&&this.shouldPauseTiles){let r=this.tileController.getAllVideoTiles();for(let o of i){let s=this.getVideoTileForAttendeeId(o.attendeeId,r),d=s?.state().paused||!1;if(e.some(l=>l.attendeeId===o.attendeeId))d&&this.pausedBwAttendeeIds.has(o.attendeeId)&&(this.logger.info(`bwe: unpausing attendee ${o.attendeeId} due to bandwidth`),this.forEachObserver(l=>{l.tileWillBeUnpausedByDownlinkPolicy(s.id())}),this.tileController.unpauseVideoTile(s.id()),this.pausedBwAttendeeIds.delete(o.attendeeId));else{let l=t.some(c=>c.attendeeId===o.attendeeId);if(s&&l){let c=this.optimalReceiveStreams.find(a=>a.attendeeId===o.attendeeId);c!==void 0&&(d||(this.logger.info(`bwe: pausing streamId ${c.streamId} attendee ${o.attendeeId} due to bandwidth`),this.forEachObserver(a=>{a.tileWillBePausedByDownlinkPolicy(s.id())}),this.tileController.pauseVideoTile(s.id())),e.push(c)),this.pausedBwAttendeeIds.add(o.attendeeId)}else if(l){let c=this.tileController.addVideoTile();c.bindVideoStream(o.attendeeId,!1,null,0,0,0,null),this.forEachObserver(a=>{a.tileWillBePausedByDownlinkPolicy(c.id())}),c.pause(),this.logger.info(`bwe: Created video tile ${c.id()} for bw paused attendee ${o.attendeeId}`),this.pausedBwAttendeeIds.add(o.attendeeId)}}}}}cleanBwPausedTiles(t){if(!this.tileController){this.logger.warn("tileController not found!");return}let e=this.tileController.getAllRemoteVideoTiles(),i=this.getCurrentVideoPreferences();for(let r of e){let o=r.state();o.boundVideoStream||(t.some(s=>s.attendeeId===o.boundAttendeeId)?i!==void 0&&!i.some(s=>s.attendeeId===o.boundAttendeeId)&&this.tileController.removeVideoTile(o.tileId):(this.tileController.removeVideoTile(o.tileId),this.logger.info(`bwe: Removed video tile ${o.tileId} for bw paused attendee ${o.boundAttendeeId}`)))}}priorityPolicy(t,e,i){let r,o=this.getCurrentVideoPreferences(),s=o.highestPriority(),d,l=s;for(;l!==-1;){d=-1;for(let c of o)if(c.priority===l)for(let a of e)a.attendeeId===c.attendeeId&&(i.some(u=>u.groupId===a.groupId)||(t.chosenTotalBitrate+a.avgBitrateKbps<=t.targetDownlinkBitrate?(i.push(a),t.chosenTotalBitrate+=a.avgBitrateKbps):t.deltaToNextUpgrade===0&&(t.deltaToNextUpgrade=a.avgBitrateKbps,r=a)));else if(c.priority>l){d=c.priority;break}for(let c of o)if(c.priority===l){for(let a of e)if(a.attendeeId===c.attendeeId){let u=i.findIndex(p=>p.groupId===a.groupId&&p.maxBitrateKbps<=a.maxBitrateKbps&&p.avgBitrateKbps<a.avgBitrateKbps);if(u!==-1){let p=a.avgBitrateKbps-i[u].avgBitrateKbps;this.hasSimulcastStreams(e,a.attendeeId,a.groupId)&&this.canUpgrade(a.avgBitrateKbps,c.targetSize,c.targetSizeToBitrateKbps(c.targetSize),a.attendeeId.endsWith(ET.default.Modality))?(this.logger.info(`bwe: attendee: ${a.attendeeId} group: ${a.groupId} has simulcast and can upgrade avgBitrate: ${a.avgBitrateKbps} target: ${c.targetSizeToBitrateKbps(c.targetSize)} targetTotalBitrate: ${t.targetDownlinkBitrate}`),t.chosenTotalBitrate+p<=t.targetDownlinkBitrate?(t.chosenTotalBitrate+=p,i[u]=a):t.deltaToNextUpgrade===0&&(t.deltaToNextUpgrade=p,r=a)):this.logger.info("bwe: cannot upgrade stream quality beyond target size")}}}else if(c.priority>l)break;if(l===s&&t.deltaToNextUpgrade!==0)break;l=d}return r}getVideoTileForAttendeeId(t,e){for(let i of e)if(i.state().boundAttendeeId===t)return i;return null}canUpgrade(t,e,i,r){let o=!1;return(e===Zs.default.High||!r&&t<=i||r&&e===Zs.default.Medium&&t<=i)&&(o=!0),o?(this.logger.info(`bwe: canUpgrade: bitrateKbps: ${t} targetBitrateKbps: ${i}`),!0):(this.logger.info(`bwe: cannot Upgrade: bitrateKbps: ${t} targetBitrateKbps: ${i}`),!1)}hasSimulcastStreams(t,e,i){let r=0;for(let o of t)o.attendeeId===e&&o.groupId===i&&r++;return this.logger.info(`bwe: attendeeId: ${e} groupId: ${i} hasSimulcastStreams: streamCount: ${r}`),r>1}streamsWithPreferenceDidChange(t){if(this.previousStreamsWithPreference===void 0||t.length!==this.previousStreamsWithPreference.length||this.videoPreferencesUpdated===!0)return!0;for(let e of t)if(this.previousStreamsWithPreference.find(r=>r.groupId===e.groupId&&r.streamId===e.streamId&&r.maxBitrateKbps===e.maxBitrateKbps)===void 0)return!0;return!1}chosenStreamsSameAsLast(t){if(this.optimalNonPausedReceiveStreams.length!==t.length)return!1;for(let e of this.optimalNonPausedReceiveStreams)if(!t.some(i=>i.streamId===e.streamId))return!1;return!0}policyStateLogStr(t,e){let i=this.calculateSubscribeRate(this.optimalReceiveStreams),r={targetBitrate:e,subscribedRate:i,probeState:this.rateProbeState,startupPeriod:this.startupPeriod},o="remoteInfos: [";for(let d of t)o+=`{grpId:${d.groupId} strId:${d.streamId} maxBr:${d.maxBitrateKbps} avgBr:${d.avgBitrateKbps}}, `;o+="]";let s=`bwe: optimalReceiveSet ${JSON.stringify(r)}
bwe:   prev ${JSON.stringify(this.prevDownlinkStats)}
bwe:   now  ${JSON.stringify(this.downlinkStats)}
bwe:   ${o}
`;return(this.pausedStreamIds.size()>0||this.pausedBwAttendeeIds.size>0)&&(s+=`bwe:   paused: app stream ids ${JSON.stringify(this.pausedStreamIds)}  bw attendees { ${Array.from(this.pausedBwAttendeeIds).join(" ")} }
`),this.videoPreferences?s+=`bwe:   preferences: ${JSON.stringify(this.videoPreferences)}`:s+=`bwe:   default preferences: ${JSON.stringify(this.defaultVideoPreferences)}`,s}getCurrentVideoPreferences(){return this.videoPreferences||this.defaultVideoPreferences}getServerSideNetworkAdaption(){return this.serverSideNetworkAdaption}setServerSideNetworkAdaption(t){this.serverSideNetworkAdaption=t,this.setProbeState("Not Probing")}supportedServerSideNetworkAdaptions(){return[De.default.None,De.default.BandwidthProbing,De.default.BandwidthProbingAndRemoteVideoQualityAdaption]}getVideoPreferences(){let t=this.getCurrentVideoPreferences();return t||(t=AT.VideoPreferences.prepare().build()),t}wantsAllTemporalLayersInIndex(){return!0}};ot.default=Ce;Ce.DEFAULT_BANDWIDTH_KBPS=2800;Ce.STARTUP_PERIOD_MS=6e3;Ce.LARGE_RATE_CHANGE_TRIGGER_PERCENT=20;Ce.TARGET_RATE_CHANGE_TRIGGER_PERCENT=15;Ce.LOW_BITRATE_THRESHOLD_KBPS=300;Ce.MIN_TIME_BETWEEN_PROBE_MS=5e3;Ce.MIN_TIME_BETWEEN_SUBSCRIBE_MS=2e3;Ce.MAX_HOLD_BEFORE_PROBE_MS=3e4;Ce.MAX_ALLOWED_PROBE_TIME_MS=6e4;Ce.SPURIOUS_PACKET_LOST_THRESHOLD=2;Ce.USED_BANDWIDTH_OVERRIDE_BUFFER_KBPS=100});var yg=g(ea=>{"use strict";var ta=ea&&ea.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ea,"__esModule",{value:!0});var tD=ta(vr()),iD=ta(ht()),MT=ta(rc()),nD=Tn(),rD=ta(vg()),oD=ta(oc()),Sg=class n extends rD.default{constructor(t){super(t,n.createConfig()),this.logger=t,super.shouldPauseTiles=!1,this.videoPreferences=void 0}static createConfig(){let t=new oD.default;return t.serverSideNetworkAdaption=iD.default.None,t}reset(){super.reset(),super.shouldPauseTiles=!1,this.videoPreferences=void 0}updateIndex(t){super.updateIndex(t);let e=nD.VideoPreferences.prepare(),i=!1,r=t.remoteStreamDescriptions();for(let o of r)e.some(s=>s.attendeeId===o.attendeeId)||(o.attendeeId.endsWith(tD.default.Modality)?(e.add(new MT.default(o.attendeeId,1)),i=!0):e.add(new MT.default(o.attendeeId,2)));i?(this.videoPreferences=e.build(),this.videoPreferencesUpdated=!0):this.videoPreferences=void 0}chooseRemoteVideoSources(t){this.logger.error("chooseRemoteVideoSources should not be called by VideoAdaptiveProbePolicy")}};ea.default=Sg});var sc=g(_g=>{"use strict";Object.defineProperty(_g,"__esModule",{value:!0});var RT=oe(),bg=class n{constructor(t,e,i,r,o){this.attendeeId="",this.groupId=0,this.streamId=0,this.ssrc=0,this.trackLabel="",this.maxBitrateKbps=0,this.avgBitrateKbps=0,this.maxFrameRate=0,this.width=0,this.height=0,this.timeEnabled=0,this.disabledByWebRTC=!1,this.disabledByUplinkPolicy=!1,this.rid="",this.attendeeId=t,this.groupId=e,this.streamId=i,this.maxBitrateKbps=r,this.avgBitrateKbps=o}clone(){let t=new n;return t.attendeeId=this.attendeeId,t.groupId=this.groupId,t.streamId=this.streamId,t.ssrc=this.ssrc,t.trackLabel=this.trackLabel,t.maxBitrateKbps=this.maxBitrateKbps,t.avgBitrateKbps=this.avgBitrateKbps,t.maxFrameRate=this.maxFrameRate,t.timeEnabled=this.timeEnabled,t.disabledByUplinkPolicy=this.disabledByUplinkPolicy,t.width=this.width,t.height=this.height,t}toStreamDescriptor(){let t=RT.SdkStreamDescriptor.create();return t.mediaType=RT.SdkStreamMediaType.VIDEO,t.trackLabel=this.trackLabel,t.attendeeId=this.attendeeId,t.streamId=this.streamId,t.groupId=this.groupId,t.framerate=this.maxFrameRate,t.maxBitrateKbps=this.disabledByUplinkPolicy?0:this.maxBitrateKbps,t.avgBitrateBps=this.avgBitrateKbps,t}totalPixels(){return this.width*this.height}};_g.default=bg});var cc=g(ia=>{"use strict";var xT=ia&&ia.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ia,"__esModule",{value:!0});var ac=oe(),dc=xT(_i()),DT=xT(sc()),wg=class{constructor(t){this.logger=t,this.currentIndex=null,this.indexForSubscribe=null,this.indexForLastRemoteVideoUpdate=null,this.currentSubscribeAck=null,this.subscribeTrackToStreamMap=null,this.subscribeStreamToAttendeeMap=null,this.subscribeStreamToExternalUserIdMap=null,this.subscribeSsrcToStreamMap=null,this.subscribeSsrcToGroupMap=null,this.streamToAttendeeMap=null,this.groupIdToAttendeeMap=null,this.streamToExternalUserIdMap=null,this.videoStreamDescription=new DT.default,this.sendVideoStreamId=0,this.videoStreamDescription.trackLabel="AmazonChimeExpressVideo",this.videoStreamDescription.streamId=2,this.videoStreamDescription.groupId=2}localStreamDescriptions(){return[this.videoStreamDescription.clone()]}convertBpsToKbps(t){return t>0&&t<1e3?1:Math.trunc(t/1e3)}remoteStreamDescriptions(){if(!this.currentIndex||!this.currentIndex.sources)return[];let t=[];return this.currentIndex.sources.forEach(e=>{let i=new DT.default;i.attendeeId=e.attendeeId,i.groupId=e.groupId,i.streamId=e.streamId,i.maxBitrateKbps=e.maxBitrateKbps,i.avgBitrateKbps=this.convertBpsToKbps(e.avgBitrateBps),i.width=e.width,i.height=e.height,i.maxFrameRate=e.framerate,t.push(i)}),t}integrateUplinkPolicyDecision(t){if(t&&t.length){let e=t[0];this.videoStreamDescription.maxBitrateKbps=e.maxBitrate/1e3,this.videoStreamDescription.maxFrameRate=e.maxFramerate}}integrateIndexFrame(t){if(this.currentIndex=t,!t)return;let e=new Map,i=!1;for(let r of t.sources){if(!e.has(r.attendeeId)){e.set(r.attendeeId,r.groupId);continue}let o=e.get(r.attendeeId);o<r.groupId&&(this.logger.warn(`Old group ID ${o} found for attendee ID ${r.attendeeId}, replacing with newer group ID ${r.groupId}`),e.set(r.attendeeId,r.groupId)),i=!0}i&&(this.currentIndex.sources=this.currentIndex.sources.filter(r=>e.get(r.attendeeId)===r.groupId)),this.streamToAttendeeMap=null,this.groupIdToAttendeeMap=null,this.streamToExternalUserIdMap=null}subscribeFrameSent(){this.indexForSubscribe=this.currentIndex}remoteVideoUpdateSent(){this.indexForLastRemoteVideoUpdate=this.currentIndex}integrateSubscribeAckFrame(t){this.currentSubscribeAck=t,this.subscribeTrackToStreamMap=this.buildTrackToStreamMap(this.currentSubscribeAck),this.subscribeSsrcToStreamMap=this.buildSSRCToStreamMap(this.currentSubscribeAck),this.subscribeSsrcToGroupMap=this.buildSSRCToGroupMap(this.currentSubscribeAck),this.subscribeStreamToAttendeeMap=this.buildStreamToAttendeeMap(this.indexForSubscribe),this.subscribeStreamToExternalUserIdMap=this.buildStreamExternalUserIdMap(this.indexForSubscribe),this.sendVideoStreamId=0,t.allocations&&t.allocations!==void 0&&t.allocations.length>0&&(this.sendVideoStreamId=t.allocations[0].streamId)}integrateBitratesFrame(t){if(this.currentIndex)for(let e of t.bitrates){let i=this.currentIndex.sources.find(r=>r.streamId===e.sourceStreamId);i!==void 0&&(i.avgBitrateBps=e.avgBitrateBps)}}allStreams(){let t=new dc.default;if(this.currentIndex)for(let e of this.currentIndex.sources)t.add(e.streamId);return t}allVideoSendingSourcesExcludingSelf(t){let e=[],i=new Set;if(this.currentIndex&&this.currentIndex.sources&&this.currentIndex.sources.length)for(let r of this.currentIndex.sources){let{attendeeId:o,externalUserId:s,mediaType:d}=r;o!==t&&d===ac.SdkStreamMediaType.VIDEO&&(i.has(o)||(e.push({attendee:{attendeeId:o,externalUserId:s}}),i.add(o)))}return e}streamSelectionUnderBandwidthConstraint(t,e,i,r){let o=new Set;if(this.currentIndex)for(let a of this.currentIndex.sources)a.attendeeId===t||a.mediaType!==ac.SdkStreamMediaType.VIDEO||!e.has(a.attendeeId)&&!i.has(a.attendeeId)&&o.add(a.attendeeId);let s=this.buildAttendeeToSortedStreamDescriptorMapExcludingSelf(t),d=new Map,l=0;s.forEach((a,u)=>{d.set(u,a[0]),l+=a[0].maxBitrateKbps}),l=this.trySelectHighBitrateForAttendees(s,e,l,r,d),this.trySelectHighBitrateForAttendees(s,o,l,r,d);let c=new dc.default;for(let a of d.values())c.add(a.streamId);return c}highestQualityStreamFromEachGroupExcludingSelf(t){let e=new dc.default;if(this.currentIndex){let i=new Map;for(let r of this.currentIndex.sources)r.attendeeId===t||r.mediaType!==ac.SdkStreamMediaType.VIDEO||(!i.has(r.groupId)||r.maxBitrateKbps>i.get(r.groupId).maxBitrateKbps)&&i.set(r.groupId,r);for(let r of i.values())e.add(r.streamId)}return e}numberOfVideoPublishingParticipantsExcludingSelf(t){return this.highestQualityStreamFromEachGroupExcludingSelf(t).array().length}numberOfParticipants(){return this.currentIndex.numParticipants?this.currentIndex.numParticipants:-1}attendeeIdForTrack(t){let e=this.streamIdForTrack(t);if(e===void 0||!this.subscribeStreamToAttendeeMap)return this.logger.warn(`no attendee found for track ${t}`),"";let i=this.subscribeStreamToAttendeeMap.get(e);return i||(this.logger.info(`track ${t} (stream ${e}) does not correspond to a known attendee`),"")}externalUserIdForTrack(t){let e=this.streamIdForTrack(t);if(e===void 0||!this.subscribeStreamToExternalUserIdMap)return this.logger.warn(`no external user id found for track ${t}`),"";let i=this.subscribeStreamToExternalUserIdMap.get(e);return i||(this.logger.info(`track ${t} (stream ${e}) does not correspond to a known externalUserId`),"")}attendeeIdForStreamId(t){if(!this.streamToAttendeeMap)if(this.currentIndex)this.streamToAttendeeMap=this.buildStreamToAttendeeMap(this.currentIndex);else return"";let e=this.streamToAttendeeMap.get(t);return e||(this.logger.info(`stream ID ${t} does not correspond to a known attendee`),"")}attendeeIdForGroupId(t){if(!this.groupIdToAttendeeMap)if(this.currentIndex)this.groupIdToAttendeeMap=this.buildGroupIdToAttendeeMap(this.currentIndex);else return"";let e=this.groupIdToAttendeeMap.get(t);return e||(this.logger.info(`group ID ${t} does not correspond to a known attendee`),"")}groupIdForStreamId(t){if(!(!this.currentIndex||!this.currentIndex.sources)){for(let e of this.currentIndex.sources)if(e.streamId===t)return e.groupId;if(this.indexForSubscribe){for(let e of this.indexForSubscribe.sources)if(e.streamId===t)return e.groupId}if(this.indexForLastRemoteVideoUpdate){for(let e of this.indexForLastRemoteVideoUpdate.sources)if(e.streamId===t)return e.groupId}}}StreamIdsInSameGroup(t,e){return this.groupIdForStreamId(t)===this.groupIdForStreamId(e)}streamIdForTrack(t){if(this.subscribeTrackToStreamMap)return this.subscribeTrackToStreamMap.get(t)}streamIdForSSRC(t){if(this.subscribeSsrcToStreamMap)return this.subscribeSsrcToStreamMap.get(t)}overrideStreamIdMappings(t,e){if(this.subscribeTrackToStreamMap){for(let[i,r]of this.subscribeTrackToStreamMap.entries())if(t===r){this.subscribeTrackToStreamMap.set(i,e);break}}if(this.subscribeSsrcToStreamMap){for(let[i,r]of this.subscribeSsrcToStreamMap.entries())if(t===r){this.subscribeSsrcToStreamMap.set(i,e);break}}}groupIdForSSRC(t){if(this.subscribeSsrcToGroupMap)return this.subscribeSsrcToGroupMap.get(t)}streamsPausedAtSource(){let t=new dc.default;if(this.currentIndex)for(let e of this.currentIndex.pausedAtSourceIds)t.add(e);return t}sendVideoStreamIdFromRid(t){return this.sendVideoStreamId}buildTrackToStreamMap(t){let e=new Map;this.logger.debug(()=>`trackMap ${JSON.stringify(t.tracks)}`);for(let i of t.tracks)i.trackLabel.length>0&&i.streamId>0&&e.set(i.trackLabel,i.streamId);return e}buildSSRCToStreamMap(t){let e=new Map;this.logger.debug(()=>`ssrcMap ${JSON.stringify(t.tracks)}`);for(let i of t.tracks)i.trackLabel.length>0&&i.streamId>0&&e.set(i.ssrc,i.streamId);return e}buildSSRCToGroupMap(t){let e=new Map;for(let i of t.tracks)i.trackLabel.length>0&&i.streamId>0&&e.set(i.ssrc,this.groupIdForStreamId(i.streamId));return e}buildStreamToAttendeeMap(t){let e=new Map;if(t)for(let i of t.sources)e.set(i.streamId,i.attendeeId);return e}buildGroupIdToAttendeeMap(t){let e=new Map;for(let i of t.sources)e.set(i.groupId,i.attendeeId);return e}buildStreamExternalUserIdMap(t){let e=new Map;if(t)for(let i of t.sources)i.externalUserId&&e.set(i.streamId,i.externalUserId);return e}trySelectHighBitrateForAttendees(t,e,i,r,o){for(let s of e){if(i>=r)break;if(t.has(s)){let d=t.get(s);for(let l of d.reverse())if(i-o.get(s).maxBitrateKbps+l.maxBitrateKbps<r){i=i-o.get(s).maxBitrateKbps+l.maxBitrateKbps,o.set(s,l);break}}}return i}buildAttendeeToSortedStreamDescriptorMapExcludingSelf(t){let e=new Map;if(this.currentIndex)for(let i of this.currentIndex.sources)i.attendeeId===t||i.mediaType!==ac.SdkStreamMediaType.VIDEO||(e.has(i.attendeeId)?e.get(i.attendeeId).push(i):e.set(i.attendeeId,[i]));return e.forEach((i,r)=>{i.sort((o,s)=>o.maxBitrateKbps>s.maxBitrateKbps?1:o.maxBitrateKbps<s.maxBitrateKbps?-1:0)}),e}};ia.default=wg});var Tg=g(na=>{"use strict";var VT=na&&na.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(na,"__esModule",{value:!0});var sD=oe(),aD=VT(cc()),dD=VT(sc()),Rn=class n extends aD.default{constructor(){super(...arguments),this.streamIdToBitrateKbpsMap=new Map,this._localStreamInfos=[],this._sendRidToVideoStreamIdMap=new Map}localStreamDescriptions(){let t=[];return this._localStreamInfos.forEach(e=>{t.push(e.clone())}),t}integrateUplinkPolicyDecision(t){let e=!0,i=0;for(let r=0;r<t.length;r++){let o=t[r].maxBitrate/1e3,s=t[r].maxFramerate;if(!e||r===this._localStreamInfos.length){e=!1;let d=new dD.default;d.maxBitrateKbps=o,d.maxFrameRate=s,d.disabledByUplinkPolicy=o===0,d.rid=t[r].rid,o!==0&&(d.timeEnabled=Date.now()),this._localStreamInfos.push(d),i++;continue}this._localStreamInfos[i].maxBitrateKbps===0&&o>0&&(this._localStreamInfos[i].timeEnabled=Date.now()),this._localStreamInfos[i].maxBitrateKbps=o,this._localStreamInfos[i].maxFrameRate=s,this._localStreamInfos[i].disabledByUplinkPolicy=o===0,i++}e&&this._localStreamInfos.splice(i)}integrateBitratesFrame(t){super.integrateBitratesFrame(t);let e=new Set,i=new Set(this.streamIdToBitrateKbpsMap.keys());for(let r of t.bitrates)e.add(r.sourceStreamId),this.streamIdToBitrateKbpsMap.set(r.sourceStreamId,this.convertBpsToKbps(r.avgBitrateBps));for(let r of i)e.has(r)||(this.streamIdToBitrateKbpsMap.get(r)===n.UNSEEN_STREAM_BITRATE?this.streamIdToBitrateKbpsMap.set(r,n.RECENTLY_INACTIVE_STREAM_BITRATE):this.streamIdToBitrateKbpsMap.set(r,n.NOT_SENDING_STREAM_BITRATE));this.logLocalStreamDescriptions()}logLocalStreamDescriptions(){let t="";for(let e of this._localStreamInfos)t+=`streamId=${e.streamId} maxBitrate=${e.maxBitrateKbps} disabledByUplink=${e.disabledByUplinkPolicy}
`;this.logger.debug(()=>t)}integrateIndexFrame(t){super.integrateIndexFrame(t);let e=new Set,i=new Set(this.streamIdToBitrateKbpsMap.keys());for(let r of this.currentIndex.sources)r.mediaType===sD.SdkStreamMediaType.VIDEO&&(e.add(r.streamId),this.streamIdToBitrateKbpsMap.has(r.streamId)||this.streamIdToBitrateKbpsMap.set(r.streamId,n.UNSEEN_STREAM_BITRATE));for(let r of i)e.has(r)||this.streamIdToBitrateKbpsMap.delete(r)}integrateSubscribeAckFrame(t){if(super.integrateSubscribeAckFrame(t),!t.allocations||t.allocations===void 0)return;let e=0;this._sendRidToVideoStreamIdMap.clear();for(let i of t.allocations){if(this._localStreamInfos.length<e+1){this.logger.info("simulcast: allocation has more than number of local streams");break}this._localStreamInfos[e].groupId=i.groupId,this._localStreamInfos[e].streamId=i.streamId,this.streamIdToBitrateKbpsMap.has(i.streamId)||this.streamIdToBitrateKbpsMap.set(i.streamId,n.UNSEEN_STREAM_BITRATE),this._sendRidToVideoStreamIdMap.set(this._localStreamInfos[e].rid,i.streamId),e++}}sendVideoStreamIdFromRid(t){let e=0;return this._sendRidToVideoStreamIdMap.has(t)&&(e=this._sendRidToVideoStreamIdMap.get(t)),e}};na.default=Rn;Rn.UNSEEN_STREAM_BITRATE=-2;Rn.RECENTLY_INACTIVE_STREAM_BITRATE=-1;Rn.NOT_SENDING_STREAM_BITRATE=0;Rn.BitratesMsgFrequencyMs=4e3});var Ig=g(ra=>{"use strict";var cD=ra&&ra.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(ra,"__esModule",{value:!0});var kg=class{constructor(t,e){if(this.devicePixelRatioSource=t,this.observerQueue=new Set,this.mediaQueryListener=()=>{this.observerQueue.forEach(r=>{r.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())})},typeof window>"u")return;let i=matchMedia(`(resolution: ${this.devicePixelRatioSource.devicePixelRatio()}dppx)`);typeof i.addEventListener=="function"?(i.addEventListener("change",this.mediaQueryListener),this.mediaQueryList=i):typeof i.addListener=="function"?(i.addListener(this.mediaQueryListener),this.mediaQueryList=i):e.warn("ignoring DefaultDevicePixelRatioMonitor")}destroy(){return cD(this,void 0,void 0,function*(){this.mediaQueryList&&(typeof this.mediaQueryList.addEventListener=="function"?this.mediaQueryList.removeEventListener("change",this.mediaQueryListener):this.mediaQueryList.removeListener(this.mediaQueryListener)),delete this.mediaQueryListener,this.observerQueue.clear()})}registerObserver(t){this.observerQueue.add(t),t.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())}removeObserver(t){this.observerQueue.delete(t)}};ra.default=kg});var Eg=g(Og=>{"use strict";Object.defineProperty(Og,"__esModule",{value:!0});var Cg=class{devicePixelRatio(){return typeof window>"u"||!window||!window.devicePixelRatio?1:window.devicePixelRatio}};Og.default=Cg});var Mg=g(Pg=>{"use strict";Object.defineProperty(Pg,"__esModule",{value:!0});var Ag=class{constructor(){this.observerQueue=new Set,this.element=null,this.resizeObserver=new ResizeObserver(t=>{for(let e of t){let{width:i,height:r}=e.contentRect;this.notifyObservers(i,r)}})}notifyObservers(t,e){for(let i of this.observerQueue)i.videoElementResolutionChanged(t,e)}registerObserver(t){this.observerQueue.add(t)}removeObserver(t){this.observerQueue.delete(t)}bindVideoElement(t){this.element!==t&&(this.element&&this.resizeObserver.unobserve(this.element),this.element=t,this.element&&this.resizeObserver.observe(this.element))}};Pg.default=Ag});var Dg=g(Dn=>{"use strict";var lD=Dn&&Dn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},oa=Dn&&Dn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Dn,"__esModule",{value:!0});var uD=oa(Pt()),fD=oa(Ig()),hD=oa(Eg()),NT=Le(),pD=oa(Mg()),mD=oa($o()),Rg=class{constructor(t,e,i){this.tileFactory=t,this.audioVideoController=e,this.logger=i,this.tileMap=new Map,this.nextTileId=1,this.currentLocalTile=null,this.currentPausedTilesByIds=new Set,this.resolutionObservers=new Set,this.keepLastFrameWhenPaused=!1,this.keepLastFrameWhenPaused=e.configuration.keepLastFrameWhenPaused}createDevicePixelRatioMonitorIfNeeded(){this.devicePixelRatioMonitor||(this.devicePixelRatioMonitor=new fD.default(new hD.default,this.logger))}discardDevicePixelRatioMonitorIfNotNeeded(){return lD(this,void 0,void 0,function*(){if(this.tileMap.size||!this.devicePixelRatioMonitor)return;let t=this.devicePixelRatioMonitor;return this.devicePixelRatioMonitor=void 0,t.destroy()})}bindVideoElement(t,e){let i=this.getVideoTile(t);if(i===null){this.logger.warn(`Ignoring video element binding for unknown tile id ${t}`);return}i.bindVideoElement(e)}unbindVideoElement(t,e=!0){let i=this.getVideoTile(t);if(i===null){this.logger.warn(`Ignoring video element unbinding for unknown tile id ${t}`);return}this.logger.info("Unbinding the video element"),this.notifyRemoteObserversOfUnbound(i.state().boundAttendeeId);let r=i.stateRef().boundVideoElement;i.bindVideoElement(null),e&&(this.logger.info("Cleaning up the video element"),mD.default.disconnectVideoStreamFromVideoElement(r,!1))}startLocalVideoTile(){if(this.audioVideoController.configuration.meetingFeatures.videoMaxResolution===uD.default.VideoDisabled)return this.logger.warn("Could not start camera video because max video resolution was set to None"),-1;let t=this.findOrCreateLocalVideoTile();return this.currentLocalTile.stateRef().localTileStarted=!0,this.audioVideoController.update({needsRenegotiation:!0}),t.id()}stopLocalVideoTile(){this.currentLocalTile&&(this.currentLocalTile.stateRef().localTileStarted=!1,this.currentLocalTile.bindVideoStream(this.audioVideoController.configuration.credentials.attendeeId,!0,null,null,null,null,this.audioVideoController.configuration.credentials.externalUserId),this.audioVideoController.update({needsRenegotiation:!0}))}hasStartedLocalVideoTile(){return!!(this.currentLocalTile&&this.currentLocalTile.stateRef().localTileStarted)}removeLocalVideoTile(){this.currentLocalTile&&this.removeVideoTile(this.currentLocalTile.id())}getLocalVideoTile(){return this.currentLocalTile}pauseVideoTile(t){let e=this.getVideoTile(t);e&&(this.currentPausedTilesByIds.has(t)||(this.audioVideoController.pauseReceivingStream(e.stateRef().streamId),this.currentPausedTilesByIds.add(t)),e.pause())}unpauseVideoTile(t){let e=this.getVideoTile(t);e&&(this.currentPausedTilesByIds.has(t)&&(this.audioVideoController.resumeReceivingStream(e.stateRef().streamId),this.currentPausedTilesByIds.delete(t)),e.unpause())}getVideoTile(t){return this.tileMap.has(t)?this.tileMap.get(t):null}getVideoTileArea(t){let e=t.state(),i=0,r=0;return e.boundVideoElement&&(i=e.boundVideoElement.clientHeight*e.devicePixelRatio,r=e.boundVideoElement.clientWidth*e.devicePixelRatio),i*r}getAllRemoteVideoTiles(){let t=new Array;return this.tileMap.forEach((e,i)=>{(!this.currentLocalTile||i!==this.currentLocalTile.id())&&t.push(e)}),t}getAllVideoTiles(){return Array.from(this.tileMap.values())}addVideoTile(t=!1){let e=this.nextTileId;this.nextTileId+=1,this.createDevicePixelRatioMonitorIfNeeded();let i=this.tileFactory.makeTile(e,t,this,this.devicePixelRatioMonitor,this.createResolutionMonitor(e));return this.tileMap.set(e,i),i}removeVideoTile(t){if(!this.tileMap.has(t))return;let e=this.tileMap.get(t);this.currentLocalTile===e&&(this.currentLocalTile=null),e.destroy(),this.tileMap.delete(t),this.audioVideoController.forEachObserver(i=>{NT.Maybe.of(i.videoTileWasRemoved).map(r=>r.bind(i)(t))}),this.discardDevicePixelRatioMonitorIfNotNeeded()}removeVideoTilesByAttendeeId(t){let e=[];for(let i of this.getAllVideoTiles()){let r=i.state();r.boundAttendeeId===t&&(this.removeVideoTile(r.tileId),e.push(r.tileId))}return e}removeAllVideoTiles(){let t=Array.from(this.tileMap.keys());for(let e of t)this.removeVideoTile(e)}sendTileStateUpdate(t){this.audioVideoController.forEachObserver(e=>{NT.Maybe.of(e.videoTileDidUpdate).map(i=>i.bind(e)(t))})}haveVideoTilesWithStreams(){for(let t of this.getAllVideoTiles())if(t.state().boundVideoStream)return!0;return!1}haveVideoTileForAttendeeId(t){return!!this.getVideoTileForAttendeeId(t)}getVideoTileForAttendeeId(t){for(let e of this.getAllVideoTiles())if(e.state().boundAttendeeId===t)return e}captureVideoTile(t){let e=this.getVideoTile(t);return e?e.capture():null}registerVideoTileResolutionObserver(t){this.resolutionObservers.add(t)}removeVideoTileResolutionObserver(t){this.resolutionObservers.delete(t)}notifyResolutionObserversOfChange(t,e,i){for(let r of this.resolutionObservers)r.videoTileResolutionDidChange(t,e,i)}notifyRemoteObserversOfUnbound(t){for(let e of this.resolutionObservers)e.videoTileUnbound(t)}createResolutionMonitor(t){let e=new class{constructor(r,o){this.controller=r,this.tileId=o}videoElementResolutionChanged(r,o){let s=this.controller.getVideoTile(this.tileId);if(s){let d=s.state().boundAttendeeId;this.controller.notifyResolutionObserversOfChange(d,r,o)}}}(this,t),i=new pD.default;return i.registerObserver(e),i}findOrCreateLocalVideoTile(){return this.currentLocalTile?this.currentLocalTile:(this.currentLocalTile=this.addVideoTile(!0),this.currentLocalTile.bindVideoStream(this.audioVideoController.configuration.credentials.attendeeId,!0,null,null,null,null,this.audioVideoController.configuration.credentials.externalUserId),this.currentLocalTile)}};Dn.default=Rg});var Vg=g(sa=>{"use strict";var gD=sa&&sa.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(sa,"__esModule",{value:!0});var vD=gD($o()),xg=class{makeTile(t,e,i,r,o){return new vD.default(t,e,i,r,o)}};sa.default=xg});var Ng=g(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.SimulcastLayers=void 0;var LT;(function(n){n[n.Low=0]="Low",n[n.LowAndMedium=1]="LowAndMedium",n[n.LowAndHigh=2]="LowAndHigh",n[n.Medium=3]="Medium",n[n.MediumAndHigh=4]="MediumAndHigh",n[n.High=5]="High"})(LT=Gr.SimulcastLayers||(Gr.SimulcastLayers={}));Gr.default=LT});var Ug=g(aa=>{"use strict";var lc=aa&&aa.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(aa,"__esModule",{value:!0});var Lg=lc(Ng()),BT=lc(Ws()),SD=Le(),Bg=lc($r()),Fg=lc(fu()),Vt=class n{constructor(t,e){this.selfAttendeeId=t,this.logger=e,this.numSenders=0,this.shouldDisableSimulcast=!1,this.newQualityMap=new Map,this.currentQualityMap=new Map,this.newActiveStreams=1,this.videoIndex=null,this.observerQueue=new Set,this.hiTargetBitrateKbps=n.kHiTargetBitrateKbpsHd,this.midTargetBitrateKbps=n.kMidTargetBitrateKbpsHd,this.lowTargetBitrateKbps=n.kLowTargetBitrateKbpsHd,this.enableFhdVideo=!1,this.optimalParameters=new Bg.default(0,0,0,0,!0),this.parametersInEffect=new Bg.default(0,0,0,0,!0),this.currentQualityMap=this.fillEncodingParamWithBitrates([this.lowTargetBitrateKbps,0,this.hiTargetBitrateKbps]),this.newQualityMap=this.fillEncodingParamWithBitrates([this.lowTargetBitrateKbps,0,this.hiTargetBitrateKbps])}updateConnectionMetric(t){}calculateEncodingParameters(){let t=[new Fg.default,new Fg.default,new Fg.default];this.shouldDisableSimulcast?(this.newActiveStreams=0,t[0].maxBitrateKbps=0,t[1].maxBitrateKbps=this.hiTargetBitrateKbps,t[2].maxBitrateKbps=0):this.numSenders<=4?(this.newActiveStreams=1,t[0].maxBitrateKbps=this.lowTargetBitrateKbps,t[1].maxBitrateKbps=0,t[2].maxBitrateKbps=this.hiTargetBitrateKbps):(this.newActiveStreams=2,t[0].maxBitrateKbps=this.lowTargetBitrateKbps*2/3,t[1].maxBitrateKbps=this.numSenders<=6?this.midTargetBitrateKbps:this.midTargetBitrateKbps*.6,t[2].maxBitrateKbps=0);let e=t.map((i,r,o)=>i.maxBitrateKbps);return this.newQualityMap=this.fillEncodingParamWithBitrates(e),this.encodingParametersEqual()||this.logger.info(`simulcast: policy:calculateEncodingParameters numSources:${this.numSenders} shouldDisableSimulcast:${this.shouldDisableSimulcast} newQualityMap: ${this.getQualityMapString(this.newQualityMap)}`),this.newQualityMap}chooseMediaTrackConstraints(){}chooseEncodingParameters(){return this.currentQualityMap=this.newQualityMap,this.activeStreamsToPublish!==this.newActiveStreams&&(this.activeStreamsToPublish=this.newActiveStreams,this.publishEncodingSimulcastLayer()),this.currentQualityMap}updateIndex(t){let e=t.numberOfVideoPublishingParticipantsExcludingSelf(this.selfAttendeeId)+1,i=e!==this.numSenders,r=t.numberOfParticipants(),o=r>=0&&r<=2,s=this.shouldDisableSimulcast!==o;this.numSenders=e,this.shouldDisableSimulcast=o,this.optimalParameters=new Bg.default(this.captureWidth(),this.captureHeight(),this.captureFrameRate(),this.maxBandwidthKbps(),!1),this.videoIndex=t,(i||s)&&(this.newQualityMap=this.calculateEncodingParameters())}wantsResubscribe(){return!this.encodingParametersEqual()}compareEncodingParameter(t,e){return JSON.stringify(t)===JSON.stringify(e)}encodingParametersEqual(){let t=!1;for(let e of BT.default.NAME_ARR_ASCENDING)if(t=t||!this.compareEncodingParameter(this.newQualityMap.get(e),this.currentQualityMap.get(e)),t)break;return!t}chooseCaptureAndEncodeParameters(){return this.parametersInEffect=this.optimalParameters.clone(),this.parametersInEffect.clone()}captureWidth(){return this.enableFhdVideo?1920:1280}captureHeight(){return this.enableFhdVideo?1080:768}captureFrameRate(){return 15}maxBandwidthKbps(){return this.enableFhdVideo?2500:1400}setIdealMaxBandwidthKbps(t){}setHasBandwidthPriority(t){}setHighResolutionFeatureEnabled(t){this.enableFhdVideo=t,this.hiTargetBitrateKbps=t?n.kHiTargetBitrateKbpsFhd:n.kHiTargetBitrateKbpsHd,this.midTargetBitrateKbps=t?n.kMidTargetBitrateKbpsFhd:n.kMidTargetBitrateKbpsHd,this.lowTargetBitrateKbps=t?n.kLowTargetBitrateKbpsFhd:n.kLowTargetBitrateKbpsHd}wantsVideoDependencyDescriptorRtpHeaderExtension(){return!0}fillEncodingParamWithBitrates(t){let e=new Map,i=1e3,r=BT.default.NAME_ARR_ASCENDING,o=t,s=this.shouldDisableSimulcast?1:4;for(let d=0;d<r.length;d++){let l=r[d];e.set(l,{rid:l,active:o[d]>0,scaleResolutionDownBy:Math.max(s,1),maxBitrate:o[d]*i}),s=s/2}return e}getQualityMapString(t){let e="";return this.videoIndex.localStreamDescriptions().length===3&&t.forEach(r=>{e+=`{ rid: ${r.rid} active:${r.active} maxBitrate:${r.maxBitrate}}`}),e}getEncodingSimulcastLayer(t){switch(t){case 0:return Lg.default.High;case 1:return Lg.default.LowAndHigh;case 2:return Lg.default.LowAndMedium}}publishEncodingSimulcastLayer(){let t=this.getEncodingSimulcastLayer(this.activeStreamsToPublish);this.forEachObserver(e=>{SD.Maybe.of(e.encodingSimulcastLayersDidChange).map(i=>i.bind(e)(t))})}addObserver(t){this.logger.info("adding simulcast uplink observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing simulcast uplink observer"),this.observerQueue.delete(t)}forEachObserver(t){for(let e of this.observerQueue)t(e)}};aa.default=Vt;Vt.kHiTargetBitrateKbpsHd=1200;Vt.kMidTargetBitrateKbpsHd=600;Vt.kLowTargetBitrateKbpsHd=300;Vt.kHiTargetBitrateKbpsFhd=2e3;Vt.kMidTargetBitrateKbpsFhd=1e3;Vt.kLowTargetBitrateKbpsFhd=500});var Hg=g(xn=>{"use strict";var yD=xn&&xn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},bD=xn&&xn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(xn,"__esModule",{value:!0});var qg=bD($r()),Jr=class n{constructor(t,e=!0,i=void 0,r=void 0){this.selfAttendeeId=t,this.scaleResolution=e,this.logger=i,this.browserBehavior=r,this.numberOfPublishedVideoSources=void 0,this.idealMaxBandwidthKbps=1500,this.hasBandwidthPriority=!1,this.encodingParamMap=new Map,this.enableHighResolutionFeature=!1,this.enableSVC=!1,this.isUsingSVCCodec=!0,this.numParticipants=0,this.reset()}reset(){this.numberOfPublishedVideoSources=void 0,this.optimalParameters=new qg.default(0,0,0,0,!1),this.parametersInEffect=new qg.default(0,0,0,0,!1),this.encodingParamMap.set(n.encodingMapKey,{maxBitrate:0})}updateConnectionMetric(t){}chooseMediaTrackConstraints(){return{}}chooseEncodingParameters(){return new Map}updateIndex(t){var e;let i=!0;this.transceiverController&&(i=this.transceiverController.hasVideoInput());let r=t.numberOfVideoPublishingParticipantsExcludingSelf(this.selfAttendeeId)+(i?1:0),o=t.numberOfParticipants();if(this.numParticipants===o&&this.numberOfPublishedVideoSources===r){(e=this.logger)===null||e===void 0||e.debug("Skipping update index; Number of participants has not changed");return}this.numberOfPublishedVideoSources=r,this.numParticipants=o,this.updateOptimalParameters()}wantsResubscribe(){return!this.parametersInEffect.equal(this.optimalParameters)}chooseCaptureAndEncodeParameters(){return this.parametersInEffect=this.optimalParameters.clone(),this.parametersInEffect.clone()}updateOptimalParameters(){let t=1;if(this.transceiverController){let e=this.getStreamCaptureSetting();e&&(t=this.calculateEncodingParameters(e).scaleResolutionDownBy)}this.optimalParameters=new qg.default(this.captureWidth(),this.captureHeight(),this.captureFrameRate(),this.maxBandwidthKbps(),!1,t,this.enableSVC&&this.numParticipants>2&&this.isUsingSVCCodec)}captureWidth(){let t=640;return this.getNumberOfPublishedVideoSources()>4&&(t=320),t}captureHeight(){let t=384;return this.getNumberOfPublishedVideoSources()>4&&(t=192),t}captureFrameRate(){return 15}maxBandwidthKbps(){if(this.hasBandwidthPriority)return Math.trunc(this.idealMaxBandwidthKbps);let t=0;return this.getNumberOfPublishedVideoSources()<=2?t=this.idealMaxBandwidthKbps:this.getNumberOfPublishedVideoSources()<=4?t=this.idealMaxBandwidthKbps*2/3:t=(544/11+14880/(11*this.getNumberOfPublishedVideoSources()))/600*this.idealMaxBandwidthKbps,Math.trunc(t)}setIdealMaxBandwidthKbps(t){this.idealMaxBandwidthKbps=t}setHasBandwidthPriority(t){this.hasBandwidthPriority=t}setTransceiverController(t){this.transceiverController=t}setSVCEnabled(t){var e;this.enableSVC=t,(e=this.logger)===null||e===void 0||e.info(`setSVCEnabled, enable: ${t}}`)}setHighResolutionFeatureEnabled(t){this.enableHighResolutionFeature=t}updateTransceiverController(){return yD(this,void 0,void 0,function*(){let t=this.getStreamCaptureSetting();if(!t)return;let e=this.calculateEncodingParameters(t);this.shouldUpdateEndcodingParameters(e)&&(this.encodingParamMap.set(n.encodingMapKey,e),this.transceiverController.setEncodingParameters(this.encodingParamMap))})}shouldUpdateEndcodingParameters(t){var e,i;let r=(i=(e=this.transceiverController.localVideoTransceiver().sender.getParameters())===null||e===void 0?void 0:e.encodings)===null||i===void 0?void 0:i[0];return t.maxBitrate!==r?.maxBitrate||t.scaleResolutionDownBy!==r?.scaleResolutionDownBy||t?.scalabilityMode!==r?.scalabilityMode}calculateEncodingParameters(t){var e,i,r;let o=this.maxBandwidthKbps()*1e3,s=1,d=720;if(t.height!==void 0&&t.width!==void 0&&this.scaleResolution&&!this.hasBandwidthPriority&&this.getNumberOfPublishedVideoSources()>2&&(d=n.targetHeightArray[Math.min(this.getNumberOfPublishedVideoSources(),n.targetHeightArray.length-1)][this.enableHighResolutionFeature?1:0],d===480&&(!((e=this.browserBehavior)===null||e===void 0)&&e.disable480pResolutionScaleDown())&&(d=360),s=Math.max(Math.min(t.height,t.width)/d,1),(i=this.logger)===null||i===void 0||i.info(`Resolution scale factor is ${s} for capture resolution ${t.width}x${t.height}. New dimension is ${t.width/s}x${t.height/s}`)),this.enableSVC){let l;return this.numParticipants>=0&&this.numParticipants<3||!this.isUsingSVCCodec?l="L1T1":l="L3T3",(r=this.logger)===null||r===void 0||r.info(`calculateEncodingParameters: SVC: ${this.enableSVC}    participants: ${this.numParticipants}     publishers: ${this.getNumberOfPublishedVideoSources()}     bitrate: ${o}  targetHeight: ${d}  scalabilityMode: ${l}   isUsingSVCCodec: ${this.isUsingSVCCodec}`),{scaleResolutionDownBy:s,maxBitrate:o,scalabilityMode:l}}else return{scaleResolutionDownBy:s,maxBitrate:o}}getStreamCaptureSetting(){var t,e,i,r;return(r=(i=(e=(t=this.transceiverController)===null||t===void 0?void 0:t.localVideoTransceiver())===null||e===void 0?void 0:e.sender)===null||i===void 0?void 0:i.track)===null||r===void 0?void 0:r.getSettings()}getNumberOfPublishedVideoSources(){var t;return(t=this.numberOfPublishedVideoSources)!==null&&t!==void 0?t:0}wantsVideoDependencyDescriptorRtpHeaderExtension(){return this.enableSVC}setMeetingSupportedVideoSendCodecs(t,e){let i=t??e,r=i.length>0&&n.SVCCodecNames.includes(i[0].codecName);r!==this.isUsingSVCCodec&&(this.isUsingSVCCodec=r,this.updateOptimalParameters())}};xn.default=Jr;Jr.encodingMapKey="video";Jr.targetHeightArray=[[0,0],[0,0],[0,0],[540,720],[540,720],[480,540],[480,540],[480,540],[480,540],[360,480],[360,480],[360,480],[360,480],[270,360],[270,360],[270,360],[270,360],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270],[180,270]];Jr.SVCCodecNames=["VP9"]});var Wg=g(jg=>{"use strict";Object.defineProperty(jg,"__esModule",{value:!0});var Qr=class n{constructor(t,e,i,r,o){this.logger=t,this.realtimeController=e,this.minVolumeDecibels=i,this.maxVolumeDecibels=r,this.selfAttendeeId=o,this.streamIdToAttendeeId={},this.streamIdToExternalUserId={},this.warnedAboutMissingStreamIdMapping={},this.attendeeIdToStreamId={},this.sessionReconnected=!1}onReconnect(){this.sessionReconnected=!0}sendRealtimeUpdatesForAudioStreamIdInfo(t){let e=0;for(let i of t.streams){let r=!!i.attendeeId,o=!!i.externalUserId,s=i.hasOwnProperty("muted"),d=!!i.dropped;if(r){this.attendeeIdToStreamId[i.attendeeId]&&this.attendeeIdToStreamId[i.attendeeId]<i.audioStreamId&&delete this.attendeeIdToStreamId[i.attendeeId],this.streamIdToAttendeeId[i.audioStreamId]=i.attendeeId;let l=o?i.externalUserId:i.attendeeId;this.streamIdToExternalUserId[i.audioStreamId]=l,this.attendeeIdToStreamId[i.attendeeId]=i.audioStreamId,this.realtimeController.realtimeSetAttendeeIdPresence(i.attendeeId,!0,l,!1,{attendeeIndex:e++,attendeesInFrame:t.streams.length})}if(s){let l=this.streamIdToAttendeeId[i.audioStreamId],c=this.streamIdToExternalUserId[i.audioStreamId];this.realtimeController.realtimeUpdateVolumeIndicator(l,null,i.muted,null,c)}if(!r&&!s){let l=this.streamIdToAttendeeId[i.audioStreamId];if(l){let c=this.streamIdToExternalUserId[i.audioStreamId];delete this.streamIdToAttendeeId[i.audioStreamId],delete this.streamIdToExternalUserId[i.audioStreamId],delete this.warnedAboutMissingStreamIdMapping[i.audioStreamId],this.attendeeIdToStreamId[l]===i.audioStreamId&&delete this.attendeeIdToStreamId[l];let a=!1;for(let u of Object.keys(this.streamIdToAttendeeId)){let p=parseInt(u);if(p>i.audioStreamId&&this.streamIdToAttendeeId[p]===l){a=!0;break}}a||this.realtimeController.realtimeSetAttendeeIdPresence(l,!1,c,d,{attendeeIndex:e++,attendeesInFrame:t.streams.length})}}}this.sessionReconnected&&(this.cleanUpState(t),this.sessionReconnected=!1)}cleanUpState(t){let e=Object.values(this.streamIdToAttendeeId),i=t.streams.map(o=>o.attendeeId),r=e.filter(o=>!i.includes(o));for(let[o,s]of r.entries()){let d=this.attendeeIdToStreamId[s],l=this.streamIdToExternalUserId[d];if(delete this.streamIdToAttendeeId[d],delete this.streamIdToExternalUserId[d],delete this.warnedAboutMissingStreamIdMapping[d],delete this.attendeeIdToStreamId[s],s===this.selfAttendeeId){this.logger.warn("the volume indicator adapter cleans up the current attendee (presence = false) after reconnection");continue}this.realtimeController.realtimeSetAttendeeIdPresence(s,!1,l,!1,{attendeeIndex:o,attendeesInFrame:s.length})}}sendRealtimeUpdatesForAudioMetadata(t){let e=null,i=null;for(let r of t.attendeeStates){let o=this.attendeeIdForStreamId(r.audioStreamId);r.hasOwnProperty("volume")&&(e===null&&(e={}),o!==null&&(e[o]=this.normalizedVolume(r))),r.hasOwnProperty("signalStrength")&&(i===null&&(i={}),o!==null&&(i[o]=this.normalizedSignalStrength(r)))}this.applyRealtimeUpdatesForAudioMetadata(e,i)}normalizedVolume(t){let i=1-(-t.volume-this.maxVolumeDecibels)/(this.minVolumeDecibels-this.maxVolumeDecibels);return Math.min(Math.max(i,0),1)}normalizedSignalStrength(t){let e=t.signalStrength/n.MAX_SIGNAL_STRENGTH_LEVELS;return Math.min(Math.max(e,0),1)}applyRealtimeUpdatesForAudioMetadata(t,e){for(let i in this.streamIdToAttendeeId){let r=this.streamIdToAttendeeId[i],o=this.streamIdToExternalUserId[i],s=null,d=null;t!==null&&(t.hasOwnProperty(r)?s=t[r]:s=n.IMPLICIT_VOLUME),e!==null&&(e.hasOwnProperty(r)?d=e[r]:d=n.IMPLICIT_SIGNAL_STRENGTH),(s!==null||d!==null)&&this.realtimeController.realtimeUpdateVolumeIndicator(r,s,null,d,o)}}attendeeIdForStreamId(t){if(t===0)return null;let e=this.streamIdToAttendeeId[t];return e||(this.warnedAboutMissingStreamIdMapping[t]||(this.warnedAboutMissingStreamIdMapping[t]=!0,this.logger.warn(`volume indicator stream id ${t} seen before being defined`)),null)}};jg.default=Qr;Qr.MAX_SIGNAL_STRENGTH_LEVELS=2;Qr.IMPLICIT_VOLUME=0;Qr.IMPLICIT_SIGNAL_STRENGTH=1});var mc=g(xe=>{"use strict";var _D=xe&&xe.__createBinding||(Object.create?(function(n,t,e,i){i===void 0&&(i=e),Object.defineProperty(n,i,{enumerable:!0,get:function(){return t[e]}})}):(function(n,t,e,i){i===void 0&&(i=e),n[i]=t[e]})),wD=xe&&xe.__setModuleDefault||(Object.create?(function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}):function(n,t){n.default=t}),TD=xe&&xe.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&_D(t,n,e);return wD(t,n),t},be=xe&&xe.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},R=xe&&xe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(xe,"__esModule",{value:!0});var kD=R(dh()),ID=R(kd()),CD=R(Za()),uc=R(pe()),OD=R(Qu()),ED=R(ph()),FT=R(Pt()),Vn=R(Gi()),ve=R(tt()),AD=R(Id()),gi=R(Xt()),PD=R(bh()),MD=R(zh()),RD=R(Ve()),Nn=R(ji()),DD=R(Jh()),Oe=R(Ed()),fc=R(Ad()),hc=R(Pd()),xD=R(Yh()),UT=TD(ht()),VD=R(me()),ND=R(Rd()),LD=oe(),BD=R(bw()),zg=R(Tl()),FD=R(ku()),UD=R(Cu()),qT=R(Kf()),$g=R(nh()),Kg=R(lp()),HT=R(vp()),qD=R(yp()),HD=R(_p()),jD=R(Pp()),jT=R(Np()),WD=R(Bp()),zD=R(Up()),$D=R(jp()),WT=R(zp()),zT=R(Kp()),KD=R(Qp()),GD=R(Yp()),We=R(tm()),Gg=R(rm()),pc=R(sm()),Jg=R(tg()),Nt=R(tc()),JD=R(rg()),QD=R(js()),XD=R(ic()),ZD=R(Ws()),YD=R(ug()),Lt=Le(),e1=R($r()),t1=R($a()),i1=R(yg()),n1=Tn(),$T=R(_i()),r1=R(cc()),o1=R(Tg()),s1=R(Dg()),a1=R(Vg()),d1=R(Ug()),c1=R(Hg()),l1=R(Wg()),KT=R(Pl()),Xr=class n{constructor(t,e,i,r,o,s){this._audioProfile=new CD.default,this.connectionHealthData=new OD.default,this.observerQueue=new Set,this.meetingSessionContext=new KT.default,this.enableSimulcast=!1,this.enableSVC=!1,this.useUpdateTransceiverControllerForUplink=!1,this.totalRetryCount=0,this.startAudioVideoTimestamp=0,this.mayNeedRenegotiationForSimulcastLayerChange=!1,this.promotedToPrimaryMeeting=!1,this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent=!1,this.receiveIndexTask=void 0,this.monitorTask=void 0,this.receiveRemotePauseResumeTask=void 0,this.destroyed=!1,this._logger=e,this.sessionStateController=new DD.default(this._logger),this._configuration=t,this._webSocketAdapter=i,this._realtimeController=new MD.default(r),this._realtimeController.realtimeSetLocalAttendeeId(t.credentials.attendeeId,t.credentials.externalUserId),this._mediaStreamBroker=r,this._reconnectController=o,this._videoTileController=new s1.default(new a1.default,this,this._logger),this._audioMixController=new ID.default(this._logger),this._mediaStreamBroker.addMediaStreamBrokerObserver(this._audioMixController),this.meetingSessionContext.logger=this._logger,this._eventController=s,this.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers||(new gi.default(this.configuration.credentials.attendeeId).hasModality(gi.default.MODALITY_CONTENT)&&new uc.default().hasChromiumWebRTC()?this.videoSendCodecPreferences=[Nn.default.av1Main(),Nn.default.vp9Profile0(),Nn.default.h264ConstrainedBaselineProfile(),Nn.default.vp8()]:this.videoSendCodecPreferences=[Nn.default.vp9Profile0(),Nn.default.h264ConstrainedBaselineProfile(),Nn.default.vp8()])}destroy(){return be(this,void 0,void 0,function*(){this.observerQueue.clear(),this._mediaStreamBroker.removeMediaStreamBrokerObserver(this._audioMixController),this.destroyed=!0})}get configuration(){return this._configuration}get realtimeController(){return this._realtimeController}get activeSpeakerDetector(){return this._activeSpeakerDetector||(this._activeSpeakerDetector=new kD.default(this._realtimeController,this._configuration.credentials.attendeeId,this.handleHasBandwidthPriority.bind(this))),this._activeSpeakerDetector}get videoTileController(){return this._videoTileController}get audioMixController(){return this._audioMixController}get logger(){return this._logger}get rtcPeerConnection(){return this.meetingSessionContext&&this.meetingSessionContext.peer||null}get mediaStreamBroker(){return this._mediaStreamBroker}get eventController(){return this._eventController}getRTCPeerConnectionStats(t){return this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent||(this.logger.warn("The `getRTCPeerConnectionStats()` is on its way to be deprecated. It makes an additional call to the `getStats` API and therefore may cause slight performance degradation. Please use the new API `clientMetricReport.getRTCStatsReport()` returned by `metricsDidReceive(clientMetricReport)` callback instead."),this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent=!0),this.rtcPeerConnection?this.rtcPeerConnection.getStats(t):null}setAudioProfile(t){this._audioProfile=t}addObserver(t){this.logger.info("adding meeting observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing meeting observer"),this.observerQueue.delete(t)}forEachObserver(t){for(let e of this.observerQueue)RD.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}initSignalingClient(){this.connectionHealthData.reset(),!this.meetingSessionContext.signalingClient&&(this.meetingSessionContext=new KT.default,this.meetingSessionContext.logger=this.logger,this.meetingSessionContext.eventController=this.eventController,this.meetingSessionContext.browserBehavior=new uc.default,this.meetingSessionContext.videoSendCodecPreferences=this.videoSendCodecPreferences,this.meetingSessionContext.audioProfile=this._audioProfile,this.meetingSessionContext.meetingSessionConfiguration=this.configuration,this.meetingSessionContext.signalingClient=new xD.default(this._webSocketAdapter,this.logger))}uninstallPreStartObserver(){this.meetingSessionContext.signalingClient.removeObserver(this.preStartObserver),this.preStartObserver=void 0}prestart(){return this.logger.info("Pre-connecting signaling connection."),this.createOrReuseSignalingTask().run().then(()=>{let t=()=>be(this,void 0,void 0,function*(){this.logger.info("Early connection closed; discarding signaling task."),this.signalingTask=void 0,this.uninstallPreStartObserver()});this.preStartObserver={handleSignalingClientEvent(e){e.type===VD.default.WebSocketClosed&&t()}},this.meetingSessionContext.signalingClient.registerObserver(this.preStartObserver)}).catch(t=>{this.logger.error(`Signaling task pre-start failed: ${t}`),this.signalingTask=void 0})}start(t){this.startReturningPromise(t).then(()=>{this.logger.info("start completed")}).catch(e=>{this.logger.error(`start failed: ${e}`)})}startReturningPromise(t){return t?.signalingOnly===!0?this.prestart():(this.activeSpeakerDetector,new Promise((e,i)=>{this.sessionStateController.perform(Oe.default.Connect,()=>{this.actionConnect(!1).then(e).catch(i)})}))}connectWithPromises(t){let e=this.meetingSessionContext,i=(m,S)=>new Nt.default(this.logger,S,m);this.monitorTask=new jD.default(e,this.configuration.connectionHealthPolicyConfiguration,this.connectionHealthData);let r=this.monitorTask.once(),o=new $D.default(e).once();this.receiveIndexTask=new KD.default(e),this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();let s=new We.default(this.logger,"Signaling",[this.createOrReuseSignalingTask(),new HD.default(e),new GD.default(e),new HT.default(e),this.receiveIndexTask]).once(),d=new qT.default(e).once(s),l=new zg.default(e).once(d,o),c=new $g.default(e).once(l),a=new Gg.default(e).once(c),u=new Kg.default(e).once(a),p=new Jg.default(e).once(u);return this.receiveRemotePauseResumeTask=new WT.default(e),this.receiveRemotePauseResumeTask.once(p),new We.default(this.logger,this.wrapTaskName("AudioVideoStart"),[r,i(this.configuration.connectionTimeoutMs,new We.default(this.logger,"Peer",[p,this.receiveRemotePauseResumeTask,t?new Nt.default(this.logger,new WD.default(this.logger,"FinalizeConnection",[new JD.default(e),new pc.default(e)]),this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs):new pc.default(e)]))])}actionConnect(t){var e;return be(this,void 0,void 0,function*(){this.initSignalingClient(),this.uninstallPreStartObserver(),this.meetingSessionContext.mediaStreamBroker=this._mediaStreamBroker,this.meetingSessionContext.realtimeController=this._realtimeController,this.meetingSessionContext.audioMixController=this._audioMixController,this.meetingSessionContext.audioVideoController=this,this.enableSimulcast=this.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&new uc.default().hasChromiumWebRTC(),this.enableSimulcast&&this.configuration.enableSVC&&this.logger.warn("SVC cannot be enabled at the same time as simulcast. Disabling SVC, using simulcast."),this.enableSVC=!this.enableSimulcast&&this.configuration.enableSVC&&new uc.default().supportsScalableVideoCoding();let i=!!this.configuration.urls.audioHostURL;if(i?this.enableSimulcast?(this.logger.info("Using transceiver controller with simulcast support"),new gi.default(this.configuration.credentials.attendeeId).hasModality(gi.default.MODALITY_CONTENT)?this.meetingSessionContext.transceiverController=new XD.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext):this.meetingSessionContext.transceiverController=new ZD.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)):(this.logger.info("Using default transceiver controller"),this.meetingSessionContext.transceiverController=new QD.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)):(this.logger.info("Using video only transceiver controller"),this.meetingSessionContext.transceiverController=new YD.default(this.logger,this.meetingSessionContext.browserBehavior,this.meetingSessionContext)),this.meetingSessionContext.volumeIndicatorAdapter=new l1.default(this.logger,this._realtimeController,n.MIN_VOLUME_DECIBELS,n.MAX_VOLUME_DECIBELS,this.configuration.credentials.attendeeId),this.meetingSessionContext.videoTileController=this._videoTileController,this.meetingSessionContext.videoDownlinkBandwidthPolicy=this.configuration.videoDownlinkBandwidthPolicy,this.meetingSessionContext.videoUplinkBandwidthPolicy=this.configuration.videoUplinkBandwidthPolicy,this.meetingSessionContext.enableSimulcast=this.enableSimulcast,this.meetingSessionContext.enableSVC=this.enableSVC,this.enableSimulcast){let s=this.meetingSessionContext.videoUplinkBandwidthPolicy;s||(s=new d1.default(this.configuration.credentials.attendeeId,this.meetingSessionContext.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy=s),s.addObserver(this),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new i1.default(this.meetingSessionContext.logger)),this.meetingSessionContext.videoStreamIndex=new o1.default(this.logger)}else this.meetingSessionContext.enableSimulcast=!1,this.meetingSessionContext.videoStreamIndex=new r1.default(this.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy||(this.meetingSessionContext.videoUplinkBandwidthPolicy=new c1.default(this.configuration.credentials.attendeeId,!this.meetingSessionContext.browserBehavior.disableResolutionScaleDown(),this.meetingSessionContext.logger,this.meetingSessionContext.browserBehavior),this.meetingSessionContext.videoUplinkBandwidthPolicy.setSVCEnabled(this.enableSVC)),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new t1.default(this.configuration.credentials.attendeeId)),this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController&&this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController&&(this.useUpdateTransceiverControllerForUplink=!0,this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController(this.meetingSessionContext.transceiverController)),this.meetingSessionContext.audioProfile=this._audioProfile;if(new gi.default(this.configuration.credentials.attendeeId).hasModality(gi.default.MODALITY_CONTENT)){let s=this.configuration.meetingFeatures.contentMaxResolution===FT.default.VideoResolutionUHD;s&&this.setVideoMaxBandwidthKbps(2500),this.meetingSessionContext.videoUplinkBandwidthPolicy.setHighResolutionFeatureEnabled(s)}else{let s=this.configuration.meetingFeatures.videoMaxResolution===FT.default.VideoResolutionFHD;this.meetingSessionContext.videoUplinkBandwidthPolicy.setHighResolutionFeatureEnabled(s)}this.meetingSessionContext.videoUplinkBandwidthPolicy&&this.maxUplinkBandwidthKbps&&this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(this.maxUplinkBandwidthKbps),this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController(this._videoTileController),this.meetingSessionContext.videoDownlinkBandwidthPolicy.setWantsResubscribeObserver&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.setWantsResubscribeObserver(()=>this.update({needsRenegotiation:!1})),this.meetingSessionContext.lastKnownVideoAvailability=new AD.default,this.meetingSessionContext.videoCaptureAndEncodeParameter=new e1.default(0,0,0,0,!1),this.meetingSessionContext.videosToReceive=new $T.default,this.meetingSessionContext.videosPaused=new $T.default,this.meetingSessionContext.statsCollector=new BD.default(this,this.logger),this.meetingSessionContext.connectionMonitor=new ED.default(this,this._realtimeController,this.connectionHealthData,new PD.default(this.meetingSessionContext.signalingClient,n.PING_PONG_INTERVAL_MS,this.logger),this.meetingSessionContext.statsCollector),this.meetingSessionContext.reconnectController=this._reconnectController,this.meetingSessionContext.videoDeviceInformation={},this._videoTileController.registerVideoTileResolutionObserver(this.meetingSessionContext.statsCollector),t||(this.totalRetryCount=0,this._reconnectController.reset(),this.startAudioVideoTimestamp=Date.now(),this.forEachObserver(s=>{Lt.Maybe.of(s.audioVideoDidStartConnecting).map(d=>d.bind(s)(!1))}),(e=this.eventController)===null||e===void 0||e.publishEvent("meetingStartRequested")),this.meetingSessionContext.startAudioVideoTimestamp=this.startAudioVideoTimestamp,this._reconnectController.hasStartedConnectionAttempt()?this._reconnectController.startedConnectionAttempt(!1):this._reconnectController.startedConnectionAttempt(!0);let r=i&&this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs>0;this.logger.info("Needs to wait for attendee presence? "+r);let o=this.connectWithPromises(r);try{yield o.run(),this.connectionHealthData.setConnectionStartTime();let s=new gi.default(this.configuration.credentials.attendeeId).hasModality(gi.default.MODALITY_CONTENT);this.connectionHealthData.setIsContentShare(s),this._mediaStreamBroker.addMediaStreamBrokerObserver(this),this.sessionStateController.perform(Oe.default.FinishConnecting,()=>{this.eventController&&(this.meetingSessionContext.meetingStartDurationMs=Date.now()-this.startAudioVideoTimestamp,this.eventController.publishEvent("meetingStartSucceeded",{maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,poorConnectionCount:this.meetingSessionContext.poorConnectionCount,retryCount:this.totalRetryCount,signalingOpenDurationMs:this.meetingSessionContext.signalingOpenDurationMs,iceGatheringDurationMs:this.meetingSessionContext.iceGatheringDurationMs,meetingStartDurationMs:this.meetingSessionContext.meetingStartDurationMs})),this.meetingSessionContext.startTimeMs=Date.now(),this.actionFinishConnecting()})}catch(s){this.signalingTask=void 0;let d=new Vn.default(this.getMeetingStatusCode(s)||ve.default.TaskFailed);if(this.logger.info(`Start failed: ${d} due to error ${s}.`),this.sessionStateController.state()===fc.default.NotConnected){this.logger.info("Start failed and not connected. Not cleaning up.");return}this.sessionStateController.perform(Oe.default.Fail,()=>be(this,void 0,void 0,function*(){yield this.actionDisconnect(d,!0,s),this.handleMeetingSessionStatus(d,s)||this.notifyStop(d,s)}))}})}createOrReuseSignalingTask(){return this.signalingTask||(this.initSignalingClient(),this.signalingTask=new Nt.default(this.logger,new jT.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs).once()),this.signalingTask}actionFinishConnecting(){this.signalingTask=void 0,this.meetingSessionContext.videoDuplexMode=LD.SdkStreamServiceType.RX,this.meetingSessionContext.enableSimulcast||(this.useUpdateTransceiverControllerForUplink?this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController():this.enforceBandwidthLimitationForSender(this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0])),this.meetingSessionContext.isSessionConnected=!0,this.forEachObserver(t=>{Lt.Maybe.of(t.audioVideoDidStart).map(e=>e.bind(t)())}),this._reconnectController.reset(),this.receiveIndexTask.resumeIngestion(),this.monitorTask.resumeResubscribeCheck()}stopReturningPromise(){var t;return this._reconnectController.disableReconnect(),this.sessionStateController.state()===fc.default.NotConnected?((t=this.meetingSessionContext.signalingClient)===null||t===void 0||t.closeConnection(),this.cleanUpMediaStreamsAfterStop(),Promise.resolve()):new Promise((e,i)=>{this.sessionStateController.perform(Oe.default.Disconnect,()=>{this.logger.info("attendee left meeting, session will not be reconnected"),this.actionDisconnect(new Vn.default(ve.default.Left),!1,null).then(e).catch(i)})})}stop(){this.stopReturningPromise()}actionDisconnect(t,e,i){return be(this,void 0,void 0,function*(){try{yield new We.default(this.logger,this.wrapTaskName("AudioVideoStop"),[new Nt.default(this.logger,new qD.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)]).run()}catch{this.logger.info("fail to stop")}try{let r=[new Nt.default(this.logger,new UD.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)];this.cleanUpMediaStreamsAfterStop(),yield new We.default(this.logger,this.wrapTaskName("AudioVideoClean"),r).run()}catch{this.logger.info("fail to clean")}this.sessionStateController.perform(Oe.default.FinishDisconnecting,()=>{e||this.notifyStop(t,i)}),this._videoTileController.removeVideoTileResolutionObserver(this.meetingSessionContext.statsCollector)})}update(t={needsRenegotiation:!0}){let e=t.needsRenegotiation;if(e||(e=this.meetingSessionContext.peer===void 0),e||(e=!this.updateRemoteVideosFromPolicy()),e||(e=!this.updateLocalVideoFromPolicy()),this.meetingSessionContext.lastVideosToReceive=this.meetingSessionContext.videosToReceive,!e)return this.logger.info("Update request does not require resubscribe"),this.actionFinishUpdating(),!0;this.logger.info("Update request requires resubscribe"),this.updateNumberOfPublishedVideoSources();let i=this.sessionStateController.perform(Oe.default.Update,()=>{this.actionUpdateWithRenegotiation(!0)});return i===hc.default.Transitioned||i===hc.default.DeferredTransition}updateNumberOfPublishedVideoSources(){let t=this.configuration.credentials.attendeeId,e=this._videoTileController.hasStartedLocalVideoTile();if(this.meetingSessionContext.videoStreamIndex!==null){let i=this.meetingSessionContext.videoStreamIndex.numberOfVideoPublishingParticipantsExcludingSelf(t)+(e?1:0);this.connectionHealthData.setNumberOfPublishedVideoSources(i)}}updateRemoteVideosFromPolicy(){if(this.meetingSessionContext.videoDownlinkBandwidthPolicy&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.getVideoPreferences!==void 0&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&!UT.serverSideNetworkAdaptionIsNoneOrDefault(this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption())){if(!this.sendRemoteVideoUpdate())return!1;if(this.meetingSessionContext.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption()===UT.default.BandwidthProbingAndRemoteVideoQualityAdaption)return this.isNotAddingOrRemovingStreams()}return this.updateRemoteVideosIfNotAddingOrRemovingStreams()}updateRemoteVideosIfNotAddingOrRemovingStreams(){let t=this.detectChangesInVideosToReceive();if(t===void 0)return!1;let e=t.added,i=t.simulcastStreamUpdates,r=t.removed,o=this.meetingSessionContext,s=[];for(let[d,l]of i.entries()){let c=new ND.default;if(c.streamId=l,c.attendeeId=o.videoStreamIndex.attendeeIdForStreamId(l),c.mid=o.transceiverController.getMidForStreamId(d),c.mid===void 0)return this.logger.info(`No MID found for stream ID ${d}, cannot update stream without renegotiation`),!1;if(s.push(c),o.transceiverController.setStreamIdForMid(c.mid,l),o.videoStreamIndex.overrideStreamIdMappings(d,l),o.videoTileController.haveVideoTileForAttendeeId(c.attendeeId)){let a=o.videoTileController.getVideoTileForAttendeeId(c.attendeeId);if(!a.setStreamId)return!1;a.setStreamId(l)}}return s.length!==0&&o.signalingClient.remoteVideoUpdate(s,[]),e.length!==0||r.length!==0?!1:(o.videoStreamIndex.remoteVideoUpdateSent(),!0)}detectChangesInVideosToReceive(){let t=this.meetingSessionContext;if(t.videosToReceive===null||!t.transceiverController||!t.transceiverController.getMidForStreamId||!t.transceiverController.setStreamIdForMid||!t.videosToReceive.forEach||!t.signalingClient.remoteVideoUpdate||!t.videoStreamIndex.overrideStreamIdMappings)return;let e=[],i=new Map,r=[];if(t.lastVideosToReceive===null)e=t.videosToReceive.array();else{let o=t.videoStreamIndex;t.videosToReceive.forEach(s=>{if(t.lastVideosToReceive.contain(s))return;let d=!1;t.lastVideosToReceive.forEach(l=>{d||o.StreamIdsInSameGroup(l,s)&&(i.set(l,s),d=!0)}),d||e.push(s)}),r=t.lastVideosToReceive.array().filter(s=>{let d=t.videosToReceive.contain(s),l=i.has(s);return!d&&!l})}return this.logger.info(`Request to update remote videos with added: [${e}], updated: [${Array.from(i.entries()).map(([o,s])=>`${o}->${s}`).join(",")}], removed: [${r}]`),{added:e,removed:r,simulcastStreamUpdates:i}}isNotAddingOrRemovingStreams(){let t=this.detectChangesInVideosToReceive();if(t===void 0)return!1;let e=t.added,i=t.removed;return e.length!==0||i.length!==0?!1:(this.meetingSessionContext.videoStreamIndex.remoteVideoUpdateSent(),!0)}sendRemoteVideoUpdate(){let t=this.meetingSessionContext;if(t.videosToReceive===null)return!1;let e=t.videosToReceive.array().map(d=>t.videoStreamIndex.groupIdForStreamId(d));this.receiveRemotePauseResumeTask.updateSubscribedGroupdIds(new Set(e));let i=n1.convertVideoPreferencesToSignalingClientVideoSubscriptionConfiguration(t,e,t.videoDownlinkBandwidthPolicy.getVideoPreferences()),r=new Map,o=[];for(let d of i){let l=!1;if(!t.lastVideoSubscriptionConfiguration.has(d.groupId))l=!0;else{let c=t.lastVideoSubscriptionConfiguration.get(d.groupId);d.equals(c)||(this.logger.debug(`${JSON.stringify(d)} does not equal ${JSON.stringify(c)}, sending update`),l=!0)}r.set(d.groupId,d),l&&o.push(d)}t.lastVideoSubscriptionConfiguration=r;let s=[];if(t.lastVideosToReceive!==null){let d=new Set(e);for(let l of t.lastVideosToReceive.array()){let c=t.videoStreamIndex.groupIdForStreamId(l);if(!d.has(c)){let a=t.transceiverController.getMidForGroupId(c);if(a===void 0){t.logger.warn(`Could not find MID for group ID to remove: ${c}`);continue}s.push(a)}}}return(o.length!==0||s.length!==0)&&t.signalingClient.remoteVideoUpdate(o,s),!0}updateLocalVideoFromPolicy(){if(this.meetingSessionContext.enableSimulcast){let t=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseEncodingParameters();if(this.mayNeedRenegotiationForSimulcastLayerChange&&this.meetingSessionContext.transceiverController.hasVideoInput()&&!this.negotiatedBitrateLayersAllocationRtpHeaderExtension())return this.logger.info("Needs regenotiation for local video simulcast layer change"),this.mayNeedRenegotiationForSimulcastLayerChange=!1,!1;this.meetingSessionContext.transceiverController.setEncodingParameters(t)}else this.meetingSessionContext.videoCaptureAndEncodeParameter=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters();return this.logger.info("Updated local video from policy without renegotiation"),!0}negotiatedBitrateLayersAllocationRtpHeaderExtension(){if(!this.meetingSessionContext.transceiverController.localVideoTransceiver())return!1;let t=this.meetingSessionContext.transceiverController.localVideoTransceiver().sender.getParameters();return!t||!t.headerExtensions?!1:t.headerExtensions.some(e=>e.uri==="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00")}restartLocalVideo(t){let e=()=>be(this,void 0,void 0,function*(){this._videoTileController.hasStartedLocalVideoTile()&&(this.logger.info("stopping local video tile prior to local video restart"),this._videoTileController.stopLocalVideoTile(),this.logger.info("preparing local video restart update"),yield this.actionUpdateWithRenegotiation(!1),this.logger.info("starting local video tile for local video restart"),this._videoTileController.startLocalVideoTile()),this.logger.info("finalizing local video restart update"),yield this.actionUpdateWithRenegotiation(!0),t()}),i=this.sessionStateController.perform(Oe.default.Update,()=>{e()});return i===hc.default.Transitioned||i===hc.default.DeferredTransition}replaceLocalVideo(t){return be(this,void 0,void 0,function*(){if(!t||t.getVideoTracks().length<1)throw new Error("could not acquire video track");if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");let e=this.meetingSessionContext.videoTileController.getLocalVideoTile();if(e){let i=e.state(),r=t.getVideoTracks()[0].getSettings();e.bindVideoStream(i.boundAttendeeId,!0,t,r.width,r.height,i.streamId,i.boundExternalUserId)}yield this.meetingSessionContext.transceiverController.setVideoInput(t.getVideoTracks()[0]),this.meetingSessionContext.activeVideoInput=t,this.logger.info("Local video input is updated")})}replaceLocalAudio(t){return be(this,void 0,void 0,function*(){if(!t||t.getAudioTracks().length<1)throw new Error("could not acquire audio track");if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");if(this.connectionHealthData.reset(),this.connectionHealthData.setConnectionStartTime(),!(yield this.meetingSessionContext.transceiverController.replaceAudioTrack(t.getAudioTracks()[0])))throw new Error("Failed to replace audio track");this.meetingSessionContext.activeAudioInput=t,this.logger.info("Local audio input is updated")})}actionUpdateWithRenegotiation(t){return be(this,void 0,void 0,function*(){this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();try{yield new We.default(this.logger,this.wrapTaskName("AudioVideoUpdate"),[new zT.default(this.meetingSessionContext),new Nt.default(this.logger,new We.default(this.logger,"UpdateSession",[new zg.default(this.meetingSessionContext),new $g.default(this.meetingSessionContext),new Gg.default(this.meetingSessionContext),new Kg.default(this.meetingSessionContext),new Jg.default(this.meetingSessionContext),new pc.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs)]).run(),t&&this.sessionStateController.perform(Oe.default.FinishUpdating,()=>{this.actionFinishUpdating()})}catch(e){this.sessionStateController.perform(Oe.default.FinishUpdating,()=>{let i=new Vn.default(this.getMeetingStatusCode(e)||ve.default.TaskFailed);i.statusCode()!==ve.default.IncompatibleSDP&&this.logger.info("failed to update audio-video session"),this.handleMeetingSessionStatus(i,e)})}})}notifyStop(t,e){var i;if(this.forEachObserver(r=>{Lt.Maybe.of(r.audioVideoDidStop).map(o=>o.bind(r)(t))}),this.eventController){let{signalingOpenDurationMs:r,poorConnectionCount:o,startTimeMs:s,iceGatheringDurationMs:d,attendeePresenceDurationMs:l,meetingStartDurationMs:c}=this.meetingSessionContext,a={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:s===null?0:Math.round(Date.now()-s),meetingStatus:ve.default[t.statusCode()],signalingOpenDurationMs:r,iceGatheringDurationMs:d,attendeePresenceDurationMs:l,poorConnectionCount:o,meetingStartDurationMs:c,retryCount:this.totalRetryCount},u=e&&e.message||((i=t.toString)===null||i===void 0?void 0:i.call(t))||"";a.meetingDurationMs===0?(a.meetingErrorMessage=u,delete a.meetingDurationMs,delete a.attendeePresenceDurationMs,delete a.meetingStartDurationMs,this.eventController.publishEvent("meetingStartFailed",a)):t.isFailure()||t.isAudioConnectionFailure()?(a.meetingErrorMessage=u,this.eventController.publishEvent("meetingFailed",a)):this.eventController.publishEvent("meetingEnded",a)}}actionFinishUpdating(){if(!this.meetingSessionContext.enableSimulcast)if(this.useUpdateTransceiverControllerForUplink)this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController();else{let t=this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0];this.enforceBandwidthLimitationForSender(t)}this.monitorTask.resumeResubscribeCheck(),this.receiveIndexTask.resumeIngestion(),this.logger.info("updated audio-video session")}reconnect(t,e){this.promotedToPrimaryMeeting&&(this.promotedToPrimaryMeeting=!1,this.forEachObserver(r=>{Lt.Maybe.of(r.audioVideoWasDemotedFromPrimaryMeeting).map(o=>o.bind(r)(new Vn.default(ve.default.AudioVideoDisconnectedWhilePromoted)))}));let i=this._reconnectController.retryWithBackoff(()=>be(this,void 0,void 0,function*(){this.sessionStateController.state()===fc.default.NotConnected?this.sessionStateController.perform(Oe.default.Connect,()=>{this.actionConnect(!0)}):this.sessionStateController.perform(Oe.default.Reconnect,()=>{this.actionReconnect(t)}),this.totalRetryCount+=1}),()=>{this.logger.info("canceled retry")});return i||this.sessionStateController.perform(Oe.default.Fail,()=>{this.actionDisconnect(t,!1,e)}),i}actionReconnect(t){return be(this,void 0,void 0,function*(){this._reconnectController.hasStartedConnectionAttempt()||(this._reconnectController.startedConnectionAttempt(!1),this.forEachObserver(e=>{Lt.Maybe.of(e.audioVideoDidStartConnecting).map(i=>i.bind(e)(!0))})),this.meetingSessionContext.volumeIndicatorAdapter.onReconnect(),this.connectionHealthData.reset(),this.receiveRemotePauseResumeTask=new WT.default(this.meetingSessionContext);try{yield new We.default(this.logger,this.wrapTaskName("AudioVideoReconnect"),[new Nt.default(this.logger,new We.default(this.logger,"Media",[new FD.default(this.meetingSessionContext),new We.default(this.logger,"Signaling",[new jT.default(this.meetingSessionContext),new HT.default(this.meetingSessionContext)]),new qT.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs),new zT.default(this.meetingSessionContext),new Nt.default(this.logger,new We.default(this.logger,"UpdateSession",[new zg.default(this.meetingSessionContext),new $g.default(this.meetingSessionContext),new Gg.default(this.meetingSessionContext),new Kg.default(this.meetingSessionContext),new Jg.default(this.meetingSessionContext),new pc.default(this.meetingSessionContext),this.receiveRemotePauseResumeTask]),this.configuration.connectionTimeoutMs)]).run(),this.sessionStateController.perform(Oe.default.FinishConnecting,()=>{if(this.eventController){let{signalingOpenDurationMs:e,poorConnectionCount:i,startTimeMs:r,iceGatheringDurationMs:o,attendeePresenceDurationMs:s,meetingStartDurationMs:d}=this.meetingSessionContext,l={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:Math.round(Date.now()-r),meetingStatus:ve.default[t.statusCode()],signalingOpenDurationMs:e,iceGatheringDurationMs:o,attendeePresenceDurationMs:s,poorConnectionCount:i,meetingStartDurationMs:d,retryCount:this.totalRetryCount};this.eventController.publishEvent("meetingReconnected",l)}this.actionFinishConnecting()})}catch(e){this.sessionStateController.perform(Oe.default.FinishConnecting,()=>{this.logger.info("failed to reconnect audio-video session");let i=new Vn.default(this.getMeetingStatusCode(e)||ve.default.TaskFailed);this.handleMeetingSessionStatus(i,e)})}this.connectionHealthData.setConnectionStartTime()})}wrapTaskName(t){return`${t}/${this.configuration.meetingId}/${this.configuration.credentials.attendeeId}`}cleanUpMediaStreamsAfterStop(){this._mediaStreamBroker.removeMediaStreamBrokerObserver(this),this.meetingSessionContext.activeAudioInput=void 0,this.meetingSessionContext.activeVideoInput=void 0}getMeetingStatusCode(t){let e=/the meeting status code: (\d+)/.exec(t&&t.message);return e&&e.length>1?Number.parseInt(e[1],10):null}enforceBandwidthLimitationForSender(t){return be(this,void 0,void 0,function*(){yield this.meetingSessionContext.transceiverController.setVideoSendingBitrateKbps(t)})}handleMeetingSessionStatus(t,e){if(this.logger.info(`handling status: ${ve.default[t.statusCode()]}`),t.isTerminal()||this.meetingSessionContext.statsCollector&&this.meetingSessionContext.statsCollector.logMeetingSessionStatus(t),t.statusCode()===ve.default.IncompatibleSDP)return this.restartLocalVideo(()=>{this.logger.info("handled incompatible SDP by attempting to restart video")}),!0;if(t.statusCode()===ve.default.VideoCallSwitchToViewOnly)return this._videoTileController.removeLocalVideoTile(),this.forEachObserver(i=>{Lt.Maybe.of(i.videoSendDidBecomeUnavailable).map(r=>r.bind(i)())}),!1;if(t.statusCode()===ve.default.AudioVideoWasRemovedFromPrimaryMeeting)return this.forEachObserver(i=>{Lt.Maybe.of(i.audioVideoWasDemotedFromPrimaryMeeting).map(r=>r.bind(i)(t))}),!1;if(t.isTerminal()&&(this.logger.error("session will not be reconnected"),this.meetingSessionContext.reconnectController&&this.meetingSessionContext.reconnectController.disableReconnect()),(t.isFailure()||t.isTerminal())&&this.meetingSessionContext.reconnectController){let i=this.reconnect(t,e);return i?this.logger.warn(`The audio video controller will reconnect due to status code ${ve.default[t.statusCode()]}${e?` and error: ${e.message}`:""}`):this.logger.error(`The audio video controller failed with status code ${ve.default[t.statusCode()]}${e?` and error: ${e.message}`:""}`),i}return!1}setVideoMaxBandwidthKbps(t){if(t<=0)throw new Error("Max bandwidth kbps has to be greater than 0");this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&(this.logger.info(`video send has ideal max bandwidth ${t} kbps`),this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(t)),this.maxUplinkBandwidthKbps=t}handleHasBandwidthPriority(t){return be(this,void 0,void 0,function*(){if(this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&!this.meetingSessionContext.enableSimulcast){if(this.useUpdateTransceiverControllerForUplink){this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(t),yield this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController();return}let e=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(t);let i=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();e!==i&&(this.logger.info(`video send bandwidth priority ${t} max has changed from ${e} kbps to ${i} kbps`),yield this.enforceBandwidthLimitationForSender(i))}})}pauseReceivingStream(t){this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.pause([t])}resumeReceivingStream(t){this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.resume([t])}setVideoCodecSendPreferences(t){this.videoSendCodecPreferences=t,this.meetingSessionContext.videoSendCodecPreferences=t,this.sessionStateController.state()!==fc.default.NotConnected&&this.update({needsRenegotiation:!0})}getRemoteVideoSources(){let{videoStreamIndex:t}=this.meetingSessionContext;if(!t)return this.logger.info("meeting has not started"),[];let e=this.configuration.credentials.attendeeId;return t.allVideoSendingSourcesExcludingSelf(e)}encodingSimulcastLayersDidChange(t){this.mayNeedRenegotiationForSimulcastLayerChange=!0,this.forEachObserver(e=>{Lt.Maybe.of(e.encodingSimulcastLayersDidChange).map(i=>i.bind(e)(t))})}promoteToPrimaryMeeting(t){return this.actionPromoteToPrimaryMeeting(t)}actionPromoteToPrimaryMeeting(t){return be(this,void 0,void 0,function*(){let e=new Vn.default(ve.default.SignalingRequestFailed);return yield new We.default(this.logger,this.wrapTaskName("PromoteToPrimaryMeeting"),[new Nt.default(this.logger,new zD.default(this.meetingSessionContext,t,i=>{e=i}),this.configuration.connectionTimeoutMs)]).run(),this.promotedToPrimaryMeeting=e.statusCode()===ve.default.OK,e})}demoteFromPrimaryMeeting(){this.meetingSessionContext.signalingClient.demoteFromPrimaryMeeting(),this.forEachObserver(t=>{Lt.Maybe.of(t.audioVideoWasDemotedFromPrimaryMeeting).map(e=>e.bind(t)(new Vn.default(ve.default.OK)))})}videoInputDidChange(t){return be(this,void 0,void 0,function*(){if(this.logger.info("Receive a video input change event"),!this.meetingSessionContext||!this.meetingSessionContext.peer){this.logger.info("Skip updating video input because there is no active meeting and peer connection");return}this._videoTileController.hasStartedLocalVideoTile()&&(t?yield this.replaceLocalVideo(t):this._videoTileController.stopLocalVideoTile())})}audioInputDidChange(t){return be(this,void 0,void 0,function*(){if(this.logger.info("Receive an audio input change event"),!this.meetingSessionContext||!this.meetingSessionContext.peer){this.logger.info("Skip updating audio input because there is no active meeting and peer connection");return}if(!t)try{t=yield this.mediaStreamBroker.acquireAudioInputStream()}catch{this.logger.error("Could not acquire audio track from mediaStreamBroker");return}yield this.replaceLocalAudio(t)})}};xe.default=Xr;Xr.MIN_VOLUME_DECIBELS=-42;Xr.MAX_VOLUME_DECIBELS=-14;Xr.PING_PONG_INTERVAL_MS=1e4});var Xg=g(da=>{"use strict";var Ln=da&&da.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(da,"__esModule",{value:!0});var u1=Sd(),Qg=class{constructor(t,e,i,r,o,s){this.audioVideoController=t,this.videoTileController=e,this.realtimeController=i,this.audioMixController=r,this.deviceController=o,this.contentShareController=s}addObserver(t){this.audioVideoController.addObserver(t),this.trace("addObserver")}removeObserver(t){this.audioVideoController.removeObserver(t),this.trace("removeObserver")}setAudioProfile(t){this.trace("setAudioProfile",t),this.audioVideoController.setAudioProfile(t)}start(t){this.audioVideoController.start(t),this.trace("start")}stop(){this.audioVideoController.stop(),this.trace("stop")}getRTCPeerConnectionStats(t){return this.trace("getRTCPeerConnectionStats",t?t.id:null),this.audioVideoController.getRTCPeerConnectionStats(t)}bindAudioElement(t){let e=this.audioMixController.bindAudioElement(t);return this.trace("bindAudioElement",t.id,e),e}unbindAudioElement(){this.audioMixController.unbindAudioElement(),this.trace("unbindAudioElement")}getCurrentMeetingAudioStream(){return this.trace("getCurrentConferenceStream"),this.audioMixController.getCurrentMeetingAudioStream()}addAudioMixObserver(t){this.trace("addAudioMixObserver"),this.audioMixController.addAudioMixObserver(t)}removeAudioMixObserver(t){this.trace("removeAudioMixObserver"),this.audioMixController.removeAudioMixObserver(t)}bindVideoElement(t,e){this.videoTileController.bindVideoElement(t,e),this.trace("bindVideoElement",{tileId:t,videoElementId:e.id})}unbindVideoElement(t,e=!0){this.videoTileController.unbindVideoElement(t,e),this.trace("unbindVideoElement",{tileId:t,cleanUpVideoElement:e})}startLocalVideoTile(){let t=this.videoTileController.startLocalVideoTile();return this.trace("startLocalVideoTile",null,t),t}stopLocalVideoTile(){this.videoTileController.stopLocalVideoTile(),this.trace("stopLocalVideoTile")}hasStartedLocalVideoTile(){let t=this.videoTileController.hasStartedLocalVideoTile();return this.trace("hasStartedLocalVideoTile",null,t),t}removeLocalVideoTile(){this.videoTileController.removeLocalVideoTile(),this.trace("removeLocalVideoTile")}getLocalVideoTile(){let t=this.videoTileController.getLocalVideoTile();return this.trace("getLocalVideoTile"),t}pauseVideoTile(t){this.videoTileController.pauseVideoTile(t),this.trace("pauseVideoTile",t)}unpauseVideoTile(t){this.videoTileController.unpauseVideoTile(t),this.trace("unpauseVideoTile",t)}getVideoTile(t){let e=this.videoTileController.getVideoTile(t);return this.trace("getVideoTile",t),e}getAllRemoteVideoTiles(){let t=this.videoTileController.getAllRemoteVideoTiles();return this.trace("getAllRemoteVideoTiles"),t}getAllVideoTiles(){let t=this.videoTileController.getAllVideoTiles();return this.trace("getAllVideoTiles"),t}addVideoTile(){let t=this.videoTileController.addVideoTile();return this.trace("addVideoTile",null,t.state()),t}removeVideoTile(t){this.videoTileController.removeVideoTile(t),this.trace("removeVideoTile",t)}removeVideoTilesByAttendeeId(t){let e=this.videoTileController.removeVideoTilesByAttendeeId(t);return this.trace("removeVideoTilesByAttendeeId",t,e),e}removeAllVideoTiles(){this.videoTileController.removeAllVideoTiles(),this.trace("removeAllVideoTiles")}captureVideoTile(t){let e=this.videoTileController.captureVideoTile(t);return this.trace("captureVideoTile",t),e}realtimeSubscribeToAttendeeIdPresence(t){this.realtimeController.realtimeSubscribeToAttendeeIdPresence(t),this.trace("realtimeSubscribeToAttendeeIdPresence")}realtimeUnsubscribeToAttendeeIdPresence(t){this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(t),this.trace("realtimeUnsubscribeToAttendeeIdPresence")}realtimeSetCanUnmuteLocalAudio(t){this.realtimeController.realtimeSetCanUnmuteLocalAudio(t),this.trace("realtimeSetCanUnmuteLocalAudio",t)}realtimeSubscribeToSetCanUnmuteLocalAudio(t){this.realtimeController.realtimeSubscribeToSetCanUnmuteLocalAudio(t),this.trace("realtimeSubscribeToSetCanUnmuteLocalAudio")}realtimeUnsubscribeToSetCanUnmuteLocalAudio(t){this.realtimeController.realtimeUnsubscribeToSetCanUnmuteLocalAudio(t),this.trace("realtimeUnsubscribeToSetCanUnmuteLocalAudio")}realtimeCanUnmuteLocalAudio(){let t=this.realtimeController.realtimeCanUnmuteLocalAudio();return this.trace("realtimeCanUnmuteLocalAudio",null,t),t}realtimeMuteLocalAudio(){this.realtimeController.realtimeMuteLocalAudio(),this.trace("realtimeMuteLocalAudio")}realtimeUnmuteLocalAudio(){let t=this.realtimeController.realtimeUnmuteLocalAudio();return this.trace("realtimeUnmuteLocalAudio"),t}realtimeSubscribeToMuteAndUnmuteLocalAudio(t){this.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(t),this.trace("realtimeSubscribeToMuteAndUnmuteLocalAudio")}realtimeUnsubscribeToMuteAndUnmuteLocalAudio(t){this.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(t),this.trace("realtimeUnsubscribeToMuteAndUnmuteLocalAudio")}realtimeIsLocalAudioMuted(){let t=this.realtimeController.realtimeIsLocalAudioMuted();return this.trace("realtimeIsLocalAudioMuted"),t}realtimeSubscribeToVolumeIndicator(t,e){this.realtimeController.realtimeSubscribeToVolumeIndicator(t,e),this.trace("realtimeSubscribeToVolumeIndicator",t)}realtimeUnsubscribeFromVolumeIndicator(t,e){this.realtimeController.realtimeUnsubscribeFromVolumeIndicator(t,e),this.trace("realtimeUnsubscribeFromVolumeIndicator",t,e)}realtimeSubscribeToLocalSignalStrengthChange(t){this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(t),this.trace("realtimeSubscribeToLocalSignalStrengthChange")}realtimeUnsubscribeToLocalSignalStrengthChange(t){this.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange(t),this.trace("realtimeUnsubscribeToLocalSignalStrengthChange")}realtimeSendDataMessage(t,e,i){this.realtimeController.realtimeSendDataMessage(t,e,i),this.trace("realtimeSendDataMessage")}realtimeSubscribeToReceiveDataMessage(t,e){this.realtimeController.realtimeSubscribeToReceiveDataMessage(t,e),this.trace("realtimeSubscribeToReceiveDataMessage")}realtimeUnsubscribeFromReceiveDataMessage(t){this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage(t),this.trace("realtimeUnsubscribeFromReceiveDataMessage")}realtimeSubscribeToFatalError(t){this.realtimeController.realtimeSubscribeToFatalError(t),this.trace("realtimeSubscribeToFatalError")}realtimeUnsubscribeToFatalError(t){this.realtimeController.realtimeUnsubscribeToFatalError(t),this.trace("realtimeUnsubscribeToFatalError")}subscribeToActiveSpeakerDetector(t,e,i,r){this.audioVideoController.activeSpeakerDetector.subscribe(t,e,i,r),this.trace("subscribeToActiveSpeakerDetector")}unsubscribeFromActiveSpeakerDetector(t){this.audioVideoController.activeSpeakerDetector.unsubscribe(t),this.trace("unsubscribeFromActiveSpeakerDetector")}listAudioInputDevices(t=!1){return Ln(this,void 0,void 0,function*(){let e=yield this.deviceController.listAudioInputDevices(t);return this.trace("listAudioInputDevices",t,e),e})}listVideoInputDevices(t=!1){return Ln(this,void 0,void 0,function*(){let e=yield this.deviceController.listVideoInputDevices(t);return this.trace("listVideoInputDevices",t,e),e})}listAudioOutputDevices(t=!1){return Ln(this,void 0,void 0,function*(){let e=yield this.deviceController.listAudioOutputDevices(t);return this.trace("listAudioOutputDevices",t,e),e})}startAudioInput(t){return Ln(this,void 0,void 0,function*(){return this.trace("startAudioInput",t),this.deviceController.startAudioInput(t)})}stopAudioInput(){return Ln(this,void 0,void 0,function*(){return this.trace("stopAudioInput"),this.deviceController.stopAudioInput()})}startVideoInput(t){return Ln(this,void 0,void 0,function*(){return u1.isVideoTransformDevice(t)?this.trace("startVideoInput with transform device"):this.trace("startVideoInput",t),this.deviceController.startVideoInput(t)})}stopVideoInput(){return Ln(this,void 0,void 0,function*(){return this.trace("stopVideoInput"),this.deviceController.stopVideoInput()})}chooseAudioOutput(t){let e=this.deviceController.chooseAudioOutput(t);return this.trace("chooseAudioOutput",t),e}addDeviceChangeObserver(t){this.deviceController.addDeviceChangeObserver(t),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver(t){this.deviceController.removeDeviceChangeObserver(t),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){let t=this.deviceController.createAnalyserNodeForAudioInput();return this.trace("createAnalyserNodeForAudioInput"),t}startVideoPreviewForVideoInput(t){this.deviceController.startVideoPreviewForVideoInput(t),this.trace("startVideoPreviewForVideoInput",t.id)}stopVideoPreviewForVideoInput(t){this.deviceController.stopVideoPreviewForVideoInput(t),this.trace("stopVideoPreviewForVideoInput",t.id)}setDeviceLabelTrigger(t){this.deviceController.setDeviceLabelTrigger(t),this.trace("setDeviceLabelTrigger")}mixIntoAudioInput(t){let e=this.deviceController.mixIntoAudioInput(t);return this.trace("mixIntoAudioInput",t.id),e}chooseVideoInputQuality(t,e,i){this.deviceController.chooseVideoInputQuality(t,e,i),this.trace("chooseVideoInputQuality",{width:t,height:e,frameRate:i})}setVideoMaxBandwidthKbps(t){this.audioVideoController.setVideoMaxBandwidthKbps(t),this.trace("setVideoMaxBandwidthKbps",t)}setVideoCodecSendPreferences(t){this.audioVideoController.setVideoCodecSendPreferences(t),this.trace("setVideoCodecSendPreferences",t)}getVideoInputQualitySettings(){let t=this.deviceController.getVideoInputQualitySettings();return this.trace("getVideoInputQualitySettings"),t}setContentAudioProfile(t){this.trace("setContentAudioProfile",t),this.contentShareController.setContentAudioProfile(t)}enableSimulcastForContentShare(t,e){this.trace("enableSimulcastForContentShare"),this.contentShareController.enableSimulcastForContentShare(t,e)}enableSVCForContentShare(t){this.trace("enableSVCForContentShare"),this.contentShareController.enableSVCForContentShare(t)}startContentShare(t){let e=this.contentShareController.startContentShare(t);return this.trace("startContentShare"),e}startContentShareFromScreenCapture(t,e){let i=this.contentShareController.startContentShareFromScreenCapture(t,e);return this.trace("startContentShareFromScreenCapture"),i}pauseContentShare(){this.contentShareController.pauseContentShare(),this.trace("pauseContentShare")}unpauseContentShare(){this.contentShareController.unpauseContentShare(),this.trace("unpauseContentShare")}stopContentShare(){this.contentShareController.stopContentShare(),this.trace("stopContentShare")}addContentShareObserver(t){this.contentShareController.addContentShareObserver(t),this.trace("addContentShareObserver")}removeContentShareObserver(t){this.contentShareController.removeContentShareObserver(t),this.trace("removeContentShareObserver")}setContentShareVideoCodecPreferences(t){this.contentShareController.setContentShareVideoCodecPreferences(t),this.trace("setContentShareVideoCodecPreferences")}trace(t,e,i){let r=this.audioVideoController.configuration.meetingId,o=this.audioVideoController.configuration.credentials.attendeeId,s=`API/DefaultAudioVideoFacade/${r}/${o}/${t}`;typeof e<"u"&&(s+=` ${JSON.stringify(e)}`),typeof i<"u"&&(s+=` -> ${JSON.stringify(i)}`),this.audioVideoController.logger.info(s)}getRemoteVideoSources(){let t=this.audioVideoController.getRemoteVideoSources();return this.trace("getRemoteVideoSources",null,t),t}get transcriptionController(){return this.realtimeController.transcriptionController}promoteToPrimaryMeeting(t){this.audioVideoController.removeObserver(this),this.audioVideoController.addObserver(this);let e=this.audioVideoController.promoteToPrimaryMeeting(t);return this.trace("promoteToPrimaryMeeting",null,e),e}demoteFromPrimaryMeeting(){this.trace("demoteFromPrimaryMeeting"),this.audioVideoController.demoteFromPrimaryMeeting()}audioVideoWasDemotedFromPrimaryMeeting(t){this.contentShareController.stopContentShare(),this.audioVideoController.removeObserver(this)}};da.default=Qg});var Yg=g(ca=>{"use strict";var f1=ca&&ca.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ca,"__esModule",{value:!0});var GT=f1(Pt()),Zg=class n{constructor(t=GT.default.VideoResolutionHD,e=GT.default.VideoResolutionFHD){this.videoMaxResolution=t,this.contentMaxResolution=e}clone(){return new n(this.videoMaxResolution,this.contentMaxResolution)}};ca.default=Zg});var la=g(tv=>{"use strict";Object.defineProperty(tv,"__esModule",{value:!0});var ev=class{constructor(){this.attendeeId=null,this.externalUserId=null,this.joinToken=null}toJSON(){return{attendeeId:this.attendeeId,joinToken:this.joinToken===null?null:"<redacted>"}}};tv.default=ev});var gc=g(nv=>{"use strict";Object.defineProperty(nv,"__esModule",{value:!0});var iv=class{constructor(){this._audioHostURL=null,this._signalingURL=null,this._turnControlURL=null,this._eventIngestionURL=null,this.urlRewriter=t=>t}get audioHostURL(){return this.urlRewriter(this._audioHostURL)}set audioHostURL(t){this._audioHostURL=t}get signalingURL(){return this.urlRewriter(this._signalingURL)}set signalingURL(t){this._signalingURL=t}get turnControlURL(){return this.urlRewriter(this._turnControlURL)}set turnControlURL(t){this._turnControlURL=t}get eventIngestionURL(){return this.urlRewriter(this._eventIngestionURL)}set eventIngestionURL(t){this._eventIngestionURL=t}};nv.default=iv});var vc=g(ua=>{"use strict";var fa=ua&&ua.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ua,"__esModule",{value:!0});var h1=fa(sf()),Zr=fa(Pt()),JT=ri(),QT=fa(Yg()),p1=fa(la()),m1=fa(gc()),rv=class{constructor(t,e){var i,r;if(this.meetingId=null,this.externalMeetingId=null,this.credentials=null,this.urls=null,this.connectionTimeoutMs=15e3,this.attendeePresenceTimeoutMs=0,this.connectionHealthPolicyConfiguration=new h1.default,this.reconnectTimeoutMs=120*1e3,this.reconnectFixedWaitMs=0,this.reconnectShortBackOffMs=1*1e3,this.reconnectLongBackOffMs=5*1e3,this.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.enableSVC=!1,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.keepLastFrameWhenPaused=!1,this.disablePeriodicKeyframeRequestOnContentSender=!1,this.meetingFeatures=new QT.default,t){t=JT.toLowerCasePropertyNames(t),t.meeting&&(t=t.meeting),this.meetingId=t.meetingid,this.externalMeetingId=t.externalmeetingid,this.urls=new m1.default,this.urls.audioHostURL=t.mediaplacement.audiohosturl,this.urls.signalingURL=t.mediaplacement.signalingurl,this.urls.turnControlURL=t.mediaplacement.turncontrolurl,t.mediaplacement.eventingestionurl&&(this.urls.eventIngestionURL=t.mediaplacement.eventingestionurl);let o=(s,d)=>{switch(s){case"None":return Zr.default.VideoDisabled;case"HD":return Zr.default.VideoResolutionHD;case"FHD":return Zr.default.VideoResolutionFHD;case"UHD":return Zr.default.VideoResolutionUHD;default:return d}};if(((i=t.meetingfeatures)===null||i===void 0?void 0:i.video)!==void 0||((r=t.meetingfeatures)===null||r===void 0?void 0:r.content)!==void 0){let s=t.meetingfeatures.video===void 0?"HD":t.meetingfeatures.video.maxresolution,d=t.meetingfeatures.content===void 0?"FHD":t.meetingfeatures.content.maxresolution;this.meetingFeatures=new QT.default(o(s,Zr.default.VideoResolutionHD),o(d,Zr.default.VideoResolutionFHD))}}e&&(e=JT.toLowerCasePropertyNames(e),e.attendee&&(e=e.attendee),this.credentials=new p1.default,this.credentials.attendeeId=e.attendeeid,this.credentials.externalUserId=e.externaluserid,this.credentials.joinToken=e.jointoken)}};ua.default=rv});var sv=g(ha=>{"use strict";var g1=ha&&ha.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ha,"__esModule",{value:!0});var v1=g1(_i()),ov=class{reset(){}updateIndex(t){}updateMetrics(t){}wantsResubscribe(){return!1}chooseSubscriptions(){return new v1.default}};ha.default=ov});var dv=g(pa=>{"use strict";var S1=pa&&pa.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(pa,"__esModule",{value:!0});var y1=S1(ic()),av=class{constructor(t,e){this.encodingParams=e,this.enableUhdContent=!1,this.defaultHiTargetBitrateKbps=1200,this.defaultLowTargetBitrateKbps=300}updateConnectionMetric(t){}chooseMediaTrackConstraints(){}chooseEncodingParameters(){var t,e,i,r,o,s,d,l,c,a,u,p;let m=new Map,S=1e3,C=y1.default.NAME_ARR_ASCENDING;return m.set(C[0],{rid:C[0],active:!0,scaleResolutionDownBy:((e=(t=this.encodingParams)===null||t===void 0?void 0:t.low)===null||e===void 0?void 0:e.scaleResolutionDownBy)||2,maxBitrate:(((r=(i=this.encodingParams)===null||i===void 0?void 0:i.low)===null||r===void 0?void 0:r.maxBitrateKbps)||this.defaultLowTargetBitrateKbps)*S,maxFramerate:((s=(o=this.encodingParams)===null||o===void 0?void 0:o.low)===null||s===void 0?void 0:s.maxFramerate)||5}),m.set(C[1],{rid:C[1],active:!0,scaleResolutionDownBy:((l=(d=this.encodingParams)===null||d===void 0?void 0:d.high)===null||l===void 0?void 0:l.scaleResolutionDownBy)||1,maxBitrate:(((a=(c=this.encodingParams)===null||c===void 0?void 0:c.high)===null||a===void 0?void 0:a.maxBitrateKbps)||this.defaultHiTargetBitrateKbps)*S,maxFramerate:(p=(u=this.encodingParams)===null||u===void 0?void 0:u.high)===null||p===void 0?void 0:p.maxFramerate}),m}updateIndex(t){}wantsResubscribe(){return!1}chooseCaptureAndEncodeParameters(){}maxBandwidthKbps(){return this.enableUhdContent?2e3:1200}setIdealMaxBandwidthKbps(t){}setHasBandwidthPriority(t){}setHighResolutionFeatureEnabled(t){this.enableUhdContent=t,this.defaultHiTargetBitrateKbps=t?2e3:1200,this.defaultLowTargetBitrateKbps=t?500:300}addObserver(t){}removeObserver(t){}forEachObserver(t){}};pa.default=av});var fv=g(Bn=>{"use strict";var cv=Bn&&Bn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},vi=Bn&&Bn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Bn,"__esModule",{value:!0});var b1=vi(Pt()),_1=vi(vc()),w1=vi(la()),lv=vi(Xt()),T1=vi(Ve()),Sc=Le(),k1=vi(sv()),I1=vi(dv()),XT=vi(vr()),uv=class{constructor(t,e,i){this.mediaStreamBroker=t,this.contentAudioVideo=e,this.attendeeAudioVideo=i,this.observerQueue=new Set,this.destroyed=!1,this.contentAudioVideo.addObserver(this),this.setupContentShareEvents()}static createContentShareMeetingSessionConfigure(t){let e=new _1.default;return e.meetingId=t.meetingId,e.externalMeetingId=t.externalMeetingId,e.urls=t.urls,e.disablePeriodicKeyframeRequestOnContentSender=t.disablePeriodicKeyframeRequestOnContentSender,e.credentials=new w1.default,e.credentials.attendeeId=t.credentials.attendeeId+XT.default.Modality,e.credentials.externalUserId=t.credentials.externalUserId,e.credentials.joinToken=t.credentials.joinToken+XT.default.Modality,e.meetingFeatures=t.meetingFeatures.clone(),e.videoDownlinkBandwidthPolicy=new k1.default,e}setContentAudioProfile(t){this.contentAudioVideo.setAudioProfile(t)}enableSimulcastForContentShare(t,e){t?(this.contentAudioVideo.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!0,this.contentAudioVideo.configuration.videoUplinkBandwidthPolicy=new I1.default(this.contentAudioVideo.logger,e)):(this.contentAudioVideo.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.contentAudioVideo.configuration.videoUplinkBandwidthPolicy=void 0)}enableSVCForContentShare(t){t?this.contentAudioVideo.configuration.enableSVC=!0:this.contentAudioVideo.configuration.enableSVC=!1}startContentShare(t){return cv(this,void 0,void 0,function*(){if(t){if(this.contentAudioVideo.configuration.meetingFeatures.contentMaxResolution===b1.default.VideoDisabled){this.contentAudioVideo.logger.info("Could not start content because max content resolution was set to None");return}this.mediaStreamBroker.mediaStream=t;for(let e=0;e<this.mediaStreamBroker.mediaStream.getTracks().length;e++)this.mediaStreamBroker.mediaStream.getTracks()[e].addEventListener("ended",()=>{this.stopContentShare()});this.contentAudioVideo.start()}})}startContentShareFromScreenCapture(t,e){return cv(this,void 0,void 0,function*(){let i=yield this.mediaStreamBroker.acquireScreenCaptureDisplayInputStream(t,e);return yield this.startContentShare(i),i})}pauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!1)&&this.forEachContentShareObserver(t=>{Sc.Maybe.of(t.contentShareDidPause).map(e=>e.call(t))})}unpauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!0)&&this.forEachContentShareObserver(t=>{Sc.Maybe.of(t.contentShareDidUnpause).map(e=>e.call(t))})}setContentShareVideoCodecPreferences(t){this.contentAudioVideo.setVideoCodecSendPreferences(t)}destroy(){return cv(this,void 0,void 0,function*(){this.contentAudioVideo&&(this.destroyed=!0,this.contentAudioVideo.removeObserver(this),this.stopContentShare(),this.observerQueue.clear(),this.contentAudioVideo=void 0,this.attendeeAudioVideo=void 0,this.mediaStreamBroker=void 0)})}stopContentShare(){this.contentAudioVideo.stop(),this.mediaStreamBroker.cleanup()}addContentShareObserver(t){this.observerQueue.add(t)}removeContentShareObserver(t){this.observerQueue.delete(t)}forEachContentShareObserver(t){for(let e of this.observerQueue)T1.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}audioVideoDidStart(){var t;((t=this.mediaStreamBroker.mediaStream)===null||t===void 0?void 0:t.getVideoTracks().length)>0&&this.contentAudioVideo.videoTileController.startLocalVideoTile()}audioVideoDidStop(t){this.mediaStreamBroker.cleanup(),this.contentShareTile&&(this.attendeeAudioVideo.videoTileController.removeVideoTile(this.contentShareTile.id()),this.contentShareTile=null),this.forEachContentShareObserver(e=>{Sc.Maybe.of(e.contentShareDidStop).map(i=>i.call(e))})}setupContentShareEvents(){this.attendeeAudioVideo.realtimeController.realtimeSubscribeToAttendeeIdPresence((t,e,i,r)=>{let o=new lv.default(t).hasModality(lv.default.MODALITY_CONTENT),s=new lv.default(t).base()===this.attendeeAudioVideo.configuration.credentials.attendeeId;if(!o||!s||!e||this.contentShareTile)return;let d=this.mediaStreamBroker.mediaStream;if(d?.getVideoTracks().length){this.contentShareTile=this.attendeeAudioVideo.videoTileController.addVideoTile();let l=d.getVideoTracks()[0],c,a;if(l.getSettings){let u=l.getSettings();c=u.width,a=u.height}else{let u=l.getCapabilities();c=u.width,a=u.height}this.contentShareTile.bindVideoStream(this.contentAudioVideo.configuration.credentials.attendeeId,!1,d,c,a,null,this.contentAudioVideo.configuration.credentials.externalUserId)}this.forEachContentShareObserver(l=>{Sc.Maybe.of(l.contentShareDidStart).map(c=>c.call(l))})})}};Bn.default=uv});var ma=g(yc=>{"use strict";Object.defineProperty(yc,"__esModule",{value:!0});yc.isDestroyable=void 0;function C1(n){return n&&"destroy"in n}yc.isDestroyable=C1});var mv=g(pv=>{"use strict";Object.defineProperty(pv,"__esModule",{value:!0});var hv=class{constructor(t=5e3,e=2,i=64,r=100,o=15){this.flushIntervalMs=t,this.flushSize=e,this.maxBufferCapacityKb=i,this.totalBufferItems=r,this.retryCountLimit=o}};pv.default=hv});var vv=g(ga=>{"use strict";var O1=ga&&ga.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ga,"__esModule",{value:!0});var E1=O1(mv()),gv=class{constructor(t,e,i=new E1.default){this.eventsClientConfiguration=t,this.ingestionURL=e,this.eventBufferConfiguration=i}};ga.default=gv});var Si=g(yv=>{"use strict";Object.defineProperty(yv,"__esModule",{value:!0});var Sv=class{constructor(t,e,i){this.fixedWaitMs=t,this.shortBackoffMs=e,this.longBackoffMs=i,this.currentRetry=0,this.fixedWaitMs<0&&(this.fixedWaitMs=0),this.shortBackoffMs<0&&(this.shortBackoffMs=0),this.longBackoffMs<0&&(this.longBackoffMs=0),this.reset()}reset(){this.currentRetry=0}nextBackoffAmountMs(){let t=Math.random()*Math.min(this.longBackoffMs,this.shortBackoffMs*Math.pow(2,this.currentRetry))+this.fixedWaitMs;return this.currentRetry+=1,t}};yv.default=Sv});var bv=g(va=>{"use strict";var A1=va&&va.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(va,"__esModule",{value:!0});var P1=Xa(),ZT=A1(Je()),bc=class n{constructor(t){var e,i,r,o,s,d,l;try{this.parserResult=navigator&&navigator.userAgent?new P1.UAParser(navigator.userAgent).getResult():void 0}catch(c){t.error(c.message)}this.browserMajorVersion=((r=(i=(e=this.parserResult)===null||e===void 0?void 0:e.browser)===null||i===void 0?void 0:i.version)===null||r===void 0?void 0:r.split(".")[0])||n.UNAVAILABLE,this.browserName=((o=this.parserResult)===null||o===void 0?void 0:o.browser.name)||n.UNAVAILABLE,this.browserVersion=((s=this.parserResult)===null||s===void 0?void 0:s.browser.version)||n.UNAVAILABLE,this.deviceName=[((d=this.parserResult)===null||d===void 0?void 0:d.device.vendor)||"",((l=this.parserResult)===null||l===void 0?void 0:l.device.model)||""].join(" ").trim()||n.UNAVAILABLE}getParserResult(){var t,e;return{browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,osName:((t=this.parserResult)===null||t===void 0?void 0:t.os.name)||n.UNAVAILABLE,osVersion:((e=this.parserResult)===null||e===void 0?void 0:e.os.version)||n.UNAVAILABLE,sdkVersion:ZT.default.sdkVersion,sdkName:ZT.default.sdkName}}};va.default=bc;bc.UNAVAILABLE="Unavailable"});var wv=g(Ft=>{"use strict";var Yr=Ft&&Ft.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},YT=Ft&&Ft.__rest||function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e},_v=Ft&&Ft.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ft,"__esModule",{value:!0});var M1=_v(Si()),R1=_v(Jt()),D1=_v(bv()),x1=ri(),Bt=class n{constructor(t,e,i,r,o){this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.retryCountLimit=15,this.lock=!1,this.cancellableEvents=new Map,this.attributesToFilter=["externalUserId","externalMeetingId","timestampMs"],this.deepCopyCurrentIngestionEvent=k=>({type:k.type,v:k.v,payloads:[...k.payloads]}),this.sendEvents=()=>Yr(this,void 0,void 0,function*(){if(this.lock)return;let k=this.getItems(this.flushSize);if(k.length===0)return;this.lock=!0;let T=this.makeRequestBody(k),w=!1,D=Date.now();this.metadata.browserName.toLowerCase()==="firefox"&&this.cancellableEvents.set(D,k);try{this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - sending body ${T}`);let L=yield this.send(T);if(this.cancellableEvents.delete(D),!L.ok)this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Failed to send events ${T} with response status ${L.status}`),w=!0;else try{let O=yield L.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - send successful events: ${T} message: ${JSON.stringify(O)}`)}catch(O){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents error reading OK response ${O} for events ${T}`)}}catch(L){w=!0,this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Error in sending events ${T} to the ingestion endpoint ${L}`)}finally{this.lock=!1}w&&(this.cancellableEvents.delete(D),this.failedIngestionEvents.push(...k))});let s=new D1.default(o).getParserResult(),{browserMajorVersion:d}=s,l=YT(s,["browserMajorVersion"]),c=e.toJSON(),{type:a,v:u}=c,p=YT(c,["type","v"]);this.authenticationToken=e.getAuthenticationToken(),this.metadata=Object.assign(Object.assign({},l),p),Object.keys(this.metadata).forEach(k=>this.attributesToFilter.push(k)),this.type=a,this.v=u,this.ingestionURL=i,this.logger=o,this.importantEvents=new Set(r);let{maxBufferCapacityKb:m,totalBufferItems:S,flushSize:C,flushIntervalMs:I,retryCountLimit:_}=t;this.maxBufferCapacityBytes=m*1024,this.totalBufferItems=S,this.maxBufferItemCapacityBytes=Math.round(this.maxBufferCapacityBytes/S),this.flushIntervalMs=I,this.flushSize=C,this.retryCountLimit=_,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.beaconEventListener=k=>this.beaconEventHandler(k),this.addEventListeners()}addEventListeners(){!this.beaconEventListener||!("window"in global)||!window.addEventListener||!("document"in global)||!document.addEventListener||(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - addEventListeners - adding pagehide and visibility change event listeners"),window.addEventListener("pagehide",this.beaconEventListener),document.addEventListener("visibilitychange",this.beaconEventListener))}beaconEventHandler(t){(t.type==="visibilitychange"&&document.visibilityState==="hidden"||t.type==="pagehide")&&(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - beaconEventHandler is triggered calling sendBeacon"),this.sendBeacon())}removeEventListeners(){!this.beaconEventListener||!("window"in global)||!window.removeEventListener||!("document"in global)||!document.removeEventListener||(window.removeEventListener("pagehide",this.beaconEventListener),document.removeEventListener("visibilitychange",this.beaconEventListener),this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - removeEventListeners - removing pagehide and visibility change event listeners"))}start(){var t;this.removeEventListeners(),this.addEventListeners(),(t=this.intervalScheduler)===null||t===void 0||t.stop(),this.intervalScheduler=new R1.default(this.flushIntervalMs),this.intervalScheduler.start(()=>this.sendEvents())}stop(){var t;(t=this.intervalScheduler)===null||t===void 0||t.stop(),this.intervalScheduler=void 0,this.sendBeacon(),this.removeEventListeners()}addItem(t){return Yr(this,void 0,void 0,function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - received event ${JSON.stringify(t)}`);let{name:e,ts:i,attributes:r}=t,o=r&&this.filterAttributes(r,this.attributesToFilter),s=Object.assign({name:e,ts:i},o);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - event after filtering attributes ${JSON.stringify(s)}`);let d=this.getSize(s);if(d>n.MAX_ITEM_SIZE_BYTES_ALLOWED)throw new Error(`Event Reporting - Item to be added has size ${d} bytes. Item cannot exceed max item size allowed of ${n.MAX_ITEM_SIZE_BYTES_ALLOWED} bytes.`);if(this.importantEvents.has(e)){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - sending important event ${JSON.stringify(s)}`),this.sendEventImmediately({name:e,ts:i,attributes:o});return}if(this.isFull())throw this.logger.warn("Event Reporting - Event buffer is full"),new Error("Buffer full");if(this.currentIngestionEvent.payloads.push(s),this.ingestionEventSize+=d,this.bufferItemThresholdReached(d)){let l=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);this.buffer.push(l),this.bufferSize+=this.ingestionEventSize,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - buffer item threshold reached updated buffer ${JSON.stringify(this.buffer)}`)}})}filterAttributes(t,e){let i=new Set(e);return Object.keys(t).filter(o=>i.has(o)).forEach(o=>delete t[o]),t}initializeAndGetCurrentIngestionEvent(){let t={type:this.type,v:this.v,payloads:[]};return this.ingestionEventSize=this.getSize(t),t}bufferItemThresholdReached(t){return t+this.ingestionEventSize>=this.maxBufferItemCapacityBytes||this.currentIngestionEvent.payloads.length===n.MAX_PAYLOAD_ITEMS}getSize(t){let e=0;if(typeof t=="object")for(let[i,r]of Object.entries(t))e+=this.getPrimitiveSize(i),e+=this.getSize(r);else e+=this.getPrimitiveSize(t);return e}getPrimitiveSize(t){let e=0;return typeof t=="string"?e+=t.length*2:typeof t=="number"&&(e+=8),e}isFull(){return this.bufferSize===this.maxBufferCapacityBytes||this.buffer.length===this.totalBufferItems}isEmpty(){return this.buffer.length===0||this.bufferSize===0}getItems(t,e=0){return this.isEmpty()?[]:(t=Math.min(this.buffer.length,t+1),this.buffer.splice(e,t))}makeBeaconRequestBody(t){let e={metadata:this.metadata,events:t,authorization:this.authenticationToken};return JSON.stringify(e)}makeRequestBody(t){let e={metadata:this.metadata,events:t};return JSON.stringify(e)}sendEventImmediately(t){return Yr(this,void 0,void 0,function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - important event received ${JSON.stringify(t)}`);let{name:e,ts:i,attributes:r}=t,o={type:this.type,v:this.v,payloads:[Object.assign({name:e,ts:i},r)]},s=!1,d=null,l=this.makeRequestBody([o]);try{if(d=yield this.send(l),d.ok){try{let c=yield d.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - send successful event: ${l}, message: ${JSON.stringify(c)}`)}catch(c){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Error reading OK response ${c} for event ${l}`)}return}else this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Failed to send an important event ${l} with response status ${d.status}`),s=!0}catch(c){this.logger.warn(`Event Reporting - There may be a failure in sending an important event ${l} to the ingestion endpoint ${c}.`),s=!0;try{if(this.metadata.browserName.toLowerCase()==="firefox"){let a=this.makeBeaconRequestBody([o]);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - beaconing data out ${a}`),navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,a)?s=!1:s=!0}}catch{this.logger.warn(`Event Reporting - Error sending beacon for an important event ${l}`),s=!0}}s&&(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - pushing to failed events ${l}`),this.failedIngestionEvents.push(o))})}send(t){return Yr(this,void 0,void 0,function*(){let e=new M1.default(n.RETRY_FIXED_BACKOFF_WAIT_MS,n.RETRY_SHORT_BACKOFF_MS,n.RETRY_LONG_BACKOFF_MS);try{let i=0;for(;i<this.retryCountLimit;){let r=yield fetch(this.ingestionURL,{method:"POST",headers:{Authorization:`Bearer ${this.authenticationToken}`},body:t});if(r.ok||!n.SENDING_FAILURE_CODES.has(r.status))return r;if(this.logger.warn(`Will retry sending failure for ${t} due to status code ${r.status}.`),i++,i<this.retryCountLimit){let o=e.nextBackoffAmountMs();yield x1.wait(o)}}if(i===this.retryCountLimit)throw new Error(`Retry count limit reached for ${t}`)}catch(i){throw i}})}sendBeacon(){return Yr(this,void 0,void 0,function*(){let t=this.buffer;if(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out buffer events ${JSON.stringify(t)}`),this.buffer=[],this.currentIngestionEvent.payloads.length>0){let i=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);t.push(i),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out current ingestion event ${JSON.stringify(i)}`),this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent()}if(this.failedIngestionEvents.length>0){let i=this.failedIngestionEvents.map(r=>this.deepCopyCurrentIngestionEvent(r));t.push(...i),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out any failed ingestion event ${JSON.stringify(i)}`),this.failedIngestionEvents=[]}if(this.cancellableEvents.size>0&&(this.cancellableEvents.forEach(i=>{t.push(...i),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out each cancellable event ${JSON.stringify(i)}`)}),this.cancellableEvents.clear()),t.length===0)return;let e=this.makeBeaconRequestBody(t);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - beacon data to send ${e}`);try{navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,e)||this.logger.warn(`Event Reporting - Browser failed to queue beacon data ${e}`)}catch(i){this.logger.warn(`Event Reporting - Sending beacon data ${e} failed with error ${i}`)}})}reset(){this.maxBufferCapacityBytes=0,this.totalBufferItems=0,this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.lock=!1,this.beaconEventListener=void 0,this.cancellableEvents.clear()}destroy(){return Yr(this,void 0,void 0,function*(){this.stop(),this.reset()})}};Ft.default=Bt;Bt.SENDING_FAILURE_CODES=new Set([408,429,500,502,503,504]);Bt.RETRY_FIXED_BACKOFF_WAIT_MS=0;Bt.RETRY_SHORT_BACKOFF_MS=1e3;Bt.RETRY_LONG_BACKOFF_MS=15e3;Bt.MAX_PAYLOAD_ITEMS=2;Bt.MAX_ITEM_SIZE_BYTES_ALLOWED=3e3});var kv=g(Fn=>{"use strict";var ek=Fn&&Fn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},V1=Fn&&Fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Fn,"__esModule",{value:!0});var N1=ma(),L1=V1(wv()),Tv=class{constructor(t,e){this.reportingEvents=!1,this.importantEvents=["meetingEnded","meetingFailed","meetingStartFailed","audioInputFailed","videoInputFailed","meetingStartSucceeded","deviceLabelTriggerFailed"],this.destroyed=!1;let{eventsClientConfiguration:i,ingestionURL:r,eventBufferConfiguration:o}=t,{eventsToIgnore:s}=i;this.eventBuffer=new L1.default(o,i,r,this.importantEvents,e),this.logger=e,this.eventsToIgnore=s,this.start()}start(){if(!this.reportingEvents)try{this.eventBuffer.start(),this.logger.info("Event reporting started"),this.reportingEvents=!0}catch(t){this.logger.error(`Event Reporting - Error starting the event buffer ${t}`)}}stop(){if(this.reportingEvents)try{this.eventBuffer.stop(),this.logger.info("Event reporting stopped"),this.reportingEvents=!1}catch(t){this.logger.error(`Event Reporting - Error stopping the event buffer ${t}`)}}reportEvent(t,e,i){return ek(this,void 0,void 0,function*(){if(this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - event received in reportEvent ${t}, ${e}, ${JSON.stringify(i)}`),this.eventsToIgnore.includes(e)){this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - ${e} event will be ignored as it is in events to ignore`);return}try{this.logger.debug("Event Reporting - DefaultMeetingEventReporter - adding item to event buffer"),yield this.eventBuffer.addItem({ts:t,name:e,attributes:i})}catch(r){this.logger.error(`Event Reporting - Error adding event to buffer ${r}`)}})}destroy(){return ek(this,void 0,void 0,function*(){this.destroyed=!0,this.stop(),N1.isDestroyable(this.eventBuffer)&&this.eventBuffer.destroy(),this.eventBuffer=void 0})}};Fn.default=Tv});var Ov=g(Cv=>{"use strict";Object.defineProperty(Cv,"__esModule",{value:!0});var Iv=class{constructor(t,e,i,r=[]){this.type="Meet",this.v=1,this.meetingId=t,this.attendeeId=e,this.eventsToIgnore=r,this.authenticationToken=i}getAuthenticationToken(){return this.authenticationToken}toJSON(){let t={};return t.type=this.type,t.v=this.v,t.meetingId=this.meetingId,t.attendeeId=this.attendeeId,t}};Cv.default=Iv});var tk=g(Ev=>{"use strict";Object.defineProperty(Ev,"__esModule",{value:!0});var B1=n=>{let t={};for(let[e,i]of Object.entries(n))if(!(i==null||i===""))if(typeof i=="number"||typeof i=="string")t[e]=i;else throw new TypeError("Unhandled type received while flattening attributes.");return t};Ev.default=B1});var wc=g(Un=>{"use strict";var Av=Un&&Un.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},eo=Un&&Un.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Un,"__esModule",{value:!0});var F1=Xa(),U1=ma(),q1=eo(vv()),H1=eo(kv()),j1=eo(Ov()),W1=eo(Ve()),ik=eo(Je()),z1=eo(tk()),_c=class n{constructor(t,e,i){var r,o,s,d,l,c,a;this.meetingHistoryStates=[],this.observerSet=new Set,this.destroyed=!1,this.logger=e,this.configuration=t,this.setupEventReporter(t,e,i);try{this.parserResult=navigator&&navigator.userAgent?new F1.UAParser(navigator.userAgent).getResult():null}catch(u){this.logger.error(u.message)}this.browserMajorVersion=((s=(o=(r=this.parserResult)===null||r===void 0?void 0:r.browser)===null||o===void 0?void 0:o.version)===null||s===void 0?void 0:s.split(".")[0])||n.UNAVAILABLE,this.browserName=((d=this.parserResult)===null||d===void 0?void 0:d.browser.name)||n.UNAVAILABLE,this.browserVersion=((l=this.parserResult)===null||l===void 0?void 0:l.browser.version)||n.UNAVAILABLE,this.deviceName=[((c=this.parserResult)===null||c===void 0?void 0:c.device.vendor)||"",((a=this.parserResult)===null||a===void 0?void 0:a.device.model)||""].join(" ").trim()||n.UNAVAILABLE}addObserver(t){this.observerSet.add(t)}removeObserver(t){this.observerSet.delete(t)}forEachObserver(t){for(let e of this.observerSet)W1.default.nextTick(()=>{this.observerSet.has(e)&&t(e)})}publishEvent(t,e){return Av(this,void 0,void 0,function*(){let i=Date.now();this.meetingHistoryStates.push({name:t,timestampMs:i});let r=Object.freeze(Object.assign(this.getAttributes(i),e));this.forEachObserver(o=>{o.eventDidReceive(t,r)}),this.reportEvent(t,i,e)})}reportEvent(t,e,i){var r;return Av(this,void 0,void 0,function*(){let o;try{i&&(o=z1.default(i)),yield(r=this.eventReporter)===null||r===void 0?void 0:r.reportEvent(e,t,o)}catch(s){this.logger.error(`Error reporting event ${s}`)}})}setupEventReporter(t,e,i){if(i)this._eventReporter=i;else if(t.urls){let r=t.urls.eventIngestionURL;if(r){this.logger.info("Event ingestion URL is present in the configuration");let{meetingId:o,credentials:{attendeeId:s,joinToken:d}}=t,l=new j1.default(o,s,d),c=new q1.default(l,r);this._eventReporter=new H1.default(c,e)}}}getAttributes(t){var e,i;return{attendeeId:this.configuration.credentials.attendeeId,browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,externalMeetingId:typeof this.configuration.externalMeetingId=="string"?this.configuration.externalMeetingId:"",externalUserId:this.configuration.credentials.externalUserId,meetingHistory:this.meetingHistoryStates,meetingId:this.configuration.meetingId,osName:((e=this.parserResult)===null||e===void 0?void 0:e.os.name)||n.UNAVAILABLE,osVersion:((i=this.parserResult)===null||i===void 0?void 0:i.os.version)||n.UNAVAILABLE,sdkVersion:ik.default.sdkVersion,sdkName:ik.default.sdkName,timestampMs:t}}get eventReporter(){return this._eventReporter}destroy(){return Av(this,void 0,void 0,function*(){U1.isDestroyable(this.eventReporter)&&(yield this.eventReporter.destroy()),this.logger=void 0,this.configuration=void 0,this._eventReporter=void 0,this.destroyed=!0})}};Un.default=_c;_c.UNAVAILABLE="Unavailable"});var Rv=g(Mv=>{"use strict";Object.defineProperty(Mv,"__esModule",{value:!0});var Pv=class{constructor(){this.timeoutMs=1e4,this.waitDurationMs=3e3,this.audioOutputFrequency=440,this.audioOutputGain=.1}};Mv.default=Pv});var nk=g(qn=>{"use strict";var se=qn&&qn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},_e=qn&&qn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(qn,"__esModule",{value:!0});var $1=_e(kd()),K1=_e(pe()),Dv=_e(bd()),Tc=_e(gd()),G1=_e(Z()),J1=_e(tc()),Sa=_e(pu()),xv=_e(mu()),Vv=_e(gu()),kc=_e(vu()),ya=_e(Su()),Ic=_e(yu()),Cc=_e(bu()),ba=_e(_u()),Nv=_e(wu()),Q1=_e(Rv()),Lv=class n{constructor(t,e,i=new Q1.default){this.logger=t,this.meetingSession=e,this.configuration=i,this.browserBehavior=new K1.default}static delay(t){return se(this,void 0,void 0,function*(){return new Promise(e=>setTimeout(e,t))})}checkAudioInput(t){return se(this,void 0,void 0,function*(){try{return yield this.meetingSession.audioVideo.startAudioInput(t),yield this.meetingSession.audioVideo.stopAudioInput(),xv.default.Succeeded}catch(e){return this.logger.error(`MeetingReadinessChecker: Audio input check failed with error ${e}`),e instanceof Tc.default?xv.default.PermissionDenied:xv.default.Failed}})}checkAudioOutput(t,e,i=null){return se(this,void 0,void 0,function*(){try{let r=t?Dv.default.getIntrinsicDeviceId(t):"";return yield this.playTone(r,this.configuration.audioOutputFrequency,i),(yield e())?Vv.default.Succeeded:Vv.default.Failed}catch(r){return this.logger.error(`MeetingReadinessChecker: Audio output check failed with error: ${r}`),Vv.default.Failed}finally{this.stopTone()}})}playTone(t,e,i){return se(this,void 0,void 0,function*(){let o=this.configuration.audioOutputGain;this.oscillatorNode&&this.stopTone(),this.audioContext=Dv.default.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=0,this.oscillatorNode=this.audioContext.createOscillator(),this.oscillatorNode.frequency.value=e,this.oscillatorNode.connect(this.gainNode),this.destinationStream=this.audioContext.createMediaStreamDestination(),this.gainNode.connect(this.destinationStream);let d=this.audioContext.currentTime+.1;this.gainNode.gain.linearRampToValueAtTime(0,d),this.gainNode.gain.linearRampToValueAtTime(o,d+.1),this.oscillatorNode.start();let l=new $1.default(this.logger);try{this.browserBehavior.supportsSetSinkId()&&(yield l.bindAudioDevice({deviceId:t}))}catch(c){this.logger.error(`Failed to bind audio device: ${c}`)}try{yield l.bindAudioElement(i||new Audio)}catch(c){this.logger.error(`Failed to bind audio element: ${c}`)}yield l.bindAudioStream(this.destinationStream.stream)})}stopTone(){if(!this.audioContext||!this.gainNode||!this.oscillatorNode||!this.destinationStream)return;let t=1,e=.1,i=this.configuration.audioOutputGain,r=this.audioContext.currentTime;this.gainNode.gain.linearRampToValueAtTime(i,r+e+t),this.gainNode.gain.linearRampToValueAtTime(0,r+e*2+t),this.oscillatorNode.stop(),this.oscillatorNode.disconnect(this.gainNode),this.gainNode.disconnect(this.destinationStream),this.oscillatorNode=null,this.gainNode=null,this.destinationStream=null}checkVideoInput(t){return se(this,void 0,void 0,function*(){try{return yield this.meetingSession.audioVideo.startVideoInput(t),yield this.meetingSession.audioVideo.stopVideoInput(),Nv.default.Succeeded}catch(e){return this.logger.error(`MeetingReadinessChecker: Video check failed with error ${e}`),e instanceof Tc.default?Nv.default.PermissionDenied:Nv.default.Failed}})}checkCameraResolution(t,e,i){return se(this,void 0,void 0,function*(){let r;try{let o=Dv.default.getIntrinsicDeviceId(t),s={video:this.calculateVideoConstraint(o,e,i)};r=yield navigator.mediaDevices.getUserMedia(s)}catch(o){return this.logger.error(`MeetingReadinessChecker: Camera resolution check with width: ${e} height ${i} failed with error ${o}`),o&&o.name==="OverconstrainedError"?kc.default.ResolutionNotSupported:o&&o.name==="NotAllowedError"?kc.default.PermissionDenied:kc.default.Failed}finally{r&&r.getTracks().forEach(function(o){o.stop()})}return kc.default.Succeeded})}calculateVideoConstraint(t,e,i){let r=this.browserBehavior.requiresResolutionAlignment(e,i),o={};return this.browserBehavior.requiresNoExactMediaStreamConstraints()?(o.deviceId=t,o.width=e,o.height=i):(o.deviceId={exact:t},o.width={exact:r[0]},o.height={exact:r[1]}),o}checkContentShareConnectivity(t){return se(this,void 0,void 0,function*(){let e=!1,i=!1,r={contentShareDidStart:()=>{e=!0}},o={audioVideoDidStart:()=>{i=!0}};try{return this.meetingSession.audioVideo.addObserver(o),this.meetingSession.audioVideo.start(),this.meetingSession.audioVideo.addContentShareObserver(r),yield this.meetingSession.audioVideo.startContentShareFromScreenCapture(t),yield this.executeTimeoutTask(()=>se(this,void 0,void 0,function*(){return i&&e})),i?(yield this.stopMeeting(),e?ya.default.Succeeded:ya.default.TimedOut):ya.default.ConnectionFailed}catch(s){return this.logger.error(`MeetingReadinessChecker: Content share check failed with error ${s}`),s.name==="NotAllowedError"?ya.default.PermissionDenied:ya.default.Failed}finally{this.meetingSession.audioVideo.removeObserver(o),this.meetingSession.audioVideo.stopContentShare(),this.meetingSession.audioVideo.removeContentShareObserver(r)}})}checkAudioConnectivity(t){return se(this,void 0,void 0,function*(){let e=!1,i={packetsReceived:0},r=this.meetingSession.audioVideo,o={metricsDidReceive(d){d.getRTCStatsReport().forEach(l=>{l.type==="inbound-rtp"&&(l.mediaType==="audio"||l.kind==="audio")&&(i.packetsReceived=l.packetsReceived)})}},s=(d,l,c,a)=>{d===this.meetingSession.configuration.credentials.attendeeId&&l&&(e=!0)};try{yield r.startAudioInput(t)}catch(d){return this.logger.error(`MeetingReadinessChecker: Failed to get audio input device with error ${d}`),d instanceof Tc.default?Sa.default.AudioInputPermissionDenied:Sa.default.AudioInputRequestFailed}return r.realtimeSubscribeToAttendeeIdPresence(s),r.addObserver(o),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>se(this,void 0,void 0,function*(){return this.isAudioConnectionSuccessful(e,i)})),r.removeObserver(o),r.realtimeUnsubscribeToAttendeeIdPresence(s),yield this.stopMeeting(),yield this.meetingSession.audioVideo.stopAudioInput(),this.isAudioConnectionSuccessful(e,i)?Sa.default.Succeeded:Sa.default.AudioNotReceived):(r.removeObserver(o),r.realtimeUnsubscribeToAttendeeIdPresence(s),yield this.meetingSession.audioVideo.stopAudioInput(),Sa.default.ConnectionFailed)})}checkVideoConnectivity(t){return se(this,void 0,void 0,function*(){let e=this.meetingSession.audioVideo,i=0,r={metricsDidReceive(o){o.getRTCStatsReport().forEach(d=>{d.type==="outbound-rtp"&&(d.mediaType==="video"||d.kind==="video")&&(i=d.packetsSent)})}};try{yield e.startVideoInput(t)}catch(o){return this.logger.error(`MeetingReadinessChecker: Failed to get video input device with error ${o}`),o instanceof Tc.default?ba.default.VideoInputPermissionDenied:ba.default.VideoInputRequestFailed}return e.addObserver(r),(yield this.startMeeting())?(e.startLocalVideoTile(),yield this.executeTimeoutTask(()=>se(this,void 0,void 0,function*(){return i>0})),yield e.stopVideoInput(),yield this.stopMeeting(),e.removeObserver(r),i<=0?ba.default.VideoNotSent:ba.default.Succeeded):ba.default.ConnectionFailed})}checkNetworkUDPConnectivity(){return se(this,void 0,void 0,function*(){let t=!1,e={metricsDidReceive(r){r.getRTCStatsReport().forEach(s=>{s.type==="candidate-pair"&&s.state==="succeeded"&&(t=!0)})}};try{this.originalURLRewriter=this.meetingSession.configuration.urls.urlRewriter}catch(r){return this.logger.error(`MeetingSessionConfiguration.urls doesn't exist. Error: ${r}`),Cc.default.MeetingSessionURLsNotInitialized}this.meetingSession.configuration.urls.urlRewriter=r=>{let o=this.originalURLRewriter(r);return o.includes("transport=tcp")?"":o};let i=this.meetingSession.audioVideo;return i.addObserver(e),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>se(this,void 0,void 0,function*(){return t})),this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,yield this.stopMeeting(),i.removeObserver(e),t?Cc.default.Succeeded:Cc.default.ICENegotiationFailed):(this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,Cc.default.ConnectionFailed)})}checkNetworkTCPConnectivity(){return se(this,void 0,void 0,function*(){let t=!1,e={metricsDidReceive(r){r.getRTCStatsReport().forEach(s=>{s.type==="candidate-pair"&&s.state==="succeeded"&&(t=!0)})}};try{this.originalURLRewriter=this.meetingSession.configuration.urls.urlRewriter}catch(r){return this.logger.error(`MeetingSessionConfiguration.urls doesn't exist. Error: ${r}`),Ic.default.MeetingSessionURLsNotInitialized}this.meetingSession.configuration.urls.urlRewriter=r=>{let o=this.originalURLRewriter(r);return o.includes("transport=udp")?"":o};let i=this.meetingSession.audioVideo;return i.addObserver(e),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>se(this,void 0,void 0,function*(){return t})),this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,yield this.stopMeeting(),i.removeObserver(e),t?Ic.default.Succeeded:Ic.default.ICENegotiationFailed):(this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,Ic.default.ConnectionFailed)})}startMeeting(){return se(this,void 0,void 0,function*(){let t=!1,e={audioVideoDidStart:()=>{t=!0}};return this.meetingSession.audioVideo.addObserver(e),this.meetingSession.audioVideo.start(),yield this.executeTimeoutTask(()=>se(this,void 0,void 0,function*(){return t})),this.meetingSession.audioVideo.removeObserver(e),t})}stopMeeting(){return se(this,void 0,void 0,function*(){let t=!1,e={audioVideoDidStop:i=>{t=!0}};return this.meetingSession.audioVideo.addObserver(e),this.meetingSession.audioVideo.stop(),yield this.executeTimeoutTask(()=>se(this,void 0,void 0,function*(){return t})),this.meetingSession.audioVideo.removeObserver(e),t})}executeTimeoutTask(t){return se(this,void 0,void 0,function*(){let e=!1;class i extends G1.default{constructor(s,d){super(s),this.waitDurationMs=d,this.isCancelled=!1}cancel(){this.isCancelled=!0}run(){return se(this,void 0,void 0,function*(){for(;!this.isCancelled;){if(yield t()){e=!0;break}yield n.delay(this.waitDurationMs)}})}}return yield new J1.default(this.logger,new i(this.logger,this.configuration.waitDurationMs),this.configuration.timeoutMs).run(),e})}isAudioConnectionSuccessful(t,e){return t&&e.packetsReceived>0}};qn.default=Lv});var wa=g(_a=>{"use strict";var X1=_a&&_a.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(_a,"__esModule",{value:!0});var Z1=X1(Qn()),Bv=class n{constructor(t,e){this.reconnectTimeoutMs=t,this.backoffPolicy=e,this.shouldReconnect=!0,this.onlyRestartPeerConnection=!1,this.firstConnectionAttempted=!1,this.firstConnectionAttemptTimestampMs=0,this.lastActiveTimestampMs=1/0,this._isFirstConnection=!0,this.backoffTimer=null,this.backoffCancel=null,this.reset()}timeSpentReconnectingMs(){return this.firstConnectionAttempted?Date.now()-this.firstConnectionAttemptTimestampMs:0}hasPastReconnectDeadline(){return Date.now()-this.lastActiveTimestampMs>=this.reconnectTimeoutMs?!0:this.timeSpentReconnectingMs()>=this.reconnectTimeoutMs}reset(){this.cancel(),this.shouldReconnect=!0,this.onlyRestartPeerConnection=!1,this.firstConnectionAttempted=!1,this.firstConnectionAttemptTimestampMs=0,this.lastActiveTimestampMs=1/0,this.backoffPolicy.reset()}startedConnectionAttempt(t){this._isFirstConnection=t,this.firstConnectionAttempted||(this.firstConnectionAttempted=!0,this.firstConnectionAttemptTimestampMs=Date.now())}hasStartedConnectionAttempt(){return this.firstConnectionAttempted}isFirstConnection(){return this._isFirstConnection}disableReconnect(){this.shouldReconnect=!1}enableRestartPeerConnection(){this.onlyRestartPeerConnection=!0}cancel(){this.disableReconnect(),this.backoffTimer&&(this.backoffTimer.stop(),this.backoffCancel&&(this.backoffCancel(),this.backoffCancel=null))}retryWithBackoff(t,e){let i=this.shouldReconnect&&!this.hasPastReconnectDeadline();return i&&(this.backoffCancel=e,this.backoffTimer=new Z1.default(this.backoffPolicy.nextBackoffAmountMs()),this.backoffTimer.start(()=>{this.backoffCancel=null,t()})),i}shouldOnlyRestartPeerConnection(){return this.onlyRestartPeerConnection}clone(){return new n(this.reconnectTimeoutMs,this.backoffPolicy)}setLastActiveTimestampMs(t){this.lastActiveTimestampMs=t}};_a.default=Bv});var ka=g(Ta=>{"use strict";var rk=Ta&&Ta.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ta,"__esModule",{value:!0});var Y1=rk(Je()),to=rk(ss()),Fv=class{constructor(t){this.logger=t}create(t,e,i){this.connection=new WebSocket(i?t:Y1.default.urlWithVersion(t),e),this.connection.binaryType="arraybuffer"}send(t){if(!this.connection)return this.logger.error("WebSocket not yet created or already destroyed."),!1;try{return t instanceof Uint8Array?this.connection.send(t.buffer):this.connection.send(t),!0}catch(e){return this.logger.debug(()=>`send error: ${e.message}, websocket state=${to.default[this.readyState()]}`),!1}}close(t,e){var i;(i=this.connection)===null||i===void 0||i.close(t,e)}destroy(){this.connection=void 0}addEventListener(t,e){if(!this.connection){this.logger.warn("Cannot add event listener with no WebSocket connection.");return}this.connection.addEventListener(t,e)}removeEventListener(t,e){var i;(i=this.connection)===null||i===void 0||i.removeEventListener(t,e)}readyState(){if(!this.connection)return to.default.None;switch(this.connection.readyState){case WebSocket.CONNECTING:return to.default.Connecting;case WebSocket.OPEN:return to.default.Open;case WebSocket.CLOSING:return to.default.Closing;case WebSocket.CLOSED:return to.default.Closed}}};Ta.default=Fv});var lk=g(Hn=>{"use strict";var ex=Hn&&Hn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},wt=Hn&&Hn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Hn,"__esModule",{value:!0});var ok=wt(mc()),tx=wt(Xg()),sk=wt(Si()),ix=wt(pe()),nx=wt($f()),ak=wt(fv()),Uv=wt(ad()),qv=ma(),rx=wt(wc()),dk=wt(wa()),ck=wt(ka()),Hv=class{constructor(t,e,i,r){this._eventController=r,this._configuration=t,this._logger=e,this.checkBrowserSupportAndFeatureConfiguration(),Uv.default.addLogger(this._logger),Uv.default.register(),this._eventController||(this._eventController=new rx.default(t,e)),i.eventController||(i.eventController=this.eventController),this.audioVideoController=new ok.default(this._configuration,this._logger,new ck.default(this._logger),i,new dk.default(this._configuration.reconnectTimeoutMs,new sk.default(this._configuration.reconnectFixedWaitMs,this._configuration.reconnectShortBackOffMs,this._configuration.reconnectLongBackOffMs)),this.eventController),this._deviceController=i,this.logger.info(`MeetingFeatures: ${JSON.stringify(t.meetingFeatures)}`);let o=new nx.default(this._logger);this.contentShareController=new ak.default(o,new ok.default(ak.default.createContentShareMeetingSessionConfigure(this._configuration),this._logger,new ck.default(this._logger),o,new dk.default(this._configuration.reconnectTimeoutMs,new sk.default(this._configuration.reconnectFixedWaitMs,this._configuration.reconnectShortBackOffMs,this._configuration.reconnectLongBackOffMs))),this.audioVideoController),this.audioVideoFacade=new tx.default(this.audioVideoController,this.audioVideoController.videoTileController,this.audioVideoController.realtimeController,this.audioVideoController.audioMixController,this._deviceController,this.contentShareController)}get configuration(){return this._configuration}get logger(){return this._logger}get audioVideo(){return this.audioVideoFacade}get contentShare(){return this.contentShareController}get deviceController(){return this._deviceController}get eventController(){return this._eventController}destroy(){return ex(this,void 0,void 0,function*(){qv.isDestroyable(this.contentShareController)&&(yield this.contentShareController.destroy()),qv.isDestroyable(this.audioVideoController)&&(yield this.audioVideoController.destroy()),qv.isDestroyable(this.eventController)&&(yield this.eventController.destroy()),Uv.default.removeLogger(this._logger),this._logger=void 0,this._configuration=void 0,this._deviceController=void 0,this.audioVideoFacade=void 0,this.audioVideoController=void 0,this.contentShareController=void 0,this._eventController=void 0})}checkBrowserSupportAndFeatureConfiguration(){let t=new ix.default,e=`${t.name()} ${t.majorVersion()} (${t.version()})`;if(this.logger.info(`browser is ${e}`),t.isSupported()||this.logger.warn(`this browser is not currently supported. Stability may suffer. Supported browsers are: ${t.supportString()}.`),this._configuration.videoUplinkBandwidthPolicy)if(this.isSimulcastUplinkPolicy(this._configuration.videoUplinkBandwidthPolicy)){if(!t.hasChromiumWebRTC())throw new Error("Simulcast is only supported on Chromium-based browsers");this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!0}else this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1;this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&(t.hasChromiumWebRTC()?this.logger.info(`Simulcast is enabled for ${t.name()}`):(this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.logger.info("Simulcast is only supported on Chromium-based browsers")),this._configuration.enableSVC&&(this._configuration.enableSVC=!1,this.logger.info("SVC is not successfully enabled since simulcast is enabled"))),this._configuration.enableSVC&&!t.supportsScalableVideoCoding()&&(this._configuration.enableSVC=!1,this.logger.info("SVC is only supported on Chromium-based browsers with version 111 or above"))}isSimulcastUplinkPolicy(t){return!!(t&&t.addObserver)}};Hn.default=Hv});var zv=g(Wv=>{"use strict";Object.defineProperty(Wv,"__esModule",{value:!0});var jv=class{constructor(t,e,i){this.type=t,this.headers=e,this.payload=i}};Wv.default=jv});var Jv={};RI(Jv,{__assign:()=>Kv,__asyncDelegator:()=>vx,__asyncGenerator:()=>gx,__asyncValues:()=>Sx,__await:()=>Ia,__awaiter:()=>lx,__classPrivateFieldGet:()=>wx,__classPrivateFieldSet:()=>Tx,__createBinding:()=>fx,__decorate:()=>ax,__exportStar:()=>hx,__extends:()=>ox,__generator:()=>ux,__importDefault:()=>_x,__importStar:()=>bx,__makeTemplateObject:()=>yx,__metadata:()=>cx,__param:()=>dx,__read:()=>uk,__rest:()=>sx,__spread:()=>px,__spreadArrays:()=>mx,__values:()=>Gv});function ox(n,t){$v(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function sx(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e}function ax(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var d=n.length-1;d>=0;d--)(s=n[d])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o}function dx(n,t){return function(e,i){t(e,i,n)}}function cx(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}function lx(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})}function ux(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,s;return s={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function d(c){return function(a){return l([c,a])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,r&&(o=c[0]&2?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,r=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){e.label=c[1];break}if(c[0]===6&&e.label<o[1]){e.label=o[1],o=c;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(c);break}o[2]&&e.ops.pop(),e.trys.pop();continue}c=t.call(n,e)}catch(a){c=[6,a],r=0}finally{i=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function fx(n,t,e,i){i===void 0&&(i=e),n[i]=t[e]}function hx(n,t){for(var e in n)e!=="default"&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Gv(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function uk(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var i=e.call(n),r,o=[],s;try{for(;(t===void 0||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(d){s={error:d}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(s)throw s.error}}return o}function px(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(uk(arguments[t]));return n}function mx(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;for(var i=Array(n),r=0,t=0;t<e;t++)for(var o=arguments[t],s=0,d=o.length;s<d;s++,r++)i[r]=o[s];return i}function Ia(n){return this instanceof Ia?(this.v=n,this):new Ia(n)}function gx(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(n,t||[]),r,o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(p){i[p]&&(r[p]=function(m){return new Promise(function(S,C){o.push([p,m,S,C])>1||d(p,m)})})}function d(p,m){try{l(i[p](m))}catch(S){u(o[0][3],S)}}function l(p){p.value instanceof Ia?Promise.resolve(p.value.v).then(c,a):u(o[0][2],p)}function c(p){d("next",p)}function a(p){d("throw",p)}function u(p,m){p(m),o.shift(),o.length&&d(o[0][0],o[0][1])}}function vx(n){var t,e;return t={},i("next"),i("throw",function(r){throw r}),i("return"),t[Symbol.iterator]=function(){return this},t;function i(r,o){t[r]=n[r]?function(s){return(e=!e)?{value:Ia(n[r](s)),done:r==="return"}:o?o(s):s}:o}}function Sx(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof Gv=="function"?Gv(n):n[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(o){e[o]=n[o]&&function(s){return new Promise(function(d,l){s=n[o](s),r(d,l,s.done,s.value)})}}function r(o,s,d,l){Promise.resolve(l).then(function(c){o({value:c,done:d})},s)}}function yx(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}function bx(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)Object.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t.default=n,t}function _x(n){return n&&n.__esModule?n:{default:n}}function wx(n,t){if(!t.has(n))throw new TypeError("attempted to get private field on non-instance");return t.get(n)}function Tx(n,t,e){if(!t.has(n))throw new TypeError("attempted to set private field on non-instance");return t.set(n,e),e}var $v,Kv,Qv=MI(()=>{$v=function(n,t){return $v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},$v(n,t)};Kv=function(){return Kv=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++){e=arguments[i];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Kv.apply(this,arguments)}});var Xv=g(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.MAX_HASHABLE_LENGTH=ze.INIT=ze.KEY=ze.DIGEST_LENGTH=ze.BLOCK_SIZE=void 0;ze.BLOCK_SIZE=64;ze.DIGEST_LENGTH=32;ze.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);ze.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];ze.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1});var fk=g(Oc=>{"use strict";Object.defineProperty(Oc,"__esModule",{value:!0});Oc.RawSha256=void 0;var $e=Xv(),kx=(function(){function n(){this.state=Int32Array.from($e.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return n.prototype.update=function(t){if(this.finished)throw new Error("Attempted to update an already finished hash.");var e=0,i=t.byteLength;if(this.bytesHashed+=i,this.bytesHashed*8>$e.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;i>0;)this.buffer[this.bufferLength++]=t[e++],i--,this.bufferLength===$e.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},n.prototype.digest=function(){if(!this.finished){var t=this.bytesHashed*8,e=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),i=this.bufferLength;if(e.setUint8(this.bufferLength++,128),i%$e.BLOCK_SIZE>=$e.BLOCK_SIZE-8){for(var r=this.bufferLength;r<$e.BLOCK_SIZE;r++)e.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(var r=this.bufferLength;r<$e.BLOCK_SIZE-8;r++)e.setUint8(r,0);e.setUint32($e.BLOCK_SIZE-8,Math.floor(t/4294967296),!0),e.setUint32($e.BLOCK_SIZE-4,t),this.hashBuffer(),this.finished=!0}for(var o=new Uint8Array($e.DIGEST_LENGTH),r=0;r<8;r++)o[r*4]=this.state[r]>>>24&255,o[r*4+1]=this.state[r]>>>16&255,o[r*4+2]=this.state[r]>>>8&255,o[r*4+3]=this.state[r]>>>0&255;return o},n.prototype.hashBuffer=function(){for(var t=this,e=t.buffer,i=t.state,r=i[0],o=i[1],s=i[2],d=i[3],l=i[4],c=i[5],a=i[6],u=i[7],p=0;p<$e.BLOCK_SIZE;p++){if(p<16)this.temp[p]=(e[p*4]&255)<<24|(e[p*4+1]&255)<<16|(e[p*4+2]&255)<<8|e[p*4+3]&255;else{var m=this.temp[p-2],S=(m>>>17|m<<15)^(m>>>19|m<<13)^m>>>10;m=this.temp[p-15];var C=(m>>>7|m<<25)^(m>>>18|m<<14)^m>>>3;this.temp[p]=(S+this.temp[p-7]|0)+(C+this.temp[p-16]|0)}var I=(((l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7))+(l&c^~l&a)|0)+(u+($e.KEY[p]+this.temp[p]|0)|0)|0,_=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&o^r&s^o&s)|0;u=a,a=c,c=l,l=d+I|0,d=s,s=o,o=r,r=I+_|0}i[0]+=r,i[1]+=o,i[2]+=s,i[3]+=d,i[4]+=l,i[5]+=c,i[6]+=a,i[7]+=u},n})();Oc.RawSha256=kx});var hk=g(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.convertToBuffer=void 0;var Ix=dl("@aws-sdk/util-utf8-browser"),Cx=typeof Buffer<"u"&&Buffer.from?function(n){return Buffer.from(n,"utf8")}:Ix.fromUtf8;function Ox(n){return n instanceof Uint8Array?n:typeof n=="string"?Cx(n):ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(n)}Ec.convertToBuffer=Ox});var pk=g(Ac=>{"use strict";Object.defineProperty(Ac,"__esModule",{value:!0});Ac.isEmptyData=void 0;function Ex(n){return typeof n=="string"?n.length===0:n.byteLength===0}Ac.isEmptyData=Ex});var mk=g(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});Pc.numToUint8=void 0;function Ax(n){return new Uint8Array([(n&4278190080)>>24,(n&16711680)>>16,(n&65280)>>8,n&255])}Pc.numToUint8=Ax});var gk=g(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});Mc.uint32ArrayFrom=void 0;function Px(n){if(!Uint32Array.from){for(var t=new Uint32Array(n.length),e=0;e<n.length;)t[e]=n[e],e+=1;return t}return Uint32Array.from(n)}Mc.uint32ArrayFrom=Px});var vk=g(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.uint32ArrayFrom=Tt.numToUint8=Tt.isEmptyData=Tt.convertToBuffer=void 0;var Mx=hk();Object.defineProperty(Tt,"convertToBuffer",{enumerable:!0,get:function(){return Mx.convertToBuffer}});var Rx=pk();Object.defineProperty(Tt,"isEmptyData",{enumerable:!0,get:function(){return Rx.isEmptyData}});var Dx=mk();Object.defineProperty(Tt,"numToUint8",{enumerable:!0,get:function(){return Dx.numToUint8}});var xx=gk();Object.defineProperty(Tt,"uint32ArrayFrom",{enumerable:!0,get:function(){return xx.uint32ArrayFrom}})});var yk=g(Dc=>{"use strict";Object.defineProperty(Dc,"__esModule",{value:!0});Dc.Sha256=void 0;var Sk=(Qv(),Ay(Jv)),Rc=Xv(),Zv=fk(),Yv=vk(),Vx=(function(){function n(t){if(this.hash=new Zv.RawSha256,t){this.outer=new Zv.RawSha256;var e=Nx(t),i=new Uint8Array(Rc.BLOCK_SIZE);i.set(e);for(var r=0;r<Rc.BLOCK_SIZE;r++)e[r]^=54,i[r]^=92;this.hash.update(e),this.outer.update(i);for(var r=0;r<e.byteLength;r++)e[r]=0}}return n.prototype.update=function(t){if(!((0,Yv.isEmptyData)(t)||this.error))try{this.hash.update((0,Yv.convertToBuffer)(t))}catch(e){this.error=e}},n.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},n.prototype.digest=function(){return Sk.__awaiter(this,void 0,void 0,function(){return Sk.__generator(this,function(t){return[2,this.digestSync()]})})},n})();Dc.Sha256=Vx;function Nx(n){var t=(0,Yv.convertToBuffer)(n);if(t.byteLength>Rc.BLOCK_SIZE){var e=new Zv.RawSha256;e.update(t),t=e.digest()}var i=new Uint8Array(Rc.BLOCK_SIZE);return i.set(t),i}});var bk=g(eS=>{"use strict";Object.defineProperty(eS,"__esModule",{value:!0});var Lx=(Qv(),Ay(Jv));Lx.__exportStar(yk(),eS)});var nS=g(jn=>{"use strict";var _k=jn&&jn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Bx=jn&&jn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(jn,"__esModule",{value:!0});var Fx=bk(),tS=dl("@aws-sdk/util-hex-encoding"),xc=Bx(Je()),iS=class{constructor(t){this.chimeClient=t}makeTwoDigits(t){return t>9?t.toString():"0"+t.toString()}hmac(t,e){let i=new Fx.Sha256(e);return i.update(t),i.digest()}getDateTimeString(){let t=new Date;return t.getUTCFullYear()+this.makeTwoDigits(t.getUTCMonth()+1)+this.makeTwoDigits(t.getUTCDate())+"T"+this.makeTwoDigits(t.getUTCHours())+this.makeTwoDigits(t.getUTCMinutes())+this.makeTwoDigits(t.getUTCSeconds())+"Z"}getDateString(t){return t.substring(0,t.indexOf("T"))}getSignatureKey(t,e,i,r){return _k(this,void 0,void 0,function*(){let o=yield this.hmac(e,"AWS4"+t),s=yield this.hmac(i,o),d=yield this.hmac(r,s);return yield this.hmac("aws4_request",d)})}signURL(t,e,i,r,o,s,d){return _k(this,void 0,void 0,function*(){let l=this.getDateTimeString(),c=this.getDateString(l),a="AWS4-HMAC-SHA256",u="";this.chimeClient.config.region instanceof Function?u=yield this.chimeClient.config.region():u=this.chimeClient.config.region;let p="host",m="host:"+r.toLowerCase()+`
`,S=c+"/"+u+"/"+i+"/aws4_request",C;this.chimeClient.config.credentials instanceof Function?C=yield this.chimeClient.config.credentials():C=this.chimeClient.config.credentials;let I=new Map;I.set("X-Amz-Algorithm",[a]),I.set("X-Amz-Credential",[encodeURIComponent(C.accessKeyId+"/"+S)]),I.set("X-Amz-Date",[l]),I.set("X-Amz-Expires",["10"]),I.set("X-Amz-SignedHeaders",["host"]),C.sessionToken&&I.set("X-Amz-Security-Token",[encodeURIComponent(C.sessionToken)]),I.set(xc.default.X_AMZN_VERSION,[encodeURIComponent(xc.default.sdkVersion)]),I.set(xc.default.X_AMZN_USER_AGENT,[encodeURIComponent(xc.default.sdkUserAgentLowResolution)]),d?.forEach((A,P)=>{let V=encodeURIComponent(P);A.sort().forEach(U=>{I.has(V)||I.set(V,[]),I.get(V).push(encodeURIComponent(U))})});let _="";I=new Map([...I.entries()].sort()),I.forEach((A,P)=>{A.forEach(V=>{_.length&&(_+="&"),_+=P+"="+V})});let k=t+`
`+o+`
`+_+`
`+m+`
`+p+`
`+tS.toHex(yield this.hmac(s)),T=tS.toHex(yield this.hmac(k)),w=`AWS4-HMAC-SHA256
`+l+`
`+c+"/"+u+"/"+i+`/aws4_request
`+T,D=yield this.getSignatureKey(C.secretAccessKey,c,u,i),L=tS.toHex(yield this.hmac(w,D)),O=_+"&X-Amz-Signature="+L;return e+"://"+r+o+"?"+O})}};jn.default=iS});var sS=g(oS=>{"use strict";Object.defineProperty(oS,"__esModule",{value:!0});var rS;(function(n){n.Connect="connect"})(rS||(rS={}));oS.default=rS});var kk=g(Wn=>{"use strict";var Ca=Wn&&Wn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Ut=Wn&&Wn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Wn,"__esModule",{value:!0});var Ux=dl("@aws-sdk/client-chime-sdk-messaging"),qx=Ut(Si()),aS=Ut(ad()),Hx=Ut(zv()),jx=Ut(wa()),Wx=Ut(Ve()),zx=Ut(nS()),$x=Ut(ka()),wk=Ut(ss()),Tk=Ut(sS()),dS=class{constructor(t,e,i,r,o){this.configuration=t,this.logger=e,this.webSocket=i,this.reconnectController=r,this.sigV4=o,this.observerQueue=new Set,this.webSocket||(this.webSocket=new $x.default(this.logger)),this.reconnectController||(this.reconnectController=new jx.default(t.reconnectTimeoutMs,new qx.default(t.reconnectFixedWaitMs,t.reconnectShortBackoffMs,t.reconnectLongBackoffMs))),this.sigV4||(this.sigV4=new zx.default(this.configuration.chimeClient)),aS.default.addLogger(this.logger),aS.default.register(),this.preBootstrapMessages=[]}addObserver(t){this.logger.info("adding messaging observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing messaging observer"),this.observerQueue.delete(t)}start(){return Ca(this,void 0,void 0,function*(){this.isClosed()?yield this.startConnecting(!1):this.logger.info("messaging session already started")})}stop(){this.isClosed()?this.logger.info("no existing messaging session needs closing"):(this.isClosing=!0,this.webSocket.close(),aS.default.removeLogger(this.logger))}forEachObserver(t){for(let e of this.observerQueue)Wx.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}setUpEventListeners(){this.webSocket.addEventListener("open",()=>{this.openEventHandler()}),this.webSocket.addEventListener("message",t=>{this.receiveMessageHandler(t.data)}),this.webSocket.addEventListener("close",t=>{this.closeEventHandler(t)}),this.webSocket.addEventListener("error",()=>{this.logger.error("WebSocket error")})}startConnecting(t){return Ca(this,void 0,void 0,function*(){return yield this.startConnectingInternal(t),yield new Promise((e,i)=>{this.bootstrapResolved=e,this.bootstrapRejected=i})})}startConnectingInternal(t){var e;return Ca(this,void 0,void 0,function*(){let i=this.configuration.endpointUrl;if(t||this.reconnectController.reset(),this.reconnectController.hasStartedConnectionAttempt()?this.reconnectController.startedConnectionAttempt(!1):this.reconnectController.startedConnectionAttempt(!0),t||i===void 0)try{if(this.configuration.chimeClient.getMessagingSessionEndpoint instanceof Function){let o=yield this.configuration.chimeClient.getMessagingSessionEndpoint();!((e=o.Endpoint)===null||e===void 0)&&e.Url?i=o.Endpoint.Url:i=(yield this.configuration.chimeClient.getMessagingSessionEndpoint().promise()).Endpoint.Url}else i=(yield this.configuration.chimeClient.send(new Ux.GetMessagingSessionEndpointCommand({}))).Endpoint.Url;this.logger.debug(`Messaging endpoint resolved to: ${i}`)}catch(o){this.logger.error(`Messaging Session failed to resolve endpoint: ${o}`);let s=new CloseEvent("close",{wasClean:!1,code:4999,reason:"Failed to get messaging session endpoint URL",bubbles:!1});this.closeEventHandler(s);return}let r=yield this.prepareWebSocketUrl(i);this.logger.info(`opening connection to ${r}`),t||this.reconnectController.reset(),this.reconnectController.hasStartedConnectionAttempt()?this.reconnectController.startedConnectionAttempt(!1):this.reconnectController.startedConnectionAttempt(!0),this.webSocket.create(r,[],!0),this.forEachObserver(o=>{o.messagingSessionDidStartConnecting&&o.messagingSessionDidStartConnecting(t)}),this.setUpEventListeners()})}prepareWebSocketUrl(t){return Ca(this,void 0,void 0,function*(){let e=new Map;return e.set("userArn",[this.configuration.userArn]),e.set("sessionId",[this.configuration.messagingSessionId]),this.configuration.prefetchOn===Tk.default.Connect&&e.set("prefetch-on",[Tk.default.Connect]),this.configuration.prefetchSortBy&&e.set("prefetch-sort-by",[this.configuration.prefetchSortBy]),yield this.sigV4.signURL("GET","wss","chime",t,"/connect","",e)})}isClosed(){return this.webSocket.readyState()===wk.default.None||this.webSocket.readyState()===wk.default.Closed}openEventHandler(){this.reconnectController.reset(),this.isSessionEstablished=!1}receiveMessageHandler(t){try{let e=JSON.parse(t),i=e.Headers["x-amz-chime-event-type"],r=new Hx.default(i,e.Headers,e.Payload||null);if(!this.isSessionEstablished&&i==="SESSION_ESTABLISHED"){this.forEachObserver(s=>{s.messagingSessionDidStart&&s.messagingSessionDidStart()}),this.bootstrapResolved(),this.isSessionEstablished=!0;let o=this.preBootstrapMessages.length;for(let s=0;s<o;s++){let d=this.preBootstrapMessages.shift();this.forEachObserver(l=>{this.sendMessageToObserver(l,d)})}}else if(!this.isSessionEstablished){this.preBootstrapMessages.push(r);return}this.forEachObserver(o=>{this.sendMessageToObserver(o,r)})}catch(e){this.logger.error(`Messaging parsing failed: ${e}`)}}sendMessageToObserver(t,e){t.messagingSessionDidReceiveMessage&&t.messagingSessionDidReceiveMessage(e)}retryConnection(){return this.reconnectController.retryWithBackoff(()=>Ca(this,void 0,void 0,function*(){yield this.startConnecting(!0)}),null)}closeEventHandler(t){this.logger.info(`WebSocket close: ${t.code} ${t.reason}`),t.code!==4999&&this.webSocket.destroy(),!(!this.isClosing&&this.canReconnect(t.code)&&this.retryConnection())&&(this.isClosing=!1,this.isSessionEstablished?this.forEachObserver(e=>{e.messagingSessionDidStop&&e.messagingSessionDidStop(t)}):this.bootstrapRejected(t))}canReconnect(t){return t===1001||t===1006||t>=1011&&t<=1014||t>4e3&&t!==4002&&t!==4003&&t!==4401}};Wn.default=dS});var lS=g(Oa=>{"use strict";var Kx=Oa&&Oa.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Oa,"__esModule",{value:!0});var Gx=Kx(Si()),cS=class extends Gx.default{constructor(t,e,i,r){super(t,e,i),this.limit=r,this.attempts=0}nextBackoffAmountMs(){if(this.attempts++,this.attempts>this.limit)throw new Error("retry limit exceeded");return super.nextBackoffAmountMs()}};Oa.default=cS});var Ck=g(Ea=>{"use strict";var Ik=Ea&&Ea.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ea,"__esModule",{value:!0});var Jx=Ik(Si()),Qx=Ik(lS()),uS=class{constructor(t,e,i){this.fixedWaitMs=t,this.shortBackoffMs=e,this.longBackoffMs=i}create(){return new Jx.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs)}createWithLimit(t){return new Qx.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs,t)}};Ea.default=uS});var pS=g(hS=>{"use strict";Object.defineProperty(hS,"__esModule",{value:!0});var fS=class{constructor(t,e,i,r){this.sequenceNumber=t,this.message=e,this.timestampMs=i,this.logLevel=r}};hS.default=fS});var Ok=g(gS=>{"use strict";Object.defineProperty(gS,"__esModule",{value:!0});var Xx=ri(),mS=class{constructor(t,e,i,r){this.userArn=t,this.messagingSessionId=e,this.endpointUrl=i,this.chimeClient=r,this.reconnectTimeoutMs=10*1e3,this.reconnectFixedWaitMs=0,this.reconnectShortBackoffMs=1*1e3,this.reconnectLongBackoffMs=5*1e3,this.prefetchOn=void 0,this.prefetchSortBy=void 0,this.messagingSessionId||(this.messagingSessionId=this.generateSessionId())}generateSessionId(){let t=new Uint32Array(1);return Xx.getRandomValues(t),t[0].toString()}};gS.default=mS});var Ek=g(Aa=>{"use strict";var Zx=Aa&&Aa.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Aa,"__esModule",{value:!0});var Yx=Zx(Ge()),vS=class{constructor(...t){this._loggers=t}info(t){for(let e of this._loggers)e.info(t)}warn(t){for(let e of this._loggers)e.warn(t)}error(t){for(let e of this._loggers)e.error(t)}debug(t){let e,i;typeof t=="string"?i=t:t?i=()=>(e||(e=t()),e):i=""+t;for(let r of this._loggers)r.debug(i)}setLogLevel(t){for(let e of this._loggers)e.setLogLevel(t)}getLogLevel(){for(let t of this._loggers)return t.getLogLevel();return Yx.default.OFF}};Aa.default=vS});var Vc=g(Pa=>{"use strict";var eV=Pa&&Pa.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Pa,"__esModule",{value:!0});var Ak=eV(Ge()),SS=class{constructor(t=Ak.default.OFF){this.level=t}info(t){}warn(t){}error(t){}debug(t){Ak.default.DEBUG<this.level||typeof t!="string"&&t()}setLogLevel(t){this.level=t}getLogLevel(){return this.level}};Pa.default=SS});var bS=g(Ma=>{"use strict";var Pk=Ma&&Ma.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ma,"__esModule",{value:!0});var tV=Pk(Ge()),iV=Pk(Vc()),yS=class extends iV.default{constructor(){super(tV.default.DEBUG)}};Ma.default=yS});var Nc=g(wS=>{"use strict";Object.defineProperty(wS,"__esModule",{value:!0});var _S=class{acquireAudioInputStream(){return Promise.reject()}acquireVideoInputStream(){return Promise.reject()}acquireDisplayInputStream(t){return Promise.reject()}muteLocalAudioInputStream(){}unmuteLocalAudioInputStream(){}addMediaStreamBrokerObserver(t){}removeMediaStreamBrokerObserver(t){}};wS.default=_S});var Rk=g(Ra=>{"use strict";var Ke=Ra&&Ra.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ra,"__esModule",{value:!0});var nV=Ke(Si()),rV=Ke(wc()),Mk=Ke(bS()),oV=Ke(Nc()),sV=Ke(vc()),aV=Ke(la()),dV=Ke(Gi()),cV=Ke(tt()),lV=Ke(gc()),uV=Ke(wa()),fV=Ke(ka()),hV=Ke(mc()),TS=class extends hV.default{constructor(t){let e=new sV.default;e.meetingId="",e.externalMeetingId="",e.credentials=new aV.default,e.credentials.attendeeId="",e.credentials.joinToken="",e.urls=new lV.default,e.urls.turnControlURL="",e.urls.audioHostURL="",e.urls.signalingURL="wss://localhost/";let i=new Mk.default;super(t||e,i,new fV.default(new Mk.default),new oV.default,new uV.default(0,new nV.default(0,0,0)),new rV.default(t||e,i))}setAudioProfile(t){}start(){}stop(){}promoteToPrimaryMeeting(t){return Promise.resolve(new dV.default(cV.default.OK))}demoteFromPrimaryMeeting(){}};Ra.default=TS});var xk=g(qt=>{"use strict";var pV=qt&&qt.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Dk=qt&&qt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(qt,"__esModule",{value:!0});qt.NoOpDeviceControllerWithEventController=void 0;var mV=Dk(Nc()),gV=Dk(Pt()),Lc=class extends mV.default{constructor(t){super(),this.destroyed=!1}destroy(){return pV(this,void 0,void 0,function*(){this.destroyed=!0})}listAudioInputDevices(){return Promise.resolve([])}listVideoInputDevices(){return Promise.resolve([])}listAudioOutputDevices(){return Promise.resolve([])}startAudioInput(t){return Promise.reject()}stopAudioInput(){return Promise.resolve()}startVideoInput(t){return Promise.reject()}stopVideoInput(){return Promise.resolve()}chooseAudioOutput(t){return Promise.reject()}addDeviceChangeObserver(t){}removeDeviceChangeObserver(t){}createAnalyserNodeForAudioInput(){return null}startVideoPreviewForVideoInput(t){}stopVideoPreviewForVideoInput(t){}setDeviceLabelTrigger(t){}mixIntoAudioInput(t){return null}chooseVideoInputQuality(t,e,i){}getVideoInputQualitySettings(){return gV.default.VideoDisabled}};qt.default=Lc;var kS=class extends Lc{constructor(t){super(),this.eventController=t}};qt.NoOpDeviceControllerWithEventController=kS});var Vk=g(CS=>{"use strict";Object.defineProperty(CS,"__esModule",{value:!0});var IS=class{constructor(){}reportEvent(t,e,i){}start(){}stop(){}};CS.default=IS});var Nk=g(ES=>{"use strict";Object.defineProperty(ES,"__esModule",{value:!0});var OS=class{cancel(){}name(){return"NoOpTask"}run(){return Promise.resolve()}setParent(t){}};ES.default=OS});var Lk=g(PS=>{"use strict";Object.defineProperty(PS,"__esModule",{value:!0});var AS=class{create(){let t={clientWidth:400,clientHeight:300,width:400,height:300,videoWidth:400,videoHeight:300,style:{transform:""},hasAttribute:()=>!1,removeAttribute:()=>{},setAttribute:()=>{},srcObject:!1,paused:!0,pause:()=>{t.paused=!0},play:()=>(t.paused=!1,Promise.resolve())};return t}};PS.default=AS});var Bk=g(Da=>{"use strict";var vV=Da&&Da.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Da,"__esModule",{value:!0});var SV=vV($r()),MS=class{constructor(){}updateConnectionMetric(t){}chooseMediaTrackConstraints(){return{}}chooseEncodingParameters(){return new Map}updateIndex(t){}wantsResubscribe(){return!1}chooseCaptureAndEncodeParameters(){return new SV.default(0,0,0,0,!1)}maxBandwidthKbps(){return 0}setIdealMaxBandwidthKbps(t){}setHasBandwidthPriority(t){}setHighResolutionFeatureEnabled(t){}wantsVideoDependencyDescriptorRtpHeaderExtension(){return!1}};Da.default=MS});var Uk=g(zn=>{"use strict";var Fk=zn&&zn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},RS=zn&&zn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(zn,"__esModule",{value:!0});var yV=RS(Jt()),bV=RS(pS()),Ht=RS(Ge()),xa=class n{constructor(t){this.logCapture=[],this.lock=!1,this.sequenceNumber=0;let{url:e,batchSize:i=n.BATCH_SIZE,intervalMs:r=n.INTERVAL_MS,logLevel:o=Ht.default.WARN,metadata:s,headers:d}=t;this.url=e,this.batchSize=i,this.intervalMs=r,this.logLevel=o,this.metadata=s,this.headers=d,this.start(),this.eventListener=()=>{this.stop()},this.addEventListener()}addEventListener(){!this.eventListener||!("window"in global)||!window.addEventListener||window.addEventListener("unload",this.eventListener)}removeEventListener(){!this.eventListener||!("window"in global)||!window.removeEventListener||window.removeEventListener("unload",this.eventListener)}debug(t){Ht.default.DEBUG<this.logLevel||(typeof t=="string"?this.log(Ht.default.DEBUG,t):t?this.log(Ht.default.DEBUG,t()):this.log(Ht.default.DEBUG,""+t))}info(t){this.log(Ht.default.INFO,t)}warn(t){this.log(Ht.default.WARN,t)}error(t){this.log(Ht.default.ERROR,t)}setLogLevel(t){this.logLevel=t}getLogLevel(){return this.logLevel}getLogCaptureSize(){return this.logCapture.length}start(){this.addEventListener(),this.intervalScheduler=new yV.default(this.intervalMs),this.intervalScheduler.start(()=>Fk(this,void 0,void 0,function*(){if(this.lock===!0||this.getLogCaptureSize()===0)return;this.lock=!0;let t=this.logCapture.slice(0,this.batchSize),e=this.makeRequestBody(t);try{(yield fetch(this.url,Object.assign({method:"POST",body:e},this.headers?{headers:this.headers}:{}))).status===200&&(this.logCapture=this.logCapture.slice(t.length))}catch(i){console.warn("[POSTLogger] "+i.message)}finally{this.lock=!1}}))}stop(){var t;(t=this.intervalScheduler)===null||t===void 0||t.stop(),this.intervalScheduler=void 0,this.removeEventListener();let e=this.makeRequestBody(this.logCapture);navigator.sendBeacon(this.url,e)}destroy(){return Fk(this,void 0,void 0,function*(){this.stop(),this.metadata=void 0,this.headers=void 0,this.logCapture=[],this.sequenceNumber=0,this.lock=!1,this.batchSize=0,this.intervalMs=0,this.url=void 0})}makeRequestBody(t){return JSON.stringify(Object.assign(Object.assign({},this.metadata),{logs:t}))}log(t,e){if(t<this.logLevel)return;let i=Date.now();this.logCapture.push(new bV.default(this.sequenceNumber,e,i,Ht.default[t])),this.sequenceNumber+=1}};zn.default=xa;xa.BATCH_SIZE=85;xa.INTERVAL_MS=2e3});var qk=g(xS=>{"use strict";Object.defineProperty(xS,"__esModule",{value:!0});var DS;(function(n){n.Unread="unread",n.LastMessageTimestamp="last-message-timestamp"})(DS||(DS={}));xS.default=DS});var Hk=g(NS=>{"use strict";Object.defineProperty(NS,"__esModule",{value:!0});var VS=class{constructor(){this.attendeeIndex=null,this.attendeesInFrame=null}};NS.default=VS});var jk=g(Va=>{"use strict";var _V=Va&&Va.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Va,"__esModule",{value:!0});var wV=_V(Z()),LS=class extends wV.default{constructor(t,e,i="RunnableTask"){super(t),this.fn=e,this.taskName=i}run(){return this.fn().then(()=>{})}};Va.default=LS});var Wk=g(Na=>{"use strict";var Bc=Na&&Na.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(Na,"__esModule",{value:!0});var BS=class{constructor(t){this.inner=t}mute(t){return Bc(this,void 0,void 0,function*(){})}stop(){var t;return Bc(this,void 0,void 0,function*(){(t=this.node)===null||t===void 0||t.disconnect()})}intrinsicDevice(){return Bc(this,void 0,void 0,function*(){return this.inner})}createAudioNode(t){var e;return Bc(this,void 0,void 0,function*(){return(e=this.node)===null||e===void 0||e.disconnect(),this.node=yield this.createSingleAudioNode(t),{start:this.node,end:this.node}})}};Na.default=BS});var zk=g(US=>{"use strict";Object.defineProperty(US,"__esModule",{value:!0});var FS=class{};US.default=FS});var $k=g(HS=>{"use strict";Object.defineProperty(HS,"__esModule",{value:!0});var qS=class{};HS.default=qS});var Kk=g(WS=>{"use strict";Object.defineProperty(WS,"__esModule",{value:!0});var jS=class{};WS.default=jS});var Gk=g($S=>{"use strict";Object.defineProperty($S,"__esModule",{value:!0});var zS=class{};$S.default=zS});var Jk=g(GS=>{"use strict";Object.defineProperty(GS,"__esModule",{value:!0});var KS=class{};GS.default=KS});var Qk=g(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.DeferredPromise=void 0;var JS=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}getPromise(){return this.promise}resolvePromise(t){this.resolve(t)}resolveAndReplacePromise(t){this.resolve(t),this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}rejectPromise(t){this.reject(t)}rejectAndReplacePromise(t){this.reject(t),this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}};Fc.DeferredPromise=JS});var Uc=g(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.DEFAULT_VIDEO_FX_SPEC=ce.FXLIB_PATH=ce.WORKER_PATH=ce.CDN_BASE_PATH=ce.RESOURCE_CONSTRAINTS=ce.SEGMENTATION_MODEL=ce.DEFAULT_STREAM_PARAMETERS=ce.WORKER_MSG=void 0;ce.WORKER_MSG={BUILD_ENGINE_REQUEST:"BuildEngineRequest",BUILD_ENGINE_RESPONSE:"BuildEngineResponse",PERFORM_SEGMENTATION_REQUEST:"PerformSegmentationRequest",PERFORM_SEGMENTATION_RESPONSE:"PerformSegmentationResponse",PERFORM_SEGMENTATION_SAB_REQUEST:"PerformSegmentationSABRequest",PERFORM_SEGMENTATION_SAB_RESPONSE:"PerformSegmentationSABResponse",DESTROY_ASSETS_REQUEST:"DestroyAssetsRequest",DESTROY_ASSETS_RESPONSE:"DestroyAssetsResponse",CLOSE_WORKER_REQUEST:"CloseWorkerRequest"};ce.DEFAULT_STREAM_PARAMETERS={FRAMES_PER_SECOND:15,WIDTH_IN_PIXEL:960,HEIGHT_IN_PIXEL:540,CHANNEL_COUNT:4};ce.SEGMENTATION_MODEL={LOAD_SUCCESS:2,WIDTH_IN_PIXELS:176,HEIGHT_IN_PIXELS:160};ce.RESOURCE_CONSTRAINTS={DEFAULT_PROCESSING_BUDGET_PER_FRAME:50,SEGMENTATION_DEFAULT_FRAMES_PER_SEGMENTATION:1,SEGMENTATION_SAMPLING_PERIOD_FRAME_COUNT:500,BLUR_DEFAULT_CYCLE_PERCENTAGE:10,BLUR_SAMPLING_PERIOD_FRAME_COUNT:1e3,MIN_PROCESSING_BUDGET:0,MAX_PROCESSING_BUDGET:100};ce.CDN_BASE_PATH="https://static.sdkassets.chime.aws";var Xk="/ml_media_fx/otherassets";ce.WORKER_PATH=`${Xk}/worker.js`;ce.FXLIB_PATH=`${Xk}/fxlib.js`;ce.DEFAULT_VIDEO_FX_SPEC={paths:{cdnBasePath:ce.CDN_BASE_PATH,workerPath:ce.WORKER_PATH,fxLibPath:ce.FXLIB_PATH}}});var Zk=g(no=>{"use strict";var QS=no&&no.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(no,"__esModule",{value:!0});no.VideoFxCanvasOpsManager=void 0;var io=Uc(),XS=class{constructor(t,e){this.streamParameters=t,this.outputCanvas=e,this.configureCanvasPipeline()}getInferenceInputData(t){return this.inferenceCtx.save(),this.inferenceCtx.scale(this.horizontalResizeScalar,this.verticalResizeScalar),this.inferenceCtx.drawImage(t,0,0),this.inferenceCtx.restore(),this.inferenceCtx.getImageData(0,0,io.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,io.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS)}configureForStreamParameters(t){return QS(this,void 0,void 0,function*(){if(this.streamParameters=t,this.outputCanvas.width=this.streamParameters.width,this.outputCanvas.height=this.streamParameters.height,this.backgroundReplacementCanvas){let e=document.createElement("canvas");e.width=this.streamParameters.width,e.height=this.streamParameters.height,e.getContext("2d").drawImage(this.backgroundReplacementCanvas,0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=e}this.configureCanvasPipeline()})}configureCanvasPipeline(){this.inferenceCanvas=document.createElement("canvas"),this.inferenceCtx=this.inferenceCanvas.getContext("2d",{willReadFrequently:!0}),this.inferenceCanvas.width=io.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,this.inferenceCanvas.height=io.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS,this.horizontalResizeScalar=io.SEGMENTATION_MODEL.WIDTH_IN_PIXELS/this.streamParameters.width,this.verticalResizeScalar=io.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS/this.streamParameters.height}getBackgroundReplacementCanvas(){return this.backgroundReplacementCanvas}loadReplacementBackground(t){return QS(this,void 0,void 0,function*(){let e=t.backgroundReplacement.backgroundImageURL,i=t.backgroundReplacement.defaultColor;if(e)try{let r=yield this.loadImage(e);this.backgroundReplacementImage=r,this.resizeAndSetReplacementImage(this.backgroundReplacementImage)}catch(r){throw this.logger.error(r),new Error("Failed to set the replacement image.")}else this.resizeAndSetReplacementColor(i)})}resizeAndSetReplacementImage(t){let e=document.createElement("canvas"),i=e.getContext("2d");e.width=this.streamParameters.width,e.height=this.streamParameters.height,i.drawImage(t,0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=e}resizeAndSetReplacementColor(t){let e=document.createElement("canvas"),i=e.getContext("2d");e.width=this.streamParameters.width,e.height=this.streamParameters.height,i.fillStyle=t,i.fillRect(0,0,this.streamParameters.width,this.streamParameters.height),this.backgroundReplacementCanvas=e}loadImage(t){return QS(this,void 0,void 0,function*(){let i=yield(yield fetch(t).catch(o=>{throw this.logger.error(o.toString()),new Error("Failed to fetch image.")})).blob(),r=new Image;return r.src=URL.createObjectURL(i),new Promise((o,s)=>{r.onload=()=>{o(r)},r.onerror=d=>{s(d)}})})}};no.VideoFxCanvasOpsManager=XS});var eI=g(qc=>{"use strict";Object.defineProperty(qc,"__esModule",{value:!0});qc.VideoFxSegmentationRateManager=void 0;var Yk=Uc(),ZS=class{constructor(t,e){this.logger=t,this.targetSegmentationCyclePercentage=e/100,this.frameCountOverSamplingPeriod=0,this.totalSegmentationDurationOverSamplingPeriod=0,this.samplingPeriodStartTime=performance.now(),this.framesPerSegmentation=Yk.RESOURCE_CONSTRAINTS.SEGMENTATION_DEFAULT_FRAMES_PER_SEGMENTATION}submitFrame(){this.frameCountOverSamplingPeriod++}shouldApplySegmentation(){return this.frameCountOverSamplingPeriod%this.framesPerSegmentation===0}startSegmentation(){this.frameSegmentationStartTime=performance.now()}completeSegmentation(){this.totalSegmentationDurationOverSamplingPeriod+=performance.now()-this.frameSegmentationStartTime,this.frameCountOverSamplingPeriod>=Yk.RESOURCE_CONSTRAINTS.SEGMENTATION_SAMPLING_PERIOD_FRAME_COUNT&&this.adjustFramesPerSegmentation(this.totalSegmentationDurationOverSamplingPeriod/(performance.now()-this.samplingPeriodStartTime))}adjustFramesPerSegmentation(t){t>this.targetSegmentationCyclePercentage?(this.framesPerSegmentation++,this.logger.info(`Segmentation cycle percentage above the configured maximal value. Decreasing segmentation rate to 1 segmentation per ${this.framesPerSegmentation} frames`)):this.framesPerSegmentation>1&&t<this.targetSegmentationCyclePercentage&&(this.framesPerSegmentation--,this.logger.info(`Segmentation cycle percentage below the configured maximal value. Increasing segmentation rate to 1 segmentation per ${this.framesPerSegmentation} frames`)),this.totalSegmentationDurationOverSamplingPeriod=0,this.frameCountOverSamplingPeriod=0,this.samplingPeriodStartTime=performance.now()}};qc.VideoFxSegmentationRateManager=ZS});var nI=g($n=>{"use strict";var Se=$n&&$n.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},jc=$n&&$n.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty($n,"__esModule",{value:!0});var TV=ed(),kV=Ii(),tI=Wt(),IV=jc(pe()),CV=jc(Vc()),OV=ri(),iI=jc(Je()),EV=jc(Eo()),YS=Qk(),AV=Zk(),Y=Uc(),PV=eI(),Hc=class n{constructor(t,e=Y.RESOURCE_CONSTRAINTS.DEFAULT_PROCESSING_BUDGET_PER_FRAME,i){this.logger=t,this.outputCanvas=document.createElement("canvas"),this.canvasVideoFrameBuffer=new EV.default(this.outputCanvas),this.videoFxSpec=Y.DEFAULT_VIDEO_FX_SPEC;try{this.validateProcessingBudgetPerFrame(e)}catch(r){throw this.logger.error(r),new Error(`Cannot instantiate VideoFxProcessor due to invalid processingBudgetPerFrame of ${e}`)}i&&(this.eventController=i),this.effectConfig={backgroundBlur:{isEnabled:!1,strength:"low"},backgroundReplacement:{isEnabled:!1,backgroundImageURL:null,defaultColor:"black"}},this.segmentationRequestPromise=new YS.DeferredPromise,this.segmentationRateManager=new PV.VideoFxSegmentationRateManager(this.logger,e),this.streamParameters={framerate:Y.DEFAULT_STREAM_PARAMETERS.FRAMES_PER_SECOND,width:Y.DEFAULT_STREAM_PARAMETERS.WIDTH_IN_PIXEL,height:Y.DEFAULT_STREAM_PARAMETERS.HEIGHT_IN_PIXEL,channels:Y.DEFAULT_STREAM_PARAMETERS.CHANNEL_COUNT},n.isSharedArrayBufferSupported&&(this.sharedImageBuffer=new SharedArrayBuffer(Y.SEGMENTATION_MODEL.WIDTH_IN_PIXELS*Y.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS*this.streamParameters.channels),this.sharedImageData=new Uint8ClampedArray(this.sharedImageBuffer)),this.logger.info(`VideoFx supports Shared Array Buffer: ${n.isSharedArrayBufferSupported}`),this.canvasOpsManager=new AV.VideoFxCanvasOpsManager(this.streamParameters,this.outputCanvas),this.outputCanvas.width=this.streamParameters.width,this.outputCanvas.height=this.streamParameters.height,this.segmentationMask=new ImageData(this.streamParameters.width,this.streamParameters.height),this.logger.info(`VideoFxProcessor instantiated with a processingBudgetPerFrame of ${e}`)}process(t){return Se(this,void 0,void 0,function*(){return t})}fxProcess(t){return Se(this,void 0,void 0,function*(){let e=t[0].asCanvasElement();this.didStreamParametersChange(e)&&(yield this.adjustProcessorForNewStreamParameters(e));try{yield this.manageSegmentationMask(e)}catch(i){throw this.logger.error(i),new Error("Video stream could not be processed")}return yield this.renderer.render(e,this.segmentationMask),t[0]=this.canvasVideoFrameBuffer,t})}noOpProcess(t){return Se(this,void 0,void 0,function*(){return t})}didStreamParametersChange(t){return t.width!==this.streamParameters.width||t.height!==this.streamParameters.height}adjustProcessorForNewStreamParameters(t){return Se(this,void 0,void 0,function*(){this.streamParameters.width=t.width,this.streamParameters.height=t.height,yield this.canvasOpsManager.configureForStreamParameters(this.streamParameters),yield this.renderer.configure(this.streamParameters.width,this.streamParameters.height,this.effectConfig)})}destroy(){return Se(this,void 0,void 0,function*(){this.canvasVideoFrameBuffer.destroy(),this.fxLibScript&&this.fxLibScript.parentNode&&this.fxLibScript.parentNode.removeChild(this.fxLibScript),this.engineWorker&&(this.destroyedAssetsPromise=new YS.DeferredPromise,this.engineWorker.postMessage({msg:Y.WORKER_MSG.DESTROY_ASSETS_REQUEST}),yield this.destroyedAssetsPromise.getPromise(),this.engineWorker.postMessage({msg:Y.WORKER_MSG.CLOSE_WORKER_REQUEST})),this.logger.info("VideoFxProcessor destroyed.")})}manageSegmentationMask(t){return Se(this,void 0,void 0,function*(){try{if(this.segmentationRateManager.submitFrame(),this.segmentationRateManager.shouldApplySegmentation()){this.segmentationRateManager.startSegmentation();let e=this.canvasOpsManager.getInferenceInputData(t);this.segmentationMask=yield this.generateSegmentationMask(e),this.segmentationRateManager.completeSegmentation()}}catch(e){throw this.logger.error(e.toString()),new Error("Can not properly manage the returned segmentation mask")}})}generateSegmentationMask(t){return Se(this,void 0,void 0,function*(){n.isSharedArrayBufferSupported?(this.sharedImageData.set(t.data),this.engineWorker.postMessage({msg:Y.WORKER_MSG.PERFORM_SEGMENTATION_SAB_REQUEST,payload:this.sharedImageBuffer})):this.engineWorker.postMessage({msg:Y.WORKER_MSG.PERFORM_SEGMENTATION_REQUEST,payload:t},[t.data.buffer]);try{return yield this.segmentationRequestPromise.getPromise()}catch(e){throw this.logger.error(e.toString()),new Error("Segmentation mask could not be generated")}})}cloneConfigFrom(t){return{backgroundBlur:{isEnabled:t.backgroundBlur.isEnabled,strength:t.backgroundBlur.strength},backgroundReplacement:{isEnabled:t.backgroundReplacement.isEnabled,backgroundImageURL:t.backgroundReplacement.backgroundImageURL,defaultColor:t.backgroundReplacement.defaultColor}}}setVideoFxSpec(t){t.paths&&(this.videoFxSpec.paths=t.paths)}setEffectConfig(t){return Se(this,void 0,void 0,function*(){if(this.sameVideoFxConfig(t,this.effectConfig))return;let e=this.cloneConfigFrom(t);try{yield this.validateEffectConfig(e)}catch(i){throw this.logger.error(i.toString()),new Error("Provided effect config is invalid, not updating VideoFxProcessor")}e.backgroundReplacement.isEnabled&&(yield this.canvasOpsManager.loadReplacementBackground(e),yield this.renderer.setBackgroundReplacementCanvas(this.canvasOpsManager.getBackgroundReplacementCanvas())),yield this.renderer.configure(this.streamParameters.width,this.streamParameters.height,e),this.effectConfig=e,!this.effectConfig.backgroundBlur.isEnabled&&!this.effectConfig.backgroundReplacement.isEnabled?this.process=this.noOpProcess:this.process=this.fxProcess,this.logger.info(`VideoFxProcessor effect configuration updated to: ${JSON.stringify(this.effectConfig)}`),this.eventController&&this.publishVideoFxConfigEvent()})}validateEffectConfig(t){return Se(this,void 0,void 0,function*(){if(t.backgroundBlur.isEnabled&&t.backgroundReplacement.isEnabled)throw new Error("Invalid VideoFx configuration: Background Blur and Background Replacement can not both be enabled");t.backgroundReplacement.isEnabled&&(yield this.validateReplacementConfig(t))})}validateReplacementConfig(t){return Se(this,void 0,void 0,function*(){if(t.backgroundReplacement.backgroundImageURL&&t.backgroundReplacement.defaultColor)throw new Error("Invalid VideoFx configuration: Background Replacement can not have both an image URL and default color");if(!t.backgroundReplacement.backgroundImageURL&&!t.backgroundReplacement.defaultColor)throw new Error("Invalid VideoFx configuration: Background Replacement image URL and default can not both be null/undefined");try{t.backgroundReplacement.backgroundImageURL&&(yield this.canvasOpsManager.loadImage(t.backgroundReplacement.backgroundImageURL))}catch(i){throw this.logger.error(i.toString()),new Error("Invalid VideoFx configuration: backgroundImageURL failed to load")}let e=t.backgroundReplacement.defaultColor;if(e&&e!=="black"&&e!=="#000000"&&e!=="#000"){if(e.includes("#")&&!new RegExp(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/).test(e))throw new Error(`Invalid hexadecimal color code for default replacement background: ${e}`);let r=document.createElement("canvas").getContext("2d"),o=r.fillStyle;if(r.fillStyle=e,r.fillStyle===o)throw new Error(`Invalid color for default replacement background: ${e}`)}})}validateProcessingBudgetPerFrame(t){if(t<Y.RESOURCE_CONSTRAINTS.MIN_PROCESSING_BUDGET||t>Y.RESOURCE_CONSTRAINTS.MAX_PROCESSING_BUDGET)throw new Error(`Invalid resource constraint: cycle percentage must be within range of ${Y.RESOURCE_CONSTRAINTS.MIN_PROCESSING_BUDGET} and ${Y.RESOURCE_CONSTRAINTS.MAX_PROCESSING_BUDGET}`)}loadAssets(){return Se(this,void 0,void 0,function*(){this.logger.info("Loading required assets for the VideoFxProcessor");try{let t=this.getVideoFxAssetParams();yield this.loadEngineWorker(t),yield this.buildEngine(t),yield this.loadFxLib(t),this.renderer=constructRenderer(Y.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,Y.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS,this.effectConfig,this.outputCanvas)}catch(t){throw this.logger.error(t.toString()),new Error("Failed to load necessary assets for the VideoFxProcessor")}this.logger.info("Finished loading of essential VideoFxProcessor assets.")})}getVideoFxAssetParams(){let t=OV.getDefaultAssetSpec();return{assetGroup:t.assetGroup,revisionID:t.revisionID,sdk:encodeURIComponent(iI.default.sdkVersion),ua:encodeURIComponent(iI.default.sdkUserAgentLowResolution)}}getPathFromVideoFxAssetParams(t,e){let i=new URL(t);for(let[r,o]of Object.entries(e))if(o!==void 0){let s=encodeURIComponent(r),d=encodeURIComponent(o);i.searchParams.set(s,d)}return i.toString()}loadEngineWorker(t){return Se(this,void 0,void 0,function*(){try{let e=this.getPathFromVideoFxAssetParams(this.videoFxSpec.paths.cdnBasePath+this.videoFxSpec.paths.workerPath,t);this.engineWorker=yield kV.loadWorker(e,"VideoFxEngineWorker",{},null),this.logger.info("Successfully loaded the VideoFxProcessor's engine worker"),this.engineWorker.addEventListener("message",i=>this.engineWorkerReceiver(i))}catch(e){throw this.logger.error(e.toString()),new Error("Failed to load the VideoFxProcessor's engine worker")}})}buildEngine(t){return Se(this,void 0,void 0,function*(){this.buildEnginePromise=new YS.DeferredPromise,this.engineWorker.postMessage({msg:Y.WORKER_MSG.BUILD_ENGINE_REQUEST,payload:{cdnBasePath:this.videoFxSpec.paths.cdnBasePath,sdkVersioningParams:t}});try{yield this.buildEnginePromise.getPromise()}catch(e){throw this.logger.error(e.toString()),new Error("Failed to instantiate the VideoFxEngine")}})}loadFxLib(t){return Se(this,void 0,void 0,function*(){let e=this.getPathFromVideoFxAssetParams(this.videoFxSpec.paths.cdnBasePath+this.videoFxSpec.paths.fxLibPath,t),i={method:"GET",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"no-referrer"};try{let r=yield TV.fetchWithBehavior(e,i,{});if(!r.ok)throw new Error("Fetch failed.");let o=window.URL.createObjectURL(yield r.blob());yield new Promise((s,d)=>{this.fxLibScript=document.createElement("script"),this.fxLibScript.setAttribute("src",o),this.fxLibScript.setAttribute("type","module"),this.fxLibScript.setAttribute("async","false"),this.fxLibScript.addEventListener("load",s),this.fxLibScript.addEventListener("error",d),document.body.appendChild(this.fxLibScript)})}catch(r){throw this.logger.error(r.toString()),new Error("Failed to load the fxlib")}})}getEffectConfig(){return this.cloneConfigFrom(this.effectConfig)}engineWorkerReceiver(t){let e=t.data;switch(e.msg){case Y.WORKER_MSG.BUILD_ENGINE_RESPONSE:this.settleEngineBuildPromise(e.payload);break;case Y.WORKER_MSG.PERFORM_SEGMENTATION_RESPONSE:this.settleSegmentationPromise(e.payload.output);break;case Y.WORKER_MSG.PERFORM_SEGMENTATION_SAB_RESPONSE:this.settleSegmentationPromiseSAB();break;case Y.WORKER_MSG.DESTROY_ASSETS_RESPONSE:this.destroyedAssetsPromise.resolvePromise();break;default:this.logger.info(`VideoFx worker received unknown event msg: ${JSON.stringify(e)}`);break}}settleEngineBuildPromise(t){t!==Y.SEGMENTATION_MODEL.LOAD_SUCCESS?this.buildEnginePromise.rejectPromise(new Error("Failed to build VideoFxProcessor's engine")):(this.logger.info("Successfully built the VideoFxEngine"),this.buildEnginePromise.resolvePromise())}settleSegmentationPromise(t){t?this.segmentationRequestPromise.resolveAndReplacePromise(t):this.segmentationRequestPromise.rejectAndReplacePromise(new Error("Failed to perform a segmentation on the input image"))}settleSegmentationPromiseSAB(){try{let t=new ImageData(new Uint8ClampedArray(this.sharedImageData),Y.SEGMENTATION_MODEL.WIDTH_IN_PIXELS,Y.SEGMENTATION_MODEL.HEIGHT_IN_PIXELS);this.segmentationRequestPromise.resolveAndReplacePromise(t)}catch{this.segmentationRequestPromise.rejectAndReplacePromise(new Error("Failed to perform a segmentation with a shared array buffer on the input image"))}}setToNoOpProcess(){this.process=this.noOpProcess}static isSupported(t=new CV.default,e=!0){return Se(this,void 0,void 0,function*(){let i=!0,r=(d,l)=>{d&&(t.info(l),i=!1)};r(typeof globalThis>"u","Browser does not have globalThis."),r(!tI.supportsWorker(globalThis,t),"Browser does not support web workers."),r(!tI.supportsWASM(globalThis,t),"Browser does not support wasm."),r(!document.createElement("canvas").getContext("webgl2"),"Browser does not support webgl.");let o=new IV.default;r(!o.isVideoFxSupportedBrowser(),"Browser is unsupported for VideoFxProcessor");let s=()=>Se(this,void 0,void 0,function*(){if(e)try{let d=new n(t);yield d.loadAssets(),yield d.destroy()}catch{return t.info("Browser environment is unable to access the required external assets."),Promise.resolve(!1)}return Promise.resolve(!0)});return Promise.resolve(i?yield s():!1)})}static create(t,e,i=Y.RESOURCE_CONSTRAINTS.DEFAULT_PROCESSING_BUDGET_PER_FRAME,r){return Se(this,void 0,void 0,function*(){let o=new n(t,i);r&&o.setVideoFxSpec(r);try{return yield o.loadAssets(),yield o.setEffectConfig(e),o}catch(s){throw t.error(s.toString()),o.setToNoOpProcess(),new Error("VideoFxProcessor built with support for only NoOp processing")}})}setEventController(t){this.eventController?this.eventController=t:(this.eventController=t,this.publishVideoFxConfigEvent())}publishVideoFxConfigEvent(){let t={backgroundBlurEnabled:this.effectConfig.backgroundBlur.isEnabled.toString(),backgroundBlurStrength:this.effectConfig.backgroundBlur.strength,backgroundReplacementEnabled:this.effectConfig.backgroundReplacement.isEnabled.toString(),backgroundFilterVersion:2};this.eventController.publishEvent("backgroundFilterConfigSelected",t)}sameVideoFxConfig(t,e){return t.backgroundBlur.isEnabled===e.backgroundBlur.isEnabled&&t.backgroundBlur.strength===e.backgroundBlur.strength&&t.backgroundReplacement.backgroundImageURL===e.backgroundReplacement.backgroundImageURL&&t.backgroundReplacement.defaultColor===e.backgroundReplacement.defaultColor&&t.backgroundReplacement.isEnabled===e.backgroundReplacement.isEnabled}};$n.default=Hc;Hc.isSharedArrayBufferSupported=typeof SharedArrayBuffer<"u"});var sI=g(yi=>{"use strict";var ty=yi&&yi.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(yi,"__esModule",{value:!0});yi.decideModel=yi.measureAndDecideExecutionApproach=void 0;var MV=Ii(),ey=Wt(),RV=3,DV=2.5,xV=2.63,VV=.6,NV=.65,LV=.5,BV=.7,rI={wasm:{noSupport:.07,inline:{c100:1,c50:.36,c20:.16,c10:.07},worker:{c100:.5,c50:.18,c20:.08,c10:.06}},simd:{noSupport:.1,inline:{c100:1,c50:.43,c20:.3,c10:.2},worker:{c100:.5,c50:.21,c20:.15,c10:.1}}},Wc=class{constructor(t,e){this.fetchConfig=t,this.logger=e;let i=`${t.paths.workers}estimator-v1.js`;this.fetchBehavior={headers:t.headers,escapedQueryString:t.escapedQueryString},this.worker=(0,MV.loadWorker)(i,"VoiceFocusEstimator",this.fetchBehavior,e)}roundtrip(t,e,i){return new Promise((r,o)=>{this.worker.then(s=>{let d;d=l=>{let{message:c,key:a}=l.data;c===e&&a===i&&(s.removeEventListener("message",d),r(l.data))},s.addEventListener("message",d),s.postMessage(t)}).catch(s=>{var d;(d=this.logger)===null||d===void 0||d.error("Failed to load worker.",s),o(s)})})}supportsSIMD(t){let e="simd",i=t||`${this.fetchConfig.paths.wasm}simd-v1.wasm`,r={message:"supports-simd",fetchBehavior:this.fetchBehavior,path:i,key:e};return this.roundtrip(r,"simd-support",e).then(o=>o.supports)}measure(t,e){let i=`${this.fetchConfig.paths.wasm}bench-v1.wasm`,r=`${this.fetchConfig.paths.wasm}bench-v1_simd.wasm`,o=t?r:i,s=`bench:${t}`,d={message:"measure",fetchBehavior:this.fetchBehavior,budget:e,path:o,key:s};return this.roundtrip(d,"measurement",s).then(l=>{if(l.measurement)return l.measurement;throw new Error("Failed to measure.")})}stop(){this.worker.then(t=>{var e;(e=this.logger)===null||e===void 0||e.debug("Stopping estimator worker."),t.terminate()}).catch(t=>{})}},FV=(n,t)=>n===1?VV:t==="quality"?NV*n:LV*n,UV=({supportsSIMD:n,supportsSAB:t,duration:e,executionPreference:i="auto",simdPreference:r,variantPreference:o="auto",namePreference:s="default",usagePreference:d,executionQuantaPreference:l=RV},c=rI,a)=>{let p=r==="force"||r!=="disable"&&n,m=e!==-1,S=m?(p?DV:xV)/e:0,C=p?c.simd:c.wasm,I=m?FV(l,d)*S:0,_=m?BV*S:0,k=s,T=O=>({supported:!1,reason:O});if(m){if(S<C.noSupport)return T(`Performance score ${S} worse than threshold ${C.noSupport}.`)}else if(i==="auto"||o==="auto")return T(`Missing explicit execution (${i}) or variant (${o}) preference, but no scoring performed.`);a?.debug(`Bench duration ${e} yields inline score ${I} and worker score ${_}.`);let w=(O,A,P)=>({supported:!0,useSIMD:p,processor:O,executionApproach:A,variant:P,executionQuanta:A==="inline"?l:void 0,name:k}),D=(O,A,P)=>A!=="auto"?!m||O>P[A]?A:"failed":O>P.c100?"c100":O>P.c50?"c50":O>P.c20?"c20":O>P.c10?"c10":"failed",L=O=>{switch(O||"auto"){case"auto":{let A=L("inline"),P=L("worker");return a?.debug(`Reducing auto preference: ${JSON.stringify(A)} vs ${JSON.stringify(P)}`),A.supported===!1||P.supported===!1?P:A.variant===P.variant||A.variant==="c50"?A:P}case"worker":return(0,ey.supportsSharedArrayBuffer)(globalThis,window,a)?L("worker-sab"):L("worker-postMessage");case"inline":{let A=D(I,o,C.inline);return A==="failed"?T(`Performance score ${I} not sufficient for inline use with variant preference ${o}.`):w("voicefocus-inline-processor","inline",A)}case"worker-sab":{if(!t){let P="Requested worker-sab but no SharedArrayBuffer support.";return a?.warn(P),{supported:!1,reason:P}}let A=D(_,o,C.worker);return A==="failed"?T(`Performance score ${_} not sufficient for worker use with variant preference ${o}.`):w("voicefocus-worker-sab-processor","worker-sab",A)}case"worker-postMessage":{let A=D(_,o,C.worker);if(A==="failed")return T(`Performance score ${_} not sufficient for worker use.`);if(k==="ns_es"){let P="Requested echo suppression but postMessage executor does not support it.";return a?.warn(P),{supported:!1,reason:P}}return w("voicefocus-worker-postMessage-processor","worker-postMessage",A)}}};return L(i)},oI=(n,t,e,i)=>ty(void 0,void 0,void 0,function*(){let r={supportsSIMD:n,supportsSAB:(0,ey.supportsSharedArrayBuffer)(globalThis,window,e),duration:-1};if(n)return e?.info("Supports SIMD: true (force)"),r;let o=!i,s=i||new Wc(t,e);try{let d=!(0,ey.isOldChrome)(window,e)&&(yield s.supportsSIMD());return e?.info(`Supports SIMD: ${d} (force: ${n})`),r.supportsSIMD=d,r}finally{o&&s.stop()}}),qV=(n,t,e,i)=>ty(void 0,void 0,void 0,function*(){let r=new Wc(t,i);try{let o=yield oI(n,t,i,r);if(o.supportsSIMD)try{return o.duration=yield r.measure(!0,e),i?.info("SIMD timing:",o.duration),o}catch{i?.warn("Failed SIMD estimation; falling back to non-SIMD."),o.supportsSIMD=!1}return o.duration=yield r.measure(!1,e),i?.info("No-SIMD timing:",o.duration),o}catch(o){throw i?.error("Could not feature check.",o),o}finally{r.stop()}}),HV=(n,t,e,i=rI)=>ty(void 0,void 0,void 0,function*(){let r=n.executionPreference,{usagePreference:o,variantPreference:s,namePreference:d,simdPreference:l,estimatorBudget:c,executionQuantaPreference:a}=n;o==="interactivity"&&r!=="inline"&&(e?.debug(`Overriding execution preference ${r} to reflect interactivity preference.`),r="inline");let u=l==="force",p=s!=="auto",m=r!=="auto",S;try{p&&m?S=yield oI(u,t,e):S=yield qV(u,t,c,e)}catch(C){throw e?.error("Could not load estimator.",C),new Error("Could not load Voice Focus estimator.")}return UV(Object.assign(Object.assign({},S),{simdPreference:l,executionPreference:r,variantPreference:s,namePreference:d,usagePreference:o,executionQuantaPreference:a}),i,e)});yi.measureAndDecideExecutionApproach=HV;var jV=({category:n,name:t,variant:e,simd:i,url:r})=>`${n}-${t}-${e}-v1${i?"_simd":""}`;yi.decideModel=jV});var $c=g(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.VoiceFocusAudioWorkletNode=void 0;var iy=class extends(typeof globalThis<"u"&&globalThis.AudioWorkletNode||class{}){};zc.VoiceFocusAudioWorkletNode=iy});var aI=g(La=>{"use strict";var Kc=La&&La.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(La,"__esModule",{value:!0});var WV=Wt(),zV=$c(),$V=5*1e3,KV=5*1e3,ny=class extends zV.VoiceFocusAudioWorkletNode{constructor(t,e){super(t,e.processor,e),this.cpuWarningCount=0,this.metrics={latencyMillisAverage:0,snr:{average:0,averageActive:0,variance:0,varianceActive:0},drr:{average:0,variance:0,averageActive:0,varianceActive:0},vad:{average:0},cpu:{lateInvoke:0,longInvoke:0}},this.channelCountMode="explicit",this.channelCount=1;let{modelURL:i,worker:r,fetchBehavior:o,logger:s,delegate:d}=e;this.logger=s,this.port.onmessage=this.onProcessorMessage.bind(this),this.delegate=d,s&&s.debug("VoiceFocusInlineNode:",i),this.worker=r,this.worker.onmessage=this.onWorkerMessage.bind(this);let l=(0,WV.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:l,key:"model",fetchBehavior:o,path:i})}onModuleBufferLoaded(t,e){this.port.postMessage({message:"module-buffer",buffer:t,key:e})}onModuleLoaded(t,e){this.port.postMessage({message:"module",module:t,key:e})}enable(){return Kc(this,void 0,void 0,function*(){this.port.postMessage({message:"enable"})})}disable(){return Kc(this,void 0,void 0,function*(){this.port.postMessage({message:"disable"})})}setMode(t){return Kc(this,void 0,void 0,function*(){this.port.postMessage({message:"set-mode",mode:t})})}stop(){var t;return Kc(this,void 0,void 0,function*(){this.port.postMessage({message:"stop"});try{(t=this.worker)===null||t===void 0||t.terminate()}catch(e){console.error("failed to terminate worker:",e)}this.disconnect()})}onProcessorMessage(t){var e,i,r,o,s,d;let{data:l}=t,{message:c}=l;switch(c){case"cpu":let{reason:a,count:u}=l;a&&u&&(this.metrics.cpu=Object.assign(Object.assign({},this.metrics.cpu),{[a]:u+this.metrics.cpu[a]})),this.cpuWarningCount++;let p=Date.now(),m=this.cpuWarningLastTriggered||p,S=Math.abs(p-m);(!this.cpuWarningLastTriggered||S>$V)&&((e=this.logger)===null||e===void 0||e.warn(`CPU warning (count: ${this.cpuWarningCount}):`,c),this.cpuWarningCount=0,this.cpuWarningLastTriggered=p),(i=this.delegate)===null||i===void 0||i.onCPUWarning();break;case"metrics":let{metrics:C}=l;if(!C){(r=this.logger)===null||r===void 0||r.warn("Got metrics message but no metrics payload");break}if(this.metrics=Object.assign(Object.assign({},this.metrics),C),this.logger){let I=Date.now();I-((o=this.metricsLastRecorded)!==null&&o!==void 0?o:0)>KV&&((s=this.logger)===null||s===void 0||s.debug("Contact metrics:",this.metrics),this.metricsLastRecorded=I)}break;default:(d=this.logger)===null||d===void 0||d.debug("Ignoring processor message.")}}getModelMetrics(){return this.metrics}onWorkerMessage(t){let e=t.data;switch(e.message){case"module-buffer":if(!e.buffer||!e.key)return;this.onModuleBufferLoaded(e.buffer,e.key);break;case"module":if(!e.module||!e.key)return;this.onModuleLoaded(e.module,e.key);break;case"stopped":this.worker&&this.worker.terminate();break;default:return}}};La.default=ny});var dI=g(Ba=>{"use strict";var Gc=Ba&&Ba.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(Ba,"__esModule",{value:!0});var GV=Wt(),JV=$c(),ro={ready:0,enabled:1},ry={disabled:0,enabled:1,stopped:2},oy=class extends JV.VoiceFocusAudioWorkletNode{constructor(t,e){super(t,e.processor,e),this.channelCountMode="explicit",this.channelCount=1;let{modelURL:i,resamplerURL:r,worker:o,fetchBehavior:s,delegate:d}=e;this.delegate=d,this.worker=o,this.worker.onmessage=this.onWorkerMessage.bind(this),this.port.onmessage=this.onProcessorMessage.bind(this);let{enabled:l,supportFarendStream:c}=e.processorOptions;this.worker.postMessage({message:"init",approach:"sab",frames:t.sampleRate===16e3?160:480,enabled:l,model:i,supportFarendStream:c});let a=(0,GV.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:a,key:"resampler",fetchBehavior:s,path:r})}enable(){return Gc(this,void 0,void 0,function*(){this.state?(Atomics.store(this.state,ro.enabled,ry.enabled),Atomics.notify(this.state,ro.ready,1)):this.worker.postMessage({message:"enable"})})}disable(){return Gc(this,void 0,void 0,function*(){this.state?(Atomics.store(this.state,ro.enabled,ry.disabled),Atomics.notify(this.state,ro.ready,1)):this.worker.postMessage({message:"disable"})})}setMode(t){return Gc(this,void 0,void 0,function*(){this.port.postMessage({message:"set-mode",mode:t})})}stop(){return Gc(this,void 0,void 0,function*(){if(this.state)Atomics.store(this.state,ro.enabled,ry.stopped),Atomics.notify(this.state,ro.ready,1);else try{this.worker.postMessage({message:"stop"})}catch{}this.disconnect()})}getModelMetrics(){}onWorkerMessage(t){var e;let i=t.data;switch(i.message){case"ready":if(!i.shared)throw new Error("No shared state.");this.state=new Int32Array(i.shared.state),this.port.postMessage(i);break;case"stopped":this.worker.terminate();break;case"module-buffer":case"module":this.port.postMessage(i);break;case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"processing":this.port.postMessage(i);break;default:return}}onProcessorMessage(t){var e;let i=t.data;switch(i.message){case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"prepare-for-frames":this.worker.postMessage(i);break;default:}}};Ba.default=oy});var cI=g(Fa=>{"use strict";var Jc=Fa&&Fa.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(Fa,"__esModule",{value:!0});var QV=Wt(),XV=$c(),sy=class extends XV.VoiceFocusAudioWorkletNode{constructor(t,e){super(t,e.processor,e),this.channelCountMode="explicit",this.channelCount=1;let{modelURL:i,audioBufferURL:r,worker:o,fetchBehavior:s,delegate:d}=e;this.delegate=d,this.worker=o,this.worker.onmessage=this.onWorkerMessage.bind(this),this.port.onmessage=this.onProcessorMessage.bind(this);let{enabled:l,agc:c,supportFarendStream:a}=e.processorOptions;this.worker.postMessage({message:"init",approach:"postMessage",frames:t.sampleRate===16e3?160:480,enabled:l,agc:c,fetchBehavior:s,model:i,supportFarendStream:a});let u=(0,QV.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:u,key:"buffer",fetchBehavior:s,path:r})}enable(){return Jc(this,void 0,void 0,function*(){this.worker.postMessage({message:"enable"})})}disable(){return Jc(this,void 0,void 0,function*(){this.worker.postMessage({message:"disable"})})}setMode(t){return Jc(this,void 0,void 0,function*(){this.port.postMessage({message:"set-mode",mode:t})})}stop(){return Jc(this,void 0,void 0,function*(){try{this.worker.postMessage({message:"stop"})}catch{}this.disconnect()})}getModelMetrics(){}onWorkerMessage(t){var e;let i=t.data;switch(i.message){case"ready":this.port.postMessage({message:"ready",shared:i.shared},i.shared?Object.values(i.shared):[]);break;case"data":if(!i.buffer)return;this.port.postMessage({message:"data",buffer:i.buffer},[i.buffer]);break;case"stopped":this.worker.terminate();break;case"module-buffer":case"module":this.port.postMessage(i);break;case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"processing":this.port.postMessage(i);break;default:return}}onProcessorMessage(t){var e;let i=t.data;switch(i.message){case"data":if(!i.buffer)return;this.worker.postMessage({message:"data",buffer:i.buffer},[i.buffer]);break;case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"prepare-for-frames":this.worker.postMessage(i);break;default:return}}};Fa.default=sy});var vI=g(kt=>{"use strict";var oo=kt&&kt.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})};Object.defineProperty(kt,"__esModule",{value:!0});kt.getAudioInput=kt.createAudioContext=kt.VoiceFocus=void 0;var pI=sI(),so=ed(),ZV=Ii(),Kn=Wt(),YV=aI(),eN=dI(),tN=cI(),iN={useVoiceFocusAGC:!1,useBuiltInAGC:!0},mI=iN,lI="stable-v1",Qc="https://static.sdkassets.chime.aws",uI={processors:`${Qc}/processors/`,workers:`${Qc}/workers/`,wasm:`${Qc}/wasm/`,models:`${Qc}/wasm/`},nN={latencyHint:0},gI={channelCount:1,echoCancellation:!0,googEchoCancellation:!0,noiseSuppression:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googTypingNoiseDetection:!1},rN=Object.assign(Object.assign({},gI),{autoGainControl:!0,googAutoGainControl:!0,googAutoGainControl2:!0}),oN=Object.assign(Object.assign({},gI),{autoGainControl:!1,googAutoGainControl:!1,googAutoGainControl2:!1}),sN={"voicefocus-worker-sab-processor":{file:"worklet-worker-sab-processor-v1.js",node:eN.default},"voicefocus-worker-postMessage-processor":{file:"worklet-worker-postMessage-processor-v1.js",node:tN.default},"voicefocus-inline-processor":{file:"worklet-inline-processor-v1.js",node:YV.default}},fI=(n,t)=>{if(n!==void 0&&!(0,so.isValidAssetGroup)(n))throw new Error(`Invalid asset group ${n}`);if(t!==void 0&&!(0,so.isValidRevisionID)(t))throw new Error(`Invalid revision ID ${t}`)},aN=(n,t)=>{let e;if(t.useBuiltInAGC?e=rN:e=oN,!n)return{audio:e};if(!n.audio)return n;if(n.video)throw new Error("Not adding Voice Focus to multi-device getUserMedia call.");return Object.assign(Object.assign({},n),{audio:n.audio===!0?e:Object.assign(Object.assign({},n.audio),e)})},hI=(n,t)=>`${t.models}${(0,pI.decideModel)(n)}.wasm`,Ua=class n{constructor(t,e,i,r,o,s){this.processorURL=e,this.nodeConstructor=i,this.nodeOptions=r,this.executionQuanta=o,this.logger=s,this.internal={worker:t,isDestroyed:!1}}getModelMetrics(){var t;return(t=this.internal.voiceFocusNode)===null||t===void 0?void 0:t.getModelMetrics()}enable(){var t;(t=this.internal.voiceFocusNode)===null||t===void 0||t.enable()}disable(){var t;(t=this.internal.voiceFocusNode)===null||t===void 0||t.disable()}setMode(t){var e;(e=this.internal.voiceFocusNode)===null||e===void 0||e.setMode(t)}destroy(){var t,e,i,r,o;return oo(this,void 0,void 0,function*(){let{worker:s,isDestroyed:d,voiceFocusNode:l,destinationNode:c,sourceNode:a,audioContext:u}=this.internal;if(d){(t=this.logger)===null||t===void 0||t.debug("Voice Focus is already destroyed");return}try{s?.terminate(),a?.disconnect(),c?.disconnect(),yield Promise.all([(e=u?.close().catch(p=>p))!==null&&e!==void 0?e:yield Promise.resolve(),(i=l?.stop().catch(p=>p))!==null&&i!==void 0?i:yield Promise.resolve()]),this.internal.audioContext=void 0,this.internal.voiceFocusNode=void 0,this.internal.sourceNode=void 0,this.internal.destinationNode=void 0,(r=this.logger)===null||r===void 0||r.debug("Voice Focus destroyed successfully")}catch(p){throw(o=this.logger)===null||o===void 0||o.error("Error while destroying the Voice Focus instance: ",p),p}finally{this.internal.isDestroyed=!0}})}static isSupported(t,e){let{fetchBehavior:i,logger:r}=e||{};if(typeof globalThis>"u")return r?.debug("Browser does not have globalThis."),Promise.resolve(!1);if(!(0,Kn.supportsAudioWorklet)(globalThis,r))return r?.debug("Browser does not support Audio Worklet."),Promise.resolve(!1);if(!(0,Kn.supportsWASM)(globalThis,r))return r?.debug("Browser does not support WASM."),Promise.resolve(!1);(0,Kn.supportsWASMStreaming)(globalThis,r)||r?.debug("Browser does not support streaming WASM compilation.");let{assetGroup:o=lI,revisionID:s,paths:d=uI}=t||{};fI(o,s);let l=s?{revisionID:s}:{assetGroup:o},c=(0,so.addQueryParams)(i,l),a=Object.assign(Object.assign({},c),{paths:d});return(0,Kn.supportsVoiceFocusWorker)(globalThis,a,r)}static mungeExecutionPreference(t,e){let i=t===void 0||t==="auto";if((0,Kn.isSafari)(globalThis)){if(i||t==="inline")return"inline";if(!i)throw new Error(`Unsupported execution preference ${t}`)}if(t==="worker-sab"&&!(0,Kn.supportsSharedArrayBuffer)(globalThis,globalThis,e))throw new Error(`Unsupported execution preference ${t}`);return t||"auto"}static configure(t,e){return oo(this,void 0,void 0,function*(){let{fetchBehavior:i,preResolve:r,logger:o}=e||{},{category:s="voicefocus",name:d="default",variant:l="auto",assetGroup:c=lI,revisionID:a,simd:u="detect",mode:p="ns",executionPreference:m="auto",executionQuantaPreference:S,usagePreference:C="interactivity",estimatorBudget:I=100,paths:_=uI,thresholds:k}=t||{};if(o?.debug("Configuring Voice Focus with spec",t),s!==void 0&&s!=="voicefocus")throw new Error(`Unrecognized category ${s}`);if(d!==void 0&&d!=="default"&&d!=="ns_es")throw new Error(`Unrecognized feature name ${d}`);if(l!==void 0&&!["auto","c100","c50","c20","c10"].includes(l))throw new Error(`Unrecognized feature variant ${l}`);if(S!==void 0&&![1,2,3].includes(S))throw new Error(`Unrecognized execution quanta preference ${S}`);if(fI(c,a),u!==void 0&&!["detect","force","disable"].includes(u))throw new Error(`Unrecognized SIMD option ${u}`);if(m!==void 0&&!["auto","inline","worker","worker-sab","worker-postMessage"].includes(m))throw new Error(`Unrecognized execution preference ${m}`);if(C!==void 0&&!["quality","interactivity"].includes(C))throw new Error(`Unrecognized usage preference ${C}`);let T={executionPreference:this.mungeExecutionPreference(m,o),usagePreference:C,executionQuantaPreference:S,variantPreference:l,namePreference:d,simdPreference:u,estimatorBudget:I},w=a?{revisionID:a}:{assetGroup:c},D=(0,so.addQueryParams)(i,w),L=Object.assign({paths:_},D),O=yield(0,pI.measureAndDecideExecutionApproach)(T,L,o,k);if(O.supported===!1)return{supported:!1,reason:O.reason};o?.info("Decided execution approach",O);let{useSIMD:A,processor:P,variant:V,executionQuanta:U}=O,fe={category:s||"voicefocus",name:d||"default",mode:p,variant:V,simd:A};if(r){let dt=hI(fe,_);fe.url=yield(0,so.resolveURL)(dt,D)}return{fetchConfig:L,model:fe,processor:P,executionQuanta:U,supported:!0}})}static init(t,{delegate:e,preload:i=!0,logger:r}){return oo(this,void 0,void 0,function*(){if(t.supported===!1)throw new Error("Voice Focus not supported. Reason: "+t.reason);let{model:o,processor:s,fetchConfig:d,executionQuanta:l}=t,{simd:c,name:a,mode:u}=o,{paths:p}=d;if(s!=="voicefocus-inline-processor"&&s!=="voicefocus-worker-postMessage-processor"&&s!=="voicefocus-worker-sab-processor")throw new Error(`Unknown processor ${s}`);let m=o.url||hI(o,p);r?.debug(`Using model URL ${m}.`);let S=`${p.wasm}audio_buffer-v1${c?"_simd":""}.wasm`,C=`${p.wasm}resampler-v1${c?"_simd":""}.wasm`,I=`${p.workers}worker-v1.js`,{file:_,node:k}=sN[s],T=`${p.processors}${_}`,w=yield(0,ZV.loadWorker)(I,"VoiceFocusWorker",d,r);if(i){r?.debug("Preloading",m);let A=(0,Kn.supportsWASMPostMessage)(globalThis)?"get-module":"get-module-buffer";w.postMessage({message:A,preload:!0,key:"model",fetchBehavior:d,path:m})}let L={processor:s,worker:w,audioBufferURL:S,resamplerURL:C,fetchBehavior:d,modelURL:m,delegate:e,logger:r,numberOfInputs:a==="ns_es"?2:1,mode:u},O=new n(w,T,k,L,l,r);return Promise.resolve(O)})}createNode(t,e){var i;if(this.internal.isDestroyed)throw new Error("Unable to create node because VoiceFocus worker has been destroyed.");let{voiceFocusSampleRate:r=t.sampleRate===16e3?16e3:48e3,enabled:o=!0,agc:s=mI}=e||{},d=e?.es,l={voiceFocusSampleRate:r,enabled:o,sendBufferCount:10,prefill:6,agc:s,executionQuanta:this.executionQuanta,supportFarendStream:d,mode:this.nodeOptions.mode},c=(0,so.withQueryString)(this.processorURL,(i=this.nodeOptions)===null||i===void 0?void 0:i.fetchBehavior);return t.audioWorklet.addModule(c).then(()=>new this.nodeConstructor(t,Object.assign(Object.assign({},this.nodeOptions),{processorOptions:l})))}applyToStream(t,e,i){return oo(this,void 0,void 0,function*(){if(this.internal.isDestroyed)throw new Error("Unable to apply stream because VoiceFocus worker has been destroyed");let r=e.createMediaStreamSource(t),o=yield this.applyToSourceNode(r,e,i),s=e.createMediaStreamDestination();return o.connect(s),this.internal=Object.assign(Object.assign({},this.internal),{voiceFocusNode:o,sourceNode:r,destinationNode:s,audioContext:e}),{node:o,source:r,destination:s,stream:s.stream}})}applyToSourceNode(t,e,i){return oo(this,void 0,void 0,function*(){let r=yield this.createNode(e,i);return t.connect(r),r})}};kt.VoiceFocus=Ua;var dN=(n=nN)=>new(window.AudioContext||window.webkitAudioContext)(n);kt.createAudioContext=dN;var cN=(n,t,e)=>oo(void 0,void 0,void 0,function*(){var i,r;let{constraints:o,spec:s,delegate:d,preload:l=!0,options:c}=t,{logger:a}=e,u=yield Ua.configure(s,e);if(!u.supported)return(i=e.logger)===null||i===void 0||i.warn("Voice Focus not supported; returning standard stream."),window.navigator.mediaDevices.getUserMedia(o);let p=yield Ua.init(u,{delegate:d,preload:l,logger:a}),m=((r=t.options)===null||r===void 0?void 0:r.agc)||mI,S=yield window.navigator.mediaDevices.getUserMedia(aN(o,m));return p.applyToStream(S,n,c).then(C=>C.stream)});kt.getAudioInput=cN});var SI=g(dy=>{"use strict";Object.defineProperty(dy,"__esModule",{value:!0});function Xc(n){return n.map(t=>typeof t=="object"?JSON.stringify(t):`${t}`).join(" ")}var ay=class{constructor(t){this.base=t}debug(...t){this.base.debug(Xc(t))}info(...t){this.base.info(Xc(t))}warn(...t){this.base.warn(Xc(t))}error(...t){this.base.error(Xc(t))}};dy.default=ay});var ly=g(Gn=>{"use strict";var at=Gn&&Gn.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},lN=Gn&&Gn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Gn,"__esModule",{value:!0});var uN=lN(pe()),cy=class n{constructor(t,e,i,r,o=!1,s=void 0,d=new uN.default,l=new Map,c=void 0,a=void 0){this.device=t,this.voiceFocus=e,this.delegate=i,this.nodeOptions=r,this.failed=o,this.node=s,this.browserBehavior=d,this.farEndStreamToAudioSourceNode=l,this.mixDestNode=c,this.mixSourceNode=a}getInnerDevice(){return this.device}mute(t){return at(this,void 0,void 0,function*(){this.node&&(t?yield this.node.disable():yield this.node.enable())})}stop(){return at(this,void 0,void 0,function*(){this.node&&(this.node.disconnect(),yield this.node.stop())})}chooseNewInnerDevice(t){return at(this,void 0,void 0,function*(){return this.device===t&&!fN(t)?this:new n(t,this.voiceFocus,this.delegate,this.nodeOptions,this.failed,this.node,this.browserBehavior,this.farEndStreamToAudioSourceNode,this.mixDestNode,this.mixSourceNode)})}intrinsicDevice(){return at(this,void 0,void 0,function*(){if(this.failed)return this.device;let t=this.nodeOptions.es,e={echoCancellation:!t,googEchoCancellation:!t,googEchoCancellation2:!t,noiseSuppression:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googNoiseSuppression2:!1},i;return this.nodeOptions&&this.nodeOptions.agc!==void 0?i=this.nodeOptions.agc.useBuiltInAGC:i=!0,e.autoGainControl=i,e.googAutoGainControl=i,e.googAutoGainControl2=i,this.device?typeof this.device=="string"?(this.browserBehavior.requiresNoExactMediaStreamConstraints()?e.deviceId=this.device:e.deviceId={exact:this.device},e):this.device.id?this.device:Object.assign(Object.assign({},this.device),e):e})}createAudioNode(t){var e,i;return at(this,void 0,void 0,function*(){if(((e=this.node)===null||e===void 0?void 0:e.context)===t)return{start:this.node,end:this.node};let o=Object.assign({enabled:!0,agc:{useVoiceFocusAGC:!1}},this.nodeOptions);try{if((i=this.node)===null||i===void 0||i.disconnect(),this.node=yield this.voiceFocus.createNode(t,o),this.nodeOptions.es){this.mixDestNode=new MediaStreamAudioDestinationNode(t,{channelCount:1,channelCountMode:"explicit"});for(let l of this.farEndStreamToAudioSourceNode.keys())this.assignFarEndStreamToAudioSourceNode(l);this.createMixSourceNode()}let s=this.node,d=this.node;return{start:s,end:d}}catch(s){throw this.failed=!0,this.delegate.onFallback(this,s),s}})}observeMeetingAudio(t){return at(this,void 0,void 0,function*(){if(!this.nodeOptions.es)return;t.addAudioMixObserver(this);let e=yield t.getCurrentMeetingAudioStream();e&&this.addFarEndStream(e)})}unObserveMeetingAudio(t){return at(this,void 0,void 0,function*(){if(!this.nodeOptions.es)return;t.removeAudioMixObserver(this);let e=yield t.getCurrentMeetingAudioStream();e&&this.removeFarendStream(e)})}addObserver(t){this.delegate.addObserver(t)}removeObserver(t){this.delegate.removeObserver(t)}addFarEndStream(t){return at(this,void 0,void 0,function*(){!this.nodeOptions.es||!t||this.farEndStreamToAudioSourceNode.has(t)||(this.node?this.assignFarEndStreamToAudioSourceNode(t):this.farEndStreamToAudioSourceNode.set(t,null))})}removeFarendStream(t){var e;return at(this,void 0,void 0,function*(){(e=this.farEndStreamToAudioSourceNode.get(t))===null||e===void 0||e.disconnect(),this.farEndStreamToAudioSourceNode.delete(t)})}meetingAudioStreamBecameActive(t){return at(this,void 0,void 0,function*(){this.addFarEndStream(t)})}meetingAudioStreamBecameInactive(t){return at(this,void 0,void 0,function*(){this.removeFarendStream(t)})}assignFarEndStreamToAudioSourceNode(t){let e=this.node.context.createMediaStreamSource(t);e.channelCount=1,e.channelCountMode="explicit",this.farEndStreamToAudioSourceNode.set(t,e),e.connect(this.mixDestNode,0)}createMixSourceNode(){this.mixSourceNode=this.node.context.createMediaStreamSource(this.mixDestNode.stream),this.mixSourceNode.channelCount=1,this.mixSourceNode.channelCountMode="explicit",this.mixSourceNode.connect(this.node,0,1)}};function fN(n){return n==="default"?!0:!n||typeof n!="object"?!1:"deviceId"in n&&n.deviceId==="default"||"id"in n&&n.id==="default"}Gn.default=cy});var yI=g(fy=>{"use strict";Object.defineProperty(fy,"__esModule",{value:!0});var uy=class{constructor(){this.observers=new Set}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}onFallback(t,e){var i;for(let r of this.observers)(i=r.voiceFocusFellBackToInnerStream)===null||i===void 0||i.call(r,t,e)}onCPUWarning(){var t;for(let e of this.observers)(t=e.voiceFocusInsufficientResources)===null||t===void 0||t.call(e)}};fy.default=uy});var _I=g(jt=>{"use strict";var bi=jt&&jt.__awaiter||function(n,t,e,i){function r(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function d(a){try{c(i.next(a))}catch(u){s(u)}}function l(a){try{c(i.throw(a))}catch(u){s(u)}}function c(a){a.done?o(a.value):r(a.value).then(d,l)}c((i=i.apply(n,t||[])).next())})},Yc=jt&&jt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(jt,"__esModule",{value:!0});jt.VoiceFocusDeviceTransformer=void 0;var hy=vI(),hN=ri(),py=Yc(Je()),bI=Yc(SI()),pN=Yc(ly()),mN=Yc(yI()),Zc=class n{constructor(t,{preload:e=!0,logger:i,fetchBehavior:r=n.defaultFetchBehavior()},o){this.spec=t,this.supported=!0,this.logger=i,this.vfLogger=i?new bI.default(i):void 0,this.preload=e,this.fetchBehavior=r,this.spec=n.augmentSpec(this.spec),o&&(this.configuration=Promise.resolve(o))}static isSupported(t,e){var i,r;let o=n.defaultFetchBehavior(),s=e?.logger?new bI.default(e.logger):void 0,d={fetchBehavior:o,logger:s};if(hN.isIFramed()){if(e?.allowIFrame===!1)return(i=e?.logger)===null||i===void 0||i.error("Amazon Voice Focus support check inside iframe: not supported."),Promise.resolve(!1);(r=e?.logger)===null||r===void 0||r.warn("Amazon Voice Focus support check inside iframe: not recommended.")}return hy.VoiceFocus.isSupported(n.augmentSpec(t),d)}static create(t={},e={},i,r,o){var s,d,l;return bi(this,void 0,void 0,function*(){r&&r.Meeting.Meeting&&(r=r.Meeting);let c=((l=(d=(s=r?.Meeting)===null||s===void 0?void 0:s.MeetingFeatures)===null||d===void 0?void 0:d.Audio)===null||l===void 0?void 0:l.EchoReduction)==="AVAILABLE",a=i&&i.supported===!0&&i.model.name==="ns_es"&&!c,u=t.name==="ns_es"&&!c;if(a||u)throw new Error("Echo Reduction requested but not enabled.");let p=new n(t,e,i);return yield p.init(),p})}static configure(t={},e={}){return bi(this,void 0,void 0,function*(){return new n(t,e,void 0).configure(!0)})}getConfiguration(){return this.configuration}isSupported(){return this.supported}createTransformDevice(t,e){return bi(this,void 0,void 0,function*(){if(this.supported)try{let[r,o]=yield this.allocateVoiceFocus(!0),s=Object.assign(Object.assign({},e),{es:this.spec.name==="ns_es"});return new pN.default(t,r,o,s)}catch{return}})}static destroyVoiceFocus(t){var e;return bi(this,void 0,void 0,function*(){(e=t?.vf)===null||e===void 0||e.destroy()})}static augmentSpec(t){return!t||!t.assetGroup&&!t.revisionID?Object.assign(Object.assign({},t),{assetGroup:n.currentSDKAssetGroup()}):t}configure(t=!1){return bi(this,void 0,void 0,function*(){let e={fetchBehavior:this.fetchBehavior,preResolve:t,logger:this.vfLogger};return hy.VoiceFocus.configure(this.spec,e)})}init(){var t;return bi(this,void 0,void 0,function*(){this.configuration||(this.configuration=this.configure());let e=yield this.configuration;if(!e.supported){this.supported=!1;return}this.pendingVoiceFocus=this.createVoiceFocus(e,this.preload);try{yield this.pendingVoiceFocus}catch(i){(t=this.logger)===null||t===void 0||t.error(`Unable to initialize Amazon Voice Focus: ${i}`),this.supported=!1}})}createVoiceFocus(t,e){return bi(this,void 0,void 0,function*(){let i=new mN.default;return this.vf=yield hy.VoiceFocus.init(t,{delegate:i,preload:e,logger:this.vfLogger}),[this.vf,i]})}allocateVoiceFocus(t){return bi(this,void 0,void 0,function*(){if(!this.supported)throw new Error("Not supported.");if(this.pendingVoiceFocus){let e=this.pendingVoiceFocus;return this.pendingVoiceFocus=void 0,e}return this.createVoiceFocus(yield this.configuration,t)})}static majorVersion(){return py.default.sdkVersion.match(/^[1-9][0-9]*\.(?:0|[1-9][0-9]*)/)[0]}static majorMinorVersion(){return py.default.sdkVersion.match(/^[1-9][0-9]*\.(?:0|(?:[1-9][0-9]*))\.(?:0|[1-9][0-9]*)/)[0]}static currentSDKAssetGroup(){let t=this.majorVersion();return t?`sdk-${t}`:"stable-v1"}static defaultFetchBehavior(){let t=n.majorMinorVersion()||"unknown",e=py.default.sdkUserAgentLowResolution;return{escapedQueryString:`sdk=${encodeURIComponent(t)}&ua=${encodeURIComponent(e)}`}}};jt.VoiceFocusDeviceTransformer=Zc;jt.default=Zc});var qp=g(h=>{"use strict";var y=h&&h.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(h,"__esModule",{value:!0});h.DefaultEventController=h.DefaultDevicePixelRatioMonitor=h.DefaultDeviceController=h.DefaultContentShareController=h.DefaultBrowserBehavior=h.DefaultAudioVideoFacade=h.DefaultAudioVideoController=h.DefaultAudioMixController=h.DefaultActiveSpeakerPolicy=h.DefaultActiveSpeakerDetector=h.DataMessage=h.CreateSDPTask=h.CreatePeerConnectionTask=h.ContentShareMediaStreamBroker=h.ContentShareConstants=h.ConsoleLogger=h.ConnectionHealthPolicyConfiguration=h.ConnectionHealthData=h.ClientVideoStreamReceivingReport=h.ClientMetricReportMediaType=h.ClientMetricReportDirection=h.ClientMetricReport=h.CleanStoppedSessionTask=h.CleanRestartedSessionTask=h.CheckVideoInputFeedback=h.CheckVideoConnectivityFeedback=h.CheckNetworkUDPConnectivityFeedback=h.CheckNetworkTCPConnectivityFeedback=h.CheckContentShareConnectivityFeedback=h.CheckCameraResolutionFeedback=h.CheckAudioOutputFeedback=h.CheckAudioInputFeedback=h.CheckAudioConnectivityFeedback=h.CanvasVideoFrameBuffer=h.CSPMonitor=h.BitrateParameters=h.BaseTask=h.BaseConnectionHealthPolicy=h.BackgroundReplacementVideoFrameProcessor=h.BackgroundFilterVideoFrameProcessor=h.BackgroundBlurVideoFrameProcessor=h.BackgroundBlurStrength=h.AudioVideoControllerState=h.AudioProfile=h.AudioLogEvent=h.Attendee=h.AttachMediaInputTask=h.AsyncScheduler=h.ApplicationMetadata=h.AllHighestVideoBandwidthPolicy=void 0;h.MeetingFeatures=h.MeetingEventsClientConfiguration=h.MediaDeviceProxyHandler=h.Maybe=h.LogLevel=h.Log=h.ListenForVolumeIndicatorsTask=h.LeaveAndReceiveLeaveAckTask=h.JoinAndReceiveIndexTask=h.IntervalScheduler=h.InMemoryJSONEventBuffer=h.GlobalMetricReport=h.GetUserMediaError=h.FullJitterLimitedBackoff=h.FullJitterBackoffFactory=h.FullJitterBackoff=h.FinishGatheringICECandidatesTask=h.EventIngestionConfiguration=h.EventBufferConfiguration=h.DeviceSelection=h.DevicePixelRatioWindowSource=h.DefaultWebSocketAdapter=h.DefaultVolumeIndicatorAdapter=h.DefaultVideoTransformDevice=h.DefaultVideoTileFactory=h.DefaultVideoTileController=h.DefaultVideoTile=h.DefaultVideoStreamIndex=h.DefaultVideoStreamIdSet=h.DefaultVideoFrameProcessorTimer=h.DefaultVideoFrameProcessorPipeline=h.DefaultVideoElementResolutionMonitor=h.DefaultVideoCaptureAndEncodeParameter=h.DefaultUserAgentParser=h.DefaultTranscriptionController=h.DefaultTransceiverController=h.DefaultSimulcastUplinkPolicyForContentShare=h.DefaultSimulcastUplinkPolicy=h.DefaultSignalingClient=h.DefaultSigV4=h.DefaultSessionStateController=h.DefaultReconnectController=h.DefaultRealtimeController=h.DefaultPingPong=h.DefaultModality=h.DefaultMessagingSession=h.DefaultMeetingSession=h.DefaultMeetingReadinessChecker=h.DefaultMeetingEventReporter=h.DefaultMediaDeviceFactory=void 0;h.RedundantAudioEncoder=h.ReconnectionHealthPolicy=h.ReceiveVideoStreamIndexTask=h.ReceiveVideoInputTask=h.ReceiveRemoteVideoPauseResumeTask=h.ReceiveAudioInputTask=h.RealtimeVolumeIndicator=h.RealtimeState=h.RealtimeAttendeePositionInFrame=h.PromoteToPrimaryMeetingTask=h.PromiseQueue=h.PrefetchSortBy=h.PrefetchOn=h.PermissionDeniedError=h.ParallelGroupTask=h.POSTLogger=h.OverconstrainedError=h.OpenSignalingConnectionTask=h.OnceTask=h.NotReadableError=h.NotFoundError=h.None=h.NoVideoUplinkBandwidthPolicy=h.NoVideoDownlinkBandwidthPolicy=h.NoOpVideoFrameProcessor=h.NoOpVideoElementFactory=h.NoOpTask=h.NoOpMediaStreamBroker=h.NoOpLogger=h.NoOpEventReporter=h.NoOpDeviceController=h.NoOpDebugLogger=h.NoOpAudioVideoController=h.NScaleVideoUplinkBandwidthPolicy=h.MutableVideoPreferences=h.MultiLogger=h.MonitorTask=h.ModelSpecBuilder=h.MessagingSessionConfiguration=h.Message=h.MeetingSessionVideoAvailability=h.MeetingSessionURLs=h.MeetingSessionTURNCredentials=h.MeetingSessionStatusCode=h.MeetingSessionStatus=h.MeetingSessionLifecycleEventCondition=h.MeetingSessionLifecycleEvent=h.MeetingSessionCredentials=h.MeetingSessionConfiguration=h.MeetingReadinessCheckerConfiguration=void 0;h.VideoEncodingConcurrentSendersHealthPolicy=h.VideoCodecCapability=h.VideoAdaptiveProbePolicy=h.Versioning=h.UnusableAudioWarningConnectionHealthPolicy=h.TypeError=h.TranscriptionStatusType=h.TranscriptionStatus=h.TranscriptResult=h.TranscriptLanguageWithScore=h.TranscriptItemType=h.TranscriptItem=h.TranscriptEntity=h.TranscriptAlternative=h.Transcript=h.TimeoutTask=h.TimeoutScheduler=h.TaskStatus=h.TargetDisplaySize=h.SubscribeAndReceiveSubscribeAckTask=h.StreamMetricReport=h.Some=h.SingleNodeAudioTransformDevice=h.SimulcastVideoStreamIndex=h.SimulcastTransceiverController=h.SimulcastLayers=h.SimulcastContentShareTransceiverController=h.SignalingClientVideoSubscriptionConfiguration=h.SignalingClientSubscribe=h.SignalingClientJoin=h.SignalingClientEventType=h.SignalingClientEvent=h.SignalingClientConnectionRequest=h.SignalingAndMetricsConnectionMonitor=h.SetRemoteDescriptionTask=h.SetLocalDescriptionTask=h.SessionStateControllerTransitionResult=h.SessionStateControllerState=h.SessionStateControllerDeferPriority=h.SessionStateControllerAction=h.ServerSideNetworkAdaption=h.SerialGroupTask=h.SendingAudioFailureConnectionHealthPolicy=h.SendAndReceiveDataMessagesTask=h.SDPMediaSection=h.SDPCandidateType=h.SDP=h.RunnableTask=h.RedundantAudioRecoveryMetricReport=h.RedundantAudioEncoderWorkerCode=void 0;h.isVideoTransformDevice=h.isDestroyable=h.isAudioTransformDevice=h.ZLIBTextCompressor=h.WebSocketReadyState=h.WaitForAttendeePresenceTask=h.VoiceFocusTransformDevice=h.VoiceFocusDeviceTransformer=h.VideoTileState=h.VideoStreamDescription=h.VideoSource=h.VideoQualitySettings=h.VideoQualityAdaptationPreference=h.VideoPriorityBasedPolicyConfig=h.VideoPriorityBasedPolicy=h.VideoPreferences=h.VideoPreference=h.VideoOnlyTransceiverController=h.VideoLogEvent=h.VideoFxProcessor=h.VideoEncodingFramerateConnectionHealthPolicy=h.VideoEncodingCpuConnectionHealthPolicy=h.VideoEncodingConnectionHealthPolicyName=void 0;var gN=y($a());h.AllHighestVideoBandwidthPolicy=gN.default;var vN=y(Py());h.ApplicationMetadata=vN.default;var SN=y(Ve());h.AsyncScheduler=SN.default;var yN=y(Tl());h.AttachMediaInputTask=yN.default;var bN=y(Cl());h.Attendee=bN.default;var _N=y(Ja());h.AudioLogEvent=_N.default;var wN=y(Za());h.AudioProfile=wN.default;var TN=y(Pl());h.AudioVideoControllerState=TN.default;var kN=y(wo());h.BackgroundBlurStrength=kN.default;var IN=y(fb());h.BackgroundBlurVideoFrameProcessor=IN.default;var CN=y(id());h.BackgroundFilterVideoFrameProcessor=CN.default;var ON=y(vb());h.BackgroundReplacementVideoFrameProcessor=ON.default;var EN=y(zt());h.BaseConnectionHealthPolicy=EN.default;var AN=y(Z());h.BaseTask=AN.default;var PN=y(fu());h.BitrateParameters=PN.default;var MN=y(ad());h.CSPMonitor=MN.default;var RN=y(Eo());h.CanvasVideoFrameBuffer=RN.default;var DN=y(pu());h.CheckAudioConnectivityFeedback=DN.default;var xN=y(mu());h.CheckAudioInputFeedback=xN.default;var VN=y(gu());h.CheckAudioOutputFeedback=VN.default;var NN=y(vu());h.CheckCameraResolutionFeedback=NN.default;var LN=y(Su());h.CheckContentShareConnectivityFeedback=LN.default;var BN=y(yu());h.CheckNetworkTCPConnectivityFeedback=BN.default;var FN=y(bu());h.CheckNetworkUDPConnectivityFeedback=FN.default;var UN=y(_u());h.CheckVideoConnectivityFeedback=UN.default;var qN=y(wu());h.CheckVideoInputFeedback=qN.default;var HN=y(ku());h.CleanRestartedSessionTask=HN.default;var jN=y(Cu());h.CleanStoppedSessionTask=jN.default;var WN=y(zu());h.ClientMetricReport=WN.default;var zN=y(fr());h.ClientMetricReportDirection=zN.default;var $N=y(pr());h.ClientMetricReportMediaType=$N.default;var KN=y(A_());h.ClientVideoStreamReceivingReport=KN.default;var GN=y(Qu());h.ConnectionHealthData=GN.default;var JN=y(sf());h.ConnectionHealthPolicyConfiguration=JN.default;var QN=y(nd());h.ConsoleLogger=QN.default;var XN=y(vr());h.ContentShareConstants=XN.default;var ZN=y($f());h.ContentShareMediaStreamBroker=ZN.default;var YN=y(Kf());h.CreatePeerConnectionTask=YN.default;var eL=y(nh());h.CreateSDPTask=eL.default;var tL=y(sh());h.DataMessage=tL.default;var iL=y(dh());h.DefaultActiveSpeakerDetector=iL.default;var nL=y(tw());h.DefaultActiveSpeakerPolicy=nL.default;var rL=y(kd());h.DefaultAudioMixController=rL.default;var oL=y(mc());h.DefaultAudioVideoController=oL.default;var sL=y(Xg());h.DefaultAudioVideoFacade=sL.default;var aL=y(pe());h.DefaultBrowserBehavior=aL.default;var dL=y(fv());h.DefaultContentShareController=dL.default;var cL=y(bd());h.DefaultDeviceController=cL.default;var lL=y(Ig());h.DefaultDevicePixelRatioMonitor=lL.default;var uL=y(wc());h.DefaultEventController=uL.default;var fL=y(hf());h.DefaultMediaDeviceFactory=fL.default;var hL=y(kv());h.DefaultMeetingEventReporter=hL.default;var pL=y(nk());h.DefaultMeetingReadinessChecker=pL.default;var mL=y(lk());h.DefaultMeetingSession=mL.default;var gL=y(kk());h.DefaultMessagingSession=gL.default;var vL=y(Xt());h.DefaultModality=vL.default;var SL=y(bh());h.DefaultPingPong=SL.default;var yL=y(zh());h.DefaultRealtimeController=yL.default;var bL=y(wa());h.DefaultReconnectController=bL.default;var _L=y(Jh());h.DefaultSessionStateController=_L.default;var wL=y(nS());h.DefaultSigV4=wL.default;var TL=y(Yh());h.DefaultSignalingClient=TL.default;var kL=y(Ug());h.DefaultSimulcastUplinkPolicy=kL.default;var IL=y(dv());h.DefaultSimulcastUplinkPolicyForContentShare=IL.default;var CL=y(js());h.DefaultTransceiverController=CL.default;var OL=y(Vh());h.DefaultTranscriptionController=OL.default;var EL=y(bv());h.DefaultUserAgentParser=EL.default;var AL=y($r());h.DefaultVideoCaptureAndEncodeParameter=AL.default;var PL=y(Mg());h.DefaultVideoElementResolutionMonitor=PL.default;var ML=y(_f());h.DefaultVideoFrameProcessorPipeline=ML.default;var RL=y(Sf());h.DefaultVideoFrameProcessorTimer=RL.default;var DL=y(_i());h.DefaultVideoStreamIdSet=DL.default;var xL=y(cc());h.DefaultVideoStreamIndex=xL.default;var VL=y($o());h.DefaultVideoTile=VL.default;var NL=y(Dg());h.DefaultVideoTileController=NL.default;var LL=y(Vg());h.DefaultVideoTileFactory=LL.default;var BL=y(kf());h.DefaultVideoTransformDevice=BL.default;var FL=y(Wg());h.DefaultVolumeIndicatorAdapter=FL.default;var UL=y(ka());h.DefaultWebSocketAdapter=UL.default;var qL=y(Eg());h.DevicePixelRatioWindowSource=qL.default;var HL=y(Df());h.DeviceSelection=HL.default;var jL=y(mv());h.EventBufferConfiguration=jL.default;var WL=y(vv());h.EventIngestionConfiguration=WL.default;var zL=y(lp());h.FinishGatheringICECandidatesTask=zL.default;var $L=y(Si());h.FullJitterBackoff=$L.default;var KL=y(Ck());h.FullJitterBackoffFactory=KL.default;var GL=y(lS());h.FullJitterLimitedBackoff=GL.default;var JL=y(Zt());h.GetUserMediaError=JL.default;var QL=y(Hu());h.GlobalMetricReport=QL.default;var XL=y(wv());h.InMemoryJSONEventBuffer=XL.default;var ZL=y(Jt());h.IntervalScheduler=ZL.default;var YL=y(vp());h.JoinAndReceiveIndexTask=YL.default;var eB=y(yp());h.LeaveAndReceiveLeaveAckTask=eB.default;var tB=y(_p());h.ListenForVolumeIndicatorsTask=tB.default;var iB=y(pS());h.Log=iB.default;var nB=y(Ge());h.LogLevel=nB.default;var rB=y(uf());h.MediaDeviceProxyHandler=rB.default;var oB=y(Ov());h.MeetingEventsClientConfiguration=oB.default;var sB=y(Yg());h.MeetingFeatures=sB.default;var aB=y(Rv());h.MeetingReadinessCheckerConfiguration=aB.default;var dB=y(vc());h.MeetingSessionConfiguration=dB.default;var cB=y(la());h.MeetingSessionCredentials=cB.default;var lB=y(ap());h.MeetingSessionLifecycleEvent=lB.default;var uB=y(dp());h.MeetingSessionLifecycleEventCondition=uB.default;var fB=y(Gi());h.MeetingSessionStatus=fB.default;var hB=y(tt());h.MeetingSessionStatusCode=hB.default;var pB=y(hp());h.MeetingSessionTURNCredentials=pB.default;var mB=y(gc());h.MeetingSessionURLs=mB.default;var gB=y(Id());h.MeetingSessionVideoAvailability=gB.default;var vB=y(zv());h.Message=vB.default;var SB=y(Ok());h.MessagingSessionConfiguration=SB.default;var yB=y(Dl());h.ModelSpecBuilder=yB.default;var bB=y(Pp());h.MonitorTask=bB.default;var _B=y(Ek());h.MultiLogger=_B.default;var wB=y(Hg());h.NScaleVideoUplinkBandwidthPolicy=wB.default;var TB=y(Rk());h.NoOpAudioVideoController=TB.default;var kB=y(bS());h.NoOpDebugLogger=kB.default;var IB=y(xk());h.NoOpDeviceController=IB.default;var CB=y(Vk());h.NoOpEventReporter=CB.default;var OB=y(Vc());h.NoOpLogger=OB.default;var EB=y(Nc());h.NoOpMediaStreamBroker=EB.default;var AB=y(Nk());h.NoOpTask=AB.default;var PB=y(Lk());h.NoOpVideoElementFactory=PB.default;var MB=y(rd());h.NoOpVideoFrameProcessor=MB.default;var RB=y(sv());h.NoVideoDownlinkBandwidthPolicy=RB.default;var DB=y(Bk());h.NoVideoUplinkBandwidthPolicy=DB.default;var xB=y(Lf());h.NotFoundError=xB.default;var VB=y(Ff());h.NotReadableError=VB.default;var NB=y(Sl());h.OnceTask=NB.default;var LB=y(Np());h.OpenSignalingConnectionTask=LB.default;var BB=y(qf());h.OverconstrainedError=BB.default;var FB=y(Uk());h.POSTLogger=FB.default;var UB=y(Bp());h.ParallelGroupTask=UB.default;var qB=y(gd());h.PermissionDeniedError=qB.default;var HB=y(sS());h.PrefetchOn=HB.default;var jB=y(qk());h.PrefetchSortBy=jB.default;var WB=y(gf());h.PromiseQueue=WB.default;var zB=y(Up());h.PromoteToPrimaryMeetingTask=zB.default;var $B=y(Hk());h.RealtimeAttendeePositionInFrame=$B.default;var KB=y(Fh());h.RealtimeState=KB.default;var GB=y(Hh());h.RealtimeVolumeIndicator=GB.default;var JB=y(jp());h.ReceiveAudioInputTask=JB.default;var QB=y(zp());h.ReceiveRemoteVideoPauseResumeTask=QB.default;var XB=y(Kp());h.ReceiveVideoInputTask=XB.default;var ZB=y(Qp());h.ReceiveVideoStreamIndexTask=ZB.default;var YB=y(Tp());h.ReconnectionHealthPolicy=YB.default;var eF=y(sg());h.RedundantAudioEncoder=eF.default;var tF=y(dg());h.RedundantAudioEncoderWorkerCode=tF.default;var iF=y(Dd());h.RedundantAudioRecoveryMetricReport=iF.default;var nF=y(jk());h.RunnableTask=nF.default;var rF=y(Wi());h.SDP=rF.default;var oF=y(Gf());h.SDPCandidateType=oF.default;var sF=y(Xf());h.SDPMediaSection=sF.default;var aF=y(Yp());h.SendAndReceiveDataMessagesTask=aF.default;var dF=y(Ip());h.SendingAudioFailureConnectionHealthPolicy=dF.default;var cF=y(tm());h.SerialGroupTask=cF.default;var lF=y(ht());h.ServerSideNetworkAdaption=lF.default;var uF=y(Ed());h.SessionStateControllerAction=uF.default;var fF=y($h());h.SessionStateControllerDeferPriority=fF.default;var hF=y(Ad());h.SessionStateControllerState=hF.default;var pF=y(Pd());h.SessionStateControllerTransitionResult=pF.default;var mF=y(rm());h.SetLocalDescriptionTask=mF.default;var gF=y(sm());h.SetRemoteDescriptionTask=gF.default;var vF=y(ph());h.SignalingAndMetricsConnectionMonitor=vF.default;var SF=y(Dp());h.SignalingClientConnectionRequest=SF.default;var yF=y(Xh());h.SignalingClientEvent=yF.default;var bF=y(me());h.SignalingClientEventType=bF.default;var _F=y(mp());h.SignalingClientJoin=_F.default;var wF=y(Zm());h.SignalingClientSubscribe=wF.default;var TF=y(Rd());h.SignalingClientVideoSubscriptionConfiguration=TF.default;var kF=y(ic());h.SimulcastContentShareTransceiverController=kF.default;var IF=y(Ng());h.SimulcastLayers=IF.default;var CF=y(Ws());h.SimulcastTransceiverController=CF.default;var OF=y(Tg());h.SimulcastVideoStreamIndex=OF.default;var EF=y(Wk());h.SingleNodeAudioTransformDevice=EF.default;var AF=y(sp());h.StreamMetricReport=AF.default;var PF=y(tg());h.SubscribeAndReceiveSubscribeAckTask=PF.default;var MF=y(nc());h.TargetDisplaySize=MF.default;var RF=y(Ga());h.TaskStatus=RF.default;var DF=y(Qn());h.TimeoutScheduler=DF.default;var xF=y(tc());h.TimeoutTask=xF.default;var VF=y(Th());h.Transcript=VF.default;var NF=y(zk());h.TranscriptAlternative=NF.default;var LF=y($k());h.TranscriptEntity=LF.default;var BF=y(Kk());h.TranscriptItem=BF.default;var FF=y(Rh());h.TranscriptItemType=FF.default;var UF=y(Gk());h.TranscriptLanguageWithScore=UF.default;var qF=y(Jk());h.TranscriptResult=qF.default;var HF=y(Ch());h.TranscriptionStatus=HF.default;var jF=y(Ah());h.TranscriptionStatusType=jF.default;var WF=y(Wf());h.TypeError=WF.default;var zF=y(Op());h.UnusableAudioWarningConnectionHealthPolicy=zF.default;var $F=y(Je());h.Versioning=$F.default;var KF=y(yg());h.VideoAdaptiveProbePolicy=KF.default;var GF=y(ji());h.VideoCodecCapability=GF.default;var JF=y(Zu());h.VideoEncodingConcurrentSendersHealthPolicy=JF.default;var QF=y(gr());h.VideoEncodingConnectionHealthPolicyName=QF.default;var XF=y(ef());h.VideoEncodingCpuConnectionHealthPolicy=XF.default;var ZF=y(nf());h.VideoEncodingFramerateConnectionHealthPolicy=ZF.default;var YF=y(nI());h.VideoFxProcessor=YF.default;var e2=y(Ka());h.VideoLogEvent=e2.default;var t2=y(ug());h.VideoOnlyTransceiverController=t2.default;var i2=y(rc());h.VideoPreference=i2.default;var n2=y(Tn());h.VideoPreferences=n2.default;var r2=y(vg());h.VideoPriorityBasedPolicy=r2.default;var o2=y(oc());h.VideoPriorityBasedPolicyConfig=o2.default;var s2=y(os());h.VideoQualityAdaptationPreference=s2.default;var a2=y(Pt());h.VideoQualitySettings=a2.default;var d2=y(gg());h.VideoSource=d2.default;var c2=y(sc());h.VideoStreamDescription=c2.default;var l2=y(Of());h.VideoTileState=l2.default;var u2=y(_I());h.VoiceFocusDeviceTransformer=u2.default;var f2=y(ly());h.VoiceFocusTransformDevice=f2.default;var h2=y(rg());h.WaitForAttendeePresenceTask=h2.default;var p2=y(ss());h.WebSocketReadyState=p2.default;var m2=y(Jm());h.ZLIBTextCompressor=m2.default;var g2=Tn();Object.defineProperty(h,"MutableVideoPreferences",{enumerable:!0,get:function(){return g2.MutableVideoPreferences}});var my=Le();Object.defineProperty(h,"Some",{enumerable:!0,get:function(){return my.Some}});Object.defineProperty(h,"None",{enumerable:!0,get:function(){return my.None}});Object.defineProperty(h,"Maybe",{enumerable:!0,get:function(){return my.Maybe}});var v2=Pf();Object.defineProperty(h,"isAudioTransformDevice",{enumerable:!0,get:function(){return v2.isAudioTransformDevice}});var S2=ma();Object.defineProperty(h,"isDestroyable",{enumerable:!0,get:function(){return S2.isDestroyable}});var y2=Sd();Object.defineProperty(h,"isVideoTransformDevice",{enumerable:!0,get:function(){return y2.isVideoTransformDevice}})});var b2=DI(qp());window.ChimeSDK=b2;})();
/*! Bundled license information:

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
